<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 08:20:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK","wgTitle":"Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK","wgCurRevisionId":211082,"wgRevisionId":211082,"wgArticleId":37701,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Bluetooth / Bluetooth Low Energy","Pages with broken file links","Template examples"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK","wgRelevantArticleId":37701,"wgRequestId":"724816e389a8b42d7573e7c7","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->

                    <script>var w=window;if(w.performance||w.mozPerformance||w.msPerformance||w.webkitPerformance){var d=document;AKSB=w.AKSB||{},AKSB.q=AKSB.q||[],AKSB.mark=AKSB.mark||function(e,_){AKSB.q.push(["mark",e,_||(new Date).getTime()])},AKSB.measure=AKSB.measure||function(e,_,t){AKSB.q.push(["measure",e,_,t||(new Date).getTime()])},AKSB.done=AKSB.done||function(e){AKSB.q.push(["done",e])},AKSB.mark("firstbyte",(new Date).getTime()),AKSB.prof={custid:"295384",ustr:"",originlat:"0",clientrtt:"186",ghostip:"23.11.215.94",ipv6:false,pct:"10",clientip:"163.125.46.158",requestid:"1742f2be",region:"26813",protocol:"",blver:14,akM:"g",akN:"ae",akTT:"O",akTX:"1",akTI:"1742f2be",ai:"181835",ra:"false",pmgn:"",pmgi:"",pmp:"",qc:""},function(e){var _=d.createElement("script");_.async="async",_.src=e;var t=d.getElementsByTagName("script"),t=t[t.length-1];t.parentNode.insertBefore(_,t)}(("https:"===d.location.protocol?"https:":"http:")+"//ds-aksb-a.akamaihd.net/aksb.min.js")}</script>
                    </head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Tutorial_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK rootpage-Tutorial_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div style="padding:0px; border: 5px solid Red"> 
<div style="padding:0px; border: 5px solid Black"> 
<div style="padding:0px; border: 5px solid Orange"> 
<div style="padding:0px; border: 5px solid Black"> 
<div style="padding:0px; border: 5px solid Red"> 
<center><b>This guide is deprecated and is superceded by the new SimpleLink Academy Training modules in Code Composer Studio (resource explorer). Follow the link below for more information.</b></center>
<center><b> <a rel="nofollow" class="external text" href="https://e2e.ti.com/support/wireless_connectivity/f/538/t/448001">SimpleLink Academy Info</a> </b></center>
<center style="color:Blue">  </center>
</div></div></div></div></div>
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Bluetooth.C2.AE_Developer_Studio"><span class="tocnumber">1.1</span> <span class="toctext">Bluetooth® Developer Studio</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#Prerequisites"><span class="tocnumber">2</span> <span class="toctext">Prerequisites</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Hardware"><span class="tocnumber">2.1</span> <span class="toctext">Hardware</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Software"><span class="tocnumber">2.2</span> <span class="toctext">Software</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Getting_Started"><span class="tocnumber">3</span> <span class="toctext">Getting Started</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Installing_and_setting_up_the_software_environment"><span class="tocnumber">3.1</span> <span class="toctext">Installing and setting up the software environment</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Application_and_project_overview"><span class="tocnumber">3.2</span> <span class="toctext">Application and project overview</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Compile_.26_Download_to_Device"><span class="tocnumber">3.3</span> <span class="toctext">Compile &amp; Download to Device</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Tutorial_Step_0:_Create_Custom_Profile.2C_Service_and_Application"><span class="tocnumber">4</span> <span class="toctext">Tutorial Step 0: Create Custom Profile, Service and Application</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Custom_Profile.2FService"><span class="tocnumber">4.1</span> <span class="toctext">Custom Profile/Service</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#UUID"><span class="tocnumber">4.1.1</span> <span class="toctext">UUID</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="#The_Sunlight_Profile_.28Custom.29"><span class="tocnumber">4.2</span> <span class="toctext">The Sunlight Profile (Custom)</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#The_Sunlight_Service_.28Custom.29"><span class="tocnumber">4.3</span> <span class="toctext">The Sunlight Service (Custom)</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#The_sunlightSensor_Application"><span class="tocnumber">4.4</span> <span class="toctext">The sunlightSensor Application</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#Tutorial_Step_1:_Set_up_Project_Settings.2C_File_and_Folder_Structure"><span class="tocnumber">5</span> <span class="toctext">Tutorial Step 1: Set up Project Settings, File and Folder Structure</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Step_by_Step_Start"><span class="tocnumber">5.1</span> <span class="toctext">Step by Step Start</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#Tutorial_Step_2:_Edit_Application_Source_Code"><span class="tocnumber">6</span> <span class="toctext">Tutorial Step 2: Edit Application Source Code</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#Edit_main.c"><span class="tocnumber">6.1</span> <span class="toctext">Edit main.c</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Edit_sunlightservice.h"><span class="tocnumber">6.2</span> <span class="toctext">Edit sunlightservice.h</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Edit_sunlightservice.c"><span class="tocnumber">6.3</span> <span class="toctext">Edit sunlightservice.c</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Edit_sunlightSensor.h"><span class="tocnumber">6.4</span> <span class="toctext">Edit sunlightSensor.h</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Edit_sunlightSensor.c"><span class="tocnumber">6.5</span> <span class="toctext">Edit sunlightSensor.c</span></a>
<ul>
<li class="toclevel-3 tocsection-24"><a href="#Button_Push_Functionality"><span class="tocnumber">6.5.1</span> <span class="toctext">Button Push Functionality</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#Edit_devinfoservice.c_.28Optional.29"><span class="tocnumber">6.6</span> <span class="toctext">Edit devinfoservice.c (Optional)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-26"><a href="#Tutorial_Step_3:_Compile.2C_Download_and_Debug_Project"><span class="tocnumber">7</span> <span class="toctext">Tutorial Step 3: Compile, Download and Debug Project</span></a></li>
<li class="toclevel-1 tocsection-27"><a href="#Tutorial_Step_4:_Verify_Application_Behavior_with_BTool"><span class="tocnumber">8</span> <span class="toctext">Tutorial Step 4: Verify Application Behavior with BTool</span></a>
<ul>
<li class="toclevel-2 tocsection-28"><a href="#Start_the_SunlighSensor_Application"><span class="tocnumber">8.1</span> <span class="toctext">Start the SunlighSensor Application</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Setup_BTool"><span class="tocnumber">8.2</span> <span class="toctext">Setup BTool</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Connect_with_BTool"><span class="tocnumber">8.3</span> <span class="toctext">Connect with BTool</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#Enable_Notifications"><span class="tocnumber">8.4</span> <span class="toctext">Enable Notifications</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=1" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<table width="1000px">
<tbody><tr><td>
<p>This guide is for use with the IAR Embedded Workbench IDE. For the Code Composer Guide go here:
<a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK_(CCS)&amp;action=edit&amp;redlink=1" class="new" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK (CCS) (page does not exist)">Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK (CCS)</a>
</p><p>This is a highly detailed step by step guide on how to create your own custom BLE profile and run it on the CC2650 device. This tutorial will take about 1 hour to complete and requires very little knowledge except some basic familiarity with embedded programming (see more details in <a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Prerequisites" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> Prerequisites</a>). We will define our own custom profile ( the sunlight profile ) and modify the application source code in the SimpleBLEPeripheral project to include the required services and modify the behavior according to our own specification. This page is divided into all the steps required from the very beginning on just how to get the development tools up and running up to the end when you will verify the correct behavior of your application.
</p>
<div style="padding:5px; border: 4px solid Red"> 
<center><b>Compatible with BLE-STACK V2</b></center>
<center> ble_cc26xx_setupwin32_2_00_00_42893 installer (February, 2015)</center> 
</div>
</td></tr></tbody></table>
<p>NOTE:<br />
<i>Currently Guide refers to the use of IAR EMbedded Workbench, but guide for Code Composer Studio will be added in the next version</i>.
</p>
<h2><span id="Bluetooth®_Developer_Studio"></span><span class="mw-headline" id="Bluetooth.C2.AE_Developer_Studio">Bluetooth® Developer Studio</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=2" title="Edit section: Bluetooth® Developer Studio">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>There is a new tool from Bluetooth SIG called Bluetooth® Developer Studio. This is a graphical, GATT-based application development and debugging tool to help developers cut their education time. This will automatically generate the service source files which you have to create manually in this guide. If you just want to get quickly started with implementing your custom service, check out the <a rel="nofollow" class="external text" href="http://www.bluetooth.com/SiteCollectionDocuments/developer-studio/bluetooth-developer-studio.aspx">Bluetooth® Developer Studio Home Page</a>. You will need to install the <a rel="nofollow" class="external text" href="https://developer.bluetooth.org/DevelopmentResources/Pages/Developer-Studio-Plugins.aspx">Bluetooth® Developer Studio Texas Instruments Plugins</a> to use it with the CC26xx parts.
</p>
<h1><span class="mw-headline" id="Prerequisites">Prerequisites</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=3" title="Edit section: Prerequisites">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<table width="1000px">
<tbody><tr><td>
<p>In this chapter the required hardware and software is listed in separate sub chapters. It can be useful to have a little knowledge on Bluetooth Low Energy, Embedded programming and TI-RTOS (Real Time Operating System). Please Consider looking at some of the documentation that comes with the BLE stack installer. 
</p><p>If you comply with the following criterias you are good to go!
</p>
<ol><li>Basic knowledge of Bluetooth Low Energy.</li>
<li>Basic C-programming knowledge.</li>
<li>Basic knowledge of IAR Embedded workbench for ARM.</li>
<li>1-2 Hours available to complete this tutorial.</li></ol>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="Hardware">Hardware</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=4" title="Edit section: Hardware">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>The following hardware is required to complete this guide all of which can be found in the CC2650 Development kit (CC2650DK): 
</p>
<ol>
<li>CC2650EM (7X7) </li>
<li>SmartRF06EB (PCB v1.2 or later) </li>
<li>Micro USB cable </li>
<li>Computer with at least two available USB ports</li>
</ol>
<div class="thumb tnone"><div class="thumbinner" style="width:502px;"><a href="File_CC26xxDK.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/f/fd/CC26xxDK.jpg" width="500" height="308" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="File_CC26xxDK.html" class="internal" title="Enlarge"></a></div>CC26xx Development Kit Content</div></div></div>
<p>The Evaluation Modules (EM) have a on-board PCB antenna meaning that you do not need any external antenna attached. Just plug the EM on the Evaluation Board (EB), plug in a micro-USB cable from your computer to the EB and turn it on.
</p>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Software">Software</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=5" title="Edit section: Software">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<ol>
<li>IAR Embedded Workbench for ARM (version 7.40.1 or later)</li>
<li>BLE SDK 2.0 Stack Installer   (<a rel="nofollow" class="external free" href="http://www.ti.com/tool/ble-stack">http://www.ti.com/tool/ble-stack</a>)</li>
<li>BTool (Will be installed by the BLE SDK Installer)</li>
<dl><dd>Section 4 ("Using BTool") in the <a rel="nofollow" class="external text" href="http://www.ti.com/lit/ug/swru301a/swru301a.pdf">CC2541 Evaluation Module Kit User’s Guide</a> describes how to use BTool in General. There will also be a very brief guide at the end of this page showing you all you need to know to complete this tutorial.</dd></dl>
</ol>
</td></tr></tbody></table>
<p><br />
</p>
<h1><span class="mw-headline" id="Getting_Started">Getting Started</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=6" title="Edit section: Getting Started">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>This chapter will guide you trough setting up all the required equipment and software
</p><p><br />
</p>
<h2><span class="mw-headline" id="Installing_and_setting_up_the_software_environment">Installing and setting up the software environment</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=7" title="Edit section: Installing and setting up the software environment">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="800px">
<tbody><tr><td>
<ol><li>Install IAR EW ARM version 7.40.1</li>
<li>Install TI emupack
<ol><li>Run the emupack installer found in the IAR installation: &lt;iar_install&gt;\arm\drivers\ti-xds</li>
<li>Install it to the default location</li></ol></li>
<li>Run the <a rel="nofollow" class="external text" href="http://www.ti.com/tool/ble-stack">BLE-STACK-2 Installer</a>
<ol><li>Install it to the default location (C:\ti\simplelink\.)</li></ol></li></ol>
<p>In the installed directory you will find the following folders:
</p>
<ul><li><b>Accessories:</b> Installer for BTool and Boundary tool as well as hex files.</li>
<li><b>Components:</b> source files, headers, and library headers which are shared among the BLE projects</li>
<li><b>Documents:</b> Several important user guides with relevant info for developers</li>
<li><b>Projects:</b> the projects which are currently supported.</li></ul>
<p>After you install the stack, the USB drivers should automatically be associated with the debugger and CC2650 device when the SmartRF06EB it is connected to your USB port through a micro USB cable.
</p><p><b>Known issues:</b>
</p>
<ul><li>none</li></ul>
<p><b>Known warnings:</b>
</p>
<ul><li>When you download the stack, you may get 2 pop-up warnings, which you can safely ignore.</li></ul>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Application_and_project_overview">Application and project overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=8" title="Edit section: Application and project overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<div class="floatright"><a href="File_SelectProject.html" class="image" title="selectProject.png"><img alt="selectProject.png" src="https://processors.wiki.ti.com/images/e/e9/SelectProject.png" width="200" height="264" /></a></div>
<p>The SimpleBLEPeripheral project can be found here: 
<b>Projects\ble\SimpleBLEPeripheral\CC26xx\IAR\SimpleBLEPeripheral.eww</b><br />
The SimpleBLEPeripheral project implements a very simple BLE peripheral device (GATT server) with GATT services. This project can be used as a framework for developing many different peripheral-role applications. More information on the general software architecture for this project can be found in the software developer's Guide at \Documents\TI_BLE_Software_Developer’s_Guide.pdf.<br />
The SimpleBLEPeripheral project is composed of 2 IAR Projects grouped into one workspace. These two projects are the <b>CC2650App</b> and the <b>CC2650Stack</b> and can be selected by right click at the project and select "Set Active" (You need to debug from workspace showing both <i>Application</i> and <i>Stack</i>, i.e. do not open Application Project only):
</p>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h2><span id="Compile_&amp;_Download_to_Device"></span><span class="mw-headline" id="Compile_.26_Download_to_Device">Compile &amp; Download to Device</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=9" title="Edit section: Compile &amp; Download to Device">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<div class="floatright"><a href="File_DWarning.html" class="image" title="dWarning.png"><img alt="dWarning.png" src="https://processors.wiki.ti.com/images/e/eb/DWarning.png" width="400" height="181" /></a></div>
<p>The steps to load the project onto a CC2650 are as follows:
</p>
<ol><li>Compile the <b>CC2650App</b> project. <br /></li></ol>
<dl><dd>The first time you run the compiler or do a rebuild, the pre-build command will take quite a long time (minutes) as it is building the TI-RTOS kernel which is used in the project.</dd></dl>
<ol><li>Compile the <b>CC2650Stack</b> project.</li>
<li>Download the application project. It is absolutely necessary to load the application project <b>BEFORE</b> the stack project to ensure that there is a safe program flow.</li>
<li>Download the stack project. During the download you may see a warning which is safe to ignore (see image on the right).</li>
<li>Select the CC2650App project and choose “Project -&gt; Debug without Downloading” to begin debugging.</li></ol>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h1><span id="Tutorial_Step_0:_Create_Custom_Profile,_Service_and_Application"></span><span class="mw-headline" id="Tutorial_Step_0:_Create_Custom_Profile.2C_Service_and_Application">Tutorial Step 0: Create Custom Profile, Service and Application</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=10" title="Edit section: Tutorial Step 0: Create Custom Profile, Service and Application">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<table width="1000px">
<tbody><tr><td>
<p>This step only explains the application you will make in this tutorial and does not require any actions besides reading. We will create a new custom profile that contains a new custom service and specification for the sunlightSensor Application that you will make. In case you are already familiar with some of these topics you can see through the list below that present each subchapter in this chapter, explain the content and gives a link to let you skip to the parts you find interesting:
</p>
<ul><li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Custom_Profile.2FService" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> Custom Profile/Service</a></li></ul>
<dl><dd>This subsection will explain what a profile and service is and how they relate to each other.</dd></dl>
<ul><li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#The_Sunlight_Profile_.28Custom.29" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> The Sunlight Profile (Custom)</a></li></ul>
<dl><dd>Explains the custom sunlight profile which is made only for this tutorial as an example with no connection to any real implementation (that the author know of at least).</dd></dl>
<ul><li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#The_Sunlight_Service_.28Custom.29" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> The Sunlight Service (Custom)</a></li></ul>
<dl><dd>This details on of the services that is contained within the sunlight profile.</dd></dl>
<ul><li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#The_sunlightSensor_Application" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> The sunlightSensor Application</a></li></ul>
<dl><dd>Here the specific application that will be implemented is described. This will have a functionality very similar to the simpleBLEPeripheral project and if you have detailed knowledge on the workings of this project you can basically just look at the sunlight profile image overview and characteristics table shown in the chapters below to quickly get an overview of what we will make.</dd></dl>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span id="Custom_Profile/Service"></span><span class="mw-headline" id="Custom_Profile.2FService">Custom Profile/Service</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=11" title="Edit section: Custom Profile/Service">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p><a rel="nofollow" class="external text" href="https://developer.bluetooth.org/AboutUs/Pages/default.aspx">Bluetooth SIG</a> defines profiles as definitions of possible applications and specify general behaviors that Bluetooth enabled devices use to communicate with other Bluetooth devices. The GATT based profiles is used in Bluetooth Low Energy (Bluetooth Smart Devices) and it is possible to define custom profiles that is not adopted by Bluetooth SIG. For a list of the adopted profiles, services and more look <a rel="nofollow" class="external text" href="https://developer.bluetooth.org/TechnologyOverview/Pages/Profiles.aspx#GATT">GATT Based here</a>. Each profile define the total solution by defining the behavior of both ends of the link, The GATT server and GATT client as well as the containing services in the GATT server. In simple terms Bluetooth Low Energy is built around concrete values in a GATT server called attributes. These attributes can be a single byte or an array of many bytes. Several of these attributes constitute a characteristic which can be for example a single byte value where the other attributes in the same characteristic describe if the value can be read or written, give a description of the characteristic in string format and more. A service defines a collection of characteristics and how they are used. A profile defines a collection one or more services and define how services can be used to enable an application or use case. A precise description of GATT, Services, attributes, etc and how they are related to each other <a rel="nofollow" class="external text" href="https://developer.bluetooth.org/TechnologyOverview/Pages/GATT.aspx">here</a>. You can also read more about <a rel="nofollow" class="external text" href="https://developer.bluetooth.org/DevelopmentResources/Pages/Custom-Profile-Development.aspx">​Bluetooth Interoperability and Profiles here</a>.
</p><p>The GATT server basically contain a chunk of memory that the GATT client can access. This data chunk contains attributes where every attribute has a UUID that identifies how to interpret that specific data, a unique handle that identify where the attribute "is" in the attribute table, permissions that define if the GATT client has read or write access and a pointer (within the GATT server memory space) to the actual attribute value or variable. A simple analogy can be text files in a FTP server (File Transfer Protocol, ignore all details related to FTP as it is just used as an example), except that ATT Protocol is optimized to run on Low Energy devices with low throughput. Every text file can be thought of as a characteristic which have some common attributes such as read/write access, address, etc and every file contains strings or data of different or same length. 
</p><p>If we step up one level in the abstraction level from single attributes we get the characteristic. A single characteristic can be a single byte value or an array of several bytes where the attributes within describe the type and permissions. But certain characteristics that contain a configuration attribute can also enable notifications or indications for the characteristic value. Usually the GATT client takes the initiative and the GATT server answers, but with indication and notifications the server will take the initiative of notifying a GATT client that an characteristic value has changed, saving the client from having to poll the value attribute.
</p>
<div class="thumb tnone"><div class="thumbinner" style="width:740px;"><a href="File_Profile_Hierarchy.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/c/c6/Profile_Hierarchy.png" width="738" height="701" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="File_Profile_Hierarchy.html" class="internal" title="Enlarge"></a></div>Profile Hierarchy</div></div></div>
<p>In the image above the generic hierarchy for GATT based profiles can be seen. The profile can be described as a parent of the service, while a service is lower level and defines content within the profile. As a reference look at the <a rel="nofollow" class="external text" href="https://developer.bluetooth.org/TechnologyOverview/Pages/BLP.aspx">Blood Pressure Profile</a> and <a rel="nofollow" class="external text" href="https://developer.bluetooth.org/TechnologyOverview/Pages/BLS.aspx">Blood Pressure Service</a> specifications to get an understanding of definitions and the relationship between the two. The sole building block of this, the ATT protocol, is the attribute. An attribute is composed by three elements:
</p>
<ul><li>A 16-bit handle.</li>
<li>An UUID which defines the attribute type.</li>
<li>A handle that uniquely identify the attribute within a single GATT server.</li>
<li>A pointer to a value of a certain length.</li></ul>
<p>To create a custom profile you basically just need to define a role and service relationship. To create a custom service you need to define a specific GATT attribute table with the required characteristics and how these are used. Also for new characteristics that is not already defined by Bluetooth SIG you need to create new unique 128-bit The Universally Unique identifiers (UUID) for the attributes. The next section will go through this in detail.
</p>
</td></tr></tbody></table>
<p><br />
</p>
<h3><span class="mw-headline" id="UUID">UUID</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=12" title="Edit section: UUID">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<table width="1000px">
<tbody><tr><td>
<p>We need a way to identify all the different attributes that are exposed in a GATT server. The Universally Unique identifier (UUID) is a 128-bit number that uniquely identify every different attribute type. All attribute types that is part of an adopted profile or service, a shorter 16-bit value can be sent between devices and then recombined with the <i>Bluetooth Base UUID</i> (00000000-0000-1000-8000-00805F9B34FB). This reduces the overhead in communication between devices. All short UUID (16 bits) are reserved pending future revisions of the BT services specs. When defining a custom service you usually define new attribute types where you will need to transmit the whole 128-bit value because the GATT client (which for example might reside on your smart phone) does not know about the base UUID for this specific attribute type. This is one of the disadvantage of using custom services as it will increase overhead slightly.
</p><p>In this tutorial we will use the same base UUID as we used in the SensorTag project. (Read more about the detail in the <a rel="nofollow" class="external text" href="SensorTag_User_Guide.html">SensorTag User Guide</a> on our external wiki:
</p>
<ul><li>TI Base 128-bit UUID&#160;: F000-<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">0000</span>-0451-4000-B000-000000000000.</li></ul>
<p>For the different attributes we will define different 16-bit values ( highlighted with <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">green</span> ) that maps into the base UUID. For example:
</p>
<ul><li><span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">0xEE01</span> maps as F000-<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">EE01</span>-0451-4000-B000-000000000000.</li></ul>
<p>If you want to create a random base UUID you can use this Generator:
<a rel="nofollow" class="external free" href="http://www.guidgenerator.com/online-guid-generator.aspx">http://www.guidgenerator.com/online-guid-generator.aspx</a>
But the generator cannot guarantee a unique number.
</p>
</td></tr></tbody></table>
<h2><span id="The_Sunlight_Profile_(Custom)"></span><span class="mw-headline" id="The_Sunlight_Profile_.28Custom.29">The Sunlight Profile (Custom)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=13" title="Edit section: The Sunlight Profile (Custom)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>For use in this tutorial, we will create the custom profile called "Sunlight Profile" and implement it. We define the following role and service relationship:
</p>
<ul><li><b>Sunlight Sensor - shall be a GATT server.</b></li></ul>
<dl><dd>This is the application called sunlightSensor that you will implement on the CC2650EM.</dd></dl>
<ul><li><b>Sunlight Collector - shall be a GATT client.</b></li></ul>
<dl><dd>This will be simulated by one of the boards (SmartRF06EB+CC2650EM) using BTool. To be able to use Btool on this platform, program one of your boards with the CC2640_SmartRF_HostTestRelease_All.hex file (hex file can be found here: C:\ti\simplelink\ble_cc26xx_2_00_00_42893\Accessories\HexFiles). SmartRF Flash Programmer 2 can be used to program hex files to the EM.</dd></dl>
<p>This is also illustrated in the image seen below.
</p>
<div class="thumb tnone"><div class="thumbinner" style="width:892px;"><a href="File_Sunlight_profile_block_diagram.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/1/1d/Sunlight_profile_block_diagram.png" width="890" height="436" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="File_Sunlight_profile_block_diagram.html" class="internal" title="Enlarge"></a></div>The Custom Sunlight Profile</div></div></div>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h2><span id="The_Sunlight_Service_(Custom)"></span><span class="mw-headline" id="The_Sunlight_Service_.28Custom.29">The Sunlight Service (Custom)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=14" title="Edit section: The Sunlight Service (Custom)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>The following characteristics are defined for our sunlight service: 
</p>
<table class="wikitable" style="&quot;background-color:#E3E3E3;" width="100%" border="0">
<tbody><tr>
<th>Characteristic</th>
<th>Requirements</th>
<th>Mandatory Properties</th>
<th>Security Permissions</th>
<th>Description
</th></tr>
<tr>
<td>Characteristic 1</td>
<td align="center">M</td>
<td align="center">Read</td>
<td align="center">None</td>
<td>Sunlight Value
</td></tr>
<tr>
<td>Characteristic 2</td>
<td align="center">M</td>
<td align="center">Notify</td>
<td align="center">None</td>
<td>Sunlight Value Notification
</td></tr>
<tr style="background-color: #E9E9E9;">
<td>Characteristic 2 Client Characteristic Configuration descriptor</td>
<td align="center">M</td>
<td align="center">Read, Write</td>
<td align="center">None</td>
<td>Sunlight Value Notification Configuration
</td></tr></tbody></table>
<p>The Characteristic 2 Client Characteristic Configuration descriptor is actually not a separate characteristic. It is a single attribute within Characteristic 2. It is listed to enlighten the reader about the possibility to enable notifications from the GATT client. This specific example does not really utilize characteristic 2 in a particular useful way as it simply copies the value from characteristic 1 at a given interval. It is possible to enable both Read permission and notification on the same characteristic.
</p>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="The_sunlightSensor_Application">The sunlightSensor Application</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=15" title="Edit section: The sunlightSensor Application">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<div class="thumb tright"><div class="thumbinner" style="width:402px;"><a href="File_SunLight_simpleFlowChart.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/d/db/SunLight_simpleFlowChart.png" width="400" height="409" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="File_SunLight_simpleFlowChart.html" class="internal" title="Enlarge"></a></div>Basic Flowchart for periodicTask in the SunlightSensor App</div></div></div>
<p>The sunlightSensor implements the GATT server and is basically just targeted to be an ambient light sensor. We nevertheless chose the sunlight name hoping it does not relate to an actual product to avoid any confusion. It is simply chosen just to be used as an example in this tutorial and might not be the best suiting name for an ambient light sensor application (ambiLightSensor might have been a more suiting name).
</p><p>We have used the simpleBLEPeripheral project as a base for our application. It is one of the most often used projects with which developers start as a base for their development. In reality the SensorTag project is actually more suited to follow for implementing a simple sensor application as we are doing here. The sunlightSensor will just read the sunlight value (controlled by buttons, read red box below), store that value in characteristic 1. Every 5 seconds the value in characteristic 1 will be copied to characteristic 2 and a notification will be sent to a connected GATT client if notifications is enabled. We will not implement the collector as this will be simulated with the SmartRF06EB+CC2650EM (running CC2640_SmartRF_HostTestRelease_All.hex) and BTool. The functionality just mentioned is illustrated in the flow chart on the right. An extensive flow chart showing all the inner working of this example code would be too big for any screen so we keep it simple.
</p><p><br />
</p>
<div style="padding:5px; width: 550px; border: 4px solid Red"> 
<p>This initial version will not use an actual light sensor, but will instead simulate the sunlight value by using the UP and DOWN buttons on the SmartRF06EB. In future updates to this tutorial we will instead use the actual light sensor located on the SmartRF06EB when the drivers for doing this in the BLE stack is complete.
</p>
</div>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h1><span id="Tutorial_Step_1:_Set_up_Project_Settings,_File_and_Folder_Structure"></span><span class="mw-headline" id="Tutorial_Step_1:_Set_up_Project_Settings.2C_File_and_Folder_Structure">Tutorial Step 1: Set up Project Settings, File and Folder Structure</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=16" title="Edit section: Tutorial Step 1: Set up Project Settings, File and Folder Structure">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<table width="1000px">
<tbody><tr><td>
<p>In this section you will set up the file structure, add/replace files and modify the project settings to create our sunlightSensor application that follows our custom sunlight profile specifications. By following this procedure you will get a new project that leaves the original SimpleBLEPeripheral project intact an ready to be used as a base for all your future projects as well. If you at any time find yourself unable to compile any of the projects residing in the $PROJECTS$ folder, maybe because of changes you have done in the install folder, you can uninstall and then run the stack installer again to get a fresh start. Just make sure to copy any containing folders or files that you want to keep. In the step by step list below the following abbreviations are used to shorten the path names:
</p>
<div style="padding:5px; border: 4px solid #6d6"> 
<p>$INSTALL_DIR$  =  C:\ti\simplelink\ble_cc26xx_2_00_00_42893
<br />$PROJECTS$     =  $InstallDir$\Projects\ble
</p>
</div>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="Step_by_Step_Start">Step by Step Start</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=17" title="Edit section: Step by Step Start">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<div style="padding:5px; border: 4px solid Red"> 
<p>In case you want to use this guide as a guide on how to set up your own project, with your own names, (based on simpleBLEPeriheral) just replace with the names of your choice instead of "sunlight" and "sunlightSensor".
</p>
</div>
<p><br />
</p>
<div class="thumb tright"><div class="thumbinner" style="width:358px;"><a href="File_SunlightProfileIARWorkspace.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/c/c9/SunlightProfileIARWorkspace.png" width="356" height="721" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="File_SunlightProfileIARWorkspace.html" class="internal" title="Enlarge"></a></div>The IAR Workspace after following the instructions</div></div></div>
<ol><li>Create the sunlight profile folder:
<ul><li>Copy the folder <b>$Projects$\Profiles\SimpleProfile</b> and rename the copied folder to <i>Sunlight</i>.</li>
<li>Within that folder rename simpleGATTprofile.h to sunlightservice.h</li>
<li>In the CC26xx folder you find the file "simpleGATTprofile.c". Rename this to <i>sunlightservice.c</i>.</li></ul></li>
<li>Create the sunlightSensor application folder:
<ul><li>Make a copy of the <b>$PROJECTS$\SimpleBLEPeripheral</b> folder within the same path.</li>
<li>Rename the new folder to <i>SunlightSensor</i>.</li></ul></li>
<li>Rename <i>simpleBLEPeripheral.c</i> and <i>simpleBLEPeripheral.h</i>:
<ul><li>These are found in your newly created folder <b>$Projects$\SunlightSensor\CC26xx\Source\Application</b>).</li>
<li>Rename them to <i>sunlightSensor.c</i> and <i>sunlightSensor.h</i>.</li></ul></li>
<li>Change the IAR project name:
<ul><li>The project file can be found in <b>$Projects$\sunlightSensor\CC26xx\IAR Projects\</b>.</li>
<li>Change the name from <i>SimpleBLEPeripheral.eww</i> to <i>SunlightSensor.eww</i>.</li></ul></li>
<li>Rename <i>SimpleBLEPeripheral.custom_argvars</i>:
<ul><li>Rename file to <i>SunlightSensor.custom_argvars</i>.</li></ul></li>
<li>Setup the IAR Workspace:
<ul><li>Open the IAR workspace (SunlightSensor.eww.):</li>
<li>Select the <i>CC2650App</i> project.</li>
<li>Remove the two files <i>simpleBLEPeripheral.c</i> and <i>simpleBLEPeripheral.h</i> from the Application workspace folder.</li>
<li>Add the two files <i>SunlightSensor.c</i> and <i>SunlightSensor.h</i> from <b>$PROJECTS$\SunlightSensor\CC26xx\Source\Application</b> to your project Application folder.</li>
<li>Add the two files <i>board_key.c</i> and <i>board_key.h</i> from <b>$PROJECTS$\common\cc26xx</b> to your project Application folder.</li>
<li>In the "PROFILES" workspace folder, remove <i>simpleGATTprofile.c</i> and <i>simpleGATTprofile.h</i>.</li>
<li>Add the file <i>sunlightservice.h</i> from <b>$PROJECTS$\Profiles\Sunlight</b> to your project PROFILES folder.</li>
<li>Add the file <i>sunlightservice.c</i> from <b>$PROJECTS$\Profiles\Sunlight\CC26xx</b> to your project PROFILES folder.</li></ul></li>
<li>Change the include directories  in the IAR Application workspace:
<ul><li>Go into the project options either by right-clicking on the <i>CC2650App-FlashROM</i> project in the workspace and click on <i>Options</i>. You can quickly enter this by pressing the short-cut keys <b>ALT+F7</b>. Then enter the <i>C/C++ Compiler</i> category and then the <i>Preprocessor</i> tab. There you will find the <i>Additional include directories</i>. This is where the C-compiler search for example after function prototypes in header files and more. Change the path names with <i>SimpleProfile</i> to <i>Sunlight</i> as shown in the images below.</li></ul></li></ol>
</td></tr></tbody></table>
<table width="1000px">
<tbody><tr><td>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="right">

<tbody><tr>
<td>
<pre><span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i></i>
$PROJ_DIR$/../../../../../../../Projects/ble/Profiles/SimpleProfile/CC26xx 
$PROJ_DIR$/../../../../../../../Projects/ble/Profiles/SimpleProfile        <i></i></span>
</pre>
</td></tr>
<tr>
<td height="40px" valign="center">
<center><div style="font-size: 350%;">&#8659;</div> </center>
</td></tr>
<tr>
<td>
<pre><span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i></i>
$PROJ_DIR$/../../../../../../../Projects/ble/Profiles/Sunlight/CC26xx 
$PROJ_DIR$/../../../../../../../Projects/ble/Profiles/Sunlight        <i></i></span><i>     </i>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<div class="floatleft"><a href="File_SunlightServiceIAR_PATH.html" class="image" title="The IAR ........."><img alt="The IAR ........." src="https://processors.wiki.ti.com/images/e/e4/SunlightServiceIAR_PATH.png" width="450" height="232" /></a></div>
</td></tr></tbody></table>
<p><br /><br />
</p><p><br />
</p>
<table width="1000px">
<tbody><tr><td>
<div style="padding:5px; border: 4px solid #6d6"> 
<p>Your workspace should now look exactly like shown in the image on the top right in this subsection. If it does you can continue to <a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Tutorial_Step_2:_Edit_Application_Source_Code" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> Tutorial Step 2</a> further down on this page. If not look through the steps again to find out what you have missed.
</p>
</div>
</td></tr></tbody></table>
<p><br />
</p>
<h1><span class="mw-headline" id="Tutorial_Step_2:_Edit_Application_Source_Code">Tutorial Step 2: Edit Application Source Code</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=18" title="Edit section: Tutorial Step 2: Edit Application Source Code">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<table width="1000px">
<tbody><tr><td>
<p>In this step you will edit the following source code files according to the instructions given in this step:
</p>
<ol><li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Edit_main.c" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> main.c</a></li>
<li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Edit_sunlightSensor.h" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> sunlightSensor.h</a></li>
<li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Edit_sunlightSensor.c" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> sunlightSensor.c</a></li>
<li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Edit_sunlightservice.h" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> sunlightservice.h</a></li>
<li><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Edit_sunlightservice.c" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> sunlightservice.c</a></li></ol>
<p>Each sub-chapter covers one file each (every chapter starts with Edit) and all must be edited according to this guide to be able to compile the project successfully in the end. You should follow this chronologically step by step. The parts of code that will be changed will be displayed in "from &#8658; to" code boxes which has the following format as illustrated in the box below. On the left you will find the original code (some changes might be in the original as we will do global name change operations with the CTRL+H operation) and on the right the new code will be Displayed. Background color highlighting is used to illustrate parts that is removed, altered or added to help you to quickly visualize the change.
</p>
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td width="40%" valign="top">
<p><b>Original Code</b>
</p>
<pre>original code line;

Unaltered code;
Unaltered code;
Unaltered code;

<span style="background:#FFE4E1">original code line that will be removed;</span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td width="40%" valign="top">
<p><b>Altered/New Code</b>
</p>
<pre><span style="background:#CCFFCC">Altered code line;</span>

Unaltered code;
Unaltered code;
Unaltered code;
<span style="background:#CCFFCC">
Added code line;
Added code line;</span>
</pre>
</td></tr></tbody></table>
<p>It should be easy to find the original code that needs to be altered. As every chapter below is divided into each source file you can just look in the file mentioned in the section heading to find the correct code parts. If you cannot find it you can press <b>CTRL+ALT+F</b> in IAR to find search strings in your project files.
</p>
<div class="floatnone"><a href="File_IarSearch.html" class="image" title="How to find code in IAR workspace"><img alt="How to find code in IAR workspace" src="https://processors.wiki.ti.com/images/f/f8/IarSearch.png" width="400" height="333" /></a></div>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="Edit_main.c">Edit main.c</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=19" title="Edit section: Edit main.c">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>The main.c file can be found in the Startup folder in the CC2650App workspace.
</p>
<ol>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>simpleBLEPeripheral</i> to <i>sunlightSensor</i></li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SimpleBLEPeripheral" to </i>SunlightSensor<i></i></li>
</ol>
<p>See the image below on how to use the replace all function in a single file in IAR (CTRL+H). It is also possible to use the <i>Replace in Files</i> function to replace strings in all the project source files at once (CTRL+SHIFT+ALT+H), but in this guide we will cover one file at a time. A good approach is to do a search for the string that you will replace in the file (CTRL+F) to make sure that you for example do not have additional white spaces after the string you want to replace. After you exit the find dialog and press CTRL+H the string searched for will automatically show up in the "Find what" box.
</p>
<div class="floatnone"><a href="File_IARCTRLH.html" class="image" title="How to find the correct COM port for the CC2540 USB Dongle"><img alt="How to find the correct COM port for the CC2540 USB Dongle" src="https://processors.wiki.ti.com/images/2/2b/IARCTRLH.png" width="400" height="170" /></a></div>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="Edit_sunlightservice.h">Edit sunlightservice.h</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=20" title="Edit section: Edit sunlightservice.h">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<ol>
<li>Change Characteristic definitions and UUID:</li>
<p>As mentioned before we will use 2 characteristics (one read only for the sunlight value and second one (which will simply copy the value from the first) for use with notifications). As we are using a custom service with custom characteristics we will need to use 128 bit UUID ( instead of 16 bits which can be used by defined adopted services and it's characteristics). We will use the random TI Base 128-bit UUID and define 16 bit nuggets for each different attribute. You can also remove the SIMPLEPROFILE_SERVICE and SIMPLEPROFILE_CHAR5_LEN defines as we will not need them in this application.
<font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>// Profile Parameters                                  
<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i></i>
#define SIMPLEPROFILE_CHAR1                 0          
#define SIMPLEPROFILE_CHAR2                 1          
#define SIMPLEPROFILE_CHAR3                 2          
#define SIMPLEPROFILE_CHAR4                 3          
#define SIMPLEPROFILE_CHAR5                 4          
                                                       
// Simple Profile Service UUID                         
#define SIMPLEPROFILE_SERV_UUID             0xFFF0     
                                                       
// Key Pressed UUID                                    
#define SIMPLEPROFILE_CHAR1_UUID            0xFFF1     
#define SIMPLEPROFILE_CHAR2_UUID            0xFFF2     
#define SIMPLEPROFILE_CHAR3_UUID            0xFFF3     
#define SIMPLEPROFILE_CHAR4_UUID            0xFFF4     
#define SIMPLEPROFILE_CHAR5_UUID            0xFFF5     
                                                       
// Simple Keys Profile Services bit fields             
#define SIMPLEPROFILE_SERVICE               0x00000001 
                                                       
// Length of Characteristic 5 in bytes                 
#define SIMPLEPROFILE_CHAR5_LEN           5            
<i></i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>// Profile Parameters                                 
<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i></i>
#define SUNLIGHT_CHAR1                      0         
#define SUNLIGHT_CHAR2                      1         
                                                      
// UUID for sunlight service                          
#define SUNLIGHT_SERV_UUID                  0xEE00    
/* The 16 bit UUID listen above is only a part of the 
 * full TI random 128 bit UUID:                       
 * F000EEE00-0451-4000-B000-00000000-00000. */        
                                                      
//  Sunlight service characteristic UUID              
#define SUNLIGHT_CHAR1_UUID                 0xEE01    
#define SUNLIGHT_CHAR2_UUID                 0xEE02    
<i></i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SimpleProfile</i> to <i>Sunlight</i>.</li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>simpleProfile</i> to <i>sunlight</i>.</li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SIMPLEGATTPROFILE_H</i> to <i>SUNLIGHTSERVICE_H</i>.</li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SIMPLEPROFILE_</i> to <i>SUNLIGHT_</i>.</li>
</ol>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Edit_sunlightservice.c">Edit sunlightservice.c</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=21" title="Edit section: Edit sunlightservice.c">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>This file can be found in the PROFILES folder in the CC2650App workspace.
</p>
<ol>

<li>Change define:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>#include <span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i> "simpleGATTprofile.h" </i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>#include <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i> "sunlightservice.h" </i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li> Change number of supported attributes from 17 to 8: </li> 
<p>The sunlight profile use 2 specific characteristics which needs 7 attributes (3 for the read only characteristic 1 and 4 for characteristic 2) + the attribute for the primary Service declaration. Then we end up with 8 in total. 
<font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>#define SERVAPP_NUM_ATTR_SUPPORTED      <span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i> 17 </i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>#define SERVAPP_NUM_ATTR_SUPPORTED      <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i> 8 </i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li>Change the global variables:</li>
<p>We are going to use 2 characteristics for our sunlight service. sunlightServicechar1UUID will have hold the sunlight value/level and sunlightServicechar1UUID will be used to send notifications to the GATT client if enabled.
<font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre><span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i>// Simple GATT Profile Service UUID: 0xFFF0                                </i>
CONST uint8 simpleProfileServUUID[ATT_BT_UUID_SIZE] =                      
{                                                                          
  LO_UINT16(SIMPLEPROFILE_SERV_UUID), HI_UINT16(SIMPLEPROFILE_SERV_UUID)   
};                                                                         
                                                                           
// Characteristic 1 UUID: 0xFFF1                                           
CONST uint8 simpleProfilechar1UUID[ATT_BT_UUID_SIZE] =                     
{                                                                          
  LO_UINT16(SIMPLEPROFILE_CHAR1_UUID), HI_UINT16(SIMPLEPROFILE_CHAR1_UUID) 
};                                                                         
                                                                           
// Characteristic 2 UUID: 0xFFF2                                           
CONST uint8 simpleProfilechar2UUID[ATT_BT_UUID_SIZE] =                     
{                                                                          
  LO_UINT16(SIMPLEPROFILE_CHAR2_UUID), HI_UINT16(SIMPLEPROFILE_CHAR2_UUID) 
};                                                                         
                                                                           
// Characteristic 3 UUID: 0xFFF3                                           
CONST uint8 simpleProfilechar3UUID[ATT_BT_UUID_SIZE] =                     
{                                                                          
  LO_UINT16(SIMPLEPROFILE_CHAR3_UUID), HI_UINT16(SIMPLEPROFILE_CHAR3_UUID) 
};                                                                         
                                                                           
// Characteristic 4 UUID: 0xFFF4                                           
CONST uint8 simpleProfilechar4UUID[ATT_BT_UUID_SIZE] =                     
{                                                                          
  LO_UINT16(SIMPLEPROFILE_CHAR4_UUID), HI_UINT16(SIMPLEPROFILE_CHAR4_UUID) 
};                                                                         
                                                                           
// Characteristic 5 UUID: 0xFFF5                                           
CONST uint8 simpleProfilechar5UUID[ATT_BT_UUID_SIZE] =                     
{                                                                          
  LO_UINT16(SIMPLEPROFILE_CHAR5_UUID), HI_UINT16(SIMPLEPROFILE_CHAR5_UUID) 
};                                                                         <i></i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre><span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>// Sunlight Service UUID: 0xEE00                      </i>
CONST uint8 sunlightServUUID[ATT_UUID_SIZE] =         
{                                                     
    TI_BASE_UUID_128(SUNLIGHT_SERV_UUID),             
};                                                    
                                                      
// Characteristic 1 UUID: 0xEE01                      
CONST uint8 sunlightchar1UUID[ATT_UUID_SIZE] =        
{                                                     
    TI_BASE_UUID_128(SUNLIGHT_CHAR1_UUID),            
};                                                    
// Characteristic 2 UUID: 0xEE02                      
CONST uint8 sunlightchar2UUID[ATT_UUID_SIZE] =        
{                                                     
    TI_BASE_UUID_128(SUNLIGHT_CHAR2_UUID),            
};                                                    <i></i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li value="2">Change the service attribute variables:</li>
<p>These are the actual variables used in the value attribute in each characteristic. 
<font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre><span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i>/*********************************************************************                          </i>
 * Profile Attributes - variables                                                               
 */                                                                                             
                                                                                                
// Simple Profile Service attribute                                                             
static CONST gattAttrType_t simpleProfileService = { ATT_BT_UUID_SIZE, simpleProfileServUUID }; 
                                                                                                
                                                                                                
// Simple Profile Characteristic 1 Properties                                                   
static uint8 simpleProfileChar1Props = GATT_PROP_READ | GATT_PROP_WRITE;                        
                                                                                                
// Characteristic 1 Value                                                                       
static uint8 simpleProfileChar1 = 0;                                                            
                                                                                                
// Simple Profile Characteristic 1 User Description                                             
static uint8 simpleProfileChar1UserDesp[17] = "Characteristic 1\0";                             
                                                                                                
                                                                                                
// Simple Profile Characteristic 2 Properties                                                   
static uint8 simpleProfileChar2Props = GATT_PROP_READ;                                          
                                                                                                
// Characteristic 2 Value                                                                       
static uint8 simpleProfileChar2 = 0;                                                            
                                                                                                
// Simple Profile Characteristic 2 User Description                                             
static uint8 simpleProfileChar2UserDesp[17] = "Characteristic 2\0";                             
                                                                                                
                                                                                                
// Simple Profile Characteristic 3 Properties                                                   
static uint8 simpleProfileChar3Props = GATT_PROP_WRITE;                                         
                                                                                                
// Characteristic 3 Value                                                                       
static uint8 simpleProfileChar3 = 0;                                                            
                                                                                                
// Simple Profile Characteristic 3 User Description                                             
static uint8 simpleProfileChar3UserDesp[17] = "Characteristic 3\0";                             
                                                                                                
                                                                                                
// Simple Profile Characteristic 4 Properties                                                   
static uint8 simpleProfileChar4Props = GATT_PROP_NOTIFY;                                        
                                                                                                
// Characteristic 4 Value                                                                       
static uint8 simpleProfileChar4 = 0;                                                            
                                                                                                
// Simple Profile Characteristic 4 Configuration Each client has its own                        
// instantiation of the Client Characteristic Configuration. Reads of the                       
// Client Characteristic Configuration only shows the configuration for                         
// that client and writes only affect the configuration of that client.                         
static gattCharCfg_t *simpleProfileChar4Config;                                                 
                                                                                                
// Simple Profile Characteristic 4 User Description                                             
static uint8 simpleProfileChar4UserDesp[17] = "Characteristic 4\0";                             
                                                                                                
                                                                                                
// Simple Profile Characteristic 5 Properties                                                   
static uint8 simpleProfileChar5Props = GATT_PROP_READ;                                          
                                                                                                
// Characteristic 5 Value                                                                       
static uint8 simpleProfileChar5[SIMPLEPROFILE_CHAR5_LEN] = { 0, 0, 0, 0, 0 };                   
                                                                                                
// Simple Profile Characteristic 5 User Description                                             
static uint8 simpleProfileChar5UserDesp[17] = "Characteristic 5\0";                             <i></i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre><span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>/*********************************************************************                    </i>
 * Service Attributes - variables                                                         
 */                                                                                       
                                                                                          
// Sunlight Service attribute                                                             
static CONST gattAttrType_t sunlightService = { ATT_UUID_SIZE, sunlightServUUID};     
                                                                                          
// Sunlight Service Characteristic 1 Properties                                           
static uint8 sunlightChar1Props = GATT_PROP_READ | GATT_PROP_WRITE;                       
                                                                                          
// Characteristic 1 Value                                                                 
static uint8 sunlightChar1 = 0;                                                           
                                                                                          
// Sunlight Service Characteristic 1 User Description                                     
static uint8 sunlightChar1UserDesp[17] = "Sunlight Value\0";                              
                                                                                          
// Sunlight Service Characteristic 2 Properties                                           
static uint8 sunlightChar2Props = GATT_PROP_NOTIFY;                                       
                                                                                          
// Characteristic 2 Value                                                                 
static uint8 sunlightChar2 = 0;                                                           
                                                                                          
// Sunlight Service Characteristic 2 Configuration.                                       
static gattCharCfg_t *sunlightChar2Config;                                                
                                                                                          
// Sunlight Service Characteristic 2 User Description                                     
static uint8 sunlightChar2UserDesp[] = "Sunlight Value Notification\0";            <i></i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li>Change the service attribute table:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>/*********************************************************************
 * Profile Attributes - Table
 */

static gattAttribute_t simpleProfileAttrTbl[SERVAPP_NUM_ATTR_SUPPORTED] =       
{                                                                               
<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i>  // Simple Profile Service                                                     </i>
  {                                                                             
    { ATT_BT_UUID_SIZE, primaryServiceUUID }, /* type */                        
    GATT_PERMIT_READ,                         /* permissions */                 
    0,                                        /* handle */                      
    (uint8 *)&amp;simpleProfileService            /* pValue */                      
  },                                                                            
                                                                                
  // Characteristic 1 Declaration                                               
  {                                                                             
    { ATT_BT_UUID_SIZE, characterUUID },                                        
    GATT_PERMIT_READ,                                                           
    0,                                                                          
    &amp;simpleProfileChar1Props                                                    
  },                                                                            
                                                                                
  // Characteristic Value 1                                                     
  {                                                                             
    { ATT_BT_UUID_SIZE, simpleProfilechar1UUID },                               
      GATT_PERMIT_READ | GATT_PERMIT_WRITE,                                     
      0,                                                                        
      &amp;simpleProfileChar1                                                       
  },                                                                            
                                                                                
  // Characteristic 1 User Description                                          
  {                                                                             
    { ATT_BT_UUID_SIZE, charUserDescUUID },                                     
    GATT_PERMIT_READ,                                                           
    0,                                                                          
    simpleProfileChar1UserDesp                                                  
  },                                                                            
                                                                                
  // Characteristic 2 Declaration                                               
  {                                                                             
    { ATT_BT_UUID_SIZE, characterUUID },                                        
    GATT_PERMIT_READ,                                                           
    0,                                                                          
    &amp;simpleProfileChar2Props                                                    
  },                                                                            
                                                                                
   // Characteristic Value 2                                                    
   {                                                                            
     { ATT_BT_UUID_SIZE, simpleProfilechar2UUID },                              
      GATT_PERMIT_READ,                                                         
      0,                                                                        
      &amp;simpleProfileChar2                                                       
   },                                                                           
                                                                                
   // Characteristic 2 User Description                                         
   {                                                                            
     { ATT_BT_UUID_SIZE, charUserDescUUID },                                    
     GATT_PERMIT_READ,                                                          
     0,                                                                         
     simpleProfileChar2UserDesp                                                 
   },                                                                           
                                                                                
   // Characteristic 3 Declaration                                              
   {                                                                            
     { ATT_BT_UUID_SIZE, characterUUID },                                       
     GATT_PERMIT_READ,                                                          
     0,                                                                         
     &amp;simpleProfileChar3Props                                                   
   },                                                                           
                                                                                
   // Characteristic Value 3                                                    
   {                                                                            
     { ATT_BT_UUID_SIZE, simpleProfilechar3UUID },                              
     GATT_PERMIT_WRITE,                                                         
     0,                                                                         
     &amp;simpleProfileChar3                                                        
   },                                                                           
                                                                                
   // Characteristic 3 User Description                                         
   {                                                                            
     { ATT_BT_UUID_SIZE, charUserDescUUID },                                    
     GATT_PERMIT_READ,                                                          
     0,                                                                         
     simpleProfileChar3UserDesp                                                 
   },                                                                           
                                                                                
   // Characteristic 4 Declaration                                              
   {                                                                            
     { ATT_BT_UUID_SIZE, characterUUID },                                       
      GATT_PERMIT_READ,                                                         
      0,                                                                        
      &amp;simpleProfileChar4Props                                                  
   },                                                                           
                                                                                
   // Characteristic Value 4                                                    
   {                                                                            
     { ATT_BT_UUID_SIZE, simpleProfilechar4UUID },                              
     0,                                                                         
     0,                                                                         
     &amp;simpleProfileChar4                                                        
   },                                                                           
                                                                                
   // Characteristic 4 configuration                                            
   {                                                                            
     { ATT_BT_UUID_SIZE, clientCharCfgUUID },                                   
     GATT_PERMIT_READ | GATT_PERMIT_WRITE,                                      
     0,                                                                         
     (uint8 *)&amp;simpleProfileChar4Config                                         
   },                                                                           
                                                                                
   // Characteristic 4 User Description                                         
   {                                                                            
     { ATT_BT_UUID_SIZE, charUserDescUUID },                                    
     GATT_PERMIT_READ,                                                          
     0,                                                                         
     simpleProfileChar4UserDesp                                                 
   },                                                                           
                                                                                
   // Characteristic 5 Declaration                                              
   {                                                                            
     { ATT_BT_UUID_SIZE, characterUUID },                                       
     GATT_PERMIT_READ,                                                          
     0,                                                                         
     &amp;simpleProfileChar5Props                                                   
   },                                                                           
                                                                                
   // Characteristic Value 5                                                    
   {                                                                            
     { ATT_BT_UUID_SIZE, simpleProfilechar5UUID },                              
     GATT_PERMIT_AUTHEN_READ,                                                   
     0,                                                                         
     simpleProfileChar5                                                         
   },                                                                           
                                                                                
   // Characteristic 5 User Description                                         
   {                                                                            
     { ATT_BT_UUID_SIZE, charUserDescUUID },                                    
     GATT_PERMIT_READ,                                                          
     0,                                                                         
     simpleProfileChar5UserDesp                                                 
   },                                                                           <i></i></span>
};                                                                              
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>/*********************************************************************
* Profile Attributes - Table
*/

static gattAttribute_t sunlightAttrTbl[SERVAPP_NUM_ATTR_SUPPORTED] =
{
<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>  // sunlight Service                                             </i>
  {                                                               
    { ATT_BT_UUID_SIZE, primaryServiceUUID },   /* type */        
    GATT_PERMIT_READ,                           /* permissions */ 
    0,                                          /* handle */      
    (uint8 *)&amp;sunlightService                   /* pValue */      
  },                                                              
  // Characteristic 1 Declaration                                 
  {                                                               
    { ATT_BT_UUID_SIZE, characterUUID },                          
    GATT_PERMIT_READ,                                             
    0,                                                            
    &amp;sunlightChar1Props                                           
  },                                                              
                                                                  
  // Characteristic Value 1                                       
  {                                                               
    { ATT_UUID_SIZE, sunlightchar1UUID },                         
    GATT_PERMIT_READ | GATT_PERMIT_WRITE,                         
    0,                                                            
    &amp;sunlightChar1                                                
  },                                                              
                                                                  
  // Characteristic 1 User Description                            
  {                                                               
    { ATT_BT_UUID_SIZE, charUserDescUUID },                       
    GATT_PERMIT_READ,                                             
    0,                                                            
    sunlightChar1UserDesp                                         
  },                                                              
                                                                  
                                                                  
  // Characteristic 2 Declaration                                 
  {                                                               
    { ATT_BT_UUID_SIZE, characterUUID },                          
    GATT_PERMIT_READ,                                             
    0,                                                            
    &amp;sunlightChar2Props                                           
  },                                                              
                                                                  
  // Characteristic Value 2                                       
  {                                                               
    { ATT_UUID_SIZE, sunlightchar2UUID },                         
    0,                                                            
    0,                                                            
    &amp;sunlightChar2                                                
  },                                                              
                                                                  
  // Characteristic 2 configuration                               
  {                                                               
    { ATT_BT_UUID_SIZE, clientCharCfgUUID },                      
    GATT_PERMIT_READ | GATT_PERMIT_WRITE,                         
    0,                                                            
    (uint8 *)&amp;sunlightChar2Config                                 
  },                                                              
                                                                  
  // Characteristic 2 User Description                            
  {                                                               
    { ATT_BT_UUID_SIZE, charUserDescUUID },                       
    GATT_PERMIT_READ,                                             
    0,                                                            
    sunlightChar2UserDesp                                         
  },                                                              <i></i></span>
};                                                                
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li>Change the <i>SimpleProfile_AddService</i> function:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre><span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i>bStatus_t SimpleProfile_AddService( uint32 services )                               </i>
{                                                                                   
  uint8 status;                                                                     
                                                                                    
  // Allocate Client Characteristic Configuration table                             
  simpleProfileChar4Config = (gattCharCfg_t *)ICall_malloc( sizeof(gattCharCfg_t) * 
                                                            linkDBNumConns );       
  if ( simpleProfileChar4Config == NULL )                                           
  {                                                                                 
    return ( bleMemAllocError );                                                    
  }                                                                                 
                                                                                    
  // Initialize Client Characteristic Configuration attributes                      
  GATTServApp_InitCharCfg( INVALID_CONNHANDLE, simpleProfileChar4Config );          
                                                                                    
  if ( services &amp; SIMPLEPROFILE_SERVICE )                                           
  {                                                                                 
    // Register GATT attribute list and CBs with GATT Server App                    
    status = GATTServApp_RegisterService( simpleProfileAttrTbl,                     
                                          GATT_NUM_ATTRS( simpleProfileAttrTbl ),   
                                          &amp;simpleProfileCBs );                      
  }                                                                                 
  else                                                                              
  {                                                                                 
    status = SUCCESS;                                                               
  }                                                                                 
                                                                                    
  return ( status );                                                                
}                                                                                   <i></i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre><span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>bStatus_t Sunlight_AddService( uint32 services )                                      </i>
{                                                                                     
  uint8 status;                                                                       
                                                                                      
  // Allocate Client Characteristic Configuration table                               
  sunlightChar2Config = (gattCharCfg_t *)ICall_malloc( sizeof(gattCharCfg_t) *        
                                                            linkDBNumConns );         
  if ( sunlightChar2Config == NULL )                                                  
  {                                                                                   
    return ( bleMemAllocError );                                                      
  }                                                                                   
                                                                                      
  // Initialize Client Characteristic Configuration attributes                        
  GATTServApp_InitCharCfg( INVALID_CONNHANDLE, sunlightChar2Config );                 
                                                                                      
  // Register GATT attribute list and CBs with GATT Server App                        
  status = GATTServApp_RegisterService( sunlightAttrTbl,                              
                                        GATT_NUM_ATTRS( sunlightAttrTbl ),            
                                        &amp;sunlightCBs );                               
                                                                                      
  return ( status );                                                                  
}                                                                                     <i></i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li>Update Sunlight_SetParameter function:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre><span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i> bStatus_t SimpleProfile_SetParameter( uint8 param, uint8 len, void *value )                       </i>
{                                                                                                 
  bStatus_t ret = SUCCESS;                                                                        
  switch ( param )                                                                                
  {                                                                                               
    case SIMPLEPROFILE_CHAR1:                                                                     
      if ( len == sizeof ( uint8 ) )                                                              
      {                                                                                           
        simpleProfileChar1 = *((uint8*)value);                                                    
      }                                                                                           
      else                                                                                        
      {                                                                                           
        ret = bleInvalidRange;                                                                    
      }                                                                                           
      break;                                                                                      
                                                                                                  
    case SIMPLEPROFILE_CHAR2:                                                                     
      if ( len == sizeof ( uint8 ) )                                                              
      {                                                                                           
        simpleProfileChar2 = *((uint8*)value);                                                    
      }                                                                                           
      else                                                                                        
      {                                                                                           
        ret = bleInvalidRange;                                                                    
      }                                                                                           
      break;                                                                                      
                                                                                                  
    case SIMPLEPROFILE_CHAR3:                                                                     
      if ( len == sizeof ( uint8 ) )                                                              
      {                                                                                           
        simpleProfileChar3 = *((uint8*)value);                                                    
      }                                                                                           
      else                                                                                        
      {                                                                                           
        ret = bleInvalidRange;                                                                    
      }                                                                                           
      break;                                                                                      
                                                                                                  
    case SIMPLEPROFILE_CHAR4:                                                                     
      if ( len == sizeof ( uint8 ) )                                                              
      {                                                                                           
        simpleProfileChar4 = *((uint8*)value);                                                    
                                                                                                  
        // See if Notification has been enabled                                                   
        GATTServApp_ProcessCharCfg( simpleProfileChar4Config, &amp;simpleProfileChar4, FALSE,         
                                    simpleProfileAttrTbl, GATT_NUM_ATTRS( simpleProfileAttrTbl ), 
                                    INVALID_TASK_ID, simpleProfile_ReadAttrCB );                  
      }                                                                                           
      else                                                                                        
      {                                                                                           
        ret = bleInvalidRange;                                                                    
      }                                                                                           
      break;                                                                                      
                                                                                                  
    case SIMPLEPROFILE_CHAR5:                                                                     
      if ( len == SIMPLEPROFILE_CHAR5_LEN )                                                       
      {                                                                                           
        VOID memcpy( simpleProfileChar5, value, SIMPLEPROFILE_CHAR5_LEN );                        
      }                                                                                           <i></i></span>
      else                                                                                        
      {                                                                                           
        ret = bleInvalidRange;                                                                    
      }                                                                                           
      break;                                                                                      
                                                                                                  
    default:                                                                                      
      ret = INVALIDPARAMETER;                                                                     
      break;                                                                                      
  }                                                                                               
                                                                                                  
  return ( ret );                                                                                 
}                                                                                                 
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre><span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i> bStatus_t Sunlight_SetParameter( uint8 param, uint8 len, void *value )                       </i>
{                                                                                             
  bStatus_t ret = SUCCESS;                                                                    
  switch ( param )                                                                            
  {                                                                                           
    case SUNLIGHT_CHAR1:                                                                      
      if ( len == sizeof ( uint8 ) )                                                          
      {                                                                                       
        sunlightChar1 = *((uint8*)value);                                                     
      }                                                                                       
      else                                                                                    
      {                                                                                       
        ret = bleInvalidRange;                                                                
      }                                                                                       
      break;                                                                                  
                                                                                              
    case SUNLIGHT_CHAR2:                                                                      
      if ( len == sizeof ( uint8 ) )                                                          
      {                                                                                       
        sunlightChar2 = *((uint8*)value);                                                     
                                                                                              
        // See if Notification has been enabled                                               
        GATTServApp_ProcessCharCfg( sunlightChar2Config, &amp;sunlightChar2, FALSE,               
                                    sunlightAttrTbl, GATT_NUM_ATTRS( sunlightAttrTbl ),       
                                    INVALID_TASK_ID, sunlight_ReadAttrCB );                   
      }                                                                                       <i></i></span>
      else                                                                                    
      {                                                                                       
        ret = bleInvalidRange;                                                                
      }                                                                                       
      break;                                                                                  
                                                                                              
    default:                                                                                  
      ret = INVALIDPARAMETER;                                                                 
      break;                                                                                  
  }                                                                                           
                                                                                              
  return ( ret );                                                                             
}                                                                                             
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li> Change the SimpleProfile_GetParameter function:</li>       
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>bStatus_t SimpleProfile_GetParameter( uint8 param, void *value )         
{                                                                        
  bStatus_t ret = SUCCESS;
<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i>  switch ( param )                                                       </i>
  {                                                                      
    case SIMPLEPROFILE_CHAR1:                                            
      *((uint8*)value) = simpleProfileChar1;                             
      break;                                                             
                                                                         
    case SIMPLEPROFILE_CHAR2:                                            
      *((uint8*)value) = simpleProfileChar2;                             
      break;                                                             
                                                                         
    case SIMPLEPROFILE_CHAR3:                                            
      *((uint8*)value) = simpleProfileChar3;                             
      break;                                                             
                                                                         
    case SIMPLEPROFILE_CHAR4:                                            
      *((uint8*)value) = simpleProfileChar4;                             
      break;                                                             
                                                                         
    case SIMPLEPROFILE_CHAR5:                                            
      VOID memcpy( value, simpleProfileChar5, SIMPLEPROFILE_CHAR5_LEN ); 
      break;                                                             <i></i></span>
                                                                         
    default:                                                             
      ret = INVALIDPARAMETER;                                            
      break;                                                             
  }                                                                      
                                                                         
  return ( ret );                                                        
}                                                                        
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>bStatus_t  <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">Sunlight_GetParameter</span>( uint8 param, void *value )        
{                                                                  
  bStatus_t ret = SUCCESS;                                         
  switch ( param )                                                 
  {                                                                
    case <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">SUNLIGHT_CHAR1</span>:                                           
      *((uint8*)value) = <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">sunlightChar1</span>;                            
      break;                                                       
                                                                   
    case <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">SUNLIGHT_CHAR2</span>:                                           
      *((uint8*)value) = <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">sunlightChar2</span>;                            
      break;                                                       
                                                                   
    default:                                                       
      ret = INVALIDPARAMETER;                                      
      break;                                                       
  }                                                                
                                                                   
  return ( ret );                                                  
}                                                                  
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li> Add the following function at the top of the file. It is used below for extracting a 16-bit version off the full 128-bit UUID:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<pre style="background:#CCFFCC;">bStatus_t utilExtractUuid16(gattAttribute_t *pAttr, uint16_t *pUuid)
{
  bStatus_t status = SUCCESS;

  if (pAttr-&gt;type.len == ATT_BT_UUID_SIZE )
  {
    // 16-bit UUID direct
    *pUuid = BUILD_UINT16( pAttr-&gt;type.uuid[0], pAttr-&gt;type.uuid[1]);
#ifdef GATT_TI_UUID_128_BIT
  }
  else if (pAttr-&gt;type.len == ATT_UUID_SIZE)
  {
    // 16-bit UUID extracted bytes 12 and 13
    *pUuid = BUILD_UINT16( pAttr-&gt;type.uuid[12], pAttr-&gt;type.uuid[13]);
#endif
  } else {
    *pUuid = 0xFFFF;
    status = FAILURE;
  }

  return status;
}
</pre>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li> Change the simpleProfile_ReadAttrCBfunction:</li>
<p>Have to add check on extracting the 16 bit UUID from the 128 bit long UUID before entering switch-case.
<font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>static bStatus_t simpleProfile_ReadAttrCB( uint16 connHandle, gattAttribute_t *pAttr,    
                                           uint8 *pValue, uint8 *pLen, uint16 offset,    
                                           uint8 maxLen, uint8 method )                  
{                                                                                        
  bStatus_t status = SUCCESS;                                                            
                                                                                         
  // If attribute permissions require authorization to read, return error                
  if ( gattPermitAuthorRead( pAttr-&gt;permissions ) )                                      
  {                                                                                      
    // Insufficient authorization                                                        
    return ( ATT_ERR_INSUFFICIENT_AUTHOR );                                              
  }                                                                                      
                                                                                         
  // Make sure it's not a blob operation (no attributes in the profile are long)         
  if ( offset &gt; 0 )                                                                      
  {                                                                                      
    return ( ATT_ERR_ATTR_NOT_LONG );                                                    
  }                                                                                      
<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i></i>
  if ( pAttr-&gt;type.len == ATT_BT_UUID_SIZE )                                             
  {                                                                                      
    // 16-bit UUID                                                                       
    uint16 uuid = BUILD_UINT16( pAttr-&gt;type.uuid[0], pAttr-&gt;type.uuid[1]);               
    switch ( uuid )                                                                      
    {                                                                                    
      // No need for "GATT_SERVICE_UUID" or "GATT_CLIENT_CHAR_CFG_UUID" cases;           
      // gattserverapp handles those reads                                               
                                                                                         
      // characteristics 1 and 2 have read permissions                                   
      // characteritisc 3 does not have read permissions; therefore it is not            
      //   included here                                                                 
      // characteristic 4 does not have read permissions, but because it                 
      //   can be sent as a notification, it is included here                            
      case SIMPLEPROFILE_CHAR1_UUID:                                                     
      case SIMPLEPROFILE_CHAR2_UUID:                                                     
      case SIMPLEPROFILE_CHAR4_UUID:                                                     
        *pLen = 1;                                                                       
        pValue[0] = *pAttr-&gt;pValue;                                                      
        break;                                                                           
                                                                                         
      case SIMPLEPROFILE_CHAR5_UUID:                                                     
        *pLen = SIMPLEPROFILE_CHAR5_LEN;                                                 
        VOID memcpy( pValue, pAttr-&gt;pValue, SIMPLEPROFILE_CHAR5_LEN );                   
        break;                                                                           
                                                                                         
      default:                                                                           
        // Should never get here! (characteristics 3 and 4 do not have read permissions) 
        *pLen = 0;                                                                       
        status = ATT_ERR_ATTR_NOT_FOUND;                                                 
        break;                                                                           
    }                                                                                    
  }                                                                                      
  else                                                                                   
  {                                                                                      
    // 128-bit UUID                                                                      
    *pLen = 0;                                                                           
    status = ATT_ERR_INVALID_HANDLE;                                                     
  }                                                                                      
                                                                                         
  return ( status );                                                                     
}                                                                                        <i></i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>static bStatus_t  <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">sunlight_ReadAttrCB</span>( uint16 connHandle, gattAttribute_t *pAttr,        
                                           uint8 *pValue, uint8 *pLen, uint16 offset,   
                                           uint8 maxLen, uint8 method )                 
{                                                                                       
  <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>uint16 uuid;</i></span>
  bStatus_t status = SUCCESS;                                                           
                                                                                        
  // If attribute permissions require authorization to read, return error               
  if ( gattPermitAuthorRead( pAttr-&gt;permissions ) )                                     
  {                                                                                     
    // Insufficient authorization                                                       
    return ( ATT_ERR_INSUFFICIENT_AUTHOR );                                             
  }                                                                                     
                                                                                        
  // Make sure it's not a blob operation (no attributes in the profile are long)        
  if ( offset &gt; 0 )                                                                     
  {                                                                                     
    return ( ATT_ERR_ATTR_NOT_LONG );                                                   
  }                                                                                     
                                                                                        
<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i></i>
  if (utilExtractUuid16(pAttr,&amp;uuid) == FAILURE) {                                      
    // Invalid handle                                                                   
    *pLen = 0;                                                                          
    return ATT_ERR_INVALID_HANDLE;                                                      
  }                                                                                     
                                                                                        
  switch ( uuid )                                                                       
  {                                                                                     
    // No need for "GATT_SERVICE_UUID" or "GATT_CLIENT_CHAR_CFG_UUID" cases;            
    // gattserverapp handles those reads                                                
                                                                                        
    // characteristics 1 has read permissions                                           
    // characteristic 2 does not have read permissions, but because it                  
    //   can be sent as a notification, it is included here                             
  case SUNLIGHT_CHAR1_UUID:                                                             
  case SUNLIGHT_CHAR2_UUID:                                                             
    *pLen = 1;                                                                          
    pValue[0] = *pAttr-&gt;pValue;                                                         
    break;                                                                              
                                                                                        
  default:                                                                              
    // Should never get here! (characteristics 3 and 4 do not have read permissions)    
    *pLen = 0;                                                                          
    status = ATT_ERR_ATTR_NOT_FOUND;                                                    
    break;                                                                              
  }                                                                                     
  return ( status );                                                                    <i></i></span>
}                                                                                       
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li> Change the <b>simpleProfile_WriteAttrCBfunction</b> function:</li>
<p>To change attribute values directly within the application the function Sunlight_SetParameter is used. sunlightService_WriteAttrCB is execute when a GATT client is "trying" to write to a attribute in the GATT server. Because SUNLIGHT_CHAR1 is read-only and the SUNLIGHTSERVICE_CHAR2 value is transferred as notifications when enabled we only need to enable function for writing to the configuration of SUNLIGHTSERVICE_CHAR2 to enable or disable notifications (GATT_CLIENT_CHAR_CFG_UUID).
</p><p>In the old code, the following function-call is executed if there has been a change in a characteristic value (attribute):
</p>
<ul><li>sunlightService_AppCBs-&gt;pfnSimpleProfileChange( notifyApp );</li></ul>
<p>This is mapped to the function SunlightSensor_charValueChangeCB in sunlightSensor.c in the following function call:
</p>
<ul><li>SunlightService_RegisterAppCBs(&amp;SunlightSensor_simpleProfileCBs);</li></ul>
<p>When the SunlightSensor_charValueChangeCB function is executed it sends a message in a RTOS queue with the SBP_CHAR_CHANGE_EVT event argument. The function SunlightSensor_processAppMsg will process this message according to the event type (only parameter in function). Originally this is implemented for the simpleBLEPeripheral to call the SunlightSensor_processCharValueChangeEvt to update teh LCD display whenever either the characteristic 1 or characteristic 2 value is changed. For this version of our sunlight profile we will update the LCD in button push call backs instead so we can comment out this for now.
</p><p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>static bStatus_t <span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;">simpleProfile_WriteAttrCB</span>( uint16 connHandle, gattAttribute_t *pAttr,                
                                            uint8 *pValue, uint8 len, uint16 offset,                  
                                            uint8 method )                                            
{                                                                                                     
  bStatus_t status = SUCCESS;                                                                         
  <span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;">uint8 notifyApp = 0xFF;</span>
                                                                                                      
  // If attribute permissions require authorization to write, return error                            
  if ( gattPermitAuthorWrite( pAttr-&gt;permissions ) )                                                  
  {                                                                                                   
    // Insufficient authorization                                                                     
    return ( ATT_ERR_INSUFFICIENT_AUTHOR );                                                           
  }                                                                                                   
 <span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i></i>
  if ( pAttr-&gt;type.len == ATT_BT_UUID_SIZE )                                                          
  {                                                                                                   
    // 16-bit UUID                                                                                    
    uint16 uuid = BUILD_UINT16( pAttr-&gt;type.uuid[0], pAttr-&gt;type.uuid[1]);                            
    switch ( uuid )                                                                                   
    {                                                                                                 
      case SIMPLEPROFILE_CHAR1_UUID:                                                                  
      case SIMPLEPROFILE_CHAR3_UUID:                                                                  
                                                                                                      
        //Validate the value                                                                          
        // Make sure it's not a blob oper                                                             
        if ( offset == 0 )                                                                            
        {                                                                                             
          if ( len&#160;!= 1 )                                                                             
          {                                                                                           
            status = ATT_ERR_INVALID_VALUE_SIZE;                                                      
          }                                                                                           
        }                                                                                             
        else                                                                                          
        {                                                                                             
          status = ATT_ERR_ATTR_NOT_LONG;                                                             
        }                                                                                             
                                                                                                      
        //Write the value                                                                             
        if ( status == SUCCESS )                                                                      
        {                                                                                             
          uint8 *pCurValue = (uint8 *)pAttr-&gt;pValue;                                                  
          *pCurValue = pValue[0];                                                                     
                                                                                                      
          if( pAttr-&gt;pValue == &amp;simpleProfileChar1 )                                                  
          {                                                                                           
            notifyApp = SIMPLEPROFILE_CHAR1;                                                          
          }                                                                                           
          else                                                                                        
          {                                                                                           
            notifyApp = SIMPLEPROFILE_CHAR3;                                                          
          }                                                                                           
        }                                                                                             
                                                                                                      
        break;                                                                                        
                                                                                                      
      case GATT_CLIENT_CHAR_CFG_UUID:                                                                 
        status = GATTServApp_ProcessCCCWriteReq( connHandle, pAttr, pValue, len,                      
                                                 offset, GATT_CLIENT_CFG_NOTIFY );                    
        break;                                                                                        
                                                                                                      
      default:                                                                                        
        // Should never get here! (characteristics 2 and 4 do not have write permissions)             
        status = ATT_ERR_ATTR_NOT_FOUND;                                                              
        break;                                                                                        
    }                                                                                                 
  }                                                                                                   
  else                                                                                                
  {                                                                                                   
    // 128-bit UUID                                                                                   
    status = ATT_ERR_INVALID_HANDLE;                                                                  
  }                                                                                                   
                                                                                                      
  // If a charactersitic value changed then callback function to notify application of change         
  if ( (notifyApp&#160;!= 0xFF ) &amp;&amp; simpleProfile_AppCBs &amp;&amp; simpleProfile_AppCBs-&gt;pfnSimpleProfileChange ) 
  {                                                                                                   
    simpleProfile_AppCBs-&gt;pfnSimpleProfileChange( notifyApp );                                        
  }                                                                                                   
                                                                                                      
  return ( status );                                                                                  
}                                                                                                     <i></i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>static bStatus_t <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">sunlight_WriteAttrCB</span>( uint16 connHandle, gattAttribute_t *pAttr,        
                                            uint8 *pValue, uint8 len, uint16 offset,     
                                            uint8 method )                               
{                                                                                        
  <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>uint16 uuid;</i></span>                                                    
  bStatus_t status = SUCCESS;                                                            
                                                                                         
  // If attribute permissions require authorization to write, return error               
  if ( gattPermitAuthorWrite( pAttr-&gt;permissions ) )                                     
  {                                                                                      
    // Insufficient authorization                                                        
    return ( ATT_ERR_INSUFFICIENT_AUTHOR );                                              
  }                                                                                      

 <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i></i>
  if (utilExtractUuid16(pAttr,&amp;uuid) == FAILURE) {                                       
    // Invalid handle                                                                    
    return ATT_ERR_INVALID_HANDLE;                                                       
  }                                                                                      
                                                                                         
  // 16-bit UUID                                                                         
  // uint16 uuid = BUILD_UINT16( pAttr-&gt;type.uuid[0], pAttr-&gt;type.uuid[1]);                 
  switch ( uuid )                                                                        
  {                                                                                      
  case GATT_CLIENT_CHAR_CFG_UUID:                                                        
    status = GATTServApp_ProcessCCCWriteReq( connHandle, pAttr, pValue, len,             
                                            offset, GATT_CLIENT_CFG_NOTIFY );            
    break;                                                                               
                                                                                         
  default:                                                                               
    // Should never get here! (characteristics 2 and 4 do not have write permissions)    
    status = ATT_ERR_ATTR_NOT_FOUND;                                                     
    break;                                                                               
  }                                                                                      
  return ( status );                                                                     
}                                                                                        <i></i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li>Use <b>CTRL+H</b> to replace all strings with "simpleProfileChar4Config" to "sunlightChar2Config"</li>
<li>Use <b>CTRL+H</b> to replace all strings with "simpleProfile" to "sunlight"</li>
<li>Use <b>CTRL+H</b> to replace all strings with "SimpleProfile_" to "Sunlight_"</li>
</ol>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Edit_sunlightSensor.h">Edit sunlightSensor.h</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=22" title="Edit section: Edit sunlightSensor.h">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This file can be found in the Application folder in the CC2650App workspace.
</p>
<ol>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SIMPLEBLEPERIPHERAL_</i> to <i>SUNLIGHTSENSOR_</i> </li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SimpleBLEPeripheral_</i> to <i>SunlightSensor_</i></li>
</ol>
<p><br />
</p>
<h2><span class="mw-headline" id="Edit_sunlightSensor.c">Edit sunlightSensor.c</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=23" title="Edit section: Edit sunlightSensor.c">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<ol>
<li>Change/add define:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>#include <span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i> "simpleGATTprofile.h" </i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>#include <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i> "sunlightservice.h" </i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li>Change/add define:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>#include <span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i> "simpleBLEPeripheral.h" </i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>#include <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i> "sunlightSensor.h" </i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li>Change the local name given in scan response data payload:</li>
<p>We will leave the rest of the payload as this parameters that provide the desired and maximum allowed connection interval which a master device will use for initiating a connection with this BLE slave device.
<font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>// GAP - SCAN RSP data (max size = 31 bytes)               
static uint8_t scanRspData[] =                             
{                                                          
  // complete name                                         
  0x14,   // length of this data                           
  GAP_ADTYPE_LOCAL_NAME_COMPLETE,                          
<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i>  0x53,   // 'S'                                           </i>
  0x69,   // 'i'                                           
  0x6d,   // 'm'                                           
  0x70,   // 'p'                                           
  0x6c,   // 'l'                                           
  0x65,   // 'e'                                           
  0x42,   // 'B'                                           
  0x4c,   // 'L'                                           
  0x45,   // 'E'                                           
  0x50,   // 'P'                                           
  0x65,   // 'e'                                           
  0x72,   // 'r'                                           
  0x69,   // 'i'                                           
  0x70,   // 'p'                                           
  0x68,   // 'h'                                           
  0x65,   // 'e'                                           
  0x72,   // 'r'                                           
  0x61,   // 'a'                                           
  0x6c,   // 'l'                                           <i></i></span>
                                                           
  // connection interval range                             
  0x05,   // length of this data                           
  GAP_ADTYPE_SLAVE_CONN_INTERVAL_RANGE,                    
  LO_UINT16(DEFAULT_DESIRED_MIN_CONN_INTERVAL),   // 100ms 
  HI_UINT16(DEFAULT_DESIRED_MIN_CONN_INTERVAL),            
  LO_UINT16(DEFAULT_DESIRED_MAX_CONN_INTERVAL),   // 1s    
  HI_UINT16(DEFAULT_DESIRED_MAX_CONN_INTERVAL),            
                                                           
  // Tx power level                                        
  0x02,   // length of this data                           
  GAP_ADTYPE_POWER_LEVEL,                                  
  0       // 0dBm                                          
};                                                         
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>// GAP - SCAN RSP data (max size = 31 bytes)               
static uint8_t scanRspData[] =                             
{                                                          
  // complete name                                         
<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>  0x0F,   // length of this data                           </i></span>
  GAP_ADTYPE_LOCAL_NAME_COMPLETE,                          
<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>  0x53,   // 'S'                                           </i>
  0x75,   // 'u'                                           
  0x6e,   // 'n'                                           
  0x6c,   // 'l'                                           
  0x69,   // 'i'                                           
  0x67,   // 'g'                                           
  0x68,   // 'h'                                           
  0x74,   // 't'                                           
  0x53,   // 'S'                                           
  0x65,   // 'e'                                           
  0x6e,   // 'n'                                           
  0x73,   // 's'                                           
  0x6f,   // 'o'                                           
  0x72,   // 'r'                                           <i></i></span>
                                                           
  // connection interval range                             
  0x05,   // length of this data                           
  GAP_ADTYPE_SLAVE_CONN_INTERVAL_RANGE,                    
  LO_UINT16(DEFAULT_DESIRED_MIN_CONN_INTERVAL),   // 100ms 
  HI_UINT16(DEFAULT_DESIRED_MIN_CONN_INTERVAL),            
  LO_UINT16(DEFAULT_DESIRED_MAX_CONN_INTERVAL),   // 1s    
  HI_UINT16(DEFAULT_DESIRED_MAX_CONN_INTERVAL),            
                                                           
  // Tx power level                                        
  0x02,   // length of this data                           
  GAP_ADTYPE_POWER_LEVEL,                                  
  0       // 0dBm                                          
};                                                         
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li>Change the device name:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>static uint8_t attDeviceName[GAP_DEVICE_NAME_LEN] = <span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i> "Simple BLE Peripheral"; </i></span>
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>static uint8_t attDeviceName[GAP_DEVICE_NAME_LEN] = <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i> "SunlightSensor"; </i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li> Change the reset values within SimpleBLEPeripheral_init() for the attributes:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>// Setup the SimpleProfile Characteristic Values                             
  {                                                                          
    uint8_t charValue1 = 1;                                                  
    uint8_t charValue2 = 2;                                                  
<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;"><i>    uint8_t charValue3 = 3;                                                  </i>
    uint8_t charValue4 = 4;                                                  
    uint8_t charValue5[SIMPLEPROFILE_CHAR5_LEN] = { 1, 2, 3, 4, 5 };         
                                                                             
    SimpleProfile_SetParameter(SIMPLEPROFILE_CHAR1, sizeof(uint8_t),         
                               &amp;charValue1);                                 
    SimpleProfile_SetParameter(SIMPLEPROFILE_CHAR2, sizeof(uint8_t),         
                               &amp;charValue2);                                 
    SimpleProfile_SetParameter(SIMPLEPROFILE_CHAR3, sizeof(uint8_t),         
                               &amp;charValue3);                                 
    SimpleProfile_SetParameter(SIMPLEPROFILE_CHAR4, sizeof(uint8_t),         
                               &amp;charValue4);                                 
    SimpleProfile_SetParameter(SIMPLEPROFILE_CHAR5, SIMPLEPROFILE_CHAR5_LEN, 
                               charValue5);                                  
                                                                             
  }                                                                          
                                                                             
  // Register callback with SimpleGATTprofile                                
  SimpleProfile_RegisterAppCBs(&amp;SimpleBLEPeripheral_simpleProfileCBs);       
                                                                             
  // Start the Device                                                        
  VOID GAPRole_StartDevice(&amp;SimpleBLEPeripheral_gapRoleCBs);                 
                                                                             
  // Start Bond Manager                                                      
  VOID GAPBondMgr_Register(&amp;SunlightSensor_BondMgrCBs);                 
                                                                             
#if defined FEATURE_OAD                                                      
#if defined (HAL_IMAGE_A)                                                    
  LCD_WRITE_STRING_VALUE("BLE Peri-A", OAD_VER_NUM(_imgHdr.ver), 16,         
                         LCD_PAGE0);                                         
#else                                                                        
  LCD_WRITE_STRING_VALUE("BLE Peri-B", OAD_VER_NUM(_imgHdr.ver), 16,         
                         LCD_PAGE0);                                         
#endif // HAL_IMAGE_A                                                        
#else                                                                        
  LCD_WRITE_STRING("BLE Peripheral", LCD_PAGE0);                             
#endif // FEATURE_OAD                                                        
</span></pre>
<p><i></i>
</p><p><br />
</p>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre><span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>  // Setup the Sunlight Service Characteristic Values                    </i></span>
  {                                                                      
    uint8_t charValue1 = 0;                                              
    uint8_t charValue2 = 0;                                              
                                                                         
<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>    Sunlight_SetParameter(SUNLIGHT_CHAR1, sizeof(uint8_t), </i>
                               &amp;charValue1);                             
    Sunlight_SetParameter(SUNLIGHT_CHAR2, sizeof(uint8_t), 
                               &amp;charValue2);                             
  }                                                                      
                                                                         
  // Register callback with SimpleGATTprofile                            
  Sunlight_RegisterAppCBs(&amp;sunlight_AppCBs);                  
#endif //!FEATURE_OAD                                                    
                                                                         
  // Start the Device                                                    
  VOID GAPRole_StartDevice(&amp;SunlightSensor_gapRoleCBs);                  
                                                                         
  // Start Bond Manager                                                  
  VOID GAPBondMgr_Register(&amp;SunlightSensor_BondMgrCBs);                  
                                                                         
#if defined FEATURE_OAD                                                  
#if defined (HAL_IMAGE_A)                                                
  LCD_WRITE_STRING("BLE SunlightSensor A", LCD_PAGE0);                   
#else                                                                    
  LCD_WRITE_STRING("BLE SunlightSensor B", LCD_PAGE0);                   
#endif // HAL_IMAGE_A                                                    
#else                                                                    
  LCD_WRITE_STRING("BLE SunlightSensor", LCD_PAGE0);                     
#endif // FEATURE_OAD                                                    <i></i></span>
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p><p><br />
</p>
<li> Comment out the content of SunlightSensor_processCharValueChangeEvt</li>
<p>This function should never be called if your already have removed the call to this function in sunlightservice.c (which you should have done as instructed earlier in this guide). But we will comment out the content as this is referring to characteristics that no longer exists and will also result in a compilation error. In IAR you can easily comment out blocks if you mark it and press <b>CTRL+K</b>. To un-comment press <b>CTRL+SHIFT+K</b>.
<font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre>static void SimpleBLEPeripheral_processCharValueChangeEvt(uint8_t paramID) 
{                                                                                  
  uint8_t newValue;                                                                
                                                                                   
  switch(paramID)                                                                  
  {                                                                                
    case SIMPLEPROFILE_CHAR1:                                                      
      SimpleProfile_GetParameter(SIMPLEPROFILE_CHAR1, &amp;newValue);                  
                                                                                   
      LCD_WRITE_STRING_VALUE("Char 1:", (uint16_t)newValue, 10, LCD_PAGE4);        
      break;                                                                       
                                                                                   
    case SIMPLEPROFILE_CHAR3:                                                      
      SimpleProfile_GetParameter(SIMPLEPROFILE_CHAR3, &amp;newValue);                  
                                                                                   
      LCD_WRITE_STRING_VALUE("Char 3:", (uint16_t)newValue, 10, LCD_PAGE4);        
      break;                                                                       
                                                                                   
    default:                                                                       
      // should not reach here!                                                    
      break;                                                                       
  }                                                                                
}                                                                                  
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>static void SimpleBLEPeripheral_processCharValueChangeEvt(uint8_t paramID) 
{                                                                                  
<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;"><i>//  uint8_t newValue;                                                                </i>
//                                                                                   
//  switch(paramID)                                                                  
//  {                                                                                
//    case SIMPLEPROFILE_CHAR1:                                                      
//      SimpleProfile_GetParameter(SIMPLEPROFILE_CHAR1, &amp;newValue);                  
//                                                                                   
//      LCD_WRITE_STRING_VALUE("Char 1:", (uint16_t)newValue, 10, LCD_PAGE4);        
//      break;                                                                       
//                                                                                   
//    case SIMPLEPROFILE_CHAR3:                                                      
//      SimpleProfile_GetParameter(SIMPLEPROFILE_CHAR3, &amp;newValue);                  
//                                                                                   
//      LCD_WRITE_STRING_VALUE("Char 3:", (uint16_t)newValue, 10, LCD_PAGE4);        
//      break;                                                                       
//                                                                                   
//    default:                                                                       
//      // should not reach here!                                                    
//      break;                                                                       
//  }                                                                                <i></i></span>
}                                                                                  
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li>Change the content of SunlightSensor_performPeriodicTask:</li>
<p>This task will be called at a interval given in SBP_PERIODIC_EVT_PERIOD (set to 5000 ms = 5 seconds). This measn that every 5 seconds the value in characteristic 1 is copied to characteristic 2. If notifications is enabled for characteristic 2 then a notification will be sent to the GATT client if this value is changed.
<font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="none">

<tbody><tr>
<td valign="top">
<pre> static void SimpleBLEPeripheral_performPeriodicTask(void)                      
{                                                                               
  uint8_t valueToCopy;                                                          
                                                                                
  // Call to retrieve the value of the third characteristic in the profile      
  if (SimpleProfile_GetParameter(SIMPLEPROFILE_CHAR3, &amp;valueToCopy) == SUCCESS) 
  {                                                                             
    // Call to set that value of the fourth characteristic in the profile.      
    // Note that if notifications of the fourth characteristic have been        
    // enabled by a GATT client device, then a notification will be sent        
    // every time this function is called.                                      
    SimpleProfile_SetParameter(SIMPLEPROFILE_CHAR4, sizeof(uint8_t),            
                               &amp;valueToCopy);                                   
  }                                                                             
}                                                                               
</pre>
</td>
<td valign="center">
<center><div style="font-size: 350%;">&#8658;</div> </center>
</td>
<td valign="top">
<pre>static void <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">SunlightSensor</span>_performPeriodicTask(void)                                
{                                                                                   
  uint8_t valueToCopy;                                                              
                                                                                    
  // Call to retrieve the value of the first characteristic in the service          
  if (<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">Sunlight</span>_GetParameter(<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">SUNLIGHT_CHAR1</span>, &amp;valueToCopy) == SUCCESS) 
  {                                                                                 
    // Call to set that value of the second characteristic in the service.          
    // Note that if notifications of the fourth characteristic have been            
    // enabled by a GATT client device, then a notification will be sent            
    // every time this function is called.                                          
    <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">Sunlight</span>_SetParameter(<span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">SUNLIGHT_CHAR2</span>, sizeof(uint8_t),            
                               &amp;valueToCopy);                                       
  }                                                                                 
}                                                                                   
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SIMPLEPROFILE_</i> to <i>SUNLIGHT_</i></li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SimpleProfile</i> to <i>Sunlight</i></li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>simpleProfile</i> to <i>sunlight</i></li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SimpleBLEPeripheral</i> to <i>SunlightSensor_</i></li>
<li>Use <b>CTRL+H</b> to replace all occurrences of the string <i>SBP_</i> to <i>SLS_</i></li>
</ol>
</td></tr></tbody></table>
<p><br />
</p>
<h3><span class="mw-headline" id="Button_Push_Functionality">Button Push Functionality</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=24" title="Edit section: Button Push Functionality">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<table width="1000px">
<tbody><tr><td>
<p>In this section you will only edit the <b>sunlightSensor.c</b> file to implement button push functionality. You will make the up and down button to change the sunlight value (sunlight service characteristic 1 value).
</p>
<ol>

<li> Add the following include:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<pre style="background:#CCFFCC;">#include "board_key.h"
</pre>
</font><p><font size="0.8"></font>
</p>
<li> Add button related functions to LOCAL FUNCTIONS:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<pre style="background:#CCFFCC;">void SunlightSensor_keyChangeHandler(uint8 keysPressed);
static void SunlightSensor_handleKeys(uint8_t shift, uint8_t keys);
</pre>
</font><p><font size="0.8"></font>
</p>
<li> Add the following define:</li>
<p><font size="0.8">
</font></p><font size="0.8">
<pre style="background:#CCFFCC;">#define SLS_KEY_CHANGE_EVT                    0x0010
</pre>
</font><p><font size="0.8"></font>
</p>
<li> Add the function call seen below to SunlightSensor_init (previously called SimpleBLEPeripheral_init):</li>
<p><font size="0.8">
</font></p><font size="0.8">
<pre style="background:#CCFFCC;">// Initialize keys on SmartRF06EB
Board_initKeys(SunlightSensor_keyChangeHandler);
</pre>
</font><p><font size="0.8"></font>
</p>
<li> Add the following function (similar function can be found in the SimpleBLECentral Project)</li>
<p><font size="0.8">
</font></p><font size="0.8">
<pre style="background:#CCFFCC;">/*********************************************************************
 * @fn      SunlightSensor_handleKeys                                 
 *                                                                    
 * @brief   Handles all key events for this device.                   
 *                                                                    
 * @param   shift - true if in shift/alt.                             
 * @param   keys - bit field for key events. Valid entries:           
 *                 HAL_KEY_SW_2                                       
 *                 HAL_KEY_SW_1                                        
 *                                                                     
 * @return  none                                                      
 */                                                                     
static void SunlightSensor_handleKeys(uint8_t shift, uint8_t keys)
{
  (void)shift;  // Intentionally unreferenced parameter  

  uint8_t sunLight;
  Sunlight_GetParameter(SUNLIGHTSERVICE_CHAR1, &amp;sunLight);
  if (keys &amp; KEY_UP)
  {
    if (sunLight &lt; 255)
    {
      sunLight++;
      Sunlight_SetParameter(SUNLIGHTSERVICE_CHAR1, sizeof(uint8_t),
                                   &amp;sunLight);
    }
  }

  if (keys &amp; KEY_DOWN)
  {
    if (sunLight &gt; 0)
    {
      sunLight--;
      Sunlight_SetParameter(SUNLIGHTSERVICE_CHAR1, sizeof(uint8_t),
                                   &amp;sunLight);
    }
  }
  LCD_WRITE_STRING_VALUE("Sunlight:", (uint16_t)sunLight, 10, LCD_PAGE5);
  return;
}
</pre>
</font><p><font size="0.8"></font>
</p>
<li>Add a case statement in the SunlightSensor_processAppMsg function to handle key press events</li>
<p><font size="0.8">
</font></p><font size="0.8">
<table border="1" cellpadding="5" cellspacing="1" align="center">

<tbody><tr>
<td width="47%" valign="top">
<pre>static void SimpleBLEPeripheral_processAppMsg(sbpEvt_t *pMsg)
{
  switch (pMsg-&gt;event)
  {
    case SBP_STATE_CHANGE_EVT:
      SimpleBLEPeripheral_processStateChangeEvt((gaprole_States_t)pMsg-&gt;status);
      break;

    case SBP_CHAR_CHANGE_EVT:
      SimpleBLEPeripheral_processCharValueChangeEvt(pMsg-&gt;status);
      break;

    default:
      // Do nothing.
      break;
  }
}
</pre>
</td>
<td width="5%" valign="center">
<center><div style="font-size: 400%;">&#8658;</div> </center>
</td>
<td width="47%" valign="top">
<pre>static void <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">SunlightSensor</span>_processAppMsg(sbpEvt_t *pMsg)
{
  switch (pMsg-&gt;event)
  {
  case SBP_STATE_CHANGE_EVT:
    <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">SunlightSensor</span>_processStateChangeEvt((gaprole_States_t)pMsg-&gt;status);
    break;
 
  case SBP_CHAR_CHANGE_EVT:
    <span style="background-color: #CCFFCC; color:; text-align:left; line-height: 1.3em;">SunlightSensor</span>_processCharValueChangeEvt(pMsg-&gt;status);
    break;
<span style="background:#CCFFCC; line-height: 1.2em;">
  case SLS_KEY_CHANGE_EVT:                    
  SunlightSensor_handleKeys(0, pMsg-&gt;status); 
  break;                                      
</span>
  default:
    // Do nothing.
    break;
  }
}
</pre>
</td></tr></tbody></table>
</font><p><font size="0.8"></font>
</p>
<li> Add the following function to the end of the file</li>
<p><font size="0.8">
</font></p><font size="0.8">
<pre style="background:#CCFFCC;">/*********************************************************************
 * @fn      SunlightSensor__keyChangeHandler
 *
 * @brief   Key event handler function
 *
 * @param   a0 - ignored
 *
 * @return  none
 */
void SunlightSensor_keyChangeHandler(uint8 keysPressed)
{
  SunlightSensor_enqueueMsg(SLS_KEY_CHANGE_EVT, keysPressed);
}
</pre>
</font><p><font size="0.8"></font>
</p>
</ol>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h2><span id="Edit_devinfoservice.c_(Optional)"></span><span class="mw-headline" id="Edit_devinfoservice.c_.28Optional.29">Edit devinfoservice.c (Optional)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=25" title="Edit section: Edit devinfoservice.c (Optional)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>You will find this file in the <i>PROFILES</i> folder in the CC2650App workspace. You do not have to change anything here besides the strings that describe your device. You can change the strings marked in red below to what ever you desire and they will show up in BTool when you read all the characteristic values. This service is adopted by bluetooth SIG and therefore you should keep it as it is so to ensure that it is compliant according to the specification. This means that any BLE Central (Master) deceive can connect to this sunlightSensor application without having any knowledge of the sunlight service and still be able to know how to handle and present the values in the device info service.
</p>
<pre>// Model Number String characteristic                          
static uint8 devInfoModelNumberProps = GATT_PROP_READ;         
static const uint8 devInfoModelNumber[] = "<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;">Model Number</span>";      
                                                               
// Serial Number String characteristic                         
static uint8 devInfoSerialNumberProps = GATT_PROP_READ;        
static const uint8 devInfoSerialNumber[] = "<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;">Serial Number</span>";    
                                                               
// Firmware Revision String characteristic                     
static uint8 devInfoFirmwareRevProps = GATT_PROP_READ;         
static const uint8 devInfoFirmwareRev[] = "<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;">Firmware Revision</span>"; 
                                                               
// Hardware Revision String characteristic                     
static uint8 devInfoHardwareRevProps = GATT_PROP_READ;         
static const uint8 devInfoHardwareRev[] = "<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;">Hardware Revision</span>"; 
                                                               
// Software Revision String characteristic                     
static uint8 devInfoSoftwareRevProps = GATT_PROP_READ;         
static const uint8 devInfoSoftwareRev[] = "<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;">Software Revision</span>"; 
                                                               
// Manufacturer Name String characteristic                     
static uint8 devInfoMfrNameProps = GATT_PROP_READ;             
static const uint8 devInfoMfrName[] = "<span style="background-color: #FFE4E1; color:; text-align:left; line-height: 1.3em;">Manufacturer Name</span>";     
</pre>
</td></tr></tbody></table>
<p><br />
</p>
<h1><span id="Tutorial_Step_3:_Compile,_Download_and_Debug_Project"></span><span class="mw-headline" id="Tutorial_Step_3:_Compile.2C_Download_and_Debug_Project">Tutorial Step 3: Compile, Download and Debug Project</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=26" title="Edit section: Tutorial Step 3: Compile, Download and Debug Project">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<table width="1000px">
<tbody><tr><td>
<p>Now you are ready to compile and download the code to your CC2560EM. 
</p>
<ol>
<li>Compile by pressing <i>F7</i>.</li>
<dl><dt>Here are some hints to what might be wrong if you get errors while running C/C++ Compiler</dt>
<dd></dd></dl>
<div style="padding:5px; border: 4px solid Red"> 
<ol>
<li><b>Possible Naming Mismatch</b></li>
<dl><dd><u>Error/Warnings:</u>
<ul><li><i>Error[Pe020]: identifier "x" is undefined ...</i></li>
<li><i>Error[Pe114]: function "x" was referenced but not defined ...</i></li>
<li><i>Warning[Pe177]: function "x" was declared but never referenced ...</i></li>
<li><i>Warning[Pe223]: function "x" declared implicitly ...</i></li></ul></dd>
<dd><u>Solution:</u></dd>
<dd>There might be a mismatch between the function declaration and the function prototype. This might have occurred during the renaming in one of the steps above.</dd></dl>
<p><br />
</p>
<li><b>Missing or Incorrect Search Path</b></li>
<dl><dd><u>Error/Warnings:</u>
<ul><li><i>Fatal Error[Pe1696]: cannot open source file "sunlightservice.h" ...</i></li></ul></dd>
<dd><u>Solution:</u></dd>
<dd>You forgot Forgot to add the following paths to your "Additional include directories" in <span class="nowrap">Project options"-&gt;"C/C++ Compiler"-&gt;"Preprocessor":</span></dd>
<dd>$PROJ_DIR$/../../../../../../../Projects/ble/Profiles/Sunlight/CC26xx</dd>
<dd>$PROJ_DIR$/../../../../../../../Projects/ble/Profiles/Sunlight</dd></dl>
<p><br />
</p>
<li><b>Too Many Characters in Project Name</b></li>
<dl><dd><u>Error/Warnings:</u>
<ul><li><i>cannot open source file "xdc/runtime/package/Package.defs.h</i></li></ul></dd>
<dd><u>Solution:</u></dd>
<dd>The reason is because the project folder name is too long which results in really long search paths during compile. Example: SimpleBLEPeripheral_A1_BTN_LED_WayToLongProjectName</dd></dl>
<p><br />
</p>
<li><b>Missing Custom Arguments</b></li>
<dl><dd><u>Error/Warnings:</u>
<ul><li><i>Error while compile “Variable expansion failed”</i></li></ul></dd>
<dd><u>Solution:</u></dd>
<dd>The solution is to rename the SimpleBLEPeripheral.custom_argvars file to SunlightSensor.custom_argvars whoich you should have done in <a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html#Step_by_Step" title="Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK"> Tutorial Step 1</a>.</dd></dl>
</ol>
</div>
<li>Download the application image</li>
<dl><dd>IAR will likely crash at the end of the CC2640App download process. The solution is to uncheck TI RTOS in Project options -&gt; Debugger -&gt; Plugins.</dd></dl>
<li>Download the stack image</li>
<p>You may get a few warnings that is safe to ignore.
</p>
<li>Reset or Power cycle your board.</li>
<p>You can either press the <i>EM RESET</i> button on the left on the smartRF06EB or power cycle the device by toggling the OFF-ON switch. 
</p>
</ol>
</td></tr></tbody></table>
<p><br />
</p>
<h1><span class="mw-headline" id="Tutorial_Step_4:_Verify_Application_Behavior_with_BTool">Tutorial Step 4: Verify Application Behavior with BTool</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=27" title="Edit section: Tutorial Step 4: Verify Application Behavior with BTool">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<table width="1000px">
<tbody><tr><td>
<p>In this step you will verify the functionality of your application by using BTool to connect, read GATT attributes, and modify the characteristic 2 client configuration to enable notifications.
</p>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="Start_the_SunlighSensor_Application">Start the SunlighSensor Application</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=28" title="Edit section: Start the SunlighSensor Application">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>Start SunlightSensor Application on CC2650EM. When you run the code the device address will show up on line number two from the top on the SmartRF06EB LCD display. You need to have this address available for the next step to know which peripheral device you will connect to in BTool. Also you can now press the up or down button to vary the sunlight value to a arbitrary number. In this case I set it to 7. This is illustrated in the picture below.
</p>
<div class="thumb tnone"><div class="thumbinner" style="width:602px;"><a href="File_SunlightSensor06EB.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/7/78/SunlightSensor06EB.jpg" width="600" height="382" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="File_SunlightSensor06EB.html" class="internal" title="Enlarge"></a></div>SunlighSensor application connected to Master</div></div></div>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="Setup_BTool">Setup BTool</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=29" title="Edit section: Setup BTool">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>There is a detailed guide on how to setup, run and use the BTool in chapter 4 in the <a rel="nofollow" class="external text" href="http://www.ti.com/lit/ug/swru301a/swru301a.pdf">CC2541 EMK User’s Guide</a>. But you should be able to do the necessary steps by following the following guide:
</p>
<ol>
<li>Make sure that the CC2640_SmartRF_HostTestRelease_All.hex is loaded on one of the CC2650EMs.</li>
<li>Connect the SmartRF06EB+CC2650EM to your USB-port of the machine from which you will run BTool.</li>
<li>Find the Correct COM Port.</li>
<p>To do this just follow the steps illustrated in the picture below. In Win7 you can usually find the computer in the start menu, then:
<br />right-click-&gt;select properties-&gt;Device Manager-&gt;Ports(COM&amp;LPT).
</p>
</ol>
<p>You can also use a CC2540Dongle with BTool. Make sure that the HostTestApp application is loaded on the device. The CC2540Dongle comes pre-loaded with this software (<a rel="nofollow" class="external free" href="http://www.ti.com/tool/cc2540emk-usb">http://www.ti.com/tool/cc2540emk-usb</a>), so if you haven't downloaded new firmware to the device you can move to the next step. If you have used the CC-Debugger or SmartRF05EB to load different firmware then just download the CC2540_USBdongle_HostTestRelease_All.hex firmware which can be found here:
<br />C:\Texas Instruments\BLE-CC254x-1.4.0\Accessories\HexFiles
</p>
</td></tr></tbody></table>
<div class="floatnone"><a href="File_CC2540COMPort.html" class="image" title="How to find the correct COM port for the CC2540 USB Dongle"><img alt="How to find the correct COM port for the CC2540 USB Dongle" src="https://processors.wiki.ti.com/images/a/ad/CC2540COMPort.png" width="1000" height="201" /></a></div>
<table width="1000px">
<tbody><tr><td>
<ol>
<li>Start BTool.</li>
<p>When you start Btool the following boc will chow up where you can set the serial settings used to communicate with the CC2540 trough the Host Controller Interface (HCI) API. Select the COM port you found in the previous step and set the remaining settings equal to what is shown here:
</p>
<div class="floatnone"><a href="File_BToolSettings.html" class="image" title="How to find the correct COM port for the CC2540 USB Dongle"><img alt="How to find the correct COM port for the CC2540 USB Dongle" src="https://processors.wiki.ti.com/images/7/77/BToolSettings.jpg" width="200" height="215" /></a></div>
</ol>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Connect_with_BTool">Connect with BTool</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=30" title="Edit section: Connect with BTool">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<ol>
<li>Press The "Scan" button to discover your peripheral device.</li>
<li>Set the <i>Min Connection Interval</i> and <i>Max Connection Interval</i> to 10 to speed up the data exchange.</li>
<li>Select your SunlightSensor Device address in the <i>Slave BDA</i> drop down list.</li>
<li>Press the <i>Establish</i> button.</li>
<li>Then right-click on the peripheral device Handle and press <i>Discover UUIDs</i>.</li>
<li>Read characteristic 1 value (<i>Sunlight Value</i>).</li>
<p>Now all the different characteristics will show up in the bottom window in BTool. Reading the sunlight value from characteristic 1 in the sunlight service. You can do this either by left-clicking once on the sunlightService characteristic 1 value attribute or by using the <i>Characteristic Read</i> function found in the <i>Read/Write</i> tab. Because the characteristic is not part of a adopted service we will need to use the 128 bit UUID. The UUID is hown in the table below.
</p>
<center>
<table class="wikitable">
<tbody><tr>
<td>The TI-Base Custom UUID
</td>
<td>F000XXXX-0451-4000-B000-000000000000
</td></tr>
<tr>
<td>The Specific UUID for characteristic1 in the sunlightservice:
</td>
<td>F000EE01-0451-4000-B000-000000000000
</td></tr>
<tr>
<td>The format to use for reading charateristic 1 in BTool
</td>
<td>00:00:00:00:00:00:00:B0:00:40:51:04:01:EE:00:F0
</td></tr></tbody></table>
<p><br />
</p>
<div class="floatnone"><a href="File_BToolConnectGuide.html" class="image" title="Guide: Connect to sunlightSensor with BTool and read characteristics"><img alt="Guide: Connect to sunlightSensor with BTool and read characteristics" src="https://processors.wiki.ti.com/images/7/76/BToolConnectGuide.png" width="900" height="612" /></a></div>
</center>
<p><br />
</p>
<div class="floatnone"><a href="File_SunlightProfileAttributesBTool.html" class="image" title="Characteristics of the custom sunlight profile as seen in BTool"><img alt="Characteristics of the custom sunlight profile as seen in BTool" src="https://processors.wiki.ti.com/images/9/93/SunlightProfileAttributesBTool.jpg" width="900" height="413" /></a></div>
</ol>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="Enable_Notifications">Enable Notifications</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit&amp;section=31" title="Edit section: Enable Notifications">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table width="1000px">
<tbody><tr><td>
<p>We have implemented the possibility in the sunlight service to enable notifications on characteristic 2. To enable this double left-click on the <i>Client Characteristic Configuration</i> attribute in sunlight service characteristic 2 and write 01:00 to this attribute. This can also be done in the <i>Characteristic Write</i> section under the <i>Read/Write</i> tab in BTool. Now whenever the value in characteristic 2 is changed a notification will be sent from the peripheral device to your BTool device (master/Central) device and the value will be updated in BTool application GUI.
</p><p>You can test this by changing the sunlight value on your peripheral device (sunlightSensor) by pressing the up and down buttons on the evaluation board. This will immediately change the characteristic 1 value (Same as the Sunlight value printed on the LCD screen). For every 5 seconds the <i>SunlightSensor_performPeriodicTask</i> function will run where the value from characteristic 1 is copied to characteristic 2 and a notification will then be sent if this value is different than what was already previously stored in characteristic 2.
</p>
<div style="padding:0px; border: 2px solid Blue"> 
<div style="padding:0px; border: 5px solid Pink"> 
<div style="padding:0px; border: 5px solid Purple"> 
<div style="padding:0px; border: 5px solid Red"> 
<div style="padding:0px; border: 5px solid Orange"> 
<div style="padding:0px; border: 5px solid Yellow"> 
<div style="padding:5px; background:#CCFFCC; border: 5px solid Green"> 
<center><b>Congratulations!</b></center>
<center style="color:Blue">You have now completed the Tutorial and can embark on new BLE adventures </center>
</div></div></div></div></div></div></div>
</td></tr></tbody></table>

<!-- 
NewPP limit report
Cached time: 20201130072634
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.291 seconds
Real time usage: 0.304 seconds
Preprocessor visited node count: 1669/1000000
Preprocessor generated node count: 4653/1000000
Post‐expand include size: 246439/2097152 bytes
Template argument size: 232126/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 2995/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   51.305      1 -total
 73.31%   37.612     18 Template:Code2Code
 65.47%   33.587     65 Template:ColorCode
  6.52%    3.343    160 Template:=
  3.07%    1.574      1 Template:Nowrap
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:37701-0!canonical and timestamp 20201130072633 and revision id 211082
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>Tutorial: How to Create a Custom Bluetooth Smart Embedded Application with the CC2650DK</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;oldid=211082">https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;oldid=211082</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Categories</a>: <ul><li><a href="Category_Bluetooth_/_Bluetooth_Low_Energy.html" title="Category:Bluetooth / Bluetooth Low Energy">Bluetooth / Bluetooth Low Energy</a></li><li><a href="https://processors.wiki.ti.com/index.php?title=Category:Pages_with_broken_file_links&amp;action=edit&amp;redlink=1" class="new" title="Category:Pages with broken file links (page does not exist)">Pages with broken file links</a></li><li><a href="https://processors.wiki.ti.com/index.php?title=Category:Template_examples&amp;action=edit&amp;redlink=1" class="new" title="Category:Template examples (page does not exist)">Template examples</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=Tutorial%3A+How+to+Create+a+Custom+Bluetooth+Smart+Embedded+Application+with+the+CC2650DK" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk"><span><a href="Talk_Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/Tutorial__How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;oldid=211082" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 21 December 2015, at 07:38.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.291","walltime":"0.304","ppvisitednodes":{"value":1669,"limit":1000000},"ppgeneratednodes":{"value":4653,"limit":1000000},"postexpandincludesize":{"value":246439,"limit":2097152},"templateargumentsize":{"value":232126,"limit":2097152},"expansiondepth":{"value":4,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":2995,"limit":5000000},"timingprofile":["100.00%   51.305      1 -total"," 73.31%   37.612     18 Template:Code2Code"," 65.47%   33.587     65 Template:ColorCode","  6.52%    3.343    160 Template:=","  3.07%    1.574      1 Template:Nowrap"]},"cachereport":{"timestamp":"20201130072634","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":239});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/Tutorial:_How_to_Create_a_Custom_Bluetooth_Smart_Embedded_Application_with_the_CC2650DK by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 08:20:42 GMT -->
</html>
