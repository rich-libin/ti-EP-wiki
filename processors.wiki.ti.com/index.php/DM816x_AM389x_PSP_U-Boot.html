<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/DM816x_AM389x_PSP_U-Boot by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 06:48:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>DM816x AM389x PSP U-Boot - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"DM816x_AM389x_PSP_U-Boot","wgTitle":"DM816x AM389x PSP U-Boot","wgCurRevisionId":101704,"wgRevisionId":101704,"wgArticleId":8901,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"DM816x_AM389x_PSP_U-Boot","wgRelevantArticleId":8901,"wgRequestId":"af97c303dc89b907db266eb5","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-DM816x_AM389x_PSP_U-Boot rootpage-DM816x_AM389x_PSP_U-Boot skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">DM816x AM389x PSP U-Boot</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div style="width:800px; text-align:justify;"> 
<div style="display:block; clear: both; margin: 10px 0px; padding: 0px; background-color: #ee1d23; text-align:right;"><a href="File_TIBanner.html" class="image"><img alt="TIBanner.png" src="https://processors.wiki.ti.com/images/c/cd/TIBanner.png" width="667" height="87" /></a></div>
<div style="display:block; margin: 5px 0px; padding: 2px 5px; font-size:1.5em; font-weight:bold; text-align:left;">DM816x C6A816x AM389x PSP U-Boot</div>
<div style="display:block; margin: 5px 0px; padding: 2px; color: #666666; font-size:1.0em; font-weight:bold; text-align:right;">Linux PSP</div> 
<p><br /> 
</p>
<div style="width:800px; text-align:left;"><div style="display:block; margin: 10px 0px; padding: 0px; text-align:left;">
<div style="margin: 5px; padding: 5px 10px; background-color: #ffffec; border-left: 5px solid #ff6600;"><b>IMPORTANT</b><br /><br />DM816x refers to DM816x/AM389x devices unless specified.<br />DM814x refers to DM814x/AM387x devices unless specified.<br />DM81xx refers to both DM816x, DM814x and DM813x.<br /></div>
</div></div> 
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Read_This_First"><span class="tocnumber">1</span> <span class="toctext"><b>Read This First</b></span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#U-Boot"><span class="tocnumber">2</span> <span class="toctext"><b>U-Boot</b></span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Modifying_U-Boot_for_DDR2"><span class="tocnumber">2.1</span> <span class="toctext"><b>Modifying U-Boot for DDR2</b></span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Modifying_U-Boot_DDR3_frequency"><span class="tocnumber">2.2</span> <span class="toctext"><b>Modifying U-Boot DDR3 frequency</b></span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Building_U-Boot"><span class="tocnumber">2.3</span> <span class="toctext"><b>Building U-Boot</b></span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#U-Boot_for_NAND_boot"><span class="tocnumber">2.3.1</span> <span class="toctext">U-Boot for NAND boot</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#U-Boot_for_SPI_boot"><span class="tocnumber">2.3.2</span> <span class="toctext">U-Boot for SPI boot</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#U-Boot_for_NOR_boot"><span class="tocnumber">2.3.3</span> <span class="toctext">U-Boot for NOR boot</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#U-Boot_for_SD_boot"><span class="tocnumber">2.3.4</span> <span class="toctext">U-Boot for SD boot</span></a>
<ul>
<li class="toclevel-4 tocsection-10"><a href="#U-Boot_1st_stage_for_SD_boot"><span class="tocnumber">2.3.4.1</span> <span class="toctext">U-Boot 1st stage for SD boot</span></a></li>
<li class="toclevel-4 tocsection-11"><a href="#U-Boot_2nd_stage_with_ENV_on_SD_Card"><span class="tocnumber">2.3.4.2</span> <span class="toctext"><b>U-Boot 2nd stage with ENV on SD Card</b></span></a></li>
<li class="toclevel-4 tocsection-12"><a href="#U-Boot_2nd_stage_with_ENV_on_NAND_and_SPI"><span class="tocnumber">2.3.4.3</span> <span class="toctext"><b>U-Boot 2nd stage with ENV on NAND and SPI</b></span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-13"><a href="#U-Boot_quick-boot_1st_stage_for_SD"><span class="tocnumber">2.3.5</span> <span class="toctext">U-Boot quick-boot 1st stage for SD</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#U-Boot_quick-boot_2nd_stage_for_SD"><span class="tocnumber">2.3.6</span> <span class="toctext">U-Boot quick-boot 2nd stage for SD</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="#Serial_port_configuration"><span class="tocnumber">2.4</span> <span class="toctext"><b>Serial port configuration</b></span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#EVM_Switch_Settings"><span class="tocnumber">2.5</span> <span class="toctext"><b>EVM Switch Settings</b></span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#NAND_boot_mode"><span class="tocnumber">2.5.1</span> <span class="toctext">NAND boot mode</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#NOR_boot_mode"><span class="tocnumber">2.5.2</span> <span class="toctext">NOR boot mode</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#SPI_boot_mode"><span class="tocnumber">2.5.3</span> <span class="toctext">SPI boot mode</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#SD_boot_mode"><span class="tocnumber">2.5.4</span> <span class="toctext">SD boot mode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="#Flashing_U-Boot_using_CCS"><span class="tocnumber">2.6</span> <span class="toctext"><b>Flashing U-Boot using CCS</b></span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Flashing_U-Boot_without_CCS"><span class="tocnumber">2.7</span> <span class="toctext"><b>Flashing U-Boot without CCS</b></span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="#SD-Flash-Method"><span class="tocnumber">2.7.1</span> <span class="toctext">SD-Flash-Method</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#EMAC-Flash-Method"><span class="tocnumber">2.7.2</span> <span class="toctext">EMAC-Flash-Method</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#U-Boot_NAND_Support"><span class="tocnumber">2.8</span> <span class="toctext"><b>U-Boot NAND Support</b></span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="#Overview"><span class="tocnumber">2.8.1</span> <span class="toctext"><b>Overview</b></span></a>
<ul>
<li class="toclevel-4 tocsection-27"><a href="#NAND_Layout"><span class="tocnumber">2.8.1.1</span> <span class="toctext"><b>NAND Layout</b></span></a></li>
<li class="toclevel-4 tocsection-28"><a href="#Writing_to_Nand"><span class="tocnumber">2.8.1.2</span> <span class="toctext"><b>Writing to Nand</b></span></a></li>
<li class="toclevel-4 tocsection-29"><a href="#Reading_from_Nand"><span class="tocnumber">2.8.1.3</span> <span class="toctext"><b>Reading from Nand</b></span></a></li>
<li class="toclevel-4 tocsection-30"><a href="#Marking_a_bad_block"><span class="tocnumber">2.8.1.4</span> <span class="toctext"><b>Marking a bad block</b></span></a></li>
<li class="toclevel-4 tocsection-31"><a href="#Viewing_bad_blocks"><span class="tocnumber">2.8.1.5</span> <span class="toctext"><b>Viewing bad blocks</b></span></a></li>
<li class="toclevel-4 tocsection-32"><a href="#Erasing_Nand"><span class="tocnumber">2.8.1.6</span> <span class="toctext"><b>Erasing Nand</b></span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-33"><a href="#NAND_ECC_algorithm_selection"><span class="tocnumber">2.8.2</span> <span class="toctext"><b>NAND ECC algorithm selection</b></span></a>
<ul>
<li class="toclevel-4 tocsection-34"><a href="#BCH_Flash_OOB_Layout"><span class="tocnumber">2.8.2.1</span> <span class="toctext"><b>BCH Flash OOB Layout</b></span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-35"><a href="#Transferring_images_to_NAND_via_U-Boot"><span class="tocnumber">2.8.3</span> <span class="toctext"><b>Transferring images to NAND via U-Boot</b></span></a>
<ul>
<li class="toclevel-4 tocsection-36"><a href="#Flashing_U-Boot_from_U-Boot"><span class="tocnumber">2.8.3.1</span> <span class="toctext"><b>Flashing U-Boot from U-Boot</b></span></a></li>
<li class="toclevel-4 tocsection-37"><a href="#Flashing_Linux_Kernel_from_U-Boot"><span class="tocnumber">2.8.3.2</span> <span class="toctext">Flashing Linux Kernel from U-Boot</span></a></li>
<li class="toclevel-4 tocsection-38"><a href="#Creating_UBIFS_File-System"><span class="tocnumber">2.8.3.3</span> <span class="toctext">Creating UBIFS File-System</span></a></li>
<li class="toclevel-4 tocsection-39"><a href="#Creating_JFFS2_File-system"><span class="tocnumber">2.8.3.4</span> <span class="toctext">Creating JFFS2 File-system</span></a></li>
<li class="toclevel-4 tocsection-40"><a href="#Flashing_File-system_from_U-Boot"><span class="tocnumber">2.8.3.5</span> <span class="toctext">Flashing File-system from U-Boot</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-41"><a href="#U-Boot_NOR_Support"><span class="tocnumber">2.9</span> <span class="toctext"><b>U-Boot NOR Support</b></span></a>
<ul>
<li class="toclevel-3 tocsection-42"><a href="#Overview_2"><span class="tocnumber">2.9.1</span> <span class="toctext"><b>Overview</b></span></a>
<ul>
<li class="toclevel-4 tocsection-43"><a href="#NOR_Pin_Muxing_Info_for_DM816x_EVM"><span class="tocnumber">2.9.1.1</span> <span class="toctext">NOR Pin Muxing Info for DM816x EVM</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-44"><a href="#NOR_Support"><span class="tocnumber">2.9.2</span> <span class="toctext">NOR Support</span></a>
<ul>
<li class="toclevel-4 tocsection-45"><a href="#Config_Macros"><span class="tocnumber">2.9.2.1</span> <span class="toctext">Config Macros</span></a></li>
<li class="toclevel-4 tocsection-46"><a href="#NOR_Layout"><span class="tocnumber">2.9.2.2</span> <span class="toctext"><b>NOR Layout</b></span></a></li>
<li class="toclevel-4 tocsection-47"><a href="#Writing_to_NOR"><span class="tocnumber">2.9.2.3</span> <span class="toctext"><b>Writing to NOR</b></span></a></li>
<li class="toclevel-4 tocsection-48"><a href="#Reading_from_NOR"><span class="tocnumber">2.9.2.4</span> <span class="toctext"><b>Reading from NOR</b></span></a></li>
<li class="toclevel-4 tocsection-49"><a href="#Erasing_NOR"><span class="tocnumber">2.9.2.5</span> <span class="toctext"><b>Erasing NOR</b></span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-50"><a href="#Transferring_images_to_NOR_via_U-Boot"><span class="tocnumber">2.9.3</span> <span class="toctext"><b>Transferring images to NOR via U-Boot</b></span></a>
<ul>
<li class="toclevel-4 tocsection-51"><a href="#Flashing_U-Boot_from_U-Boot_2"><span class="tocnumber">2.9.3.1</span> <span class="toctext"><b>Flashing U-Boot from U-Boot</b></span></a></li>
<li class="toclevel-4 tocsection-52"><a href="#Flashing_Linux_Kernel_from_U-Boot_2"><span class="tocnumber">2.9.3.2</span> <span class="toctext">Flashing Linux Kernel from U-Boot</span></a></li>
<li class="toclevel-4 tocsection-53"><a href="#Creating_JFFS2_File-system_2"><span class="tocnumber">2.9.3.3</span> <span class="toctext">Creating JFFS2 File-system</span></a></li>
<li class="toclevel-4 tocsection-54"><a href="#Flashing_File-system_from_U-Boot_2"><span class="tocnumber">2.9.3.4</span> <span class="toctext">Flashing File-system from U-Boot</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-55"><a href="#U-Boot_SPI_Support"><span class="tocnumber">2.10</span> <span class="toctext"><b>U-Boot SPI Support</b></span></a>
<ul>
<li class="toclevel-3 tocsection-56"><a href="#Overview_3"><span class="tocnumber">2.10.1</span> <span class="toctext"><b>Overview</b></span></a>
<ul>
<li class="toclevel-4 tocsection-57"><a href="#SPI_Flash_Layout"><span class="tocnumber">2.10.1.1</span> <span class="toctext"><b>SPI Flash Layout</b></span></a></li>
<li class="toclevel-4 tocsection-58"><a href="#Writing_to_SPI_Flash"><span class="tocnumber">2.10.1.2</span> <span class="toctext"><b>Writing to SPI Flash</b></span></a></li>
<li class="toclevel-4 tocsection-59"><a href="#Reading_from_SPI_Flash"><span class="tocnumber">2.10.1.3</span> <span class="toctext"><b>Reading from SPI Flash</b></span></a></li>
<li class="toclevel-4 tocsection-60"><a href="#Erasing_SPI_Flash"><span class="tocnumber">2.10.1.4</span> <span class="toctext"><b>Erasing SPI Flash</b></span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-61"><a href="#Transferring_images_to_SPI_flash_via_U-Boot"><span class="tocnumber">2.10.2</span> <span class="toctext"><b>Transferring images to SPI flash via U-Boot</b></span></a>
<ul>
<li class="toclevel-4 tocsection-62"><a href="#Flashing_U-Boot_from_U-Boot_3"><span class="tocnumber">2.10.2.1</span> <span class="toctext"><b>Flashing U-Boot from U-Boot</b></span></a></li>
<li class="toclevel-4 tocsection-63"><a href="#Flashing_Linux_Kernel_from_U-Boot_3"><span class="tocnumber">2.10.2.2</span> <span class="toctext">Flashing Linux Kernel from U-Boot</span></a></li>
<li class="toclevel-4 tocsection-64"><a href="#Creating_JFFS2_File-system_3"><span class="tocnumber">2.10.2.3</span> <span class="toctext">Creating JFFS2 File-system</span></a></li>
<li class="toclevel-4 tocsection-65"><a href="#Flashing_File-system_from_U-Boot_3"><span class="tocnumber">2.10.2.4</span> <span class="toctext">Flashing File-system from U-Boot</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-66"><a href="#U-Boot_SD_.28Secured_Digital_card.29_Support"><span class="tocnumber">2.11</span> <span class="toctext"><b>U-Boot SD (Secured Digital card) Support</b></span></a>
<ul>
<li class="toclevel-3 tocsection-67"><a href="#Overview_4"><span class="tocnumber">2.11.1</span> <span class="toctext"><b>Overview</b></span></a></li>
<li class="toclevel-3 tocsection-68"><a href="#Setting_Up_Boot_Environment_on_SD_Card"><span class="tocnumber">2.11.2</span> <span class="toctext"><b>Setting Up Boot Environment on SD Card</b></span></a></li>
<li class="toclevel-3 tocsection-69"><a href="#Boot_using_SD_card"><span class="tocnumber">2.11.3</span> <span class="toctext">Boot using SD card</span></a></li>
<li class="toclevel-3 tocsection-70"><a href="#Flashing_U-Boot_to_NAND_using_SD_boot"><span class="tocnumber">2.11.4</span> <span class="toctext"><b>Flashing U-Boot to NAND using SD boot</b></span></a></li>
<li class="toclevel-3 tocsection-71"><a href="#Flashing_U-Boot_to_SPI_using_SD_boot"><span class="tocnumber">2.11.5</span> <span class="toctext"><b>Flashing U-Boot to SPI using SD boot</b></span></a></li>
<li class="toclevel-3 tocsection-72"><a href="#ENV_on_SD_card_using_a_script"><span class="tocnumber">2.11.6</span> <span class="toctext"><b>ENV on SD card using a script</b></span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-73"><a href="#U-Boot_Network_configuration"><span class="tocnumber">2.12</span> <span class="toctext"><b>U-Boot Network configuration</b></span></a></li>
<li class="toclevel-2 tocsection-74"><a href="#U-Boot_Environment_Variables"><span class="tocnumber">2.13</span> <span class="toctext"><b>U-Boot Environment Variables</b></span></a>
<ul>
<li class="toclevel-3 tocsection-75"><a href="#Environment_Settings_for_Ramdisk"><span class="tocnumber">2.13.1</span> <span class="toctext">Environment Settings for Ramdisk</span></a></li>
<li class="toclevel-3 tocsection-76"><a href="#Environment_Settings_for_JFFS2_Filesystem"><span class="tocnumber">2.13.2</span> <span class="toctext"><b>Environment Settings for JFFS2 Filesystem</b></span></a></li>
<li class="toclevel-3 tocsection-77"><a href="#Environment_Settings_for_NFS_Filesystem"><span class="tocnumber">2.13.3</span> <span class="toctext"><b>Environment Settings for NFS Filesystem</b></span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-78"><a href="#Booting_the_kernel"><span class="tocnumber">2.14</span> <span class="toctext">Booting the kernel</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Read_This_First"><b>Read This First</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=1" title="Edit section: Read This First">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<div style="padding: 5px; background: none repeat scroll 0% 0% rgb(238, 238, 238); color: rgb(255, 0, 0);">
<p>This section show the major updates since last release, please review this section before any SW activities. 
</p>
<ul><li>We have migrating from "legacy" mmc driver to a "generic" mmc driver in the latest u-boot as a part of quick boot patched. The new mmc driver has a different set of commands.This will break the existing boot script used. Please refer the U-boot user guide and update you scripts according to that.</li></ul>
<p>Example
</p>
<pre>$<font color="RED">mmc init</font> must be replaced with $<font color="blue">mmc rescan 0</font>

</pre>
<p>The mmc channel number must be “0” in all commands instead of “1”
</p>
<pre>$<font color="RED">fatls mmc 1</font> must be replaced with $<font color="blue">fatls mmc 0</font>
$<font color="RED">fatload mmc 1 &lt;address&gt; &lt;file&gt;</font> must be replaced with $<font color="blue">fatls mmc 0 &lt;address&gt; &lt;file&gt;</font>
</pre>
<ul><li>Quick-boot support from MMC/SD is added in this release. Please follow the steps in the user guide to build a quick-boot binaries. Refer <a href="DM81XX_Quick_Boot_Measurements.html" title="DM81XX Quick Boot Measurements">DM81XX_Quick_Boot_Measurements</a>.</li></ul>
</div>
<h1><span class="mw-headline" id="U-Boot"><b>U-Boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=2" title="Edit section: U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>In DM816x the ROM code serves as the first stage bootloader. The 2nd stage bootloader is based on <a rel="nofollow" class="external text" href="http://www.denx.de/wiki/U-Boot/WebHome">U-Boot</a>. It does the bare minimum configuration needed to boot the kernel and in the process relocates itself to DDR. 
</p><p>In case of NAND/SPI/SD boot mode, the ROM code loads the U-Boot image from the flash memory into OCMC RAM1. In case of NOR boot mode, the ROM code passes the control to the U-Boot image in NOR memory after some basic initialization. 
</p><p><b>Size of U-Boot (TEXT + BSS section) cannot exceed 255KB </b> 
</p>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(21,27,84); padding-top: 5px">
<p><b>Note</b><br />To avoid over-writing U-Boot when it is executing make sure that an address greater than 0x80800000 is used when downloading the kernel and/or filesystem images
</p>
</div>
<h2><span class="mw-headline" id="Modifying_U-Boot_for_DDR2"><b>Modifying U-Boot for DDR2</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=3" title="Edit section: Modifying U-Boot for DDR2">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(21,27,84); padding-top: 5px">
<p><b>Note</b><br />The pre-built U-Boot binaries that comes in the release package has been built for DDR3 based EVM and the configuration is for <b>DDR3@400MHz</b> I/O clk. The binaries MLO and u-boot.bin are meant for SD boot and u-boot.noxip.bin is for flashing to NAND. If you have a DDR3 based EVM and wish to use the pre-built U-Boot image for flashing to NAND or if you want to use SD boot proceed to the <a href="#Flashing_U-Boot_using_CCS">Flashing U-Boot</a> section
</p>
</div>
<p><br />
This section described how to modify the U-Boot source to enable DDR2 support.
</p>
<ul><li>Open the file <i>arch/arm/include/asm/arch-ti81xx/clocks_ti816x.h</i> and modify the #define as shown below</li></ul>
<pre>#define DDR_PLL_400     /* Values supported 400,531,675,796 */
</pre>
<ul><li>Open the file <i>include/configs/ti8168_evm.h</i> and make sure that the config option for DDR2 is not commented and that for DDR3 is commented out as shown below</li></ul>
<pre>[...]
//#define CONFIG_TI816X_EVM_DDR3                  /* Configure DDR3 in U-Boot */
#define CONFIG_TI816X_EVM_DDR2                /* Configure DDR2 in U-Boot */
[...]
</pre>
<h2><span class="mw-headline" id="Modifying_U-Boot_DDR3_frequency"><b>Modifying U-Boot DDR3 frequency</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=4" title="Edit section: Modifying U-Boot DDR3 frequency">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section described how to modify the U-Boot source to change the DDR3 frequency on DM816x EVMs. Currently the following are the supported frequencies on the DM816x EVM.
</p>
<ul><li>400MHz</li>
<li>531MHz</li>
<li>675MHz</li>
<li>796MHz</li></ul>
<p>The default configuration is for DDR3@796MHz.
</p>
<ul><li>Open the file <i>arch/arm/include/asm/arch-ti81xx/ddr_defs.h</i> and modify the number in the #define shown below to the required frequency.</li></ul>
<pre>#define CONFIG_TI8168_DDR3_796     /* Values supported 400,531,675,796 */
</pre>
<ul><li>Open the file <i>arch/arm/include/asm/arch-ti81xx/clocks_ti816x.h</i> and modify the number in the #define shown below to the required frequency. The number used here should be the same as the that in the previous step.</li></ul>
<pre>#define DDR_PLL_796     /* Values supported 400,531,675,796 */
</pre>
<ul><li>Open the file <i>include/configs/ti8168_evm.h</i> and make sure that the config option for DDR3 is not commented and that for DDR2 is commented out as shown below</li></ul>
<pre>[...]
#define CONFIG_TI816X_EVM_DDR3                  /* Configure DDR3 in U-Boot */
//#define CONFIG_TI816X_EVM_DDR2                /* Configure DDR2 in U-Boot */
[...]
</pre>
<p>Once these changes are done, recompile U-Boot as described in this User-Guide.
</p>
<h2><span class="mw-headline" id="Building_U-Boot"><b>Building U-Boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=5" title="Edit section: Building U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>U-Boot supports saving environment variables to NAND, SPI or NOR. The media to be used for saving the ENV variables needs to be decided before building U-Boot. The default behavior is to place the ENV section of U-Boot (where the environment variables are stored) in the same media for which U-Boot was built.
</p>
<h3><span class="mw-headline" id="U-Boot_for_NAND_boot">U-Boot for NAND boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=6" title="Edit section: U-Boot for NAND boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>U-Boot for NAND boot is meant to be flashed to NAND using the NAND flash-writer or from an already running U-Boot. This can also serve as 2nd stage of SD boot as described later on.
</p>
<pre>$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm distclean
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm ti8168_evm_config_nand
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm u-boot.ti
</pre>
<p>This will generate binaries named <b>u-boot.noxip.bin</b> and <b>u-boot.bin</b>. Use u-boot.noxip.bin for flashing to NAND.
</p>
<h3><span class="mw-headline" id="U-Boot_for_SPI_boot">U-Boot for SPI boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=7" title="Edit section: U-Boot for SPI boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>U-Boot for SPI boot is meant to be flashed to SPI using the SPI flash-writer or from an already running U-Boot. This can also serve as 2nd stage of SD boot as described later on.
</p>
<pre>$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm distclean
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm ti8168_evm_config_spi
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm u-boot.ti
</pre>
<p>This will generate binaries named <b>u-boot.noxip.bin.spi</b> and <b>u-boot.bin</b>. Use u-boot.noxip.bin for flashing to SPI.
</p>
<h3><span class="mw-headline" id="U-Boot_for_NOR_boot">U-Boot for NOR boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=8" title="Edit section: U-Boot for NOR boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>U-Boot for NOR boot is meant to be flashed to NOR using the NOR flash-writer.
</p>
<pre>$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm distclean
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm ti8168_evm_config_nor
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm u-boot.ti
</pre>
<p>This will generate a binary named <b>u-boot.bin</b> which has to be used for flashing to NOR.
</p>
<h3><span class="mw-headline" id="U-Boot_for_SD_boot">U-Boot for SD boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=9" title="Edit section: U-Boot for SD boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>ROM boot loader for SD Boot limits the (FAT32/VFAT) file size of the loader binary to max of 128K.  
Due to this reason we adopt a 2 stage boot strategy when booting out of SD card. In the first stage 
a very minimal version of U-Boot (just enough to support SD in u-boot - u-boot.min.sd/MLO) is booted 
by the RBL from the SD media. The second stage then boots the actual u-boot binary (u-boot.bin from SD card) 
that has extended support for other peripherals like NAND/NOR/SPI/I2C etc. 
</p>
<h4><span class="mw-headline" id="U-Boot_1st_stage_for_SD_boot">U-Boot 1st stage for SD boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=10" title="Edit section: U-Boot 1st stage for SD boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre>$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm distclean
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm ti8168_evm_min_sd
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm u-boot.ti
</pre>
<p>This will generate a file <b>u-boot.min.sd</b> which needs to be renamed to MLO.
</p>
<div style="margin: 5px; padding: 5px 10px; background-color: #ffffec; border-left: 5px solid #ff6600;">
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  Saving u-boot environment variables in MMC/SD support is only applicable to 04.00.02.14 or higher Release. Older versions of u-boot must use NAND or SPI images.
</p>
</div>
<h4><span class="mw-headline" id="U-Boot_2nd_stage_with_ENV_on_SD_Card"><b>U-Boot 2nd stage with ENV on SD Card</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=11" title="Edit section: U-Boot 2nd stage with ENV on SD Card">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre>$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm distclean
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm ti8168_evm_config_sd
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm u-boot.ti
</pre>
<p>This will generate a binary named u-boot.bin which saves the ENV onto SD Card flash.
</p>
<h4><span class="mw-headline" id="U-Boot_2nd_stage_with_ENV_on_NAND_and_SPI"><b>U-Boot 2nd stage with ENV on NAND and SPI</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=12" title="Edit section: U-Boot 2nd stage with ENV on NAND and SPI">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The binary <b>u-boot.bin</b> generated in U-Boot for NAND boot or in U-Boot for SPI boot can be used as the 2nd stage for SD boot. The binary to be used depends on where the user wants to save the ENV variables. If <b>u-boot.bin</b> from <a href="#U-Boot_for_NAND_boot">U-Boot for NAND boot</a> is used then ENV is stored in NAND and if <b>u-boot.bin</b> from <a href="#U-Boot_for_SPI_boot">U-Boot for SPI boot</a> is used then ENV is stored in SPI.
</p><p>The section on <a href="#U-Boot_SD_.28Secured_Digital_card.29_Support">U-Boot SD support</a> gives more information about using the 2 images that are generated for SD boot.
</p>
<h3><span class="mw-headline" id="U-Boot_quick-boot_1st_stage_for_SD">U-Boot quick-boot 1st stage for SD</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=13" title="Edit section: U-Boot quick-boot 1st stage for SD">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Quick-boot enable a faster booting using the SD card images . Quick boot removed the boot delay and suppress the console message from the u-boot. It uses a separate configuration file "include/configs/ti8168_evm_quick_mmc.h"
for building the quick-boot images.Please follow the steps to build 1st stage quick-boot images for mmc. 
</p>
<pre>$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm distclean
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm ti8168_evm_config_quick_mmc_min
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm u-boot.ti
</pre>
<p>This will generate a file <b>u-boot.min.sd</b> which needs to be renamed to MLO.
</p>
<h3><span class="mw-headline" id="U-Boot_quick-boot_2nd_stage_for_SD">U-Boot quick-boot 2nd stage for SD</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=14" title="Edit section: U-Boot quick-boot 2nd stage for SD">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The 2nd stage quick-boot images for mmc is generated from the same quick-boot config file "include/configs/ti8168_evm_quick_mmc.h". The u-boot image will load the kernel from the sd card.The env "quite" is passed by default from the u-boot .
Normal messages about hardware detection at boot are suppressed ,only important and system critical kernel messages are printed to the console.
It also avoid the boot delay by setting it to 0 .
</p>
<pre>$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm distclean
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm ti8168_evm_config_quick_mmc
$ make CROSS_COMPILE=arm-none-linux-gnueabi- ARCH=arm u-boot.ti
</pre>
<p>This will generate binaries named <b>u-boot.noxip.bin</b> and <b>u-boot.bin</b>. Use u-boot.bin for boot from mmc.
</p><p>Refer this <a href="DM81XX_Quick_Boot_Measurements.html" title="DM81XX Quick Boot Measurements">DM81XX_Quick_Boot_Measurements</a> for more information.
</p>
<h2><span class="mw-headline" id="Serial_port_configuration"><b>Serial port configuration</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=15" title="Edit section: Serial port configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Connect a serial cable from the serial port of the EVM (there are two serial ports on the EVM, use the one which is next to the MMC/SD slot) to the COM port on either the Windows machine or Linux host depending on where you'll be running the serial terminal software. 
</p><p>For correct operation the serial terminal software should be configured with the following settings: 
</p>
<pre>   * Baud rate: 115,200
   * Data bits: 8
   * Parity: None
   * Stop bits: 1
   * Flow control: None
   * Transmit delay: 0 msec/char, 100 msec/line 
</pre>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(21,27,84); padding-top: 5px">
<p>If Teraterm is being used ensure that the latest version (4.67) of Teraterm is installed. The implementation of the kermit protocol in Teraterm is not reliable in older versions. The latest version of Teraterm 4.67 can be downloaded from <a rel="nofollow" class="external text" href="http://logmett.com/index.php?/download/tera-term-467.html">here</a>
</p>
</div>
<h2><span class="mw-headline" id="EVM_Switch_Settings"><b>EVM Switch Settings</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=16" title="Edit section: EVM Switch Settings">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The picture below captures the boot mode configuration switch SW3 on the DM8168 EVM. 
<b>NOTE</b>&#160;: The bootmode setting in this picture is for NAND boot.
</p><p><a href="File_Ti8168_dip_switch.html" class="image"><img alt="Ti8168 dip switch.png" src="https://processors.wiki.ti.com/images/8/85/Ti8168_dip_switch.png" width="460" height="125" /></a> <a href="File_Nand_spi_dip_switch.html" class="image"><img alt="Nand spi dip switch.png" src="https://processors.wiki.ti.com/images/c/c3/Nand_spi_dip_switch.png" width="140" height="125" /></a> 
</p><p><b>NAND BOOT MODE SW-3[9:0] 0000010010 SW-4[1:0] 10 [NAND/SPI]</b> 
] 
</p><p>Make sure that the EVM boot switch settings are set to the required boot mode and then power on the board.
</p>
<h3><span class="mw-headline" id="NAND_boot_mode">NAND boot mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=17" title="Edit section: NAND boot mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<pre>SW3----&gt;BTM[4:0] ==&gt; 10010   (other pins should be 0 i.e. OFF)
SW4----&gt;NAND ON
Daughter Card SW1----&gt;SW1[3:0] ==&gt; 0000 (all off)
</pre>
<h3><span class="mw-headline" id="NOR_boot_mode">NOR boot mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=18" title="Edit section: NOR boot mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<pre>SW3----&gt;CS0BW (i.e pin 8) 1 (should be ON)
SW3----&gt;BTM[4:0] ==&gt; 10000   
SW4----&gt;NAND OFF
Daughter Card (RevA) SW1----&gt;SW1[3:0] ==&gt; 0001 
IODC (RevA) and other Daughter Cards (RevB) SW1----&gt;SW1[3:0] ==&gt; 0011
</pre>
<h3><span class="mw-headline" id="SPI_boot_mode">SPI boot mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=19" title="Edit section: SPI boot mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<pre> SW3----&gt;BTM[4:0] ==&gt; 10110   (other pins should be 0 i.e. OFF)
 SW4----&gt;SPI ON
</pre>
<h3><span class="mw-headline" id="SD_boot_mode">SD boot mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=20" title="Edit section: SD boot mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<pre> SW3---BTM[4:0] ==&gt; 10111 (other pins should be 0 i.e. OFF)
 SW4---(as appropriate depending on where the ENV variables need to be stored - SPI/NAND)
</pre>
<h2><span class="mw-headline" id="Flashing_U-Boot_using_CCS"><b>Flashing U-Boot using CCS</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=21" title="Edit section: Flashing U-Boot using CCS">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>You can flash u-boot onto NAND (for NAND boot), to NOR (NOR Boot) or to SPI (SPI boot).
</p><p>Refer to <a href="DM816x_C6A816x_AM389x_PSP_Flashing_Tools_Guide.html#Burning_NAND_Flash_.28using_CCS.29" class="mw-redirect" title="DM816x C6A816x AM389x PSP Flashing Tools Guide"> Flashing to NAND Flash using CCS</a> wiki page for instructions on how to flash the pre-built U-Boot binary (or the recompiled one) with the help of the NAND flash writer. 
</p><p>Refer to <a href="DM816x_C6A816x_AM389x_PSP_Flashing_Tools_Guide.html#Burning_NOR_Flash_.28using_CCS.29" class="mw-redirect" title="DM816x C6A816x AM389x PSP Flashing Tools Guide"> Flashing to NOR Flash using CCS</a> wiki page for instructions on how to flash the pre-built U-Boot binary (or the recompiled one) with the help of the NOR flash writer. 
</p><p>Refer to <a href="DM816x_C6A816x_AM389x_PSP_Flashing_Tools_Guide.html#Burning_SPI_Flash_.28using_CCS.29" class="mw-redirect" title="DM816x C6A816x AM389x PSP Flashing Tools Guide"> Flashing to SPI Flash using CCS</a> wiki page for instructions on how to flash the pre-built U-Boot binary (or the recompiled one) with the help of the SPI flash writer. 
</p><p>After flashing the image, configure the EVM switches as per the information provided in EVM switch settings section.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Flashing_U-Boot_without_CCS"><b>Flashing U-Boot without CCS</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=22" title="Edit section: Flashing U-Boot without CCS">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>It is possible to flash U-Boot from a U-Boot binary already loaded into RAM. This technique can be used for flashing U-Boot in case CCS is not available.
</p><p>A couple of ways in which this can be achieved is mentioned below.
</p>
<h3><span class="mw-headline" id="SD-Flash-Method">SD-Flash-Method</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=23" title="Edit section: SD-Flash-Method">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This method involves booting from SD card and then flashing the U-Boot image to NAND or SPI as required.
</p>
<ol><li>Boot from the SD card using the steps described <a href="#Boot_using_SD_card">here</a></li>
<li>Flash the U-Boot binary either to NAND using the steps over <a href="#Flashing_U-Boot_to_NAND_using_SD_boot">here</a> or to SPI using the steps over <a href="#Flashing_U-Boot_to_SPI_using_SD_boot">here</a>.</li>
<li>After flashing use the appropriate switch settings to boot <a href="#NAND_boot_mode">from NAND</a> or <a href="#SPI_boot_mode">from SPI</a>.</li></ol>
<h3><span class="mw-headline" id="EMAC-Flash-Method">EMAC-Flash-Method</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=24" title="Edit section: EMAC-Flash-Method">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This method involves using EMAC boot mode to get to the U-Boot prompt and then flashing the U-Boot image to NAND or SPI as required.
</p>
<ol><li>Boot over network using the steps described <a href="DM816x_C6A816x_AM389x_EMAC_Boot.html" class="mw-redirect" title="DM816x C6A816x AM389x EMAC Boot">here</a>.</li>
<li>Make sure the network configuration has been done as described over <a href="#U-Boot_Network_configuration">here</a>.</li>
<li>Flash the U-Boot binary either to NAND using the steps over <a href="#Flashing_U-Boot_from_U-Boot">here</a> or to SPI using the steps over <a href="#Flashing_U-Boot_from_U-Boot_3">here</a>.</li>
<li>After flashing use the appropriate switch settings to boot <a href="#NAND_boot_mode">from NAND</a> or <a href="#SPI_boot_mode">from SPI</a>.</li></ol>
<h2><span class="mw-headline" id="U-Boot_NAND_Support"><b>U-Boot NAND Support</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=25" title="Edit section: U-Boot NAND Support">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section gives an <i>overview</i> of the NAND support in U-Boot. It also describe how to store the kernel image, RAMDISK or the JFFS2/UBIFS filesystem to NAND so as to have a network-free boot right from powering on the board to getting the kernel up and running. 
</p>
<h3><span class="mw-headline" id="Overview"><b>Overview</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=26" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Micron Nand parts (page size 2KB, block size 128KB) are supported on DM816xEVM platforms. 
</p>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(21,27,84); padding-top: 5px">
<p><b>Note</b><br /> 
</p>
<ul><li>The following sub-sections illustrate the usage of NAND specific commands on DM816x EVM.</li>
<li>If u-boot is built with NAND support and if NAND is disabled in the EVM (or NOR is enabled) then u-boot will crash immediately after displaying the banner. Refer to <a href="#EVM_Switch_Settings">EVM Switch Settings</a> section for more info on enabling/disabling different boot devices.</li></ul>
</div> 
<h4><span class="mw-headline" id="NAND_Layout"><b>NAND Layout</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=27" title="Edit section: NAND Layout">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The NAND part on the EVM has been configured in the following manner. The addresses mentioned here are used in the subsequent NAND related commands. 
</p>
<pre>  +------------+-&gt;0x00000000-&gt; U-Boot start
 |		|
 |		|  
 |		|
 |		|
 |		|--&gt;0x0025FFFF-&gt; U-Boot end
 |		|--&gt;0x00260000-&gt; ENV start
 |		|
 |		|
 |		|--&gt;0x0027FFFF-&gt; ENV end
 |		|--&gt;0x00280000-&gt; Linux Kernel start
 |		|
 |		|
 |		|
 |		|
 |		|--&gt;0x006BFFFF-&gt; Linux Kernel end
 |		|--&gt;0x006C0000-&gt; Filesystem start
 |		|
 |		|
 |		|
 |		|
 |		|
 |		|
 |		|
 |		|
 |		|
 |		|--&gt;0x0CEDFFFF-&gt; Filesystem end
 |		|--&gt;0x0CEE0000-&gt; Free start
 |		|
 |		|
 |		|
 +------------+--&gt;0x10000000-&gt; NAND end (Free end)
</pre>
<h4><span class="mw-headline" id="Writing_to_Nand"><b>Writing to Nand</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=28" title="Edit section: Writing to Nand">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To write len bytes of data from a memory buffer located at addr to the NAND block offset: 
</p>
<pre>TI8168_EVM# nand write &lt;addr&gt; &lt;offset&gt; &lt;len&gt;
</pre>
<p>If a bad block is encountered during the write operation, it is skipped and the write operation continues from next 'good' block. 
</p><p>For example, to write 0x40000 bytes from memory buffer at address 0x80000000 to NAND - starting at block 32 (offset 0x400000): 
</p>
<pre>TI8168_EVM# nand write 0x80000000 0x400000 0x40000
</pre>
<h4><span class="mw-headline" id="Reading_from_Nand"><b>Reading from Nand</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=29" title="Edit section: Reading from Nand">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To read len bytes of data from NAND block at a particular offset to the memory buffer in DDR located at addr: 
</p>
<pre>TI8168_EVM# nand read &lt;addr&gt; &lt;offset&gt; &lt;len&gt;
</pre>
<p>If a bad block is encountered during the read operation, it is skipped and the read operation continues from next 'good' block. 
</p><p>For example, to read 0x40000 bytes from NAND - starting at block 32 (offset 0x400000) to memory buffer at address 0x80000000: 
</p>
<pre>TI8168_EVM# nand read 0x80000000 0x400000 0x40000
</pre>
<p><br /> 
</p>
<h4><span class="mw-headline" id="Marking_a_bad_block"><b>Marking a bad block</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=30" title="Edit section: Marking a bad block">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Some of the blocks in the NAND may get corrupted over a period of time. In such cases you should explicitly mark such blocks as bad so that the image that you are writing to NAND does not end up getting corrupted. 
</p><p>To forcefully mark a block as bad: 
</p>
<pre>TI8168_EVM # nand markbad &lt;offset&gt;

</pre>
<p>For example, to mark block 32 (assuming erase block size of 128Kbytes) as bad block - offset = blocknum * 128 * 1024: 
</p>
<pre>TI8168_EVM# nand markbad 0x400000
</pre>
<h4><span class="mw-headline" id="Viewing_bad_blocks"><b>Viewing bad blocks</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=31" title="Edit section: Viewing bad blocks">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To view the list of bad blocks: 
</p>
<pre>TI8168_EVM# nand bad
</pre>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(21,27,84); padding-top: 5px">
<p><b>Note</b><br />The user marked bad blocks can be viewed by using this command only after a reset. 
</p>
</div> 
<h4><span class="mw-headline" id="Erasing_Nand"><b>Erasing Nand</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=32" title="Edit section: Erasing Nand">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To erase NAND blocks in a particular the address range or using block numbers: 
</p>
<pre>TI8168_EVM# nand erase &lt;stoffaddr&gt; &lt;len&gt;
</pre>
<p>This commands skips bad blocks (both factory or user marked) encountered within the specified range. 
</p><p>For example, to erase blocks 32 through 34: 
</p>
<pre>TI8168_EVM# nand erase 0x00400000 0x40000
</pre>
<h3><span class="mw-headline" id="NAND_ECC_algorithm_selection"><b>NAND ECC algorithm selection</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=33" title="Edit section: NAND ECC algorithm selection">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>NAND flash memory, although cheap, suffers from problems like bit flipping which lead to data corruption. However by making use of some error correction coding (ECC) techniques it is possible to workaround this problem. 
</p><p>For the data stored in NAND flash, U-Boot supports following NAND ECC schemes 
</p>
<ol><li>S/W ECC (Hamming code)</li>
<li>H/W ECC (Hamming code, BCH4, BCH8, BCH16)</li></ol>
<p><b>NOTE:</b> Current releases do not support BCH4 and BCH16. 
</p>
<h4><span class="mw-headline" id="BCH_Flash_OOB_Layout"><b>BCH Flash OOB Layout</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=34" title="Edit section: BCH Flash OOB Layout">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>For any ECC scheme we need to add some extra data while writing so as to detect and correct (if possible) the errors introduced by the NAND part. In case of BCH scheme some bytes are needed to store the ECC related info. 
</p><p>The section of NAND memory where addition info like ECC data is stored is referred to as Out Of Band or OOB section. 
</p><p>The first 2 bytes are used for Bad block marker – 0xFFFF =&gt; Good block 
</p><p>The next ‘N’ bytes is used for BCH bytes 
</p><p>N = B * &lt;Number of 512-byte sectors in a page&gt; 
</p>
<pre>  B =  8 bytes per 512 byte sector in BCH4
 B = 14 bytes per 512 byte sector in BCH8 
 B = 26 bytes per 512 byte sector in BCH16
</pre>
<p>So for a 2k page-size NAND flash with 64-byte OOB size, we will use BCH8. This will consume 2 + (14*4) = 58 bytes out of 64 bytes available. 
</p><p>The NAND flash part used in EVM does not have enough spare area to support BCH16. 
</p>
<table border="1">
<caption><b>ECC Schemes and their context of usage</b>
</caption>
<tbody><tr>
<th>ECC type
</th>
<th>Usage
</th></tr>
<tr>
<td>S/W ECC
</td>
<td>Not used
</td></tr>
<tr>
<td>H/W ECC - Hamming Code
</td>
<td>Use this for flashing any image/binary which will be used by Linux. This scheme is also used for by the U-Boot ENV variables.
</td></tr>
<tr>
<td>H/W ECC – BCH8
</td>
<td>Only while flashing U-Boot from U-Boot. After flashing U-Boot revert back to hamming code h/w ecc
</td></tr></tbody></table>
<p><br /> 
</p><p>To select ECC algorithm for NAND: 
</p>
<pre>TI8168_EVM# nandecc [sw | hw &lt;hw_type&gt;] 

</pre>
<p>Usage: 
</p>
<pre>   sw - Set software ECC for NAND
  hw &lt;hw_type&gt; - Set hardware ECC for NAND
     &lt;hw_type&gt; - 0 for Hamming code
                 1 for bch4
                 2 for bch8
                 3 for bch16
  Currently we support only Software, Hamming Code and BCH8. We do not support BCH4 and BCH16
</pre>
<h3><span class="mw-headline" id="Transferring_images_to_NAND_via_U-Boot"><b>Transferring images to NAND via U-Boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=35" title="Edit section: Transferring images to NAND via U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(21,27,84); padding-top: 5px"><b>Note</b><br />When updating any partition in NAND, please erase the complete partition and not just the space needed by the image which will be transferred onto NAND</div> 
<p>Make sure the EVM is connected to network. This is required to get Linux Image from a tftp server. If there is no DHCPserver in the network then use static ip. The section on <a href="#U-Boot_Network_configuration">U-Boot network configuration</a> gives commands for doing this. 
</p><p>Make sure tftp server is running in a windows PC and the home directory for the tftp server has Linux kernel uImage. This windows PC should be accessible from the EVM. 
</p>
<h4><span class="mw-headline" id="Flashing_U-Boot_from_U-Boot"><b>Flashing U-Boot from U-Boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=36" title="Edit section: Flashing U-Boot from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To flash u-boot image (u-boot.noxip.bin) to NAND execute the commands listed below: 
</p>
<pre>TI8168_EVM# mw.b 0x81000000 0xFF 0x260000
TI8168_EVM# tftp 0x81000000 u-boot.noxip.bin
TI8168_EVM# nand erase 0x0 0x260000     &lt;=== Erasing the whole partition before flashing the image
TI8168_EVM# nandecc hw 2
TI8168_EVM# nand write.i 0x81000000 0x0 0x260000
TI8168_EVM# nandecc hw 0
</pre>
<p>The above set to commands, fill in the section of memory starting from 0x81000000 with size 0x260000 with 0xFF. In DM816x EVM this memory region is a part of the DDR memory. 
</p><p>Next we download the U-Boot image (u-boot.noxip.bin) to the DDR memory. 
</p><p>To have persistent storage we then transfer the downloaded U-Boot image to NAND with the help of the NAND commands described earlier. 
</p>
<h4><span class="mw-headline" id="Flashing_Linux_Kernel_from_U-Boot">Flashing Linux Kernel from U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=37" title="Edit section: Flashing Linux Kernel from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>TFTP the kernel uImage to DDR. 
</p>
<pre>TI8168_EVM# mw.b 0x81000000 0xFF 0x440000
TI8168_EVM# tftp 0x81000000 &lt;kernel_image&gt;
</pre>
<p>Now flash the kernel image to NAND at the appropriate offset (refer to <a href="#NAND_Layout">NAND layout</a> section for the offsets) 
</p>
<pre>TI8168_EVM# nand erase 0x00280000 0x00440000     &lt;=== Erasing the whole partition before flashing the image
TI8168_EVM# nand write 0x81000000 0x00280000 &lt;image_size&gt; (example, 0x200000)
</pre>
<h4><span class="mw-headline" id="Creating_UBIFS_File-System">Creating UBIFS File-System</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=38" title="Edit section: Creating UBIFS File-System">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Refer to <a href="UBIFS_Support.html" title="UBIFS Support">UBIFS Support guide</a>
</p>
<h4><span class="mw-headline" id="Creating_JFFS2_File-system">Creating JFFS2 File-system</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=39" title="Edit section: Creating JFFS2 File-system">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Since jffs2 is used only on flash devices, a standard Linux distribution does not have the tools to make a jffs2 file system.Refer <a href="MTD_Utilities.html" title="MTD Utilities">MTD_Utilities</a> wiki page for instructions on how to create JFFS2. mkfs.jffs2 is the tool needed to build a jffs2 file system and the source is in this code. All of the MTD code will be downloaded but only the code to build mkfs.jffs2 is built. 
</p><p>With the mkfs.jffs2 utility built and in place it is now time to make the jffs2 file system from of the target directory. Change to the /home/user directory and enter the mkfs.jffs2 command below. Probably the most important argument to the utility is the erase block size. For the NAND part on the TI8168 EVM board the erase block is 128k Consult either u-boot, the kernel, or the data manual for the flash part used to find the erase block size. 
</p>
<pre>  [root@localhost util]# cd /home/user
 [root@localhost util]# mkfs.jffs2 -lqn –e 128 -r target -o /tftpboot/rd-jffs2.bin
</pre>
<p><br />By building the file in the /tftpboot directory, the step of copying it over is eliminated. The file must now be written into flash at a specific location. In u-boot, the flash file system will get flashed to the physical address 0x6c0000 and will be mounted by the kernel from /dev/mtdblock&lt;partition-number&gt;, partition-number starts from 0, refer flash layout for individual flash devices and partition creation order for exact number. Use 'cat /proc/partitions' at Linux prompt for the list of partitions. 
</p><p>After identifying the partition, unprotect the flash area where the file system will reside, erase that area. Download the rd-jffs2.bin file. Write it to flash. Modify bootargs to support a JFFS2 file system as root on /dev/mtdblock&lt;partition-number&gt;. Save the environment variables. 
</p><p><br /> 
</p>
<h4><span class="mw-headline" id="Flashing_File-system_from_U-Boot">Flashing File-system from U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=40" title="Edit section: Flashing File-system from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>First TFTP the filesystem image (example - rootfs-base.jffs2 or ubi.img) to DDR. 
</p>
<pre>TI8168_EVM# mw.b 0x81000000 0xFF 0x0C820000 &lt;=== Required to get rid of "Empty Flash" JFFS2 warnings while booting.
TI8168_EVM# tftp 0x81000000 &lt;filesystem_image&gt;
</pre>
<p>Flash the file system image to NAND using the appropriate offsets 
</p>
<pre>For <b>JFFS2</b> file system:
TI8168_EVM# nand erase clean 0x006C0000 0x0C820000      &lt;=== Erasing the whole partition before flashing the image

For <b>UBIFS</b> file system: 
TI8168_EVM# nand erase 0x006C0000 0x0C820000  &lt;=== Erasing the whole partition before flashing the image

TI8168_EVM# nand write 0x81000000 0x006C0000 &lt;image_size&gt; &lt;=== Example, 0x01040000
<b>NOTE:</b> The image size should be upward aligned to NAND page size which is 2KiB (i.e. 0x800).
For example, if the image size is 0x19B8004 the size to be passed to the NAND write
command should be 0x19B8800.
</pre>
<pre>  <b>NOTE</b>: The NAND page size alignment applies to any NAND write from u-boot and not only while flashing filesystem. 
             Also, refer [<a rel="nofollow" class="external autonumber" href="http://www.linux-mtd.infradead.org/archive/tech/faq.html">[1]</a>] for information on JFFS2 error/warning messages.
</pre>
<h2><span class="mw-headline" id="U-Boot_NOR_Support"><b>U-Boot NOR Support</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=41" title="Edit section: U-Boot NOR Support">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section gives an <i>overview</i> of the NOR support in U-Boot. It also describe how to store the kernel image, RAMDISK or the JFFS2 filesystem to NOR so as to have a network-free boot right from powering on the board to getting the kernel up and running. 
</p>
<h3><span class="mw-headline" id="Overview_2"><b>Overview</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=42" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div style="padding: 5px; background: none repeat scroll 0% 0% rgb(238, 238, 238); color: rgb(52, 128, 23);">
<p><b>Important</b><br />Please note that the U-Boot commands used in this section is applicable only from a U-Boot which is already running from NOR. Please refer to the Flashing Tools page for flashing the U-Boot image to NOR.
</p>
</div> 
<ul><li>This section details on the NOR support available in DM816x</li>
<li>ROM Code always uses XIP for NOR boot.</li>
<li>ROM Code initializes only 12 GPMC address lines (gpmc_a0 - gpmc_a11) hence it can access only first 4KBytes of the NOR.</li></ul>
<h4><span class="mw-headline" id="NOR_Pin_Muxing_Info_for_DM816x_EVM">NOR Pin Muxing Info for DM816x EVM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=43" title="Edit section: NOR Pin Muxing Info for DM816x EVM">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<ul><li>Pin muxing for address lines gpmc_a0 to gpmc_a11 is not required (used in default mode)</li>
<li>Pin muxing is done only for lines gpmc_a12 to gpmc_a25 using the following lines</li></ul>
<pre>gpmc_a12 -----&gt; tim7_out
gpmc_a13 -----&gt; uart1_ctsn
gpmc_a14 -----&gt; uart1_rtsn
gpmc_a15 -----&gt; uart2_rtsn
gpmc_a16 -----&gt; uart2_ctsn
gpmc_a17 -----&gt; uart0_rin
gpmc_a18 -----&gt; uart0_dcdn
gpmc_a19 -----&gt; uart0_dsrn
gpmc_a20 -----&gt; uart0_dtrn
gpmc_a21 -----&gt; spi_scs3
gpmc_a22 -----&gt; spi_scs2
gpmc_a23 -----&gt; gpo_io6
gpmc_a24 -----&gt; tim6_out
gpmc_a25 -----&gt; sc0_data
gpio0_20 -----&gt; gpmc_a27
</pre>
<ul><li>gpmc_a27 should be configured as gpio0_20 and its output should be set low.</li>
<li>For the above pad configuration we cannot use below mentioned modules
<ul><li>Smart Card 0</li>
<li>Advanced features of uart0/1/2</li>
<li>spi cs 2/3</li>
<li>timer 6/7 output</li></ul></li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="NOR_Support">NOR Support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=44" title="Edit section: NOR Support">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>The NOR boot logic is handled in <b>arch/arm/cpu/arm_cortexa8/ti81xx/lowlevel_init.S</b></li>
<li>Since ROM code does not initialize all 25 address lines required for accessing 64MBytes, u-boot should first initialize GPMC to continue with the XIP beyond 4KBytes.</li>
<li>u-boot should also configure pin muxing for the remaining 13 address lines (gpmc_a12 - gpmc_a24) based on board schematics</li>
<li>In case of NOR boot and XIP, we cannot initialize GPMC while running from NOR, hence we have to relocate the tiny GPMC init code to SRAM and then transfer control to SRAM and then come back to NOR XIP.</li>
<li>Also, the relocatable GPMC init code should be placed in the first 4KBytes of the u-boot. This is achieved by adding lowlevel_init.o just below start.o in the u-boot linker script <b>board/ti8168_evm/u-boot.lds</b> as shown below.</li></ul>
<pre>SECTIONS
{
    . = 0x00000000;
    . = ALIGN(4);
    .text  &#160;:
    {
      arch/arm/cpu/arm_cortexa8/start.o  (.text)
      arch/arm/cpu/arm_cortexa8/ti81xx/lowlevel_init.o   (.text)
      *(.text)
    }
...
...
...
</pre>
<ul><li>Before relocating any code to SRAM we have to first enable the SRAM.</li>
<li>All the above steps have to be done only if we are not already running from SRAM (or DDR)</li>
<li>The diagram below explains the above discussed steps</li></ul>
<p><a href="File_U-boot_nor-boot_gpmc-init.html" class="image"><img alt="U-boot nor-boot gpmc-init.jpg" src="https://processors.wiki.ti.com/images/2/26/U-boot_nor-boot_gpmc-init.jpg" width="640" height="421" /></a> 
</p>
<h5><span class="mw-headline" id="Config_Macros">Config Macros</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=45" title="Edit section: Config Macros">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<pre>    #define CONFIG_SYS_FLASH_CFI
    #define CONFIG_MTD_DEVICE
    #define CONFIG_FLASH_CFI_DRIVER
    #define CONFIG_FLASH_CFI_MTD
    #define CONFIG_SYS_MAX_FLASH_SECT   512
    #define CONFIG_SYS_MAX_FLASH_BANKS  1
    #define CONFIG_ENV_IS_IN_FLASH      1
    #define CONFIG_SYS_FLASH_BASE       (0x08000000)
    #define CONFIG_SYS_MONITOR_BASE     CONFIG_SYS_FLASH_BASE
    #define NOR_SECT_SIZE               (128 * 1024)
    #define CONFIG_SYS_ENV_SECT_SIZE    (NOR_SECT_SIZE)
    #define CONFIG_ENV_OFFSET           (2 * NOR_SECT_SIZE)
    #define CONFIG_ENV_ADDR             (CONFIG_ENV_OFFSET)
</pre>
<ul><li>These macros assume spansion flash being used in the EVM. For any other flash part, the sector size macro (NOR_SECT_SIZE) has to be modified.</li></ul>
<p><br />Spansion NOR parts are supported on DM816x platforms. 
</p>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(21,27,84); padding-top: 5px">
<p><b>Note</b><br />
</p>
<ul><li>The following sub-sections illustrate the usage of NOR specific commands on DM8168EVM.</li>
<li>If U-Boot is built with NOR support and if NOR is disabled in the EVM (or NAND is enabled) and if you try loading U-Boot through CCS then U-Boot will crash. Refer to <a href="#EVM_Switch_Settings">EVM Switch Settings</a> section for more info on enabling/disabling different boot devices.</li></ul>
</div>
<h4><span class="mw-headline" id="NOR_Layout"><b>NOR Layout</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=46" title="Edit section: NOR Layout">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The NOR part on the EVM has been configured in the following manner. Please note the addresses mentioned here carefully as they are used in the subsequent NOR related commands. 
</p>
<pre>----------------+----&gt; 0x08000000 (u-boot Start) Flash Start
|		|
|		|
|		|
|		|----&gt; 0x0803FFFF (u-boot End) 
|		|----&gt; 0x08040000 (ENV Start)
|		|
|		|
|		|----&gt; 0x0805FFFF (ENV End)  
|		|----&gt; 0x08060000 (Linux Start)
|		|
|		|
|		|
|		|
|		|----&gt; 0x0845FFFF (Linux End) 
|		|----&gt; 0x08460000 (FS Start)
|		|
|		|
|		|
|		|
|		|
|		|
|		|
|		|----&gt; 0x0B65FFFF (FS End) 
|		|----&gt; 0x0B660000 (Reserved Start)
|		|
|		|
----------------+----&gt; 0x0C000000 (Reserved End) Flash End
</pre>
<h4><span class="mw-headline" id="Writing_to_NOR"><b>Writing to NOR</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=47" title="Edit section: Writing to NOR">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To write len bytes of data from a memory buffer located at addr to the NOR block offset (here &lt;len&gt; is always in 16-bit word count and not bytes): 
</p>
<pre>TI8168_EVM# cp.w &lt;src&gt; &lt;dest&gt; &lt;len&gt;
</pre>
<p>For example, to write 0x40000 bytes (i.e. 0x20000 16-bit words) from memory buffer at address 0x81000000 to NOR - starting at offset 0x0B660000: 
</p>
<pre>TI8168_EVM# cp.w 0x81000000 0x0B660000 0x20000
</pre>
<h4><span class="mw-headline" id="Reading_from_NOR"><b>Reading from NOR</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=48" title="Edit section: Reading from NOR">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To read len bytes of data from NOR block at offset to memory buffer located at addr (here &lt;len&gt; is always in 16-bit word count and not bytes): 
</p>
<pre>TI8168_EVM# cp.w &lt;src&gt; &lt;dest&gt; &lt;len&gt;
</pre>
<p>For example, to read 0x40000 bytes (i.e. 0x20000 16-bit words) from NOR - starting at offset 0x0B660000 to memory buffer at address 0x81000000: 
</p>
<pre>TI8168_EVM# cp.w 0x0B660000 0x81000000 0x20000
</pre>
<h4><span class="mw-headline" id="Erasing_NOR"><b>Erasing NOR</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=49" title="Edit section: Erasing NOR">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To erase NOR in the address range (start and end should align to block size): 
</p>
<pre>TI8168_EVM# erase &lt;start&gt; &lt;end&gt;
</pre>
<p><br />For example, to erase from 0x0B660000 to 0x0BFFFFFF: 
</p>
<pre>TI8168_EVM# erase 0x0B660000 0x0BFFFFFF
</pre>
<h3><span class="mw-headline" id="Transferring_images_to_NOR_via_U-Boot"><b>Transferring images to NOR via U-Boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=50" title="Edit section: Transferring images to NOR via U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Make sure the EVM is connected to network. This is required to get Linux Image from a tftp server. If there is no DHCPserver in the network then use static ip. The section on <a href="#U-Boot_Network_configuration"> U-Boot network configuration</a> gives the commands for doing this. 
</p><p>Make sure tftp server is running in a windows PC and the home directory for the tftp server has Linux kernel uImage. This windows PC should be accessible from board. 
</p>
<h4><span class="mw-headline" id="Flashing_U-Boot_from_U-Boot_2"><b>Flashing U-Boot from U-Boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=51" title="Edit section: Flashing U-Boot from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To flash u-boot image (u-boot.bin) to the NOR execute the commands listed below: 
</p>
<pre>TI8168_EVM# mw.b 0x81000000 0xFF 0x100000
TI8168_EVM# tftp 0x81000000 u-boot.bin
TI8168_EVM# protect off 0x08000000 0x0803FFFF
TI8168_EVM# erase 0x08000000 0x0803FFFF
TI8168_EVM# cp.w 0x81000000 0x08000000 0x20000 (NOTE: 0x20000 is size of uboot.bin / 2)
</pre>
<p>Please note that the above steps can only be used from U-Boot already running out of NOR.
</p><p>The above set of commands fill in the section of memory starting from 0x81000000 with size 0x100000 with 0xFF. In DM816x EVM this memory region is a part of the DDR memory. Next we download the U-Boot image to the DDR memory. To have persistent storage we then transfer the downloaded U-Boot image to NOR with the help of the NOR commands described earlier.
</p>
<h4><span class="mw-headline" id="Flashing_Linux_Kernel_from_U-Boot_2">Flashing Linux Kernel from U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=52" title="Edit section: Flashing Linux Kernel from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>TFTP the kernel uImage to DDR. 
</p>
<pre>TI8168_EVM# tftp 81000000 &lt;kernel_image&gt;
</pre>
<p>Flash the kernel image to NOR 
</p>
<pre>TI8168_EVM# protect off 0x08060000  0x0845FFFF 
TI8168_EVM# erase 0x08060000  0x0845FFFF 
TI8168_EVM# cp.w 0x81000000 0x08060000 0xcb4da (NOTE: 0xcb4da is size of kernel_image / 2)
</pre>
<h4><span class="mw-headline" id="Creating_JFFS2_File-system_2">Creating JFFS2 File-system</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=53" title="Edit section: Creating JFFS2 File-system">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Refer <a href="#Creating_JFFS2_File-system">Creating JFFS2 File-system</a>
</p>
<h4><span class="mw-headline" id="Flashing_File-system_from_U-Boot_2">Flashing File-system from U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=54" title="Edit section: Flashing File-system from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>TFTP filesystem image (example - rootfs-816x.jffs2) to DDR. 
</p>
<pre>TI8168_EVM# tftp 81000000 &lt;filesystem_image&gt;
</pre>
<p>Flash the file system image to NOR 
</p>
<pre>TI8168_EVM# protect off 0x08460000  0x0B65FFFF 
TI8168_EVM# erase 0x08460000  0x0B65FFFF 
TI8168_EVM# cp.w 0x81000000 0x08460000 0x800000 (NOTE: 0x800000 is size of filesystem / 2)
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="U-Boot_SPI_Support"><b>U-Boot SPI Support</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=55" title="Edit section: U-Boot SPI Support">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section gives an <i>overview</i> of the SPI support in U-Boot. It also describe how to store the kernel image, RAMDISK or the JFFS2 filesystem to SPI flash so as to have a network-free boot right from powering on the board to getting the kernel up and running. 
</p>
<h3><span class="mw-headline" id="Overview_3"><b>Overview</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=56" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Winbond SPI Flash part W25X32 is supported on DM8168EVM. Refer <a rel="nofollow" class="external text" href="http://www.mail-archive.com/u-boot@lists.denx.de/msg35376.html">http://www.mail-archive.com/u-boot@lists.denx.de/msg35376.html</a> for information on supporting new Winbond SPI flashes. This mail thread discusses on adding support for W25Q64 SPI&#160;flash part.<br />
</p><p><br />
</p>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(21,27,84); padding-top: 5px">
<p><b>Note</b><br />
</p>
<ul><li>The following sub-sections illustrate the usage of SPI specific commands on DM8168EVM.</li>
<li>Refer to <a href="#EVM_Switch_Settings"> EVM Switch Settings</a> section for more info on enabling/disabling different boot devices.</li></ul>
</div>
<h4><span class="mw-headline" id="SPI_Flash_Layout"><b>SPI Flash Layout</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=57" title="Edit section: SPI Flash Layout">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The SPI flash part on the EVM has been configured in the following manner. The addresses mentioned here are used in the subsequent SPI related commands. 
</p>
<pre>  +-------------+--&gt;0x00000000-&gt; U-Boot start
  |		|
  |		|  
  |		|
  |		|
  |		|--&gt;0x0003FFFF-&gt; U-Boot end
  |		|--&gt;0x00040000-&gt; ENV start
  |		|
  |		|
  |		|--&gt;0x00041FFF-&gt; ENV end
  |		|--&gt;0x00042000-&gt; Linux Kernel start
  |		|
  |		|
  |		|
  |		|
  |		|--&gt;0x002C1FFF-&gt; Linux Kernel end
  |		|--&gt;0x002C2000-&gt; Filesystem start
  |		|
  |		|
  |		|
  +-------------+--&gt;0x00400000-&gt; Filesystem end 
</pre>
<p>NOTE&#160;: 
</p>
<ul><li>Type <b>sf</b> in u-boot prompt to get help on SPI flash commands</li>
<li>Before using any SPI command, first the SPI flash has to be probed using the <b>sf probe 0</b> command. Here 0 is the SPI flash chip select number</li></ul>
<h4><span class="mw-headline" id="Writing_to_SPI_Flash"><b>Writing to SPI Flash</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=58" title="Edit section: Writing to SPI Flash">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To write <b>len</b> bytes of data from a memory buffer located at <b>addr</b> to <b>offset</b> in SPI flash: 
</p>
<pre>TI8168_EVM# sf write addr offset len
</pre>
<p>For example, to write 0x1000 bytes from memory buffer at address 0x80000000 to SPI flash - starting at offset 0x4000: 
</p>
<pre>TI8168_EVM# sf write 0x80000000 0x4000 0x1000
</pre>
<h4><span class="mw-headline" id="Reading_from_SPI_Flash"><b>Reading from SPI Flash</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=59" title="Edit section: Reading from SPI Flash">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To read <b>len</b> bytes of data from SPI flash at a particular <b>offset</b> to the memory buffer located at <b>addr</b>: 
</p>
<pre>TI8168_EVM# sf read addr offset len
</pre>
<p>For example, to read 0x1000 bytes from flash - starting at offset 0x4000 to memory buffer at address 0x80000000: 
</p>
<pre>TI8168_EVM# sf write 0x80000000 0x4000 0x1000
</pre>
<p><br />
</p>
<h4><span class="mw-headline" id="Erasing_SPI_Flash"><b>Erasing SPI Flash</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=60" title="Edit section: Erasing SPI Flash">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To erase <b>len</b> bytes from 'offset' in a SPI flash: 
</p>
<pre>TI8168_EVM# sf erase offset len
</pre>
<p>For example, to erase 0x1000 bytes from offset 0x4000: 
</p>
<pre>TI8168_EVM# sf erase 0x4000 0x1000
</pre>
<h3><span class="mw-headline" id="Transferring_images_to_SPI_flash_via_U-Boot"><b>Transferring images to SPI flash via U-Boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=61" title="Edit section: Transferring images to SPI flash via U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Make sure the EVM is connected to network. This is required to get Linux Image from a tftp server. If there is no DHCPserver in the network then use static ip. The section on <a href="#U-Boot_Network_configuration">U-Boot network configuration</a> gives commands for doing this. 
</p><p>Make sure tftp server is running in a windows PC and the home directory for the tftp server has Linux kernel uImage. This windows PC should be accessible from the EVM. 
</p>
<h4><span class="mw-headline" id="Flashing_U-Boot_from_U-Boot_3"><b>Flashing U-Boot from U-Boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=62" title="Edit section: Flashing U-Boot from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To flash u-boot image (u-boot.noxip.bin.spi) to the Winbond SPI flash execute the commands listed below: 
</p>
<pre>TI8168_EVM# mw.b 0x81000000 0xFF 0x100000
TI8168_EVM# tftp 0x81000000 u-boot.noxip.bin.spi
TI8168_EVM# sf probe 0:0 
TI8168_EVM# sf erase 0x0 0x40000
TI8168_EVM# sf write 0x81000000 0x0 0x40000
</pre>
<p>The above set to commands, fill in the section of memory starting from 0x81000000 with size 0x100000 with 0xFF. In DM816x EVM this memory region is a part of the DDR memory. 
</p><p>Next we download the SPI U-Boot image to the DDR memory. 
</p><p>To have persistent storage we then transfer the downloaded U-Boot image to SPI flash with the help of the SPI flash commands described earlier.
</p>
<h4><span class="mw-headline" id="Flashing_Linux_Kernel_from_U-Boot_3">Flashing Linux Kernel from U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=63" title="Edit section: Flashing Linux Kernel from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>TFTP the kernel uImage to DDR. 
</p>
<pre>TI8168_EVM# tftp 81000000 &lt;kernel_image&gt;
</pre>
<p>Now flash the kernel image to flash at the appropriate offset (refer to <a href="#SPI_Flash_Layout"> SPI layout</a> section for the offsets) 
</p>
<pre>TI8168_EVM# sf probe 0
TI8168_EVM# sf erase 0x42000 0x280000
TI8168_EVM# sf write 0x81000000 0x42000 0x280000
</pre>
<h4><span class="mw-headline" id="Creating_JFFS2_File-system_3">Creating JFFS2 File-system</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=64" title="Edit section: Creating JFFS2 File-system">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p><b>NOTE:</b> JFFS2 cannot be supported on the SPI flash available on DM8168 EVM due to erase size restrictions. The erase sector size of W25X32 is 4KiB but JFFS2 requires it be minimum 8KiB. Hence JFFS2 filesystem cannot be used on this flash part. For help on JFFS2 filesystem creation (for other SPI flash parts) refer <a href="#Creating_JFFS2_File-system"> Creating JFFS2 File-system</a>
</p>
<h4><span class="mw-headline" id="Flashing_File-system_from_U-Boot_3">Flashing File-system from U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=65" title="Edit section: Flashing File-system from U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre>TI8168_EVM# tftp 81000000 &lt;filesystem_image&gt;
TI8168_EVM# 
</pre>
<p>Flash the file system image to flash using the appropriate offsets 
</p>
<pre>TI8168_EVM# sf probe 0
TI8168_EVM# sf erase 0x2c2000 0x13E000
TI8168_EVM# sf write 0x81000000 0x2c2000 0x13E000
TI8168_EVM#
</pre>
<h2><span id="U-Boot_SD_(Secured_Digital_card)_Support"></span><span class="mw-headline" id="U-Boot_SD_.28Secured_Digital_card.29_Support"><b>U-Boot SD (Secured Digital card) Support</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=66" title="Edit section: U-Boot SD (Secured Digital card) Support">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section gives an overview of the SD (Secured Digital Card) support in U-Boot 
</p>
<h3><span class="mw-headline" id="Overview_4"><b>Overview</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=67" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>SD (Secured Digital Card) support is available through HSMMC controller. 
</p><p>SD support is available by default in all U-Boot configs.&#160; SD card can be access in all other boot modes (NAND/SPI/NOR). 
</p><p><b>Read and execute application from SD card</b> 
</p><p>List files on a FAT32 formated SD card
</p>
<pre>TI8168_EVM# mmc rescan 0
TI8168_EVM# fatls mmc 0
</pre>
<p>Booting kernel image from the SD card
</p>
<pre>TI8168_EVM# mmc rescan 0
TI8168_EVM# fatload mmc 0 0x81000000 uImage
TI8168_EVM# bootm 0x81000000
</pre>
<p>Booting application (ex. u-boot.bin)image from the SD card
</p>
<pre>TI8168_EVM# mmc rescan 0
TI8168_EVM# fatload mmc 0 0x81000000 u-boot.bin
TI8168_EVM# go 0x81000000
</pre>
<div style="margin: 5px; padding: 5px 10px; background-color: #ffffec; border-left: 5px solid #ff6600;">
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b> For the PSP_04.00.00.12 and older release use the following mmc commands
</p>
<pre>$mmc rescan 0 must be replaced with $mmc init
$fatload mmc 0 &lt;addr&gt; &lt;file&gt; must be replaced with $fatload mmc 1 &lt;addr&gt; &lt;file&gt;
</pre>
</div>
<h3><span class="mw-headline" id="Setting_Up_Boot_Environment_on_SD_Card"><b>Setting Up Boot Environment on SD Card</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=68" title="Edit section: Setting Up Boot Environment on SD Card">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This section describes steps to be followed to create a standalone power-on bootable system on SD card. 
</p><p><b>Prerequisites</b> Ensure that following is available: 
</p>
<ul><li>A Linux host with fdisk, sfdisk, mkfs.ext3 and mkfs.vfat utilities is available</li>
<li>Copy images MLO, u-boot.bin, uImage, nfs.tar.gz and mksd-ti816x.sh from release package to a directory on this Linux machine. For subsequent description, we will assume these files are copied to /home/ti816x. Please refer <a href="DM816x_C6A816x_AM389x_PSP_User_Guide.html#Package_Contents" class="mw-redirect" title="DM816x C6A816x AM389x PSP User Guide"> Package Contents</a> section in <a href="DM816x_C6A816x_AM389x_PSP_User_Guide.html" class="mw-redirect" title="DM816x C6A816x AM389x PSP User Guide"> DM816x User Guide</a> for location of these files.</li>
<li>Empty SD card (at least 256MB, preferably 4GB SDHC)</li>
<li>A SD memory card reader/programmer to copy files from Linux Host</li></ul>
<pre>  <b>Note: The SD Boot has some specific restriction about the format of the 1st partition and copying the MLO image.</b>
        <b>So it is recommended that the supplied script mksd-ti816x.sh is used for creating partitions and copying files. </b>
</pre>
<p><b>Steps </b> 
</p>
<ul><li>Connect the SD memory card using Memory Card reader to the Linux Host</li>
<li>Note the name allotted for this device. We assume the device is named as "/dev/sdd"</li>
<li>Navigate to the /home/ti816x directory where all the mentioned files are copied</li>
<li>Ensure that the script mksd-ti816x.sh has executable permissions</li>
<li>This scripts expects arguments in the following format</li></ul>
<pre>./mksd-ti816x.sh &lt;sd-device-name&gt; &lt;sd-1st-stage-bootloader&gt; &lt;kernel-uImage&gt; &lt;tar-gzipped-filesystem-directory&gt;
</pre>
<ul><li><b>Note</b> that the user will require root/sudo permissions</li>
<li>In our example, we run the following command</li></ul>
<pre>sudo ./mksd-ti816x.sh /dev/sdd MLO u-boot.bin uImage nfs.tar.gz
</pre>
<ul><li>You will be asked about data getting overwritten, confirm it and the files along with filesystem will be copied to SD card</li>
<li>Note that this script will create two primary partitions:
<ul><li>1st partition is formatted as FAT32 containing MLO, u-boot.bin, uImage files</li>
<li>2nd partition is formatted as ext3 where the filesystem is extracted in root</li></ul></li></ul>
<h3><span class="mw-headline" id="Boot_using_SD_card">Boot using SD card</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=69" title="Edit section: Boot using SD card">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Once the SD card has been setup as described in the previous section make sure the switch setting are set for <a href="#SD_boot_mode">SD boot mode</a> and then plug in the SD card in the MMC/SD card slot on the EVM.
</p><p>When the EVM is powered on the 1st stage will autoload the 2nd stage from SD. Interrupt the countdown in the 2nd stage if kernel boot is not required. You should see the <b>TI8168_EVM#</b> prompt on the console.
</p>
<h3><span class="mw-headline" id="Flashing_U-Boot_to_NAND_using_SD_boot"><b>Flashing U-Boot to NAND using SD boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=70" title="Edit section: Flashing U-Boot to NAND using SD boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Before proceeding with any of the commands given in this section please make sure that NAND is enabled on the EVM. The switch for enabling NAND on TI8168 EVM is SW4.</b>
</p><p>Copy the U-Boot image <b>u-boot.noxip.bin</b> built for NAND as described [#U-Boot_for_NAND_boot here] in the FAT partition on the SD card. (The release package contains a pre-built image u-boot.noxip.bin which can be used for this purpose)
</p><p>Once the second stage of SD boot comes up use the following commands to flash to NAND
</p>
<pre>TI8168_EVM# mmc rescan 0
TI8168_EVM# fatload mmc 0 0x81000000 u-boot.noxip.bin
TI8168_EVM# nandecc hw 2
TI8168_EVM# nand erase 0x0 0x1c0000
TI8168_EVM# nand write.i 0x81000000 0x0 0x1c0000
TI8168_EVM# nandecc hw 0
</pre>
<p>After this the EVM switch settings can be changed to [#NAND_boot NAND boot mode] if boot out of NAND is required.
</p>
<h3><span class="mw-headline" id="Flashing_U-Boot_to_SPI_using_SD_boot"><b>Flashing U-Boot to SPI using SD boot</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=71" title="Edit section: Flashing U-Boot to SPI using SD boot">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Before proceeding with any of the commands given in this section please make sure that SPI is enabled on the EVM. The switch for enabling SPI on TI8168 EVM is SW4.</b>
</p><p>Copy the U-Boot image <b>u-boot.noxip.bin.spi</b> built for SPI as described <a rel="nofollow" class="external text" href="http://processors.wiki.ti.com/index.php?title=DM816x_C6A816x_AM389x_PSP_U-Boot#U-Boot_for_SPI_boot">U-Boot_for_SPI_boot</a> in the FAT partition on the SD card. 
</p><p>Once the second stage of SD boot comes up use the following commands to flash to SPI
</p>
<pre>TI8168_EVM# mmc rescan 0
TI8168_EVM# mw.b 0x81000000 0xFF 0x100000
TI8168_EVM# fatload mmc 0 0x81000000 u-boot.noxip.bin.spi
TI8168_EVM# sf probe 0:0 
TI8168_EVM# sf erase 0x0 0x40000
TI8168_EVM# sf write 0x81000000 0x0 0x40000
</pre>
<p>After this the EVM switch settings can be changed to <a rel="nofollow" class="external text" href="http://processors.wiki.ti.com/index.php?title=DM816x_C6A816x_AM389x_PSP_U-Boot#SPI_boot_mode">SPI_boot_mode</a> if boot out of SPI is required.
</p>
<div style="margin: 5px; padding: 5px 10px; background-color: #ffffec; border-left: 5px solid #ff6600;">
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b> For the PSP_04.00.00.12 and older release use the following mmc commands
</p>
<pre>$mmc rescan 0 must be replaced with $mmc init
$fatload mmc 0 &lt;addr&gt; &lt;file&gt; must be replaced with $fatload mmc 1 &lt;addr&gt; &lt;file&gt;
</pre>
</div>
<h3><span class="mw-headline" id="ENV_on_SD_card_using_a_script"><b>ENV on SD card using a script</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=72" title="Edit section: ENV on SD card using a script">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>U-Boot environment variables can be modified using U-Boot scripts. The scripts can be used to modify and even over-ride the various parameters like bootargs, TFTP serverip etc.
</p><p>Generation of the scripts is done with the help of the <i>mkimage</i> tool which can be found under the tools directory of the U-Boot source. The <i>mkimage</i> binary gets generated whenever any U-Boot image is built.
</p><p>Once the <i>mkimage</i> binary generated, create a text file named <i>boot.txt</i> with the U-Boot commands that would normally be executed manually at the U-Boot prompt.
</p><p>Example text file named <i>boot.txt</i>
</p>
<pre>setenv bootargs 'console=ttyO2,115200n8 root=/dev/mmcblk0p2 mem=128M rootwait'
setenv bootcmd 'mmc rescan 0; fatload mmc 0 0x81000000 uImage; bootm 0x81000000'
boot
</pre>
<div style="margin: 5px; padding: 5px 10px; background-color: #ffffec; border-left: 5px solid #ff6600;">
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b> For the PSP_04.00.00.12 and older release use the following
</p>
<pre>setenv bootargs 'console=ttyO2,115200n8 root=/dev/mmcblk0p2 mem=128M rootwait'
setenv bootcmd 'mmc init; fatload mmc 1 0x81000000 uImage; bootm 0x81000000'
boot
</pre>
</div>
<p><br />
Now use the following command to generate the script named <i>boot.scr</i>
</p>
<pre>mkimage -A arm -O linux -T script -C none -n TI_script -d boot.txt boot.scr
</pre>
<p>The file <i>boot.scr</i> can now be executed from U-Boot using the source command to execute all the commands present in it.
Eg: TFTP the file to some location in DDR and then use source command in the following manner (assumption: network setting has already been done using the steps mentioned in this User Guide)
</p>
<pre>TI8168_EVM# tftp 0x81000000 boot.scr 
TI8168_EVM# source 0x81000000
</pre>
<p>The script can even be placed in the SD card and then bootcmd set to autorun this script if present. This is the default behavior of the SD boot images built from the PSP release.
</p>
<h2><span class="mw-headline" id="U-Boot_Network_configuration"><b>U-Boot Network configuration</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=73" title="Edit section: U-Boot Network configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>In order to download the Linux kernel image from the TFTP server and for mounting NFS the network settings in U-Boot need to be configured. 
</p><p><i>Please note that the following commands are being run from the 2nd stage U-Boot prompt on the serial console.</i> 
</p>
<pre>TI8168_EVM# setenv autoload no
TI8168_EVM# setenv bootfile uImage
</pre>
<p>The above two commands configure U-Boot not to autoboot the kernel and then set the name of the kernel image to be downloaded over the network. 
</p><p>When booting for the first time, U-Boot tries to fetch the MAC address from the env space. If it returns empty, it will look for MAC address from the eFuse registers in the Control module space and set the "ethaddr" variable in the env appropriately.
</p><p>The ethaddr can also be set using the setenv/saveenv commands. In such cases the user-set MAC address will take effect on subsequent reboot only.
</p><p>To set a different MAC address use the following command
</p>
<pre>TI8168_EVM# set ethaddr &lt;random MAC address eg- 08:11:23:32:12:77&gt;
</pre>
<div style="padding: 5px; background: none repeat scroll 0% 0% rgb(238, 238, 238); color: rgb(21, 27, 84);">
<p><b>Note</b><br />When setting a MAC address please ensure that the LSB of the 1st byte if not 1 i.e. when setting the MAC address: <b>y</b> in x<b>y</b>:ab:cd:ef:gh:jk has to be an even number. For more info this refer to the wiki page <a rel="nofollow" class="external free" href="http://en.wikipedia.org/wiki/MAC_address">http://en.wikipedia.org/wiki/MAC_address</a>
</p>
</div>
<p><br />
In case a static ip is not available run the dhcp command to obtain the ip address from the DHCP server on the network to which the EVM is connected. 
</p>
<pre>TI8168_EVM# setenv serverip &lt;tftp server in your network&gt;
TI8168_EVM# dhcp
TI8168_EVM# saveenv
</pre>
<p>In case a static ip is available run the following commands 
</p>
<pre>TI8168_EVM# setenv ipaddr &lt;your static ip&gt;
TI8168_EVM# saveenv
</pre>
<p>This completes the network configuration in U-Boot.
</p>
<h2><span class="mw-headline" id="U-Boot_Environment_Variables"><b>U-Boot Environment Variables</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=74" title="Edit section: U-Boot Environment Variables">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>After completing the network configuration and flashing the kernel image and filesystems to flash you need to set some other parameters which are essential for booting the kernel. 
</p>
<h3><span class="mw-headline" id="Environment_Settings_for_Ramdisk">Environment Settings for Ramdisk</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=75" title="Edit section: Environment Settings for Ramdisk">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>In case you are using a RAMDISK as the Linux filesystem 
</p>
<pre>TI8168_EVM# setenv bootargs 'console=ttyO2,115200n8 mem=256M earlyprintk root=/dev/ram rw initrd=0x82000000,32MB'
</pre>
<p>In case of NAND boot (0x170000 =&gt; size of Linux kernel uImage, 0x00320000 =&gt; size of Filesystem) 
</p>
<pre>TI8168_EVM# setenv bootcmd 'nand read 0x81000000 0x280000 0x170000;nand read 0x82000000 0x6C0000 0x320000;bootm 0x81000000'
</pre>
<p>In case of NOR boot (0x00320000 =&gt; size of Filesystem) 
</p>
<pre>TI8168_EVM# setenv bootcmd 'cp.w 0x8460000 0x82000000 0x320000;bootm 0x08060000'
</pre>
<p>In case of SPI boot (0x280000 =&gt; size of Linux kernel uImage, 0x13E000 =&gt; size of Filesystem) 
</p>
<pre>TI8168_EVM# setenv bootcmd 'sf probe 0; sf read 0x81000000 0x42000 0x280000; sf read 0x82000000 0x2C2000 0x13E000;bootm 0x81000000'
</pre>
<p>In case of SD boot 
</p>
<pre>TI8168_EVM# setenv bootcmd 'mmc init;fatload mmc 1 0x80009000 uImage;bootm 0x80009000' 
</pre>
<p><br /> 
</p><p>If auto boot is required then prefix 'dhcp' and 'run addip' to the above 'bootcmd' 
</p>
<pre>TI8168_EVM# setenv bootcmd 'dhcp;run addip;${bootcmd}'
</pre>
<p><b>NOTE:</b> The sizes of images mentioned in the above commands have to be modified based on the actual image size. Also, it should be aligned to sector size of the flash device used. 
</p><p>Finally 
</p>
<pre>TI8168_EVM# saveenv
</pre>
<h3><span class="mw-headline" id="Environment_Settings_for_JFFS2_Filesystem"><b>Environment Settings for JFFS2 Filesystem</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=76" title="Edit section: Environment Settings for JFFS2 Filesystem">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>U-Boot environment variable <b>bootargs</b> has information on arguments to be passed to Linux kernel. The <b>bootargs</b> format for JFFS2 root filesystem is,</li></ul>
<pre>  console=ttyO2,115200n8 root=/dev/mtdblock&lt;partion_id&gt; [ro|rw] rootfstype=jffs2 mem=100M earlyprintk
</pre>
<p>The value of <b>&lt;partition_id&gt;</b> depends on memory device which holds the rootfs. The below list gives values for different scenarios and it also assumes that only that respective device is enabled on the board, 
</p>
<pre> rootfs on NAND ==&gt; partion_id should be 3
 rootfs on NOR ==&gt; partion_id should be 3
 rootfs on SPI ==&gt; partion_id should be 3
<span style="color: rgb(255, 0, 0);"><b> NOTE</b></span>:&#160;If the kernel is compiled with both SPI and NAND support then /dev/mtdblock7 should be used for NAND.
       If the kernel is compiled with both SPI and NOR support then /dev/mtdblock7 should be used for SPI.
</pre>
<ul><li>Below examples set <b>bootargs</b> variable from u-boot prompt for different memory devices (in case of SPI, mtdblock3 should be used).</li></ul>
<p>In case if you want readonly filesystem, 
</p>
<pre>TI8168_EVM# setenv bootargs 'console=ttyO2,115200n8 root=/dev/mtdblock3 ro rootfstype=jffs2 mem=100M earlyprintk'
</pre>
<p>In case if you want read/write filesystem, 
</p>
<pre>TI8168_EVM# setenv bootargs 'console=ttyO2,115200n8 root=/dev/mtdblock3 rw rootfstype=jffs2 mem=100M earlyprintk'
</pre>
<p><span style="color: rgb(255, 0, 0);"><b>NOTE: If the kernel is compiled with both SPI and NAND support then /dev/mtdblock7 should be used for NAND</b></span><br /> 
</p><p>In case of NAND boot (0x170000 =&gt; size of Linux kernel uImage) 
</p>
<pre>TI8168_EVM# setenv bootcmd 'nand read 0x81000000 0x00280000 0x170000;bootm 0x81000000'
</pre>
<p>In case of NOR boot 
</p>
<pre>TI8168_EVM# setenv bootcmd 'bootm 0x08060000'
</pre>
<p>In case of SPI boot (0x280000 =&gt; size of Linux kernel uImage) 
</p>
<pre>TI8168_EVM# setenv bootcmd 'sf probe 0; sf read 0x81000000 0x42000 0x280000;bootm 0x81000000'
</pre>
<p><b>NOTE:</b> The sizes of images mentioned in the above commands have to be modified based on the actual image size. Also, it should be aligned to sector size of the flash device used.
</p>
<h3><span class="mw-headline" id="Environment_Settings_for_NFS_Filesystem"><b>Environment Settings for NFS Filesystem</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=77" title="Edit section: Environment Settings for NFS Filesystem">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>In case you want to have the kernel use the same ip as that assigned to U-Boot 
</p>
<pre>TI8168_EVM# print ethaddr                          &lt;-- Check if MAC address is assigned and is unique
TI8168_EVM# setenv ethaddr &lt;unique-MAC-address&gt;    &lt;-- Set only if not present already, format uv:yy:zz:aa:bb:cc
TI8168_EVM# setenv bootcmd 'dhcp;run addip; tftp 81000000 uImage;bootm'
TI8168_EVM# setenv hostname &lt;unique-hostname&gt;
TI8168_EVM# setenv addip 'setenv bootargs ${bootargs} ip=${ipaddr}:${nfsserver}:${gatewayip}:${netmask}:${hostname}:eth0:off'
TI8168_EVM# setenv autoload no
TI8168_EVM# setenv nfsserver &lt;NFS server-ip&gt;         &lt;-- Make sure the same NFS server IP is used below
TI8168_EVM# setenv bootargs 'console=ttyO2,115200n8 root=/dev/nfs nfsroot=&lt;NFS server-ip&gt;:&lt;NFS share&gt;,nolock rw mem=128M'      
TI8168_EVM# setenv serverip &lt;tftp-server-ip&gt;
</pre>
<p>In case you want to use dhcp for getting an IP when the kernel boots up 
</p>
<pre>TI8168_EVM# print ethaddr                          &lt;-- Check if MAC address is assigned and is unique
TI8168_EVM# setenv ethaddr &lt;unique-MAC-address&gt;    &lt;-- Set only if not present already, format uv:yy:zz:aa:bb:cc
TI8168_EVM# setenv bootcmd 'dhcp;tftp 81000000 uImage;bootm'
TI8168_EVM# setenv autoload no
TI8168_EVM# setenv nfsserver &lt;NFS server-ip&gt;         &lt;-- Make sure the same NFS server IP is used below
TI8168_EVM# setenv bootargs 'console=ttyO2,115200n8 root=/dev/nfs nfsroot=&lt;NFS server-ip&gt;:&lt;NFS share&gt;,nolock rw mem=128M ip=dhcp'      
TI8168_EVM# setenv serverip &lt;tftp-server-ip&gt;
</pre>
<p><br />Finally 
</p>
<pre>TI8168_EVM# saveenv
</pre>
<h2><span class="mw-headline" id="Booting_the_kernel">Booting the kernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;section=78" title="Edit section: Booting the kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>In case everything went well you should now be able to boot the kernel from U-Boot using the following command. 
</p>
<pre>TI8168_EVM# boot
</pre></div>
<!-- 
NewPP limit report
Cached time: 20201201034911
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.146 seconds
Real time usage: 0.152 seconds
Preprocessor visited node count: 410/1000000
Preprocessor generated node count: 615/1000000
Post‐expand include size: 1460/2097152 bytes
Template argument size: 213/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 1292/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    9.342      1 -total
 31.56%    2.948      1 Template:PspDM81xxInterchangeableNamesHeader
 20.08%    1.876      4 Template:Note
 17.08%    1.596      1 Template:SpImportant
 15.10%    1.411      1 Template:SpArticleStart
 13.16%    1.229      1 Template:SpLicenseCC-SA
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:8901-0!canonical and timestamp 20201201034911 and revision id 101704
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>DM816x AM389x PSP U-Boot</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>DM816x AM389x PSP U-Boot</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>DM816x AM389x PSP U-Boot</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>DM816x AM389x PSP U-Boot</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>DM816x AM389x PSP U-Boot</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>DM816x AM389x PSP U-Boot</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>DM816x AM389x PSP U-Boot</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>DM816x AM389x PSP U-Boot</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>DM816x AM389x PSP U-Boot</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;oldid=101704">https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;oldid=101704</a>"					</div>
				<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=DM816x+AM389x+PSP+U-Boot" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="DM816x_AM389x_PSP_U-Boot.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:DM816x_AM389x_PSP_U-Boot&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="DM816x_AM389x_PSP_U-Boot.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/DM816x_AM389x_PSP_U-Boot.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/DM816x_AM389x_PSP_U-Boot.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;oldid=101704" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=DM816x_AM389x_PSP_U-Boot&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 26 March 2012, at 23:37.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.146","walltime":"0.152","ppvisitednodes":{"value":410,"limit":1000000},"ppgeneratednodes":{"value":615,"limit":1000000},"postexpandincludesize":{"value":1460,"limit":2097152},"templateargumentsize":{"value":213,"limit":2097152},"expansiondepth":{"value":4,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":1292,"limit":5000000},"timingprofile":["100.00%    9.342      1 -total"," 31.56%    2.948      1 Template:PspDM81xxInterchangeableNamesHeader"," 20.08%    1.876      4 Template:Note"," 17.08%    1.596      1 Template:SpImportant"," 15.10%    1.411      1 Template:SpArticleStart"," 13.16%    1.229      1 Template:SpLicenseCC-SA"]},"cachereport":{"timestamp":"20201201034911","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":235});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/DM816x_AM389x_PSP_U-Boot by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 06:48:24 GMT -->
</html>
