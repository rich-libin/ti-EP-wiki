<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/TI811x_UBIFS_Support by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 10:26:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>TI811x UBIFS Support - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"TI811x_UBIFS_Support","wgTitle":"TI811x UBIFS Support","wgCurRevisionId":120223,"wgRevisionId":120223,"wgArticleId":17309,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"TI811x_UBIFS_Support","wgRelevantArticleId":17309,"wgRequestId":"64541cb28fafb7a388af8208","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-TI811x_UBIFS_Support rootpage-TI811x_UBIFS_Support skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">TI811x UBIFS Support</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#UBIFS"><span class="tocnumber">1</span> <span class="toctext"><b>UBIFS</b></span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#UBIFS_User-space_tools"><span class="tocnumber">2</span> <span class="toctext"><b>UBIFS User-space tools</b></span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#UBIFS_Implementation_Details"><span class="tocnumber">3</span> <span class="toctext"><span>UBIFS Implementation Details</span></span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Configuration"><span class="tocnumber">4</span> <span class="toctext"><b>Configuration</b></span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Compilling_UBIFS_Tools"><span class="tocnumber">5</span> <span class="toctext"><b>Compilling UBIFS Tools</b></span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Creating_UBIFS_file_system"><span class="tocnumber">6</span> <span class="toctext"><b>Creating UBIFS file system</b></span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Calculations"><span class="tocnumber">6.1</span> <span class="toctext"><b>Calculations</b></span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#Usable_Size_Calculation"><span class="tocnumber">6.1.1</span> <span class="toctext">Usable Size Calculation</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#Using_UBIFS_file_system"><span class="tocnumber">7</span> <span class="toctext"><b>Using UBIFS file system</b></span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Flashing_UBIFS_image_to_a_NAND_partition"><span class="tocnumber">7.1</span> <span class="toctext">Flashing UBIFS image to a NAND partition</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Using_UBIFS_image_as_root_file_system"><span class="tocnumber">7.2</span> <span class="toctext">Using UBIFS image as root file system</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="UBIFS"><b>UBIFS</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=1" title="Edit section: UBIFS">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>UBIFS may be considered as the next generation of the JFFS2 file-system. 
</p><p>JFFS2 file system works on top of MTD devices, but UBIFS works on top of UBI volumes and cannot operate on top of MTD devices. In other words, there are 3 subsystems involved: 
</p>
<ul><li>MTD subsystem, which provides uniform interface to access flash chips. MTD provides an notion of MTD devices (e.g., /dev/mtd0) which basically represents raw flash;</li>
<li>UBI subsystem, which is a wear-leveling and volume management system for flash devices; UBI works on top of MTD devices and provides a notion of UBI volumes; UBI volumes are higher level entities than MTD devices and they are devoid of many unpleasant issues MTD devices have (e.g., wearing and bad blocks); see here for more information;</li>
<li>UBIFS file system, which works on top of UBI volumes.</li></ul>
<p><br /> 
</p><p>For more information on MTD, refer &lt;<a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/general.html">http://www.linux-mtd.infradead.org/doc/general.html</a>&gt; 
</p><p>For more information on UBI, refer &lt;<a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubi.html">http://www.linux-mtd.infradead.org/doc/ubi.html</a>&gt; 
</p><p>For more information on UBIFS, refer &lt;<a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubifs.html">http://www.linux-mtd.infradead.org/doc/ubifs.html</a>&gt; 
</p>
<h1><span class="mw-headline" id="UBIFS_User-space_tools"><b>UBIFS User-space tools</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=2" title="Edit section: UBIFS User-space tools">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>UBI user-space tools, as well as other MTD user-space tools, are available from the the following git repository:
<a rel="nofollow" class="external free" href="git://git.infradead.org/mtd-utils.git">git://git.infradead.org/mtd-utils.git</a>
</p><p>The repository contains the following UBI tools:
</p>
<pre>   ubinfo - provides information about UBI devices and volumes found in the system;
   ubiattach - attaches MTD devices (which describe raw flash) to UBI and creates corresponding UBI devices;
   ubidetach - detaches MTD devices from UBI devices (the opposite to what ubiattach does);
   ubimkvol - creates UBI volumes on UBI devices;
   ubirmvol - removes UBI volumes from UBI devices;
   ubiupdatevol - updates UBI volumes; this tool uses the UBI volume update feature which leaves the volume in 
                  "corrupted" state if the update was interrupted; additionally, this tool may be used to wipe 
                  out UBI volumes;
   ubicrc32 - calculates CRC-32 checksum of a file with the same initial seed as UBI would use;
   ubinize - generates UBI images;
   ubiformat - formats empty flash, erases flash and preserves erase counters, flashes UBI images to MTD devices;
   mtdinfo - reports information about MTD devices found in the system.
</pre>
<p>All UBI tools support "-h" option and print sufficient usage information.
</p><p><br />
</p>
<h1><span class="mw-headline" id="UBIFS_Implementation_Details"><span style="font-weight: bold;">UBIFS Implementation Details</span></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=3" title="Edit section: UBIFS Implementation Details">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<ul><li>The UBIFS file system is supported with 8-bit BCH ECC scheme by default. The 8-bit BCH ECC scheme is aligned across ROM, U-boot and Kernel.<br /></li>
<li>Both UBIFS and 8-bit BCH scheme are enabled in the Uboot and Kernel by default.</li></ul>
<h1><span class="mw-headline" id="Configuration"><b>Configuration</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=4" title="Edit section: Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Note: The following configuration is enabled in the kernel by default.
</p><p>To enable UBIFS support, start the <i><b>Linux Kernel Configuration</b></i>&#160;tool:<br /> 
</p>
<pre>$ make menuconfig 
</pre> 
<p><b>(1)</b> 
</p>
<ul><li>Select <i><b>Device Drivers</b></i> from the main menu.</li></ul>
<pre>    ...
    ...
    Power management options ---&gt;
[ ] Networking support ---&gt;
    Device Drivers ---&gt;
    ...</pre> 
<p><br /> Select <i><b>Memory Technology Device (MTD) Support</b></i>as shown here:<i><b><br /></b></i> 
</p>
<pre>    ...
    ...
&lt; &gt; Connector - unified userspace &lt;-&gt; kernelspace linker  ---&gt;
&lt;*&gt; Memory Technology Device (MTD) support  ---&gt;
&lt; &gt; Parallel port support  ---&gt;
    ...</pre> 
<p><br /> Select <i><b>Enable UBI - Unsorted block images</b></i>&#160;as shown here:<br /> 
</p>
<pre>    ...
&lt;*&gt; Enable UBI - Unsorted block images  ---&gt;
</pre> 
<p><b><br /></b> <b>(2)</b> 
</p>
<ul><li>Select <i><b>Device Drivers</b></i> from the main menu.</li></ul>
<pre>    ...
    ...
    Power management options ---&gt;
[ ] Networking support ---&gt;
    Device Drivers ---&gt;
    ...</pre> 
<p><br /> Select <i><b>Memory Technology Device (MTD) Support</b></i>as shown here:<i><b><br /></b></i> 
</p>
<pre>    ...
    ...
&lt; &gt; Connector - unified userspace &lt;-&gt; kernelspace linker  ---&gt;
&lt;*&gt; Memory Technology Device (MTD) support  ---&gt;
&lt; &gt; Parallel port support  ---&gt;
    ...</pre> 
<p><br /> Select <i><b>NAND Device Support</b></i>&#160;as shown here:<br /> 
</p>
<pre>    ...
    ...
[ ] NAND ECC Smart Media byte order
&lt;*&gt; NAND Device Support  ---&gt;
    ...

</pre> 
<p><b>Deselect </b>Verify NAND page writes from the main menu. 
</p>
<pre>[ ] Verify NAND page writes
    ...
    ...
</pre> 
<p><br /> 
</p><p><b>(3)</b> 
</p>
<ul><li>Select <i><b>File Systems</b></i> from the main menu.</li></ul>
<pre>    ...
    ...
    Device Drivers ---&gt;
    File systems  ---&gt;
    ...</pre> 
<p><br /> Select <i><b>Miscellaneous filesystems</b></i>as shown here:<i><b><br /></b></i> 
</p>
<pre>    ...
    ...
    Pseudo filesystems  ---&gt;
[*] Miscellaneous filesystems  ---&gt; 
[*] Network File Systems  ---&gt; 
    ...</pre> 
<p><br /> Select<b>&#160;</b><i><b>UBIFS file system support</b>'<b>&#160;as shown here:<br /></b></i> 
</p>
<pre>    ...
    ...
&lt;*&gt; UBIFS file system support
[ ] Extended attributes support
[ ] Advanced compression options
[ ] Enable debugging support
    ...

</pre> 
<p><b><br /></b>
</p>
<h1><span class="mw-headline" id="Compilling_UBIFS_Tools"><b>Compilling UBIFS Tools</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=5" title="Edit section: Compilling UBIFS Tools">edit</a><span class="mw-editsection-bracket">]</span></span></h1><p>
The MTD and UBI user-space tools are available from the the following git repository: </p><pre>git://git.infradead.org/mtd-utils.git</pre>
<p>As of writing this wiki, the mtd-utils version is 1.4.8. 
</p><p>For instructions on compiling MTD-utils, refer <a href="TI811x_MTD_Utilities.html#MTD-Utils_Compilation" class="mw-redirect" title="TI811x MTD Utilities"> TI811x MTD-Utils Compilation</a>.
</p>
<h1><span class="mw-headline" id="Creating_UBIFS_file_system"><b>Creating UBIFS file system</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=6" title="Edit section: Creating UBIFS file system">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>From information on how to create a UBIFS image. refer <a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_mkfubifs">create an UBIFS image</a>
</p>
<ul><li><b>mkfs.ubifs</b></li></ul>
<pre> [root@localhost]# cd /home/&lt;user&gt;/mtd/install/sbin
 [root@localhost]# ./mkfs.ubifs -r &lt;target_fs&gt; -F -o ubifs.img -m 2048 -e 126976 -c 1580
</pre> 
<p>Where: 
</p><p><b>-m 2KiB (or 2048)</b><i><b><br /></b></i>The minimum I/O size of the underlying UBI and MTD devices. In our case, we are running the flash with no sub-page writes, so this is a 2KiB page.<i><b><br /></b></i><b>-e&#160;</b><b>124KiB (or 126976)</b><br />Erase Block Size: UBI requires 2 minimum I/O units out of each Physical Erase Block (PEB) for overhead: 1 for maintaining erase count information, and 1 for maintaining the Volume ID information. The PEB size for the XO flash is 128KiB, so this leads to each Logical Erase Block (LEB) having 124KiB available for data.<br /><b>-c 1580</b><br />The maximum size, in LEBs, of this file system. See calculation below for how this number is determined.<br /><b>-r filesystem</b><br />Use the contents of the 'filesystem/' directory to generate the initial file system image. 
</p><p><b>-F</b> 
</p><p>File-system free space has to be fixed up on first mount (<a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_free_space_fixup">http://www.linux-mtd.infradead.org/faq/ubifs.html#L_free_space_fixup</a>)<br /><b>-o ubifs.img</b><br />Output file.&#160; 
</p><p>The output of the above command, <b>ubifs.img</b> is fed into the 'ubinize' program to wrap it into a UBI image.<br /> 
</p>
<pre>  The images produced by <i>mkfs.ubifs</i> must be further fed to the ubinize tool to create a UBI image which must be put to the raw flash to be used a UBI partition. 
</pre>
<p><br /> 
</p>
<ul><li>Create <b>ubinize.cfg</b> file and write the contents into it</li></ul>
<pre> 
 [root@localhost]# cd /home/&lt;user&gt;/mtd/install/sbin
 [root@localhost]# vi ubinize.cfg
</pre> 
<pre>  [ubifs]               &lt;== Section header
  mode=ubi              &lt;== Volume mode (other option is static)
  image=ubifs.img       &lt;== Source image
  vol_id=0              &lt;== Volume ID in UBI image
  vol_size=192MiB       &lt;== Volume size
  vol_type=dynamic      &lt;== Allow for dynamic resize
  vol_name=rootfs       &lt;== Volume name
  vol_flags=autoresize  &lt;== Autoresize volume at first mount
</pre>
<p>[See calculations below to determine the value associated with 'vol_size'] <br /> 
</p>
<ul><li><b>ubinize</b></li></ul>
<pre> 
 [root@localhost]# cd /home/&lt;user&gt;/mtd/install/sbin
 [root@localhost]# ./ubinize -o ubi.img -m 2048 -p 128KiB -s 512 -O 2048 ubinize.cfg
</pre> 
<p>Where:<br /><b>-o ubi.img</b><br />Output file<br /><b>-m 2KiB (or 2048)</b><br />Minimum flash I/O size of 2KiB page<br /><b>-p&#160;128KiB</b> 
</p><p>Size of the physical eraseblock of the flash&#160;this UBI image is created for 
</p><p><b>-O 2048</b> offset if the VID header from start of the&#160;physical eraseblock<br /> 
</p><p>The output of the above command, '<b>ubi.img'</b> is the required image. 
</p><p><br /> 
</p>
<h2><span class="mw-headline" id="Calculations"><b>Calculations</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=7" title="Edit section: Calculations">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h5><span class="mw-headline" id="Usable_Size_Calculation">Usable Size Calculation</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=8" title="Edit section: Usable Size Calculation">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>As documented <a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubi.html#L_overhead">here</a>, UBI reserves a certain amount of space for management and bad PEB handling operations. Specifically: 
</p>
<ul><li>2 PEBs are used to store the UBI volume table</li>
<li>1 PEB is reserved for wear-leveling purposes;</li>
<li>1 PEB is reserved for the atomic LEB change operation;</li>
<li>a&#160;% of PEBs is reserved for handling bad EBs. The default for NAND is 1%</li>
<li>UBI stores the erase counter (EC) and volume ID (VID) headers at the beginning of each PEB. 1 min I/O unit is required for each of these.</li></ul>
<p>To calculate the full overhead, we need the following values: 
</p>
<table>

<tbody><tr>
<th>Symbol
</th>
<th>Meaning
</th>
<th>Value for XO test case
</th></tr>
<tr>
<td>SP
</td>
<td>PEB Size
</td>
<td>128KiB
</td></tr>
<tr>
<td>SL
</td>
<td>LEB Size
</td>
<td>128KiB - 2 * 2KiB = 124 KiB
</td></tr>
<tr>
<td>P
</td>
<td>Total number of PEBs on the MTD device
</td>
<td>200MiB / 128KiB = 1600
</td></tr>
<tr>
<td>B
</td>
<td>Number of PEBs reserved for bad PEB handling
</td>
<td>1% of P = 16
</td></tr>
<tr>
<td>O
</td>
<td>The overhead related to storing EC and VID headers in bytes, i.e. O = SP - SL
</td>
<td>4KiB
</td></tr></tbody></table>
<p><br /> 
</p>
<pre>UBI Overhead = (B + 4) * SP + O * (P - B - 4) 
      = (16 + 4) * 128Kib + 4 KiB * (1600 - 16 - 4)
      = 8880 KiB 
      = 69.375 PEBs (round to 69)
</pre>
<p>This leaves us with 1531 PEBs or 195968KiB available for user data. 
</p><p>Note that we used "-c 1580" in the above mkfs.ubifs command line to specify the maximum filesystem size, not "-c 1531" The reason for this is that mkfs.ubifs operates in terms of LEB size (124 KiB), not PEB size (128Kib). 195968KiB / 124 Kib = 1580.39 (round to 1580). 
</p><p>Volume size =&#160;195968KiB (~192MiB) 
</p><p><br />
</p>
<h1><span class="mw-headline" id="Using_UBIFS_file_system"><b>Using UBIFS file system</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=9" title="Edit section: Using UBIFS file system">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p><br />
</p>
<h2><span class="mw-headline" id="Flashing_UBIFS_image_to_a_NAND_partition">Flashing UBIFS image to a NAND partition<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=10" title="Edit section: Flashing UBIFS image to a NAND partition">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>We can Flash UBIFS image from either Linux Kernel or U-Boot. 
</p><p>Follow steps mentioned <a href="UBIFS_Support.html#Creating_UBIFS_file_system" title="UBIFS Support">here</a> to create an UBIFS image. 
</p><p>From U-Boot, <br /> 
</p><p>Get the UBIFS image to U-Boot from tftp or MMC/SD or UART. Lets consider an example of MMC card. 
</p><p>Since we copy the data to NAND, Empty/Erase the required RAM. Then, get the UBIFS image to U-Boot 
</p>
<pre> u-boot# mw.b 0x83000000 0xFF &lt;filesystem_image_size&gt; &lt;=== filesystem image size is upward aligned to NAND block size,
                                                           This is required to get rid of "Empty Flash" JFFS2 during kernel boot.
 u-boot# mmc rescan
 u-boot# fatload mmc 0 0x83000000 ubi.img
</pre> 
<p>Next, erase and write to the NAND. 
</p>
<div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />On flashing UBIFS image from U-Boot, make sure that ECC selected is in sync with Linux</div>
<p><br /> 
</p>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(52,128,23); padding-top: 5px"><b>Example</b> 
<p>Assuming 
</p>
<ol><li>NAND partition to be erased starts from "0x6C0000",</li>
<li>NAND partition of size "0xC820000" and</li>
<li>File system image size to be flashed is 0xFC0000 which is upward aligned to NAND block size</li></ol>
<pre> 
 u-boot# nand erase 0x6C0000 0xC820000
 u-boot# nand write 0x83000000 0x6C0000 0xFC0000
</pre> </div>
<h2><span class="mw-headline" id="Using_UBIFS_image_as_root_file_system">Using UBIFS image as root file system</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit&amp;section=11" title="Edit section: Using UBIFS image as root file system">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Set up the bootargs environment variable as below to use the UBIFS file system image present in a MTD partition:</li></ul>
<pre>setenv bootargs 'console=ttyO0,115200n8 noinitrd ip=off mem=256M rootwait=1 rw ubi.mtd=X,YYYY rootfstype=ubifs root=ubi0:rootfs init=/init'</pre> 
<p>Where X is the MTD partition number being used for file system and YYYY is the NAND page size.
make sure that an UBI file system is flashed into this partition before passing it as a boot partition for Linux.
</p><p>Assuming <b>9</b>th mtd partition, 
</p>
<pre>#setenv bootargs 'console=ttyO0,115200n8 noinitrd ip=off mem=256M rootwait=1 rw ubi.mtd=9,2048 rootfstype=ubifs root=ubi0:rootfs init=/init'</pre>
<p>The value of <b>&lt;X&gt;</b> depends on memory device which holds the rootfs.
</p>
<div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />On booting with UBIFS as rootfs, the first boot happens successfully. Before subsequent boot-ups, it is recommended to do a manual "sync" from the console. This allows UBIFS meta data properly updated on the partition. This initial sync will help later recovery.</div>
<p><br />
<span style="color: rgb(255, 0, 0);"><b> NOTE:</b></span>:&#160;
</p>
<pre>   By default the kernel is compiled with both SPI and NAND support
   If SW6.1 is ON ubi.mtd=4,2048 should be used for NAND.
   If SW6.3 is ON ubi.mtd=4,2048 should be used for SPI.
   If both SW6.1 and SW6.3 are ON then ubi.mtd=9,2048 should be used for NAND or SPI.
</pre>
<p><br />
</p>
<!-- 
NewPP limit report
Cached time: 20201201040229
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.042 seconds
Real time usage: 0.043 seconds
Preprocessor visited node count: 216/1000000
Preprocessor generated node count: 480/1000000
Post‐expand include size: 604/2097152 bytes
Template argument size: 348/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 2550/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    1.762      1 -total
 84.40%    1.487      2 Template:SpNote
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:17309-0!canonical and timestamp 20201201040229 and revision id 120223
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>TI811x UBIFS Support</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>TI811x UBIFS Support</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>TI811x UBIFS Support</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>TI811x UBIFS Support</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>TI811x UBIFS Support</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>TI811x UBIFS Support</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>TI811x UBIFS Support</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>TI811x UBIFS Support</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>TI811x UBIFS Support</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;oldid=120223">https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;oldid=120223</a>"					</div>
				<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=TI811x+UBIFS+Support" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="TI811x_UBIFS_Support.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:TI811x_UBIFS_Support&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="TI811x_UBIFS_Support.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/TI811x_UBIFS_Support.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/TI811x_UBIFS_Support.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;oldid=120223" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=TI811x_UBIFS_Support&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 14 September 2012, at 06:17.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.042","walltime":"0.043","ppvisitednodes":{"value":216,"limit":1000000},"ppgeneratednodes":{"value":480,"limit":1000000},"postexpandincludesize":{"value":604,"limit":2097152},"templateargumentsize":{"value":348,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":2550,"limit":5000000},"timingprofile":["100.00%    1.762      1 -total"," 84.40%    1.487      2 Template:SpNote"]},"cachereport":{"timestamp":"20201201040229","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":221});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/TI811x_UBIFS_Support by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 10:26:01 GMT -->
</html>
