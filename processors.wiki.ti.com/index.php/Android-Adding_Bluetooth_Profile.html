<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/Android-Adding_Bluetooth_Profile by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 04:13:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Android-Adding Bluetooth Profile - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Android-Adding_Bluetooth_Profile","wgTitle":"Android-Adding Bluetooth Profile","wgCurRevisionId":217995,"wgRevisionId":217995,"wgArticleId":12243,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["AM37x","Android","OMAP35x","Sitara Android"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Android-Adding_Bluetooth_Profile","wgRelevantArticleId":12243,"wgRequestId":"eb3894370dd5094f6a5f2659","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":["sysop"],"wgRestrictionMove":["sysop"]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Android-Adding_Bluetooth_Profile rootpage-Android-Adding_Bluetooth_Profile skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">Android-Adding Bluetooth Profile</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><b><big><big><big><span style="color:red">Content is no longer maintained and is being kept for reference only!</span></big></big></big></b>
<br />
<br />
This wiki highlights on - "How to add bluetooth profile(HID) support into android framework". This can be taken as a reference to add more profiles for bluetooth or other software stack under android framework.
</p>
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Android_Bluetooth_Framewrok"><span class="tocnumber">1</span> <span class="toctext">Android Bluetooth Framewrok</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Bluetooth_profiles_supported_by_android"><span class="tocnumber">2</span> <span class="toctext">Bluetooth profiles supported by android</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Android_Bluetooth_Source"><span class="tocnumber">3</span> <span class="toctext">Android Bluetooth Source</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Bluetooth_event_flow_in_Android_Source_Tree"><span class="tocnumber">4</span> <span class="toctext">Bluetooth event flow in Android Source Tree</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Adding_a_bluetooth_HID_profile"><span class="tocnumber">5</span> <span class="toctext">Adding a bluetooth HID profile</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Create_JNI_interface"><span class="tocnumber">5.1</span> <span class="toctext">Create JNI interface</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Create_framework_service_for_Bluetooth_HID"><span class="tocnumber">5.2</span> <span class="toctext">Create framework service for Bluetooth HID</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Create_Application_Bluetooth_HID_service_.26_Application_moification_to_add_bluetooth_HID"><span class="tocnumber">5.3</span> <span class="toctext">Create Application Bluetooth HID service &amp; Application moification to add bluetooth HID</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#References"><span class="tocnumber">6</span> <span class="toctext">References</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Android_Bluetooth_Framewrok">Android Bluetooth Framewrok</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=1" title="Edit section: Android Bluetooth Framewrok">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a href="File_BT_Stack.html" class="image"><img alt="BT Stack.jpg" src="https://processors.wiki.ti.com/images/e/e0/BT_Stack.jpg" width="500" height="375" /></a>
</p>
<h2><span class="mw-headline" id="Bluetooth_profiles_supported_by_android">Bluetooth profiles supported by android</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=2" title="Edit section: Bluetooth profiles supported by android">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Android's Bluetooth stack uses BlueZ for:
</p>
<ul><li>GAP profile: Generic Access protocol</li>
<li>SDP profile&#160;: Service discovery protocol</li>
<li>Headset and Handsfree (v1.5) profiles are implemented in the Android framework and are both tightly coupled with the Phone App. These profiles are also SIG qualified.</li>
<li>RFCOMM profile: Cable replacement protocol,and is a SIG-qualified Bluetooth 2.0 host stack.</li></ul>
<p>BlueZ Website: <a rel="nofollow" class="external free" href="http://wiki.bluez.org/">http://wiki.bluez.org/</a>
Documentation: mydroid\external\bluez\utils\doc
</p><p>Bluez is GPL licensed, so the Android framework interacts with userspace bluez code through D-BUS IPC to avoid proprietary code.
</p><p>D-BUS website: <a rel="nofollow" class="external free" href="http://www.freedesktop.org/wiki/IntroductionToDBus">http://www.freedesktop.org/wiki/IntroductionToDBus</a>
</p>
<h2><span class="mw-headline" id="Android_Bluetooth_Source">Android Bluetooth Source</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=3" title="Edit section: Android Bluetooth Source">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Bluez 3.38 (user space and kernel)</li></ul>
<pre>&lt;android-src&gt;/external/bluez
&lt;android-src&gt;/kernel/drivers/bluetooth
&lt;android-src&gt;/kernel/net/bluetooth
</pre>
<ul><li>Android App framework (java &amp; c++)</li></ul>
<pre>&lt;android-src&gt;/frameworks/base/core/jni/android_bluetooth_*.cpp
&lt;android-src&gt;/frameworks/base/core/java/android/bluetooth/*.java
&lt;android-src&gt;/frameworks/bases/services/java/com/android/server (system_server)
</pre>
<ul><li>Android UI application</li></ul>
<pre>&lt;android-src&gt;/packages/apps/Phone/src/com/android/phone (Phone App)
&lt;android-src&gt;/package/apps/Settings/src/com/android/settings/bluetooth/ (Settings App)
</pre>
<h2><span class="mw-headline" id="Bluetooth_event_flow_in_Android_Source_Tree">Bluetooth event flow in Android Source Tree</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=4" title="Edit section: Bluetooth event flow in Android Source Tree">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a href="File_500px-Bluetooth_Source_Flow_Android.html" class="image"><img alt="500px-Bluetooth Source Flow Android.jpg" src="https://processors.wiki.ti.com/images/4/42/500px-Bluetooth_Source_Flow_Android.jpg" width="500" height="488" /></a>
<br />
Above diagram explains a sequence of bluetooth event flow with respect to android source tree
</p>
<ul><li><b>BlueZ</b>
<ul><li>BlueZ provides support for the core Bluetooth layers and protocols</li>
<li>Android BlueZ is software stack implenation which will get/send bluetooth controls and data to/from bluetooth h/w using kenrel (bluez) modules.</li>
<li>BlueZ also expose a interface for android framework which enable door to access bluetooth functionalities.</li>
<li>Documenataion of exposed interface can be found at &lt;android-src&gt;/external/bluetooth/bluez/doc</li>
<li>Android framework communicates with bluez using D-Bus protocol.Interface to use for diffenent types of bluetooth porfile is documented at &lt;android-src&gt;/external/bluetooth/bluez/doc</li></ul></li></ul>
<p>e.g. Bluetooth input device - Exposed API is available at &lt;android-src&gt;/external/bluetooth/bluez/doc/input-api.txt
</p>
<pre>Input hierarchy
===============
Service     org.bluez
Interface   org.bluez.Input
Object path [variable prefix]/{hci0,hci1,...}/dev_XX_XX_XX_XX_XX_XX
Methods     void Connect()
            Connect to the input device.

        	void Disconnect()
            Disconnect from the input device.

	        dict GetProperties()
            Returns all properties for the interface. See the
            properties section for available properties.


Signals     PropertyChanged(string name, variant value)

            This signal indicates a changed value of the given
            property.

Properties  boolean Connected [readonly]

            Indicates if the device is connected.
</pre>
<ul><li><b>Framework Layer</b>
<ul><li>Bluetooth functionality in a framewrok is divided in two parts
<ul><li>Bluetooth JNI Service&#160;: This component talks to bluez using D-Bus interface</li></ul></li></ul></li></ul>
<pre>frameworks/base/core/jni/Android.mk
frameworks/base/jcore/jni/AndroidRuntime.cpp
frameworks/base/core/jni/android_server_BluetoothEventLoop.cpp
frameworks/base/core/jni/android_server_BluetoothHidService.cpp
</pre>
<ul><li><ul><li><ul><li>Bluetooth Service Layer&#160;: This component provides interface to application to communicate with bluez using component#1.</li></ul></li></ul></li></ul>
<pre>frameworks/base/core/java/android/server/BluetoothEventLoop.java
frameworks/base/core/java/android/server/BluetoothHidService.java
frameworks/base/services/java/com/android/server/SystemServer.java
</pre>
<ul><li><b>Application Layer</b>
<ul><li>Application&#160;: Component that creates user interface</li>
<li>Service    &#160;: Component talks to android framewrok using AIDL to get/send bluetooth controls and data</li></ul></li></ul>
<pre>Application:
packages/apps/Phone/src/com/android/phone
package/apps/Settings/src/com/android/settings/bluetooth/

Service&#160;: (android.bluetooth)
frameworks/base/core/java/android/bluetooth/BluetoothClass.java
frameworks/base/core/java/android/bluetooth/BluetoothUuid.java
frameworks/base/core/java/android/bluetooth/BluetoothHid.java

AIDL:
frameworks/base/core/java/android/bluetooth/IBluetoothHid.aidl
</pre>
<h2><span class="mw-headline" id="Adding_a_bluetooth_HID_profile">Adding a bluetooth HID profile</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=5" title="Edit section: Adding a bluetooth HID profile">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li><span style="color: GREEN"><b>Note&#160;: For complete code reference guide; kindly take reference of attached patch.</b></span></li></ul><b></b><p><b></b>
<a rel="nofollow" class="external free" href="File_Bluetooth-HID-support-Android.html">http://processors.wiki.ti.com/index.php/File:Bluetooth-HID-support-Android.zip</a>
</p>
<h3><span class="mw-headline" id="Create_JNI_interface">Create JNI interface</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=6" title="Edit section: Create JNI interface">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Create File:&lt;android-src&gt;/frameworks/base/core/jni/android_server_BluetoothHidService.cpp</li></ul>
<pre>

static bool initNative(JNIEnv* env, jobject object) {
	/* open dbus connection */
}

static void cleanupNative(JNIEnv* env, jobject object) {
	 /* close dbus connection */
}

static jobjectArray getInputPropertiesNative(JNIEnv *env, jobject object,
                                            jstring path) {
	/* talk to bluez with interface org.bluez.Input and method&#160;:GetProperties */
}

static jboolean connectInputNative(JNIEnv *env, jobject object, jstring path) {
	/* talk to bluez with interface org.bluez.Input and method&#160;:Connect */
}

static jboolean disconnectInputNative(JNIEnv *env, jobject object,
                                     jstring path) {
	/* talk to bluez with interface org.bluez.Input and method&#160;:Disconnect */
}

DBusHandlerResult hid_event_filter(DBusMessage *msg, JNIEnv *env) {
	/* talk to bluez with interface org.bluez.Input and signal&#160;:PropertyChanged */
}

static JNINativeMethod sMethods[] = {
    {"initNative", "()Z", (void *)initNative},
    {"cleanupNative", "()V", (void *)cleanupNative},

    /* Bluez audio 4.40 API */
    {"connectInputNative", "(Ljava/lang/String;)Z", (void *)connectInputNative},
    {"disconnectInputNative", "(Ljava/lang/String;)Z", (void *)disconnectInputNative},
    {"getInputPropertiesNative", "(Ljava/lang/String;)[Ljava/lang/Object;",
                                    (void *)getInputPropertiesNative},                                                       
};

int register_android_server_BluetoothHidService(JNIEnv *env) {
	/* register HID service and methods mentioned above */
}

</pre>
<ul><li>Add HID support to eventloop&#160;:</li></ul>
<pre>/* Open&#160;:&lt;android-src&gt;/frameworks/base/core/jni/android_server_BluetoothEventLoop.cpp */
/* 1. add entry to fucntion static "setUpEventLoop" */
static jboolean setUpEventLoop(native_data_t *nat) {
.....
.....
	dbus_bus_add_match(nat-&gt;conn,
       "type='signal',interface='org.bluez.Input'",
       &amp;err);
        if (dbus_error_is_set(&amp;err)) {
            LOG_AND_FREE_DBUS_ERROR(&amp;err);
            return JNI_FALSE;
        }
..
..
}

/* 2. add entry to function "tearDownEventLoop" */
static void tearDownEventLoop(native_data_t *nat) {
.....
....
 dbus_bus_remove_match(nat-&gt;conn,
       "type='signal',interface='org.bluez.Input'",
        &amp;err);
	    if (dbus_error_is_set(&amp;err)) {
            LOG_AND_FREE_DBUS_ERROR(&amp;err);
        }

....
}

/* 3. delcare extern for hid_event_filter&#160;: Implemented in android_server_BluetoothHidService.cpp */
extern DBusHandlerResult hid_event_filter(DBusMessage *msg, JNIEnv *env);

/* call "hid_event_filter(msg, env);" in function&#160;:event_filter
static DBusHandlerResult event_filter(DBusConnection *conn, DBusMessage *msg,
                                      void *data) {
.....
.....
hid_event_filter(msg, env);
ret = a2dp_event_filter(msg, env);
}
</pre>
<ul><li>Register HID service and add build support</li></ul>
<pre>/* open frameworks/base/core/jni/Android.mk, add android_server_BluetoothHidService.cpp for build  */
LOCAL_SRC_FILES += android_server_BluetoothHidService.cpp
</pre>
<pre>/* open&#160;: frameworks/base/core/jni/AndroidRuntime.cpp and add HID service registration */
extern int register_android_server_BluetoothHidService(JNIEnv* env);
/* in function static const RegJNIRec add HID entry */
static const RegJNIRec gRegJNI[] = {
....
....
REG_JNI(register_android_server_BluetoothHidService),
....
....
}
</pre>
<h3><span class="mw-headline" id="Create_framework_service_for_Bluetooth_HID">Create framework service for Bluetooth HID</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=7" title="Edit section: Create framework service for Bluetooth HID">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Create bluetooth HID service</li></ul>
<pre>/* create file&#160;:frameworks/base/java/android/server/BluetoothHidService.java */
/* implement wrapper APIs for all methods present in JNI interface. For more info on code kindly refer attached patch */
</pre>
<ul><li>register bluetooth HID service with system server</li></ul>
<pre>/* open file&#160;: &lt;android-src&gt;/frameworks/base/services/java/com/android/server/SystemServer.java */
import android.server.BluetoothHidService;
public void run() {
....
....
	BluetoothService bluetooth = null;
    BluetoothA2dpService bluetoothA2dp = null;
    /* HID port - start */
    BluetoothHidService bluetoothHid = null;
    /* HID port - end */
....
....
	bluetoothA2dp = new BluetoothA2dpService(context, bluetooth);
    ServiceManager.addService(BluetoothA2dpService.BLUETOOTH_A2DP_SERVICE,
                                  bluetoothA2dp);
    /* HID port - start */
    if (SystemProperties.TARGET_OMAP4) {
    	bluetoothHid = new BluetoothHidService(context, bluetooth);
        ServiceManager.addService(BluetoothHidService.BLUETOOTH_HID_SERVICE,
        							bluetoothHid);
    }
    /* HID port - end */
....
....
}
</pre>
<ul><li>Add authorization check at BluetoothEventLoop.java</li></ul>
<pre>/* open file&#160;:frameworks/base/core/java/android/server/BluetoothEventLoop.java */
private boolean onAgentAuthorize(String objectPath, String deviceUuid){
....
....
	if (mBluetoothService.isEnabled() &amp;&amp;
	..
	..
	}
    /* HID port - start */
    if (mBluetoothService.isEnabled() &amp;&amp;
          (BluetoothUuid.isInputHID(uuid)) &amp;&amp; SystemProperties.TARGET_OMAP4) {
           authorized = true;
           Log.i(TAG, "Allowing incoming HID connection from " + address);
    /* HID port - end */
	}
	else {
	    Log.i(TAG, "Rejecting incoming " + deviceUuid + " connection from " + address);
    }
....
....
}
</pre>
<h3><span id="Create_Application_Bluetooth_HID_service_&amp;_Application_moification_to_add_bluetooth_HID"></span><span class="mw-headline" id="Create_Application_Bluetooth_HID_service_.26_Application_moification_to_add_bluetooth_HID">Create Application Bluetooth HID service &amp; Application moification to add bluetooth HID</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=8" title="Edit section: Create Application Bluetooth HID service &amp; Application moification to add bluetooth HID">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Kindly refer user guide for creating custom service at</li></ul>
<p><a rel="nofollow" class="external free" href="Android-Adding_SystemService.html">http://processors.wiki.ti.com/index.php/Android-Adding_SystemService</a>
</p>
<ul><li>Create Blueetooth HID custom application service</li></ul>
<pre>/* create file&#160;: frameworks/base/core/java/android/bluetooth/BluetoothHid.java */
define BluetoothHID class with following methods:
public final class BluetoothHid { 
....
....
public BluetoothHid(Context c){
	/* Create a BluetoothHid proxy object for interacting with the local Bluetooth HID service */
	IBinder b = ServiceManager.getService(BluetoothHidService.BLUETOOTH_HID_SERVICE);
	mService = IBluetoothHid.Stub.asInterface(b); 
}
public boolean connectInput(BluetoothDevice device) {
	/* Initiate a connection to an HID input device */
	mService.connectInput(device);
}
public boolean disconnectInput(BluetoothDevice device) {
	/* Initiate disconnect from an HID input device.  */
	mService.disconnectInput(device);
}
public int getInputState(BluetoothDevice device) {
	/*  Get the state of an HID input device */
	 mService.getInputState(device);
}
....
/* Add more custom methods */
....
}
</pre>
<ul><li>Create Uuid for bluetooth HID profile</li></ul>
<pre>/* open file&#160;: frameworks/base/core/java/android/bluetooth/BluetoothUuid.java */
public final class BluetoothUuid {
....
....
public static final ParcelUuid HID =
            ParcelUuid.fromString("00001124-0000-1000-8000-00805f9b34fb");
....
/* public static final ParcelUuid[] RESERVED_UUIDS = {
        AudioSink, AudioSource, AdvAudioDist, HSP, Handsfree, AvrcpController, AvrcpTarget,
        ObexObjectPush};*/
change to 
public static final ParcelUuid[] RESERVED_UUIDS = {
        AudioSink, AudioSource, AdvAudioDist, HSP, Handsfree, AvrcpController, AvrcpTarget,
        ObexObjectPush,HID};
...
/* HID port - start */
    public static boolean isInputHID(ParcelUuid uuid) {
        return uuid.equals(HID);
    }
/* HID port - end */
...
}
</pre>
<ul><li>Create HID profile ID</li></ul>
<pre>/* open file&#160;: frameworks/base/core/java/android/bluetooth/BluetoothClass.java */
/* HID port - start */
/** @hide */
	public static final int PROFILE_HID = 3;
/* HID port - end */
</pre>
<ul><li>Create AIDL file and add in build file</li></ul>
<pre>/* create file&#160;:frameworks/base/core/java/android/bluetooth/IBluetoothHid.aidl */
/* refer patch for more details */
</pre>
<ul><li>Change application</li></ul>
<p>Refer attached patch for more details
</p>
<h2><span class="mw-headline" id="References">References</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit&amp;section=9" title="Edit section: References">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a rel="nofollow" class="external free" href="Android-Adding_SystemService.html">http://processors.wiki.ti.com/index.php/Android-Adding_SystemService</a><br />
<a rel="nofollow" class="external free" href="http://www.slideshare.net/erinyueh/android-bluetooth-introduction">http://www.slideshare.net/erinyueh/android-bluetooth-introduction</a><br />
<a rel="nofollow" class="external free" href="https://sites.google.com/a/android.com/opensource/projects/bluetooth-faq">https://sites.google.com/a/android.com/opensource/projects/bluetooth-faq</a><br />
</p>
<pre> <a href="https://processors.wiki.ti.com/index.php?title=CategoryBeagleboard&amp;action=edit&amp;redlink=1" class="new" title="CategoryBeagleboard (page does not exist)">CategoryBeagleboard</a>
</pre>
<!-- 
NewPP limit report
Cached time: 20201130213521
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.051 seconds
Real time usage: 0.054 seconds
Preprocessor visited node count: 199/1000000
Preprocessor generated node count: 404/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 9066/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:12243-0!canonical and timestamp 20201130213521 and revision id 217995
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>Android-Adding Bluetooth Profile</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>Android-Adding Bluetooth Profile</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>Android-Adding Bluetooth Profile</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>Android-Adding Bluetooth Profile</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>Android-Adding Bluetooth Profile</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>Android-Adding Bluetooth Profile</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>Android-Adding Bluetooth Profile</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>Android-Adding Bluetooth Profile</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>Android-Adding Bluetooth Profile</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;oldid=217995">https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;oldid=217995</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Categories</a>: <ul><li><a href="Category_AM37x.html" title="Category:AM37x">AM37x</a></li><li><a href="Category_Android.html" title="Category:Android">Android</a></li><li><a href="Category_OMAP35x.html" title="Category:OMAP35x">OMAP35x</a></li><li><a href="Category_Sitara_Android.html" title="Category:Sitara Android">Sitara Android</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=Android-Adding+Bluetooth+Profile" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="Android-Adding_Bluetooth_Profile.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:Android-Adding_Bluetooth_Profile&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="Android-Adding_Bluetooth_Profile.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/Android-Adding_Bluetooth_Profile.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/Android-Adding_Bluetooth_Profile.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;oldid=217995" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=Android-Adding_Bluetooth_Profile&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 28 June 2016, at 09:42.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.051","walltime":"0.054","ppvisitednodes":{"value":199,"limit":1000000},"ppgeneratednodes":{"value":404,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":9066,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20201130213521","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":235});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/Android-Adding_Bluetooth_Profile by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 04:13:39 GMT -->
</html>
