<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 04:15:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides","wgTitle":"TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides","wgCurRevisionId":182413,"wgRevisionId":182413,"wgArticleId":10791,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["OMAP35x","AM37x","BeagleBoard","Android","Sitara Android"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides","wgRelevantArticleId":10791,"wgRequestId":"24b87ad5ce2b0c089725b2a9","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-TI-Android-GingerBread-2_3_4-DevKit-2_1_PortingGuides rootpage-TI-Android-GingerBread-2_3_4-DevKit-2_1_PortingGuides skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><a href="File_TIBanner.html" class="image"><img alt="TIBanner.png" src="https://processors.wiki.ti.com/images/c/cd/TIBanner.png" width="667" height="87" /></a>
<br />
</p><p><br />
</p>
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#About_this_manual"><span class="tocnumber">1</span> <span class="toctext">About this manual</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Power_Management"><span class="tocnumber">2</span> <span class="toctext">Power Management</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Introduction"><span class="tocnumber">2.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Features_Overview"><span class="tocnumber">2.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Android_PM_Sub-System_Overview"><span class="tocnumber">2.3</span> <span class="toctext">Android PM Sub-System Overview</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Driver_Configuration"><span class="tocnumber">2.4</span> <span class="toctext">Driver Configuration</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Android_PM_HAL_Configuration"><span class="tocnumber">2.5</span> <span class="toctext">Android PM HAL Configuration</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Power_Management_Sequence"><span class="tocnumber">2.6</span> <span class="toctext">Power Management Sequence</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Android_Layer"><span class="tocnumber">2.6.1</span> <span class="toctext">Android Layer</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#How_to_enable_suspend.2Fwake_up_feature_for_Keypad_keys"><span class="tocnumber">2.6.2</span> <span class="toctext">How to enable suspend/wake up feature for Keypad keys</span></a>
<ul>
<li class="toclevel-4 tocsection-11"><a href="#How_to_designate_a_POWER_key"><span class="tocnumber">2.6.2.1</span> <span class="toctext">How to designate a POWER key</span></a></li>
<li class="toclevel-4 tocsection-12"><a href="#How_to_designate_keys_as_WAKE_keys"><span class="tocnumber">2.6.2.2</span> <span class="toctext">How to designate keys as WAKE keys</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-13"><a href="#How_to_enable_Touch_Wake_up.2FResume"><span class="tocnumber">2.6.3</span> <span class="toctext">How to enable Touch Wake up/Resume</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#How_to_change_the_Brighness_Control_Interface"><span class="tocnumber">2.6.4</span> <span class="toctext">How to change the Brighness Control Interface</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="#Power_Management_Framework_in_Kernel"><span class="tocnumber">2.7</span> <span class="toctext">Power Management Framework in Kernel</span></a>
<ul>
<li class="toclevel-3 tocsection-16"><a href="#Suspend-Resume_Feature"><span class="tocnumber">2.7.1</span> <span class="toctext">Suspend-Resume Feature</span></a>
<ul>
<li class="toclevel-4 tocsection-17"><a href="#Suspend_Resume_Sequence"><span class="tocnumber">2.7.1.1</span> <span class="toctext">Suspend Resume Sequence</span></a></li>
<li class="toclevel-4 tocsection-18"><a href="#How_to_enable_wake_up_capability_to_a_device_driver"><span class="tocnumber">2.7.1.2</span> <span class="toctext">How to enable wake up capability to a device driver</span></a>
<ul>
<li class="toclevel-5 tocsection-19"><a href="#EXAMPLE:_matrix_keypad_driver"><span class="tocnumber">2.7.1.2.1</span> <span class="toctext">EXAMPLE: matrix keypad driver</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-20"><a href="#Power_Consumption_Details_of_Suspend_Resume."><span class="tocnumber">2.7.1.3</span> <span class="toctext">Power Consumption Details of Suspend Resume.</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-21"><a href="#CPU_Idle_Features"><span class="tocnumber">2.7.2</span> <span class="toctext">CPU Idle Features</span></a>
<ul>
<li class="toclevel-4 tocsection-22"><a href="#Enabling_system_for_hitting_retention_during_idle"><span class="tocnumber">2.7.2.1</span> <span class="toctext">Enabling system for hitting retention during idle</span></a></li>
<li class="toclevel-4 tocsection-23"><a href="#Enabling_system_for_hitting_OFF"><span class="tocnumber">2.7.2.2</span> <span class="toctext">Enabling system for hitting OFF</span></a></li>
<li class="toclevel-4 tocsection-24"><a href="#Impact_on_Power_Consumption_on_Android_system"><span class="tocnumber">2.7.2.3</span> <span class="toctext">Impact on Power Consumption on Android system</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-25"><a href="#DVFS_-_CPU_Freq_framework"><span class="tocnumber">2.7.3</span> <span class="toctext">DVFS - CPU Freq framework</span></a>
<ul>
<li class="toclevel-4 tocsection-26"><a href="#Introduction_to_DVFS"><span class="tocnumber">2.7.3.1</span> <span class="toctext">Introduction to DVFS</span></a></li>
<li class="toclevel-4 tocsection-27"><a href="#CPU_Freq_framework"><span class="tocnumber">2.7.3.2</span> <span class="toctext">CPU&#160;Freq framework</span></a>
<ul>
<li class="toclevel-5 tocsection-28"><a href="#Enabling_ondemand_frequency_governor"><span class="tocnumber">2.7.3.2.1</span> <span class="toctext">Enabling ondemand frequency governor</span></a></li>
<li class="toclevel-5 tocsection-29"><a href="#Enabling_performance_frequency_governor"><span class="tocnumber">2.7.3.2.2</span> <span class="toctext">Enabling performance frequency governor</span></a></li>
<li class="toclevel-5 tocsection-30"><a href="#Enabling_powersave_frequency_governor"><span class="tocnumber">2.7.3.2.3</span> <span class="toctext">Enabling powersave frequency governor</span></a></li>
<li class="toclevel-5 tocsection-31"><a href="#Enabling_userspace_frequency_governor"><span class="tocnumber">2.7.3.2.4</span> <span class="toctext">Enabling userspace frequency governor</span></a>
<ul>
<li class="toclevel-6 tocsection-32"><a href="#See_all_the_available_operating_points"><span class="tocnumber">2.7.3.2.4.1</span> <span class="toctext">See all the available operating points</span></a></li>
<li class="toclevel-6 tocsection-33"><a href="#Application_can_select_any_of_the_available_frequency_from_the_above"><span class="tocnumber">2.7.3.2.4.2</span> <span class="toctext">Application can select any of the available frequency from the above</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-4 tocsection-34"><a href="#Impact_of_Power_Consumption_on_Android_system"><span class="tocnumber">2.7.3.3</span> <span class="toctext">Impact of Power Consumption on Android system</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-35"><a href="#Smart_Reflex"><span class="tocnumber">2.7.4</span> <span class="toctext">Smart Reflex</span></a>
<ul>
<li class="toclevel-4 tocsection-36"><a href="#To_enable_smart_reflex"><span class="tocnumber">2.7.4.1</span> <span class="toctext">To enable smart reflex</span></a></li>
<li class="toclevel-4 tocsection-37"><a href="#To_disable_smart_reflex"><span class="tocnumber">2.7.4.2</span> <span class="toctext">To disable smart reflex</span></a></li>
<li class="toclevel-4 tocsection-38"><a href="#Impact_on_Power_Consuption_on_Android_System"><span class="tocnumber">2.7.4.3</span> <span class="toctext">Impact on Power Consuption on Android System</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-39"><a href="#To_minimize_the_power_consumption_in_runtime"><span class="tocnumber">2.7.5</span> <span class="toctext">To minimize the power consumption in runtime</span></a></li>
<li class="toclevel-3 tocsection-40"><a href="#To_minimize_the_power_consumption_in_suspend"><span class="tocnumber">2.7.6</span> <span class="toctext">To minimize the power consumption in suspend</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-41"><a href="#WLan"><span class="tocnumber">3</span> <span class="toctext">WLan</span></a>
<ul>
<li class="toclevel-2 tocsection-42"><a href="#Introduction_2"><span class="tocnumber">3.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#Features_Overview_2"><span class="tocnumber">3.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="#Android_WLAN_Sub-System_Overview"><span class="tocnumber">3.3</span> <span class="toctext">Android WLAN Sub-System Overview</span></a></li>
<li class="toclevel-2 tocsection-45"><a href="#Driver_Configuration_2"><span class="tocnumber">3.4</span> <span class="toctext">Driver Configuration</span></a></li>
<li class="toclevel-2 tocsection-46"><a href="#Android_WiFi_HAL_Configuration"><span class="tocnumber">3.5</span> <span class="toctext">Android WiFi HAL Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-47"><a href="#Bluetooth"><span class="tocnumber">4</span> <span class="toctext">Bluetooth</span></a>
<ul>
<li class="toclevel-2 tocsection-48"><a href="#Introduction_3"><span class="tocnumber">4.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-49"><a href="#Features_Overview_3"><span class="tocnumber">4.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-50"><a href="#Android_BT_Sub-System_Overview"><span class="tocnumber">4.3</span> <span class="toctext">Android BT Sub-System Overview</span></a></li>
<li class="toclevel-2 tocsection-51"><a href="#Driver_Configuration_3"><span class="tocnumber">4.4</span> <span class="toctext">Driver Configuration</span></a></li>
<li class="toclevel-2 tocsection-52"><a href="#Android_BT_HAL_Configuration"><span class="tocnumber">4.5</span> <span class="toctext">Android BT HAL Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-53"><a href="#Audio"><span class="tocnumber">5</span> <span class="toctext">Audio</span></a>
<ul>
<li class="toclevel-2 tocsection-54"><a href="#Introduction_4"><span class="tocnumber">5.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-55"><a href="#Features_Overview_4"><span class="tocnumber">5.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-56"><a href="#Android_Audio_Sub-System_Overview"><span class="tocnumber">5.3</span> <span class="toctext">Android Audio Sub-System Overview</span></a></li>
<li class="toclevel-2 tocsection-57"><a href="#Driver_Configuration_4"><span class="tocnumber">5.4</span> <span class="toctext">Driver Configuration</span></a></li>
<li class="toclevel-2 tocsection-58"><a href="#Android_Audio_HAL_Configuration"><span class="tocnumber">5.5</span> <span class="toctext">Android Audio HAL Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-59"><a href="#Camera"><span class="tocnumber">6</span> <span class="toctext">Camera</span></a>
<ul>
<li class="toclevel-2 tocsection-60"><a href="#Introduction_5"><span class="tocnumber">6.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-61"><a href="#Features_Overview_5"><span class="tocnumber">6.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-62"><a href="#Android_Camera_Sub-System_Overview"><span class="tocnumber">6.3</span> <span class="toctext">Android Camera Sub-System Overview</span></a></li>
<li class="toclevel-2 tocsection-63"><a href="#Adding_Camera_Module_to_Linux_Kernel"><span class="tocnumber">6.4</span> <span class="toctext">Adding Camera Module to Linux Kernel</span></a></li>
<li class="toclevel-2 tocsection-64"><a href="#Driver_Configuration_5"><span class="tocnumber">6.5</span> <span class="toctext">Driver Configuration</span></a></li>
<li class="toclevel-2 tocsection-65"><a href="#Android_Camera_HAL_Configuration"><span class="tocnumber">6.6</span> <span class="toctext">Android Camera HAL Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-66"><a href="#Display"><span class="tocnumber">7</span> <span class="toctext">Display</span></a>
<ul>
<li class="toclevel-2 tocsection-67"><a href="#Introduction_6"><span class="tocnumber">7.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-68"><a href="#Features_Overview_6"><span class="tocnumber">7.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-69"><a href="#Android_Display_Subsystem_Overview"><span class="tocnumber">7.3</span> <span class="toctext">Android Display Subsystem Overview</span></a></li>
<li class="toclevel-2 tocsection-70"><a href="#Driver_Configuration_6"><span class="tocnumber">7.4</span> <span class="toctext">Driver Configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-71"><a href="#V4L2_Driver"><span class="tocnumber">7.4.1</span> <span class="toctext">V4L2 Driver</span></a></li>
<li class="toclevel-3 tocsection-72"><a href="#Frame_Buffer_Driver"><span class="tocnumber">7.4.2</span> <span class="toctext">Frame Buffer Driver</span></a></li>
<li class="toclevel-3 tocsection-73"><a href="#TV_Output_Support"><span class="tocnumber">7.4.3</span> <span class="toctext">TV Output Support</span></a></li>
<li class="toclevel-3 tocsection-74"><a href="#LCD_Driver_Support"><span class="tocnumber">7.4.4</span> <span class="toctext">LCD Driver Support</span></a></li>
<li class="toclevel-3 tocsection-75"><a href="#Modification_in_Board_File_and_LCD_driver"><span class="tocnumber">7.4.5</span> <span class="toctext">Modification in Board File and LCD driver</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-76"><a href="#MMC"><span class="tocnumber">8</span> <span class="toctext">MMC</span></a>
<ul>
<li class="toclevel-2 tocsection-77"><a href="#Introduction_7"><span class="tocnumber">8.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-78"><a href="#Features_Overview_7"><span class="tocnumber">8.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-79"><a href="#Driver_Configuration_7"><span class="tocnumber">8.3</span> <span class="toctext">Driver Configuration</span></a></li>
<li class="toclevel-2 tocsection-80"><a href="#Android_MMC_HAL_or_Vold_Configuration"><span class="tocnumber">8.4</span> <span class="toctext">Android MMC HAL or Vold Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-81"><a href="#Touchscreen"><span class="tocnumber">9</span> <span class="toctext">Touchscreen</span></a>
<ul>
<li class="toclevel-2 tocsection-82"><a href="#Introduction_8"><span class="tocnumber">9.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-83"><a href="#Features_Overview_8"><span class="tocnumber">9.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-84"><a href="#Driver_Configuration_8"><span class="tocnumber">9.3</span> <span class="toctext">Driver Configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-85"><a href="#Add_touchscreen_driver_support"><span class="tocnumber">9.3.1</span> <span class="toctext">Add touchscreen driver support</span></a></li>
<li class="toclevel-3 tocsection-86"><a href="#Test_touch_driver_using_getevent"><span class="tocnumber">9.3.2</span> <span class="toctext">Test touch driver using getevent</span></a></li>
<li class="toclevel-3 tocsection-87"><a href="#Touch_Calibration"><span class="tocnumber">9.3.3</span> <span class="toctext">Touch Calibration</span></a></li>
<li class="toclevel-3 tocsection-88"><a href="#Test_Touch_Calibration_in_Android"><span class="tocnumber">9.3.4</span> <span class="toctext">Test Touch Calibration in Android</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-89"><a href="#Improve_Touch_Screen_Sensitivity"><span class="tocnumber">9.4</span> <span class="toctext">Improve Touch Screen Sensitivity</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-90"><a href="#Keypad"><span class="tocnumber">10</span> <span class="toctext">Keypad</span></a>
<ul>
<li class="toclevel-2 tocsection-91"><a href="#Introduction_9"><span class="tocnumber">10.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-92"><a href="#Features_Overview_9"><span class="tocnumber">10.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-93"><a href="#Driver_Configuration_9"><span class="tocnumber">10.3</span> <span class="toctext">Driver Configuration</span></a></li>
<li class="toclevel-2 tocsection-94"><a href="#Android_Keypad_Configuration"><span class="tocnumber">10.4</span> <span class="toctext">Android Keypad Configuration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-95"><a href="#NAND"><span class="tocnumber">11</span> <span class="toctext">NAND</span></a>
<ul>
<li class="toclevel-2 tocsection-96"><a href="#Introduction_10"><span class="tocnumber">11.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-97"><a href="#Features_Overview_10"><span class="tocnumber">11.2</span> <span class="toctext">Features Overview</span></a></li>
<li class="toclevel-2 tocsection-98"><a href="#Driver_Configuration_10"><span class="tocnumber">11.3</span> <span class="toctext">Driver Configuration</span></a></li>
<li class="toclevel-2 tocsection-99"><a href="#Fastboot"><span class="tocnumber">11.4</span> <span class="toctext">Fastboot</span></a>
<ul>
<li class="toclevel-3 tocsection-100"><a href="#Establishing_Fastboot_connectivity"><span class="tocnumber">11.4.1</span> <span class="toctext">Establishing Fastboot connectivity</span></a></li>
<li class="toclevel-3 tocsection-101"><a href="#Supported_Fastboot_commands"><span class="tocnumber">11.4.2</span> <span class="toctext">Supported Fastboot commands</span></a></li>
<li class="toclevel-3 tocsection-102"><a href="#Fastboot_Porting_guide"><span class="tocnumber">11.4.3</span> <span class="toctext">Fastboot Porting guide</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-103"><a href="#Sensors"><span class="tocnumber">12</span> <span class="toctext">Sensors</span></a>
<ul>
<li class="toclevel-2 tocsection-104"><a href="#Introduction_11"><span class="tocnumber">12.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-105"><a href="#Accelerometer"><span class="tocnumber">12.2</span> <span class="toctext">Accelerometer</span></a>
<ul>
<li class="toclevel-3 tocsection-106"><a href="#Android_sensor_sub_system_overview"><span class="tocnumber">12.2.1</span> <span class="toctext">Android sensor sub system overview</span></a></li>
<li class="toclevel-3 tocsection-107"><a href="#Driver_porting"><span class="tocnumber">12.2.2</span> <span class="toctext">Driver porting</span></a>
<ul>
<li class="toclevel-4 tocsection-108"><a href="#Modify_LIS331DLH_data_structure"><span class="tocnumber">12.2.2.1</span> <span class="toctext">Modify LIS331DLH data structure</span></a></li>
<li class="toclevel-4 tocsection-109"><a href="#Add_I2C_board_info_structure"><span class="tocnumber">12.2.2.2</span> <span class="toctext">Add I2C board info structure</span></a></li>
<li class="toclevel-4 tocsection-110"><a href="#Register_i2c_bus"><span class="tocnumber">12.2.2.3</span> <span class="toctext">Register i2c bus</span></a></li>
<li class="toclevel-4 tocsection-111"><a href="#Interrupt_line_modification"><span class="tocnumber">12.2.2.4</span> <span class="toctext">Interrupt line modification</span></a>
<ul>
<li class="toclevel-5 tocsection-112"><a href="#Pin_mux_change_in_board_configuration_file"><span class="tocnumber">12.2.2.4.1</span> <span class="toctext">Pin mux change in board configuration file</span></a></li>
<li class="toclevel-5 tocsection-113"><a href="#LIS331DLH_driver_file_modification"><span class="tocnumber">12.2.2.4.2</span> <span class="toctext">LIS331DLH driver file modification</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-114"><a href="#Test_Accelerometer_driver"><span class="tocnumber">12.2.3</span> <span class="toctext">Test Accelerometer driver</span></a></li>
<li class="toclevel-3 tocsection-115"><a href="#Android_hardware_abstraction_layer"><span class="tocnumber">12.2.4</span> <span class="toctext">Android hardware abstraction layer</span></a>
<ul>
<li class="toclevel-4 tocsection-116"><a href="#Adding_new_sensor_support_in_android_HAL_Ex:_Accelerometer"><span class="tocnumber">12.2.4.1</span> <span class="toctext">Adding new sensor support in android HAL Ex: Accelerometer</span></a>
<ul>
<li class="toclevel-5 tocsection-117"><a href="#Implement_a_sensor_class"><span class="tocnumber">12.2.4.1.1</span> <span class="toctext">Implement a sensor class</span></a></li>
<li class="toclevel-5 tocsection-118"><a href="#Add_new_sensor_support"><span class="tocnumber">12.2.4.1.2</span> <span class="toctext">Add new sensor support</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-119"><a href="#Calibration_methods"><span class="tocnumber">12.2.5</span> <span class="toctext">Calibration methods</span></a>
<ul>
<li class="toclevel-4 tocsection-120"><a href="#Changing_axes_directions_and_swapping_axes"><span class="tocnumber">12.2.5.1</span> <span class="toctext">Changing axes directions and swapping axes</span></a>
<ul>
<li class="toclevel-5 tocsection-121"><a href="#Driver_Modification"><span class="tocnumber">12.2.5.1.1</span> <span class="toctext">Driver Modification</span></a></li>
<li class="toclevel-5 tocsection-122"><a href="#Android_HAL_modification"><span class="tocnumber">12.2.5.1.2</span> <span class="toctext">Android HAL modification</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-123"><a href="#Accelerometer_zero_calibration"><span class="tocnumber">12.2.5.2</span> <span class="toctext">Accelerometer zero calibration</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-124"><a href="#Important_files"><span class="tocnumber">12.2.6</span> <span class="toctext">Important files</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-125"><a href="#Mass_storage"><span class="tocnumber">13</span> <span class="toctext">Mass storage</span></a>
<ul>
<li class="toclevel-2 tocsection-126"><a href="#Introduction_12"><span class="tocnumber">13.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-127"><a href="#Beagleboard_example"><span class="tocnumber">13.2</span> <span class="toctext">Beagleboard example</span></a></li>
<li class="toclevel-2 tocsection-128"><a href="#Test_Mass_storage_in_Android"><span class="tocnumber">13.3</span> <span class="toctext">Test Mass storage in Android</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-129"><a href="#Versioning"><span class="tocnumber">14</span> <span class="toctext">Versioning</span></a></li>
<li class="toclevel-1 tocsection-130"><a href="#Technical_Support_and_Product_Updates"><span class="tocnumber">15</span> <span class="toctext">Technical Support and Product Updates</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="About_this_manual">About this manual</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=1" title="Edit section: About this manual">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p><br />
</p>
<h1><span class="mw-headline" id="Power_Management">Power Management<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=2" title="Edit section: Power Management">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=3" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Android supports its own Power Management (on top of the standard Linux Power Management) designed with the premise that the CPU shouldn't consume power if no applications or services require power.
</p><p>Android requires that applications and services request CPU resources with "wake locks" through the Android application framework and native Linux libraries. If there are no active wake locks, Android will shut down the CPU.
</p>
<h2><span class="mw-headline" id="Features_Overview">Features Overview<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=4" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Below are the features supported in TI-Android-GingerBread-2.3.4-DevKit-2.1
</p><p><b> AM37X, OMAP35X  </b>
</p>
<ul><li>Change of LCD backlights based on Wake Locks and Screen Timeouts (DIM,OFF)</li>
<li>LCD back light brightness control from Settings Application</li>
<li>Suspending the device to Memory.The device can be suspended in two ways.
<ul><li>Pressing the POWER key on the keypad</li>
<li>Allowing the system go to suspend after a screen timeout</li></ul></li>
<li>Prevent Suspend based on Wake Locks</li>
<li>System Resume on Key Press</li>
<li>System Resume on Alarm</li>
<li>CPU Dynamic Voltage and Frequency Scaling (ondemand, performance, powersave and userspace governors)</li>
<li>CPU Idle States</li>
<li>Enabling system for hitting retention during idle</li>
<li>Enabling system for hitting OFF</li>
<li>Smart Reflex</li></ul>
<p><b> AM35X  </b>
</p>
<ul><li>Suspending the device to Memory.The device can be suspended in two ways.
<ul><li>Pressing the POWER key on the keypad</li>
<li>Allowing the system go to suspend after a screen timeout</li></ul></li>
<li>Prevent Suspend based on Wake Locks</li>
<li>System Resume on Key Press</li>
<li>Android Early Suspend Feature for frame buffer driver <br /></li></ul>
<p><b> Limitations  </b>
</p>
<ul><li>In beagle and am35x platforms there is no keypad connected to the wake up domain. So wake up is not possible by pressing keys. As a workaround, you can wake up am35x platform like below
<ul><li>Press ENTER on Serial Port console and then press any key on the keypad to wake up the device.</li></ul></li>
<li>If the usb device connected to the USB EHCI port when suspending the device, it might not work properly after resume. So Disconnect any usb device connected to USB EHCI port when suspending the device and connect it after resume.</li>
<li>In Suspend, If USB OTG cable is connected, it makes Powerdomain (core_pwrdm) not entering to sleep State</li>
<li>Inserting and Removing USB OTG cable continuously after suspend-resume makes system hang sometimes</li></ul>
<h2><span class="mw-headline" id="Android_PM_Sub-System_Overview">Android PM Sub-System Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=5" title="Edit section: Android PM Sub-System Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a href="File_Pm_block.html" class="image"><img alt="Pm block.JPG" src="https://processors.wiki.ti.com/images/7/70/Pm_block.JPG" width="742" height="555" /></a>
</p>
<h2><span class="mw-headline" id="Driver_Configuration">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=6" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><b> Suspend Resume<br />  </b>
</p>
<pre>-*- Power Management support
│ │[*] Power Management Debug Support
│ │[ ] Extra PM attributes in sysfs for low-level debugging/testing
│ │[ ] Verbose Power Management debugging
│ │[*] Suspend to RAM and standby
│ │[ ] Test suspend/resume and wakealarm during bootup
│ │[*] Wake lock
│ │[*] Wake lock stats
│ │[*] Userspace wake locks
│ │[*] Early suspend
│ │User-space screen access (Sysfs interface) ---&gt;
│ │&lt; &gt; Advanced Power Management Emulation
│ │-*- Run-time PM core functionality
│ │-*- Operating Performance Point (OPP) Layer library </pre>
<p>Linux Suspend Resume Code is located at kernel/power <br />
</p><p>Android power management patches for wakelock feature and earlysuspend are present in wakelock.c and earlysuspend.c<br />
</p><p>Generic Device/Bus suspend resume code located at drivers/base/power/ <br />
</p><p>Device/Bus level suspend resume code in .suspend and .resume callbacks for each device driver or bus driver<br />
</p><p>Low level Suspend Resume Code in arch/arm/mach-omap2/pm34xx.c<br />
</p><p><b> CPU&#160;Idle<br />  </b>
</p>
<pre>CPU Power Management ---&gt;
│ │ [*] CPU idle PM support
</pre>
<p><br />
</p><p>The default CPU Idle governor is menu governor and the code is located at drivers/cpuidle<br />
</p><p>Platform dependant cpu idle code which sets number of states, power domain status for each state is located at arch/arm/mach-omap2/cpuidle34xx.c<br />
</p><p>This code sets "exit_latency", "target_residency" and "idle state entering function"( platform dependant parameters used by the generic cpuidle driver to decide on state transition)
</p><p>as well.<br />
</p><p>The function to for entering to idle state (omap_sram_idle) is defined at arch/arm/mach-omap2/pm34xx.c<br />
</p><p><b> CPU DVFS<br />  </b>
</p>
<pre>CPU Power Management ---&gt;
│ │ [*] CPU Frequency scaling
│ │ [ ] Enable CPUfreq debugging
│ │ &lt;*&gt; CPU frequency translation statistics
│ │ [*] CPU frequency translation statistics details
│ │ Default CPUFreq governor (performance) ---&gt;
│ │ -*- 'performance' governor
│ │ &lt;*&gt; 'powersave' governor
│ │ &lt;*&gt; 'userspace' governor for userspace frequency scaling
│ │ &lt;*&gt; 'ondemand' cpufreq policy governor
│ │ &lt; &gt; 'interactive' cpufreq policy governor
│ │ &lt; &gt; 'conservative' cpufreq governor </pre>
<p><br />
</p><p>There are different generic CPU frequency governors like performance, powersave, userspace, ondemand etc to control transitions among various OPPs(Operating Points).<br />
</p><p>The code is located at drivers/cpufreq.<br />
</p><p>The definitions for various OPPs are defined at arch/arm/mach-omap2/opp3xxx_data.c<br />
</p><p><b> Smart Reflex<br />  </b>
</p>
<pre>System Type ---&gt; [*] TI OMAP Common Features ---&gt; [*] SmartReflex support

System Type ---&gt; [*] TI OMAP Common Features ---&gt; [*] Class 3 mode of Smartreflex Implementation
</pre>
<p>Class 3 implementation of Smart Reflex employs continuous voltage calibration. The code changes are at arch/arm/mach-omap2/smartreflex-class3.c and arch/arm/mach-omap2/smartreflex.c <br />
</p>
<h2><span class="mw-headline" id="Android_PM_HAL_Configuration">Android PM HAL Configuration<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=7" title="Edit section: Android PM HAL Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><b>Android Power Manager Service </b>
</p><p>Android Power Manager controls the following features<br />
</p>
<ul><li>Change of LCD backlights based on Wake Locks and Screen Timeouts (DIM,OFF)</li>
<li>LCD back light brightness control from Settings Application</li>
<li>Suspending the device to Memory.The device can be suspended in two ways.<br /></li>
<li>Pressing the POWER key on the keypad</li>
<li>Allowing the system go to suspend after a screen timeout</li>
<li>Prevent Suspend based on Wake Locks</li>
<li>System Resume on Key Press <br /></li></ul>
<p>Android Power Management service defined at frameworks/base/services/java/com/android/server/PowerManagerService.java changes the states of the android device based on the user events and the screen timeouts. The same service provides wakelock feature for the android applications.
</p><p><b>Android HAL for Power and Lights </b>
</p><p>hardware/libhardware_legacy/power/power.c defines the interfaces for wake locks and power states of the device.<br />
</p><p>hardware/ti/omap3/liblights/omap3evm/lights.c&#160;defines the interfaces for the sysfs path of lcd backlight.
</p><p><b>Device Initialization </b>
</p><p>device/ti/omap3evm/init.rc<br />
</p><p>device/ti/am3517evm/init.rc<br />
</p><p>device/ti/beagleboard/init.rc<br />
</p>
<h2><span class="mw-headline" id="Power_Management_Sequence">Power Management Sequence</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=8" title="Edit section: Power Management Sequence">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Android_Layer">Android Layer</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=9" title="Edit section: Android Layer">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Android Power management framework has the following responsibilities
</p>
<ul><li>The framework provides applications access to WAKELOCK, STATES, BACKLIGHT features of android kernel, thus
<ul><li>Applications can hold different wakelocks to keep the CPU on, partially on like that.</li>
<li>Android Settings application can control screen brightness</li>
<li>Android Key Press can put the system into suspend mode</li></ul></li></ul>
<ul><li>The framework controls the various android power states based on timeouts and user activity
<ul><li>Refer to the below state diagrams which relates time and user events to various power states.</li></ul></li></ul>
<p><a href="File_Pm_1.html" class="image" title="Time out behavior when we have set Stay Awake option is true"><img alt="Time out behavior when we have set Stay Awake option is true" src="https://processors.wiki.ti.com/images/4/4e/Pm_1.jpg" width="640" height="480" /></a><br />
</p><p>Time out behavior when we have set Stay Awake option is false<br /><br />
</p><p><a href="File_Pm_2.html" class="image" title="Time out behavior when we have set Stay Awake option is true"><img alt="Time out behavior when we have set Stay Awake option is true" src="https://processors.wiki.ti.com/images/6/6b/Pm_2.jpg" width="640" height="480" /></a><br />
</p><p>Time out behavior when we have set Stay Awake option is true<br />
</p><p><a href="File_Pm_3.html" class="image" title="POWER Button behavior when we have set Stay Awake option is false"><img alt="POWER Button behavior when we have set Stay Awake option is false" src="https://processors.wiki.ti.com/images/6/69/Pm_3.jpg" width="640" height="480" /></a><br />
</p><p>POWER Button behavior when we have set Stay Awake option is false<br />
</p><p><a href="File_Pm_4.html" class="image" title="POWER Button behavior when we have Stay Awake option is true"><img alt="POWER Button behavior when we have Stay Awake option is true" src="https://processors.wiki.ti.com/images/6/6b/Pm_4.jpg" width="640" height="480" /></a><br />
</p><p>POWER Button behavior when we have set Stay Awake option is false<br /> The entry "setprop hw.nopm false" enables suspend and resume features.
</p><p>These files are parsed by the android init program. So all the initial power management settings are done in init.rc
</p>
<h3><span id="How_to_enable_suspend/wake_up_feature_for_Keypad_keys"></span><span class="mw-headline" id="How_to_enable_suspend.2Fwake_up_feature_for_Keypad_keys">How to enable suspend/wake up feature for Keypad keys<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=10" title="Edit section: How to enable suspend/wake up feature for Keypad keys">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="How_to_designate_a_POWER_key">How to designate a POWER key<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=11" title="Edit section: How to designate a POWER key">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Power key is the key which can suspend the Android system. In the Keypad mapping file you can designated one key as POWER key.<br />
</p><p>For example for omap3evm keypad mapping file, TWL4030_Keypad.kl(located at system/usr/keylayout ) key 105 is designated at POWER&#160;key.<br />
</p>
<h4><span class="mw-headline" id="How_to_designate_keys_as_WAKE_keys">How to designate keys as WAKE keys <br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=12" title="Edit section: How to designate keys as WAKE keys">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Any key in the physical keypad can wake up the Android system. In the Keypad mapping file you can designated any key as WAKE key.
</p><p>For example for omap3evm keypad mapping file, TWL4030_Keypad.kl(located at system/usr/keylayout ) some keys are designated as WAKE keys.<br />
</p><p>Some keys are designated as WAKE_DROPPED. Those keys can also wake up the system but the correspondinf Android functionality is not passed to the upper layers.<br />
</p>
<h3><span id="How_to_enable_Touch_Wake_up/Resume"></span><span class="mw-headline" id="How_to_enable_Touch_Wake_up.2FResume">How to enable Touch Wake up/Resume</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=13" title="Edit section: How to enable Touch Wake up/Resume">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>By default, Android does not support wake up from touch. See <a rel="nofollow" class="external text" href="Capacitive_touch_integration_with_android.html#Touch_Event_Flow_in_brief">this link</a> to understand the touch event flow in Android. After Android EventHub system receive events from kernel input layer, Touch events and Key events separated and passed to different upper layers. For touch events to wake Android and to bring the locked screen, the following method can be used.
</p>
<ol><li>While touch event is being processed, Check if the screen is off.</li>
<li>If the screen is off, Let Android WindowManager know that a wake event has occured.</li>
<li>For this pass a fake key event intercept call form the input manager</li></ol>
<p>The below patch in frameworks/base achieves this
</p>
<pre>--- a/services/jni/com_android_server_InputManager.cpp
+++ b/services/jni/com_android_server_InputManager.cpp
@@ -914,7 +914,15 @@ void NativeInputManager::interceptGenericBeforeQueueing(nsecs_t when, uint32_t&amp;
 #if DEBUG_INPUT_DISPATCHER_POLICY
     LOGD("interceptGenericBeforeQueueing - when=%lld, policyFlags=0x%x", when, policyFlags);
 #endif
-
+    if (isScreenOn() == false) {
+          int32_t flags=0x8;
+          int32_t deviceId =0x0;
+          int32_t action =0x0;
+          int32_t keyCode =0x52;
+          int32_t scanCode =0x19;
+          uint32_t dpolicyFlags = 0x2000002;
+          interceptKeyBeforeQueueing(nsecs_t (when), deviceId, action, flags, keyCode, scanCode, dpolicyFlags);
+    }
     // Policy:
     // - Ignore untrusted events and pass them along.
     // - No special filtering for injected events required at this time.
</pre>
<h3><span class="mw-headline" id="How_to_change_the_Brighness_Control_Interface">How to change the Brighness Control Interface<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=14" title="Edit section: How to change the Brighness Control Interface">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The LCD _FILE&#160;global variable in hardware/ti/omap3/liblights/omap3evm/lights.c defines the interfaces for the sysfs path of lcd backlight. <br />
</p><p>For example LCD_FILE&#160;is specified as "/sys/class/backlight/sharp-ls/brightness" for omap3evm.<br />
</p><p>Android tries write values of range 0-255 to this interface. Need to modify the function&#160;set_light_backlight in hardware/ti/omap3/liblights/omap3evm/lights.c to calibrate this android values to the values expected by the lcd backlight driver interface.<br />
</p>
<h2><span class="mw-headline" id="Power_Management_Framework_in_Kernel">Power Management Framework in Kernel <br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=15" title="Edit section: Power Management Framework in Kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Suspend-Resume_Feature">Suspend-Resume Feature</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=16" title="Edit section: Suspend-Resume Feature">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Suspend_Resume_Sequence">Suspend Resume Sequence<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=17" title="Edit section: Suspend Resume Sequence">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The normal Linux Suspend sequance is initiated by writing a value "mem" to "/sys/power/state" interface. This will be going to enter_state() in kernel/power/main.c.The detailed flow of the things are explained at <a rel="nofollow" class="external free" href="http://kerneltrap.org/node/14004">http://kerneltrap.org/node/14004</a>.<br />
</p><p>But in Android things are little bit different. Android Power manager service will write the value "mem" to "/sys/power/state" when the suspend sequence is initiated by the user or the screen timeout.&#160;In android patched kernel, it will be going to request_suspend_state() in kernel/power/earlysuspend.c. It calls the early suspend routines of all the drivers registered with the Android early suspend feature and checks whether any wakelocks preventing suspending are held. Once all the wakelocks are unlocked, the enter_state function in kernel/power/main.c is called. Then it follows the normal linux suspend sequence. In resume After normal linux resume sequence is completed, the late resume routines of all the drivers registered with the Android early suspend feature.
</p>
<h4><span class="mw-headline" id="How_to_enable_wake_up_capability_to_a_device_driver">How to enable wake up capability to a device driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=18" title="Edit section: How to enable wake up capability to a device driver">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>There are two requirements for a device to be wake up capable.
</p>
<ul><li>The wake up event from the device should trigger any of the pins (GPIO bank 0 or any other configured wake up source) connected to the wake up domain of the cpu.</li>
<li>he device must be configured stay partially awake in suspended state in order to trigger the wake up event.</li></ul>
<p>When the system enters a low power state, each device's driver is asked to suspend the device by putting it into state compatible with the target system state. The wakeup-enabled devices will usually stay partly functional in order to wake the system.
</p><p>This capability of a device is initialized by bus or device driver code using device_init_wakeup(dev,can_wakeup). This is also controlled through one of the sysfs entry "/sys/devices/.../power/wakeup". The "can_wakeup" flag just records whether the device (and its driver) can physically support wakeup events. When that flag is clear, the sysfs "wakeup" file is empty, and "device_may_wakeup()" returns false.
</p><p>Usually a wake up capable device will invoke device_init_wakeup(dev,pdata-&gt;wakeup) during its .probe routine with the pdata is being its device specific data. While .remove routine the device invoke device_init_wakeup(dev,0).
</p><p>The device's .suspend function will contain the call to enable_irq_wake for the particular irq line and the .resume function will contain a call to disable_irq_line. So device can be partially functional in suspended state.
</p>
<h5><span class="mw-headline" id="EXAMPLE:_matrix_keypad_driver">EXAMPLE: matrix keypad driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=19" title="Edit section: EXAMPLE: matrix keypad driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<hr />
<p>matrix keypad is a simple gpio based keypad
</p><p>Let's see platform-dependent keypad data of this driver
</p>
<pre>struct matrix_keypad_platform_data {
       .......................
       bool            wakeup;
}; </pre>
<p>It has a field wakeup controls whether the device should be set up as wakeup source.
</p><p>This field can be set us "true" in the board initialization file of the device.
</p><p>Now lets explore the ".probe" and ".remove" functions of the driver
</p>
<pre>static int __devinit matrix_keypad_probe(struct platform_device *pdev) {

       const struct matrix_keypad_platform_data *pdata;
       ................................
       pdata = pdev-&gt;dev.platform_data;
       ................................
       device_init_wakeup(&amp;pdev-&gt;dev, pdata-&gt;wakeup);

} </pre> <pre>static int __devexit matrix_keypad_remove(struct platform_device *pdev)
<pre>     struct matrix_keypad *keypad = platform_get_drvdata(pdev);
    const struct matrix_keypad_platform_data *pdata = keypad-&gt;pdata;
    int i;
    device_init_wakeup(&amp;pdev-&gt;dev, 0);
    .................................
</pre>
}</pre>
<p>Also in the suspend routine of the driver, enable_irq_wake is called for the irq lines corresponding to the gpio keys
</p>
<pre>static int matrix_keypad_suspend(struct device *dev)
{
        struct platform_device *pdev = to_platform_device(dev);
        .................................
        if (device_may_wakeup(&amp;pdev-&gt;dev))
                for (i = 0; i &lt; pdata-&gt;num_row_gpios; i++)
                        enable_irq_wake(gpio_to_irq(pdata-&gt;row_gpios[i]));

        return 0;
}</pre> <pre>static int matrix_keypad_resume(struct device *dev)
<p>{
</p><p><br />
</p>
<pre>       struct platform_device *pdev = to_platform_device(dev);
      .................................
      if (device_may_wakeup(&amp;pdev-&gt;dev))
              for (i = 0; i &lt; pdata-&gt;num_row_gpios; i++)
                      disable_irq_wake(gpio_to_irq(pdata-&gt;row_gpios[i]));
      .................................
</pre>
<p><br />
}
</p><p><br />
</p>
</pre>
<h4><span class="mw-headline" id="Power_Consumption_Details_of_Suspend_Resume.">Power Consumption Details of Suspend Resume.</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=20" title="Edit section: Power Consumption Details of Suspend Resume.">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>By default in suspend all power domains enter to RETENTION mode. Upon resume, you can check the powerdomain state statistics to check whether all states hit the desired state, cf. 'Debug info'
</p>
<pre># cat /debug/pm_debug/count</pre>
<p>In addition, if any powerdomains did not hit the desired state, you will see a message on the console.<br />If the OFF mode is enabled all the power domains will hit the OFF mode in suspend.You can enable the off mode via<br />
</p>
<pre># echo 1 &gt; /debug/pm_debug/enable_off_mode</pre>
<p>Once again, after a suspend use the powerdomain transition stats to check that transitions to off-mode are happening
</p>
<pre># cat /debug/pm_debug/count
</pre>
<p><b>Notes&#160;: Core domain cannot enter into OFF mode if the board ES revision is less than 1.2</b>
</p>
<h3><span class="mw-headline" id="CPU_Idle_Features">CPU Idle Features<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=21" title="Edit section: CPU Idle Features">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>There are seven power states introduced by CPU Idle. See the the MPU, CORE states and latencies/thresholds.<br />
</p><p>Two parameters exit_latency and target_residency are the two platform dependant parameters used by the generic cpuidle driver to decide on state transition.&#160;The exit_latency is sleep + wake latency. The target_residency is threshold from the below table. You can change these parameters from /arch/arm/mach-omap2/cpuidle34xx.c<br />
</p>
<table width="500" cellspacing="1" cellpadding="1" border="1">

<tbody><tr>
<th scope="col">Power States<br />
</th>
<th scope="col">CORE&#160;STATE<br />
</th>
<th scope="col">MPU&#160;STATE<br />
</th>
<th scope="col">sleep latency<br />
</th>
<th scope="col">wake_latency<br />
</th>
<th scope="col">threshold<br />
</th></tr>
<tr>
<td>C0<br />
</td>
<td>Active<br />
</td>
<td>WFI<br />
</td>
<td>2<br />
</td>
<td>2<br />
</td>
<td>5<br />
</td></tr>
<tr>
<td>C1<br />
</td>
<td>Inactive<br />
</td>
<td>WFI<br />
</td>
<td>10<br />
</td>
<td>10<br />
</td>
<td>30<br />
</td></tr>
<tr>
<td>C2<br />
</td>
<td>Inactive<br />
</td>
<td>CSWR<br />
</td>
<td>50<br />
</td>
<td>50<br />
</td>
<td>300<br />
</td></tr>
<tr>
<td>C3<br />
</td>
<td>Inactive<br />
</td>
<td>OFF<br />
</td>
<td>1500<br />
</td>
<td>1800<br />
</td>
<td>4000<br />
</td></tr>
<tr>
<td>C4<br />
</td>
<td>RET<br />
</td>
<td>RET<br />
</td>
<td>2500<br />
</td>
<td>7500<br />
</td>
<td>12000<br />
</td></tr>
<tr>
<td>C5<br />
</td>
<td>RET<br />
</td>
<td>OFF<br />
</td>
<td>3000<br />
</td>
<td>8500<br />
</td>
<td>15000<br />
</td></tr>
<tr>
<td>C6<br />
</td>
<td>OFF<br />
</td>
<td>OFF<br />
</td>
<td>10000<br />
</td>
<td>30000<br />
</td>
<td>300000<br />
</td></tr></tbody></table>
<p>But MPU and CORE&#160;Domains will be transitioned to RETENTION or OFF mode depending on the sleep while idle and enable off mode settings.<br />
</p><p>ie to enable all the C states you need to set the sleep while idle and enable off mode.<br />
</p>
<h5><span class="mw-headline" id="Enabling_system_for_hitting_retention_during_idle">Enabling system for hitting retention during idle</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=22" title="Edit section: Enabling system for hitting retention during idle">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>To enable powerdomain transitions to off mode
</p>
<pre># echo 1 &gt; /debug/pm_debug/sleep_while_idle</pre>
<p>Also need to wait for any inactivity timers to expire
</p>
<pre># echo 5 &gt; /sys/devices/platform/omap/omap_uart.0/sleep_timeout
# echo 5 &gt; /sys/devices/platform/omap/omap_uart.1/sleep_timeout
# echo 5 &gt; /sys/devices/platform/omap/omap_uart.2/sleep_timeout</pre>
<h5><span class="mw-headline" id="Enabling_system_for_hitting_OFF">Enabling system for hitting OFF</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=23" title="Edit section: Enabling system for hitting OFF">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>To enable powerdomain transitions to off mode
</p>
<pre># echo 1 &gt; /debug/pm_debug/enable_off_mode
</pre>
<p>The usage and time count for these different states can be checked via
</p>
<pre>#cat /sys/devices/system/cpu/cpu0/cpuidle/state*/time
#cat /sys/devices/system/cpu/cpu0/cpuidle/state*/usage
</pre>
<h4><span class="mw-headline" id="Impact_on_Power_Consumption_on_Android_system">Impact on Power Consumption on Android system<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=24" title="Edit section: Impact on Power Consumption on Android system">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>CPU Idle features are hidden from Android power management. Still cpu idle framework controls the overall power behavior by moving the MPU, CORE power domains.<br />
</p><p>Here is a list of peripherals controlled by MPU, CORE and PER domains.<br /><b>MPU </b><br />MPU core<br />ICECrusher CS<br />MPU async bridge (master)<br /><b>CORE</b><br />GPMC<br />USB TLL<br />GPTIMER[10, 11]<br />HDQ/1-Wire<br />HS USB<br />I2C[1, 2, 3]<br />ICR<br />IVA2.2 async bridge 1 (slave)<br />IVA2.2 async bridge 2 (master)<br />IVA2.2 WUGEN<br />MAILBOXES<br />McBSP[1, 5]<br />McSPI[1, 2, 3, 4]<br />MMC/SD/SDIO[1, 2, 3]<br />MPU async bridge (slave)<br />MPU INTC<br />OCM_RAM<br />OCM_ROM<br />SCM<br />SDRC<br />SMS<br />L3 interconnect<br />UART[1, 2]<br />SDMA<br />Temperature sensor (x2)]<br />L4-Core interconnect
</p>
<h3><span class="mw-headline" id="DVFS_-_CPU_Freq_framework">DVFS - CPU Freq framework <br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=25" title="Edit section: DVFS - CPU Freq framework">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Introduction_to_DVFS">Introduction to DVFS<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=26" title="Edit section: Introduction to DVFS">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The CPU can operate on different Operating Points(OPP) depending on the performance(CPU Frequency) required<br />
</p><p>Each OPP is characterized by:
</p>
<ul><li>CPU frequency</li>
<li>Voltage required by the CPU. <br /></li></ul>
<p>Here is the OPP Table for DM3730
</p>
<table width="500" cellspacing="1" cellpadding="1" border="1">

<tbody><tr>
<th scope="col">OPP<br />
</th>
<th scope="col">Frequency<br />
</th>
<th scope="col">MPU Voltage<br />
</th>
<th scope="col">L3 Voltage<br />
</th>
<th scope="col">DSP Voltage<br />
</th></tr>
<tr>
<td>OPP50<br />
</td>
<td>300MHz<br />
</td>
<td>1.012500<br />
</td>
<td>1000000<br />
</td>
<td>1.012500<br />
</td></tr>
<tr>
<td>OPP100<br />
</td>
<td>600MHz<br />
</td>
<td>1.200000<br />
</td>
<td>1.200000<br />
</td>
<td>1.200000<br />
</td></tr>
<tr>
<td>OPP-Turbo<br />
</td>
<td>800MHz<br />
</td>
<td>1.325000<br />
</td>
<td>1.200000<br />
</td>
<td>1.325000<br />
</td></tr>
<tr>
<td>OPP-SB<br />
</td>
<td>1GHz<br />
</td>
<td>1.375000<br />
</td>
<td>1.200000<br />
</td>
<td>1.375000<br />
</td></tr></tbody></table>
<p>Refer to the device specific TRM for OPP definitions.<br />
</p><p>The DVFS has been implemented using the cpufreq framework.<br />
</p>
<h4><span class="mw-headline" id="CPU_Freq_framework">CPU&#160;Freq framework<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=27" title="Edit section: CPU Freq framework">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The cpufreq framework consists of:
</p>
<ul><li>A set of governors that decides the target OPP of the system</li>
<li>A driver that actually transitions the system to the target OPPs specified by the governor. <br /></li></ul>
<p>There are four different governors controls the target OPPs of the system, ie ondemand, performance, powersave, userspace<br />
</p>
<h5><span class="mw-headline" id="Enabling_ondemand_frequency_governor">Enabling ondemand frequency governor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=28" title="Edit section: Enabling ondemand frequency governor">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The ondemand governor enables DVFS(frequency/OPP) transitions based on CPU load.
</p>
<pre>echo ondemand &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
</pre>
<h5><span class="mw-headline" id="Enabling_performance_frequency_governor">Enabling performance frequency governor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=29" title="Edit section: Enabling performance frequency governor">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The performance governor keeps the CPU always at the highest frequency.
</p>
<pre>echo performance &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor </pre>
<h5><span class="mw-headline" id="Enabling_powersave_frequency_governor">Enabling powersave frequency governor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=30" title="Edit section: Enabling powersave frequency governor">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The powersave governor keeps the CPU always at the lowest frequency.
</p>
<pre>echo powersave &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
</pre>
<h5><span class="mw-headline" id="Enabling_userspace_frequency_governor">Enabling userspace frequency governor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=31" title="Edit section: Enabling userspace frequency governor">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Once this governor is enabled, DVFS( frequency) transitions will be manually triggered by a userspace application by using the CPUfreq sysfs interface
</p>
<pre>echo userspace &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor </pre>
<h6><span class="mw-headline" id="See_all_the_available_operating_points">See all the available operating points</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=32" title="Edit section: See all the available operating points">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<pre>cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies
</pre>
<h6><span class="mw-headline" id="Application_can_select_any_of_the_available_frequency_from_the_above">Application can select any of the available frequency from the above</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=33" title="Edit section: Application can select any of the available frequency from the above">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<pre>echo &lt;Desired Frequancy&gt; &gt; /sys/devices/system/cpu/cpu0/cpufreq/ scaling_setspeed </pre>
<p>You can check the transitions and statistics at /sys/devices/system/cpu/cpu0/cpufreq/stats<br />
</p>
<h4><span class="mw-headline" id="Impact_of_Power_Consumption_on_Android_system">Impact of Power Consumption on Android system<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=34" title="Edit section: Impact of Power Consumption on Android system">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>DVFS features are hidden from Android power management. Still DVFS framework controls the overall power consumption by varying the operating voltage. <br />
</p><p><b>P = V<sup>2</sup> / R</b><br />
</p><p>Where <b>V</b> is the operating voltage for a given operating point(OPP).&#160; <br />
</p><p><br />
</p>
<h3><span class="mw-headline" id="Smart_Reflex">Smart Reflex<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=35" title="Edit section: Smart Reflex">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The variations in the silicon manufacturing processes are responsible for the difference in performance and/or power consumption of the device. Adaptive Voltage Scaling- AVS, implemented with SmartReflex(TM) technology, tends to narrow this difference.
</p><p>Dedicated SmartReflex hardware implements a feedback loop - without processor intervention - which optimizes the voltage levels to account for differences in the manufacturing process, temperature and silicon degradation.
</p>
<h4><span class="mw-headline" id="To_enable_smart_reflex">To enable smart reflex</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=36" title="Edit section: To enable smart reflex">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre># echo 1 &gt; /debug/voltage/vdd_core/smartreflex/autocomp
# echo 1 &gt; /debug/voltage/vdd_mpu/smartreflex/autocomp</pre>
<h4><span class="mw-headline" id="To_disable_smart_reflex">To disable smart reflex</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=37" title="Edit section: To disable smart reflex">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre># echo 0 &gt; /debug/voltage/vdd_core/smartreflex/autocomp
# echo 0 &gt; /debug/voltage/vdd_mpu/smartreflex/autocomp

</pre>
<h4><span class="mw-headline" id="Impact_on_Power_Consuption_on_Android_System">Impact on Power Consuption on Android System<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=38" title="Edit section: Impact on Power Consuption on Android System">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>This feature is hardware controlled after initialization. Initialization is done from the kernel. Android Power management is completely unaware of smart reflex.<br />
</p><p>Power consumption is reduced since the operating voltage is lowered for each operating point in which the device is operating in.<br />
</p>
<h3><span class="mw-headline" id="To_minimize_the_power_consumption_in_runtime">To minimize the power consumption in runtime</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=39" title="Edit section: To minimize the power consumption in runtime">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The maximum power reduction in runtime is achieved when “enable_off_mode”, “sleep_while_idle”and “smart reflex” options are enabled and dvfs option is set to “power save”.<br />
</p>
<h3><span class="mw-headline" id="To_minimize_the_power_consumption_in_suspend"><br />To minimize the power consumption in suspend</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=40" title="Edit section: To minimize the power consumption in suspend">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The maximum power reduction in suspend is achieved when “enable_off_mode”, “sleep_while_idle”and “smart reflex” options are enabled and UART console timeouts are set.
</p><p>Please check the power consumption analysis at <a rel="nofollow" class="external free" href="Android_Benchmarks_DevKit2.3.4v2.html#Power_Management">http://processors.wiki.ti.com/index.php/Android_Benchmarks_DevKit2.3.4v2.1#Power_Management</a><br />
</p><p><br />
</p><p><br />
</p>
<h1><span class="mw-headline" id="WLan">WLan</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=41" title="Edit section: WLan">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_2">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=42" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section of guide provides a step by step explanation of what's involved in adding a new WiFi driver and making WiFi work in a custom Android build like Rowboat.
<br />
</p>
<h2><span class="mw-headline" id="Features_Overview_2">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=43" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>WLAN (802.11 b/g/n)</li>
<li>Core IP pre-tested against WiFi specifications.</li>
<li>Currently only station mode is supported.</li></ul>
<p><br />
</p>
<h2><span class="mw-headline" id="Android_WLAN_Sub-System_Overview">Android WLAN Sub-System Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=44" title="Edit section: Android WLAN Sub-System Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a href="File_WLAN_Stack.html" class="image"><img alt="WLAN Stack.jpg" src="https://processors.wiki.ti.com/images/4/4a/WLAN_Stack.jpg" width="960" height="720" /></a>
<br />
<br />
Android uses a modified wpa_supplicant (<b>external/wpa_supplicant_6</b>) daemon for wifi support which is controlled through a socket by <b>hardware/libhardware_legacy/wifi/wifi.c</b> (WiFiHW) that gets controlled from Android UI through <b>android.net.wifi</b> package from <b>frameworks/base/wifi/java/android/net/wifi</b> and it's corresponding JNI implementation in <b>frameworks/base/core/jni/android_net_wifi_Wifi.cpp</b> Higher level network management is done in <b>frameworks/base/core/java/android/net</b>.
<br />
<br />
</p>
<h2><span class="mw-headline" id="Driver_Configuration_2">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=45" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>In this Devkit release we are using WL12XX Compat wireless SDK. The drivers and firmwares of WL12XX Compat release are at <b>hardware/ti/wlan/WL1271_compat</b>
</p>
<ul><li>Make sure the following options are not enabled in the Kernel:</li></ul>
<pre>   CONFIG_CFG80211
   CONFIG_LIB80211
   CONFIG_MAC80211
</pre>
<p>Else corresponding Wireless Compat driver modules will not build.
</p>
<ul><li>On the other hand following Config options should be enabled in Kernel:</li></ul>
<pre>   CONFIG_WIRELESS_EXT=y
   CONFIG_WEXT_CORE=y
   CONFIG_WEXT_PROC=y
   CONFIG_WEXT_PRIV=y
</pre>
<ul><li>On AM37 WL1271 SDIO is connected to MMC2 bus. Its relevant initialization and pin-muxing is done at <b>arch/arm/mach-omap2/board-omap3evm.c</b> under <b>CONFIG_WL12XX_PLATFORM_DATA</b> macro. Do take care of this initialization and pin-muxing if using any other MMC bus e.g. MMC3.</li></ul>
<h2><span class="mw-headline" id="Android_WiFi_HAL_Configuration">Android WiFi HAL Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=46" title="Edit section: Android WiFi HAL Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Enable building of wpa_supplicant in your BoardConfig.mk</li></ul>
<p>This is by simply adding following options in BoardConfig.mk:
</p>
<pre>   BOARD_WPA_SUPPLICANT_DRIVER&#160;:= WEXT
   WPA_SUPPLICANT_VERSION     &#160;:= VER_0_6_X
   WIFI_DRIVER_MODULE_PATH    &#160;:= "/system/etc/wifi/wl12xx_sdio.ko"
   WIFI_DRIVER_MODULE_ARG     &#160;:= ""
   WIFI_DRIVER_MODULE_NAME    &#160;:= "wl12xx_sdio"
   WIFI_DRIVER_FW_STA_PATH    &#160;:= "/system/etc/firmware/ti-connectivity/wl1271-fw-2.bin"
</pre>
<p>This will set  WPA_BUILD_SUPPLICANT to true in <b>external/wpa_supplicant_6/Android.mk</b> enabling building of <b>driver_wext.c</b>. At run time <b>wl12xx_sdio</b> will get loaded from <i>WIFI_DRIVER_MODULE_PATH</i>. We don't need any external <i>WIFI_FIRMWARE_LOADER</i> because our driver module <b>wl12xx_sdio</b> is capable of loading the firmware from <i>WIFI_DRIVER_FW_STA_PATH</i>
</p>
<ul><li>Android uses SIOCSIWPRIV ioctl to send commands to modify driver behaviour and receive information like signal strength, mac address of the AP, link speed etc. This ioctl is usually not implemented. A quick workaround was to emulate this ioctl functionality in WPA_supplicant itself. Here is the corresponding patch <a rel="nofollow" class="external text" href="https://gitorious.org/picopc-android-gingerbread/external-wpa_supplicant_6/commit/5f5c50d722eedaedd75c1698b79f464310ce6478?format=patch">Added emulation of Android private ioctls for generic WiFi drivers</a></li></ul>
<ul><li>Next we need to provide a proper wpa_supplicant.conf for our device. That we will keep in <b>/data/misc/wifi</b>.</li></ul>
<ul><li>Set the correct permissions and paths created from init.rc</li></ul>
<pre>   # give system access to wpa_supplicant.conf for backup and restore
   mkdir /system/etc/wifi 0770 system wifi
   chmod 0770 /system/etc/wifi
   chmod 0660 /system/etc/wifi/wpa_supplicant.conf
   chown system wifi /system/etc/wifi/wpa_supplicant.conf
   mkdir /data/misc/wifi 0770 system wifi
   mkdir /data/misc/wifi/sockets 0770 system wifi
   chmod 0770 /data/misc/wifi
   chmod 0660 /data/misc/wifi/wpa_supplicant.conf
   chown system wifi /data/misc/wifi
   chown system wifi /data/misc/wifi/wpa_supplicant.conf
</pre>
<p><b>Important</b>
We use System user(uid: 1000) to initiate wpa_supplicant service that way are able to enable WiFi over Android NFS rootfs. Here is the detailed discussion on that <a rel="nofollow" class="external text" href="http://groups.google.com/group/rowboat/browse_thread/thread/698e2b6e049e53e8/7e273dfb2afe87d1?pli=1">WiFi does not work when booting from an NFS file system</a>
</p>
<ul><li>Start <b>wpa_supplicant</b> and <b>dhcpcd_wlan0</b> from init.rc.</li></ul>
<pre>   # wpa_supplicant and dhcp daemon
   service wpa_supplicant /system/bin/wpa_supplicant -Dwext -iwlan0 -c/data/misc/wifi/wpa_supplicant.conf -dd
       socket wpa_wlan0 dgram 660 system wifi
       group system wifi inet
       disabled
</pre>
<pre>   #service dhcpcd_${iface} /system/bin/dhcpcd -o domain_name_servers -ABKL ${iface}
   service dhcpcd_wlan0 /system/bin/dhcpcd  -ABKL wlan0
       disabled
       oneshot
</pre>
<p><br />
</p>
<h1><span class="mw-headline" id="Bluetooth">Bluetooth</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=47" title="Edit section: Bluetooth">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_3">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=48" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section describes how to enable Bluetooth support on Android for wl1271 chipset.
<br />
</p>
<h2><span class="mw-headline" id="Features_Overview_3">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=49" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Bluetooth 2.1</li>
<li>OPP, A2DP, AVRCP, HSP/HFP profiles are supported.</li></ul>
<p><br />
</p>
<h2><span class="mw-headline" id="Android_BT_Sub-System_Overview">Android BT Sub-System Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=50" title="Edit section: Android BT Sub-System Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a href="File_BT_Stack.html" class="image"><img alt="BT Stack.jpg" src="https://processors.wiki.ti.com/images/e/e0/BT_Stack.jpg" width="960" height="720" /></a>
</p><p><br />
</p><p>Enable Bluetooth with the following setting in BoardConfig.mk:
</p>
<pre>   # Bluetooth
   BOARD_HAVE_BLUETOOTH&#160;:= true
</pre>
<p>This enables bluez <b>external/bluez</b> HAL layer, which is used to connect with Android Frameworks (<b>frameworks/base/core/jni/android_bluetooth_*.cpp</b>, <b>frameworks/base/core/java/android/bluetooth/*.java</b> and <b>SystemServer</b> via DBUS .
</p>
<h2><span class="mw-headline" id="Driver_Configuration_3">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=51" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>WL1271 BT UART initialization and power on/off is implemented at <b>drivers/tty/tty_io.c</b></li></ul>
<ul><li>The following kernel configs are enabled for Bluetooth support:</li></ul>
<pre>CONFIG_BT=y
CONFIG_BT_L2CAP=y
CONFIG_BT_RFCOMM=y
CONFIG_BT_RFCOMM_TTY=y
CONFIG_BT_BNEP=y
CONFIG_BT_BNEP_MC_FILTER=y
CONFIG_BT_BNEP_PROTO_FILTER=y
CONFIG_BT_HIDP=y
CONFIG_BT_HCIUART=y
CONFIG_BT_HCIUART_H4=y
CONFIG_BT_HCIUART_BCSP=y
CONFIG_BT_HCIUART_LL=y
CONFIG_BT_WL1271=y
</pre>
<ul><li>The following kernel configs are enabled for Bluetooth AVRCP support:</li></ul>
<pre>CONFIG_INPUT_MISC=y
CONFIG_INPUT_UINPUT=y
</pre>
<ul><li>The following kernel configs are enabled for Bluetooth Audio (SCO-over-PCM) support:</li></ul>
<pre>CONFIG_BT_SCO=y
CONFIG_SND_SOC_WL1271BT=y
</pre>
<h2><span class="mw-headline" id="Android_BT_HAL_Configuration">Android BT HAL Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=52" title="Edit section: Android BT HAL Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Set the correct permissions and paths created from init.rc</li></ul>
<pre>   #Owners, Modes for Bluetooth
   #console changed to ttyO* from ttyS* since 2.6.37 kernel.
   chmod 0660 /dev/ttyO1
   chown bluetooth bluetooth /dev/ttyO1
   chmod 0660 sys/class/rfkill/rfkill0/state
   chown bluetooth bluetooth /sys/class/rfkill/rfkill0/state
   write /sys/class/rfkill/rfkill0/state 0
</pre>
<ul><li>The following services are registered in init.rc for Bluetooth operation:</li></ul>
<ul><li>dbus-daemon: (deal connections between hcid and system server)</li></ul>
<pre>   service dbus /system/bin/dbus-daemon --system --nofork
   socket dbus stream 660 bluetooth bluetooth
   user bluetooth
   group bluetooth net_bt_admin
</pre>
<ul><li>bluetoothd: create hcid (Bluetooth Host Controller Interface Daemon) service, but disabled at first</li></ul>
<pre>   service bluetoothd /system/bin/bluetoothd -n
   socket bluetooth stream 660 bluetooth bluetooth
   socket dbus_bluetooth stream 660 bluetooth bluetooth
   group bluetooth net_bt_admin misc
   disabled
</pre>
<ul><li>hciattach - Project <b>external/bluetooth/bluez</b> is patched to enable TI-WL1271 chipset specific <i>hciattach</i> tool. This service attaches the BT UART HCI interface to the bluetooth stack at 3000000 baud rate. It is also responsible for loading the BT firmware on WL1271.</li></ul>
<p>Note:
</p>
<pre>   Starting 2.6.37 kernel, UART driver is changed to use ttyO* instead of ttyS*
</pre>
<pre>   service hciattach /system/bin/hciattach -n /dev/ttyO1 texas 3000000
   user root
   group bluetooth net_bt_admin misc
   disabled
   oneshot
</pre>
<ul><li>btpwr - Bluedroid <b>system/bluetooth/bluedroid</b> is used by Android UI to enable/disable Bluetooth. It uses the linux kernel rfkill infrastructure for this. The current kernel supplied with TI Android DevKit does not support rfkill, hence bluedroid is modified to use the wl1271bt_enable app provided with the Wireless Compat release. The wl1271bt_enable app is registered as a service named btpwr in init.rc. This service runs the wl1271bt_enable app to power-on/power-off the BT module in WL1271. wl1271bt_enable uses the ioctls exposed by the kernel at <b>drivers/tty/tty_io.c</b>.</li></ul>
<pre>   # rfkill is not supported, use this instead
   service btpwr /wl1271bt_enable /dev/ttyO1
   disabled
   oneshot
</pre>
<ul><li>opush - BT Object Push Profile</li></ul>
<pre>   service opush /system/bin/sdptool add --channel=12 OPUSH
   user bluetooth
   group bluetooth net_bt_admin
   disabled
   oneshot
</pre>
<h1><span class="mw-headline" id="Audio">Audio</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=53" title="Edit section: Audio">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_4">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=54" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Audio module is available inside PMIC IC TPS65950 (in OMAP35xEVM, AM37xEVM, BEAGLE, BEAGLE-XM) and AIC23 (in AM3517EVM), contains audio analog inputs and outputs. It is connected to the main processor through the TDM / I2S interface and used to transmit and receive audio data. The TPS65950 / AIC23 audio codec is connected via Multi-Channel Buffered Serial Port (McBSP) interface, a communication peripheral, to the main processor.
</p><p><br />
McBSP provides a full-duplex direct serial interface between the main processor (AM/DM37x, OMAP35x and AM3517) and other devices in the system such as the TPS65950 / AIC23 codec. It provides a direct interface to industry standard codecs, analog interface chips (AICs) and other serially connected A/D and D/A devices:
</p>
<ul><li>Inter-IC Sound (I2S) compliant devices</li>
<li>Pulse Code Modulation (PCM) devices</li>
<li>Time Division Multiplexed (TDM) bus devices.</li></ul>
<p><br />
The TPS65950 / AIC23 audio module is controlled by internal registers that can&#160;be accessed by the high speed I2C control interface.<br />
</p><p>This user manual section defines and describes the user level and&#160;platform level interfaces of the ALSA SoC Audio driver.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Features_Overview_4">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=55" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The features supported by ALSA SoC Audio driver are:
</p>
<ul><li>Supports AIC23 audio codec (on AM3517 only) and TPS65950 audio codec (on AM/DM37x,OMAP35x only) in ALSA SoC framework.</li>
<li>Multiple sample rates support (8KHz, 16KHz, 22.05KHz, 32KHz, 44.1KHz, 48KHz, 64KHz, 88.2KHz and 96KHz - AM3517; 8 KHz, 11.025 KHz, 12 KHz, 16 KHz, 22.05 KHz, 24 KHz, 32 KHz, 44.1 KHz and 48 KHz - AM/DM37x,OMAP35x) for both capture and playback.</li>
<li>Supports audio in stereo mode.</li>
<li>Supports simultaneous playback and record (full-duplex mode).</li>
<li>Start, stop, pause and resume feature.</li>
<li>Supports mixer interface for audio codecs.</li>
<li>Supports MMAP mode for both playback and capture.</li>
<li>McBSP is configured as slave and TPS65950 / AIC23 Codec is configured as&#160;master.</li></ul>
<p><br />
</p><p><b>Important</b><br />
Please note that enabling any line-in inputs necessitates connecting an audio playback source's output&#160;; connecting a (non-preamplified) microphone input (like the one from a head-set jack) might not work.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Android_Audio_Sub-System_Overview">Android Audio Sub-System Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=56" title="Edit section: Android Audio Sub-System Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a href="File_Audio_Stack.html" class="image"><img alt="Audio Stack.jpg" src="https://processors.wiki.ti.com/images/1/18/Audio_Stack.jpg" width="960" height="720" /></a>
</p><p><br />
</p>
<ul><li>To use ALSA framework as HAL we need to build Rowboat with following options in BoardConfig.mk:</li></ul>
<pre>BOARD_USES_ALSA_AUDIO&#160;:= true
BUILD_WITH_ALSA_UTILS&#160;:= true
</pre>
<ul><li>Generic ALSA as AudioFlinger Interface(<b>libaudio.so</b>) is implemented at <b>hardware/alsa_sound</b>.</li>
<li>Audio device specific settings and controls(<b>alsa.omap3.so</b>) are implemented at <b>hardware/ti/omap3/modules/alsa</b>.</li>
<li>ALSA library(<b>libasound.so</b>) is implemented at <b>external/alsa-libs</b>.</li>
<li>ALSA core utils(<b>alsa_aplay, alsa_amixer</b>) are implemented at <b>external/alsa-utils</b>.</li></ul>
<p><br />
</p>
<h2><span class="mw-headline" id="Driver_Configuration_4">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=57" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>To enable/disable audio support, start the <i>Linux Kernel Configuration</i>&#160;tool:
</p>
<pre>$ make ARCH=arm menuconfig
</pre>
<ul><li>Select <i>Device Drivers </i>from the main menu.</li></ul>
<pre>    ...
    ...
    Power management options ---&gt;
    [*] Networking support ---&gt;
    '''Device Drivers ---&gt;'''
    File systems ---&gt;
    Kernel hacking ---&gt;
    ...
    ...

</pre>
<ul><li>Select <i>Sound card support</i> as shown here:</li></ul>
<pre>    ...
    ...
    Multimedia devices ---&gt;
    Graphics support ---&gt;
'''&lt;*&gt; Sound card support ---&gt;'''
[*] HID Devices ---&gt;
[*] USB support ---&gt;
    ...
    ...

</pre>
<ul><li>Select <i>Advanced Linux Sound Architecture</i> as shown here:</li></ul>
<p><br />
</p>
<pre>--- Sound card support
'''&lt;*&gt; Advanced Linux Sound Architecture ---&gt;'''
&lt; &gt; Open Sound System (DEPRECATED) ---&gt;


</pre>
<ul><li>Select <i>ALSA for SoC audio support </i>as shown here:</li></ul>
<p><br />
</p>
<pre>    ...
    ...
[*] ARM sound devices  ---&gt;
[*] SPI sound devices  ---&gt;
[*] USB sound devices  ---&gt;
'''&lt;*&gt; ALSA for SoC audio support ---&gt;'''


</pre>
<ul><li>For AM/DM37x,OMAP35x, select <i>SoC Audio support for OMAP3EVM board</i> as shown here:</li></ul>
<pre>--- ALSA for SoC audio support
&lt;*&gt; SoC Audio for the Texas Instruments OMAP chips
'''&lt;*&gt; SoC Audio support for OMAP3EVM board'''
&lt; &gt; Build all ASoC CODEC drivers


</pre>
<ul><li>For AM3517, select <i>SoC Audio support for OMAP3517 / AM3517 EVM</i> as shown here:</li></ul>
<pre>--- ALSA for SoC audio support
&lt;*&gt; SoC Audio for the Texas Instruments OMAP chips
'''&lt;*&gt; SoC Audio support for OMAP3517 / AM3517 EVM'''
&lt; &gt; Build all ASoC CODEC drivers


</pre>
<ul><li>Make sure that McBSP support is enabled. To check the same, select <i>System Type</i> from the main menu.</li></ul>
<pre>    ...
    ...
[*] Enable loadable module support ---&gt;
[*] Enable the block layer ---&gt;
    '''System Type ---&gt;'''
    Bus support ---&gt;
    Kernel Features ---&gt;
    ...
    ...


</pre>
<ul><li>Select <i>TI OMAP Common Features </i>as shown here:</li></ul>
<pre>    [*] MMU-based Paged Memory Management Support
    ARM system type (TI OMAP) ---&gt;
    '''TI OMAP Common Features ---&gt;'''
    TI OMAP2/3/4 Specific Features  ---&gt;
    *** Processor Type ***
-*- Support ARM V6K processor extensions
    ...
    ...


</pre>
<ul><li><i>McBSP support </i>should be selected:</li></ul>
<pre>    ...
    ...
[ ] Multiplexing debug output
[*] Warn about pins the bootloader didn't set up
-*- McBSP support
&lt; &gt; Mailbox framework support
&lt; &gt; Export OMAP IOMMU internals in DebugFS
    System timer (Use 32KHz timer) ---&gt;
    ...
    ...


</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Android_Audio_HAL_Configuration">Android Audio HAL Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=58" title="Edit section: Android Audio HAL Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Before diving into Android ALSA hardware layer, we have to verify whether ALSA driver is properly working or not. We will use ALSA utilities(alsa_aplay, alsa_arecord, and alsa_amixer) which got build along with Rowboat and is a part of <b>external/alsa-utils</b> package.
</p>
<ul><li>alsa_amixer is used to set ALSA controls &amp; settings.</li>
<li>alsa_arecord and alsa_aplay are used for record and playback purpose respectively.</li></ul>
<p><br />
By default alsa_arecord doesn't exist. It is a soft link to alsa_aplay. So to create the link run the following command from Android prompt.
</p>
<pre># ln -s /system/bin/alsa_aplay /system/bin/alsa_arecord
</pre>
<p><br />
<b>Important (for AM/DM37x,OMAP35x ONLY)</b><br />
</p>
<ul><li>Audio capture channels AUXL and AUXR are by default disabled for AM37x,OMAP35x ASoC driver. To enable run the following 'alsa_amixer' commands:</li></ul>
<pre># alsa_amixer cset name='Analog Left AUXL Capture Switch' 1
# alsa_amixer cset name='Analog Right AUXR Capture Switch' 1
</pre>
<ul><li>Audio playback (on Headset channel) is muted by default and capture is set to capture at MAX volume. Run the following 'alsa_amixer' commands to fix the volume settings:</li></ul>
<pre># alsa_amixer set 'Headset' 3
# alsa_amixer set 'Analog' 0
</pre>
<ul><li>Software loopback command to test capture-playback. Following command will record in "CD" format and play the recorded data.</li></ul>
<pre># alsa_arecord -f cd | alsa_aplay
</pre>
<p>The <tt>--help</tt> option provides a comprehensive list of command-line options for ALSA utilities.
</p><p>The above procedure should get your Audio Capture and Playback working from command line. If it is then we are all set to make the corresponding changes in Android HAL layer and that will be all.
</p><p>Hardware specific ALSA configurations will go here to <b>hardware/ti/omap3/modules/alsa/alsa_module.cpp</b> file.
</p><p><b> Select and configure hardware devices </b>
</p>
<ul><li>List down all the Audio devices available on target/AM37x.</li></ul>
<pre># alsa_aplay -l
**** List of PLAYBACK Hardware Devices ****
card 0: omap3evm [omap3evm], device 0: TWL4030 twl4030-0 []
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 0: omap3evm [omap3evm], device 1: WL1271 BT PCM wl1271bt-1 []
  Subdevices: 1/1
  Subdevice #0: subdevice #0
</pre>
<ul><li>We got that default out device is <b>hw 0:0</b> whereas BT SCO device is <b>hw 0:1</b></li></ul>
<ul><li>Define: <tt> deviceName() </tt> to return correct out device on query. See the implementation for details.</li></ul>
<ul><li>In <tt> alsa_handle_t _defaults[] </tt> goes the ALSA handle settings:</li></ul>
<pre>.....
    {
        module     &#160;: 0,
        devices    &#160;: OMAP3_OUT_SCO,
        curDev     &#160;: 0,
        curMode    &#160;: 0,
        handle     &#160;: 0,
        format     &#160;: SND_PCM_FORMAT_S16_LE, // AudioSystem::PCM_16_BIT
        channels   &#160;: 2,
        sampleRate &#160;: DEFAULT_SAMPLE_RATE, // should ideally be 8000
        latency    &#160;: 200000, // Desired Delay in usec
        bufferSize &#160;: DEFAULT_SAMPLE_RATE / 5, // Desired Number of samples
                mmap           &#160;:0,
        modPrivate &#160;: (void *)&amp;setScoControls,
    },
    {
        module     &#160;: 0,
        devices    &#160;: OMAP3_OUT_DEFAULT,
        curDev     &#160;: 0,
        curMode    &#160;: 0,
        handle     &#160;: 0,
        format     &#160;: SND_PCM_FORMAT_S16_LE, // AudioSystem::PCM_16_BIT
        channels   &#160;: 2,
        sampleRate &#160;: DEFAULT_SAMPLE_RATE,
        latency    &#160;: 200000, // Desired Delay in usec
        bufferSize &#160;: DEFAULT_SAMPLE_RATE / 11, // Desired Number of samples
                mmap           &#160;:0,
        modPrivate &#160;: (void *)&amp;setDefaultControls,
    },
.....
</pre>
<ul><li>In <tt> setDefaultControls() </tt> we set the ALSA controls. It is similar to setting the ALSA Switch and Volume controls what we did using the <tt> alsa_amixer </tt> command for AM37/OMAP35 above. You can see the exact one-to-one mapping of those commands here.</li></ul>
<ul><li>How to set controls for default out device:</li></ul>
<pre>.....
void setDefaultControls(uint32_t devices, int mode)
{
LOGV("%s", __FUNCTION__);
    ALSAControl control("hw:00");

    /* check whether the devices is input or not */
    /* for output devices */
    if (devices &amp; 0x0000FFFF){
        if (devices &amp; AudioSystem::DEVICE_OUT_SPEAKER) {
            control.set("HeadsetR Mixer AudioR1", 1); // on
            control.set("HeadsetL Mixer AudioL1", 1); // on
            control.set("Headset Playback Volume", 1); //Headset Volume
        } else {
            control.set("HeadsetR Mixer AudioR1", (unsigned int)0); // off
            control.set("HeadsetL Mixer AudioL1", (unsigned int)0); // off
        }
    }

    /* for input devices */
    if (devices &gt;&gt; 16) {
        if (devices &amp; AudioSystem::DEVICE_IN_BUILTIN_MIC) {
            control.set("Analog Left AUXL Capture Switch", 1); //on
            control.set("Analog Right AUXR Capture Switch", 1); //on
            control.set("Analog Capture Volume", (unsigned int)0); //Capture volume '0' to capture less noice
        } else {
            control.set("Analog Left AUXL Capture Switch", (unsigned int)0); //off
            control.set("Analog Right AUXR Capture Switch", (unsigned int)0); //off
        }
    }
}
.....
</pre>
<p><br />
<b>Important</b><br />
Please note that enabling any line-in inputs necessitates connecting an audio playback source's output&#160;; connecting a (non-preamplified) microphone input (like the one from a head-set jack) might not work.
</p><p><b>Important (for AM3517 ONLY)</b><br />
By default Line is enabled. Connect an audio player source to Line In Codec 1 jack on the application board and a headset or speaker source to the Line-Out Codec 1 jack.
<br />
</p>
<h1><span class="mw-headline" id="Camera">Camera</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=59" title="Edit section: Camera">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_5">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=60" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This porting guide briefs about porting camera module to Gingerbread with respect to camera sensor mt9v113 for Beagle board and mt9t111 for AM37x.
<br />
</p>
<h2><span class="mw-headline" id="Features_Overview_5">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=61" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Still image capture</li>
<li>Capture in YUV format from the sensor at VGA resolution</li>
<li>Standard V4L2 ioctls</li>
<li>Buffer accessing mechanism through userpointer and memory mapping</li></ul>
<h2><span class="mw-headline" id="Android_Camera_Sub-System_Overview">Android Camera Sub-System Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=62" title="Edit section: Android Camera Sub-System Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Android's camera application connects with android HAL through camera binding interface. HAL inturn connects physical camera sensor and provides control &amp; data interface between application and camera sensor.
The block diagram below shows the camera sub-system in android
<br />
<a href="File_Camera_stack.html" class="image"><img alt="Camera stack.jpg" src="https://processors.wiki.ti.com/images/a/a7/Camera_stack.jpg" width="640" height="480" /></a>
</p><p><br />
</p>
<h2><span class="mw-headline" id="Adding_Camera_Module_to_Linux_Kernel">Adding Camera Module to Linux Kernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=63" title="Edit section: Adding Camera Module to Linux Kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Write/Get camera driver. (mt9v113.c / mt9111.c)</li>
<li>Put driver files at &lt;Kernel&gt;/drivers/media/video. Good to have header files at &lt;Kernel&gt;/include/media</li>
<li>Open &amp; Edit &lt;Kernel&gt;drivers/media/video/Makefile <br /></li></ul>
<p>&lt;syntaxhighlight lang="bash"&gt;
$vim &lt;Kernel&gt;/drivers/media/video/Makefile
Add driver file to get compiled.
e.x.
obj-$(CONFIG_VIDEO_MT9V113) += mt9v113.o
obj-$(CONFIG_VIDEO_MT9T111) += mt9t111.o
&lt;/syntaxhighlight&gt;
</p>
<ul><li>Open &amp; Edit &lt;Kernel&gt;/drivers/media/video/Kconfig</li></ul>
<p>&lt;syntaxhighlight lang="bash"&gt;
$vim &lt;Kernel&gt;/drivers/media/video/Kconfig
Add config entry for the driver.
e.x.
config VIDEO_MT9V113
</p>
<pre>tristate "Aptina MT9V113 VGA CMOS IMAGE SENSOR"
depends on VIDEO_V4L2 &amp;&amp; I2C
---help---
This is a Video4Linux2 sensor-level driver for the Aptina MT9V113
image sensor.
</pre>
<pre>To compile this driver as a module, choose M here: the
module will be called mt9v113.
</pre>
<p>config VIDEO_MT9T111
</p>
<pre>tristate "Aptina MT9T111 VGA CMOS IMAGE SENSOR"
depends on VIDEO_V4L2 &amp;&amp; I2C
---help---
This is a Video4Linux2 sensor-level driver for the Aptina MT9T111
image sensor.
</pre>
<pre>To compile this driver as a module, choose M here.
</pre>
<p>&lt;/syntaxhighlight&gt;
</p>
<ul><li>Add board specific changes for camera sensor to the board file</li>
<li>For the reference refer file - '&lt;Kernel&gt;/arch/arm/mach-omap2/board-omap3beagle-camera.c'</li></ul>
<h2><span class="mw-headline" id="Driver_Configuration_5">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=64" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>&lt;syntaxhighlight lang='bash'&gt;
$cd &lt;Kernel&gt;
$make CROSS_COMPILE=arm-eabi- ARCH=arm menuconfig
&lt;/syntaxhighlight&gt;
</p>
<ul><li>Go to device drivers -&gt; multimedia support -&gt; video capture adapters -&gt; encoders/decoders and other helper chips, select added camera driver</li></ul>
<p>(Select MT9V113 camera sensor for Beagleboard-xm and MT9T111 for AM37x)
</p>
<ul><li>Camera sensor driver source is located at kernel/drivers/media/video/mt9v113.c for MT9V113 for Beagleboard-xm and kernel/drivers/media/video/mt9t111.c for AM37x</li></ul>
<pre>General setup  ---&gt;
[*] Enable loadable module support  ---&gt;
[*] Enable the block layer  ---&gt;
    System Type  ---&gt;
[*] FIQ Mode Serial Debugger
    Bus support  ---&gt;
    Kernel Features  ---&gt;
    Boot options  ---&gt;
    CPU Power Management  ---&gt;
    Floating point emulation  ---&gt;
    Userspace binary formats  ---&gt;
    Power management options  ---&gt;
[*] Networking support  ---&gt;
    Device Drivers  ---&gt;
    File systems  ---&gt;
    Kernel Hacking ---&gt;
    Security options ---&gt;
-*- Cryptographic API ---&gt;
    Library routines ---&gt;

</pre>
<pre>    *** Multimedia core support ***
[*]   Media Controller API (EXPERIMENTAL)
[*]   Video For Linux
[*]     Enable Video For Linux API 1 (DEPRECATED)
[*]     V4L2 sub-device userspace API (EXPERIMENTAL)
&lt; &gt;   DVB for Linux
    *** Multimedia drivers ***
[ ]   Load and attach frontend and tuner driver modules as needed
[ ]   Customize analog and hybrid tuner modules to build  ---&gt;
[*]   Video capture adapters  ---&gt;
[ ]   Memory -to -memory multemedia devices ---&gt;
[*]   Radio Adapters  ---&gt;
[ ]   DAB adapters

</pre>
<pre>[ ]   Enable advanced debug functionality
[ ]   Enable old-style fixed minor ranges for video devices
[ ]   Autoselect pertinent encoders/decoders and other helper chips
      Encoders/decoders and other helper chips  ---&gt;
&lt; &gt;   VPSS system module driver
&lt; &gt;   VPFE Video Capture Driver
&lt;*&gt;   OMAP2/OMAP3 V4L2-Display Driver
&lt; &gt;   CPiA2 Video For Linux
&lt; &gt;   SR030PC30 VGA camera support
&lt;*&gt;   OMAP 3 camera support (EXPERIMENTAL)
[*]     OMAP 3 camera debug messages
&lt; &gt;   SOC camera support
[*]   V4L USB devices ---&gt;


</pre>
 <pre>&lt; &gt; OmniVision OV7670 sensor support
&lt;*&gt; Micron mt9v011 sensor support
&lt;*&gt; Aptina MT9V113 VGA CMOS IMAGE SENSOR
&lt;*&gt; Aptina MT9T111 VGA CMOS IMAGE SENSOR
&lt; &gt; TCM825x camera sensor support
&lt; &gt; Philips SAA7110 vdieo decoder
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Android_Camera_HAL_Configuration">Android Camera HAL Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=65" title="Edit section: Android Camera HAL Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Camera HAL source is located at android_source/hardware/ti/omap3/camera/ and the shared library libcamera.so is created out of this.</li>
<li>The HAL is implemented based on CameraHardwareInterface.h in framework/base/include/camera/CameraHardwareInterface.h</li>
<li>HAL communicates with hardware through V4L2 framework and media controller framework in the linux kernel</li></ul>
<p>Refer GingerBread source.
</p>
<ul><li>Following section briefs about important interface which needs to be defined under camera HAL.</li></ul>
<p><br />
&lt;syntaxhighlight lang="bash"&gt;
/* constructor */
CameraHardware::CameraHardware()
</p>
<pre>: mParameters(),
mPreviewHeap(0),
mRawHeap(0),
mCamera(0),
mPreviewFrameSize(0),
mNotifyCb(0),
mDataCb(0),
mDataCbTimestamp(0),
mCallbackCookie(0),
mMsgEnabled(0),
previewStopped(true)
</pre>
<p>{
</p>
<pre>/* create camera, open camera sensor(video device), open subdevice and set up format pads, open media device, enumerate all the entities, set-up media link, close the media device */
/* init default paramets
e.x.
CameraParameters p;
p.setPreviewSize(320, 240);
p.set(CameraParameters::KEY_JPEG_QUALITY, 100);
p.setPreviewFormat(CameraParameters::PIXEL_FORMAT_YUV422SP);
*/
initDefaultParameters();
</pre>
<p>}
/* destructor */
CameraHardware::~CameraHardware()
{
</p>
<pre>/* close device and delete instance created */
</pre>
<p>}
</p><p>sp&lt;IMemoryHeap&gt; CameraHardware::getPreviewHeap() const
{
</p>
<pre>/* return preview frame pointer */
return mPreviewHeap;
</pre>
<p>}
</p><p><br />
void CameraHardware::setCallbacks(notify_callback notify_cb,
</p>
<pre>data_callback data_cb,
data_callback_timestamp data_cb_timestamp,
void* user)
</pre>
<p>{
</p>
<pre>/* store callback to local pointers, need to callback at the time of preview/image capture
e.x.
mNotifyCb = notify_cb;
mDataCb = data_cb;
mDataCbTimestamp = data_cb_timestamp;
mCallbackCookie = user;*/
</pre>
<p>}
</p><p>void CameraHardware::enableMsgType(int32_t msgType)
{
</p>
<pre>/* set local message flag. Application will give this notification to perform certain action while previewing.
ex.start video, image caputure etc. */
mMsgEnabled |= msgType;
</pre>
<p>}
</p><p>void CameraHardware::disableMsgType(int32_t msgType)
{
</p>
<pre>mMsgEnabled &amp;= ~msgType;
</pre>
<p>}
</p><p>bool CameraHardware::msgTypeEnabled(int32_t msgType)
{
</p>
<pre>/* return message value - presently enable at HAL
return (mMsgEnabled &amp; msgType); */
</pre>
<p>}
/* start preview */
status_t CameraHardware::startPreview()
{
</p>
<pre>/* configure device and start preview thread */
/* in preview thread call
- check message type
- fill preview frame pointer with valid preview data
- call data callback with data
*/
</pre>
<p>}
</p><p>void CameraHardware::stopPreview()
{
</p>
<pre>/* stop preview */
</pre>
<p>}
</p><p>status_t CameraHardware::startRecording()
{
</p>
<pre>/* configure device &amp; start record thread */
/* record thread
- check message type
- if message type contains - CAMERA_MSG_VIDEO_FRAME then call 'mDataCbTimestamp' with video frame captured
*/
</pre>
<p>}
</p><p>void CameraHardware::stopRecording()
{
</p>
<pre>/* stop recording */
</pre>
<p>}
</p><p>status_t CameraHardware::takePicture()
{
</p>
<pre>/*
- configure camera device
- take a current frame
- check message type
- call callback
*/
}
</pre>
<p>status_t CameraHardware::setParameters(const CameraParameters&amp; params)
{
</p>
<pre>/*
- configure device as per parameters
*/
</pre>
<p>}
</p><p>CameraParameters CameraHardware::getParameters() const
{
</p>
<pre>/*
- return current value of parameter set
*/
</pre>
<p>}
&lt;/syntaxhighlight&gt;
</p>
<ul><li>Create and configure android.mk file</li></ul>
<p>&lt;syntaxhighlight lang="bash"&gt;
LOCAL_PATH:= $(call my-dir)
</p>
<ol><li class="mw-empty-elt"></li>
<li>libcamera</li>
<li class="mw-empty-elt"></li></ol>
<p>include $(CLEAR_VARS)
LOCAL_SRC_FILES:= \
</p>
<pre>source1.cpp \
source2.cpp ...
</pre>
<p>LOCAL_MODULE:= libcamera
LOCAL_SHARED_LIBRARIES:= \
</p>
<pre>libcutils \
libui \
libutils \
libbinder \
libjpeg \
libcamera_client \
</pre>
<pre>libsurfaceflinger_client
</pre>
<p>LOCAL_C_INCLUDES += \
</p>
<pre>external/jpeg
</pre>
<p>include $(BUILD_SHARED_LIBRARY)
include $(all-subdir-makefiles)
&lt;/syntaxhighlight&gt;
</p>
<ul><li>Compile android system or one can also compile individal subsystem by</li></ul>
<p>&lt;syntaxhighlight lang="bash"&gt;
Go to module directory
$cd /projects/rowboat-android/hardware/ti/omap3/camera
$source &lt;ANDROID_ROOT&gt;/build/envsetup.sh
$mm TARGET_PRODUCT= &lt;TARGET PRODUCT NAME&gt;
e.g.$ mm TARGET_PRODUCT=beagleboard
copy libcamera.so to out/target/product/&lt;boardname&gt;/system/lib
&lt;/syntaxhighlight&gt;
</p><p><br />
Note:
- To enable camera on android the corresponding BoardConfig.mk file should have USES_CAMERA_STUB commented otherwise camera stub will be used.
<br />
</p><p><br />
</p>
<h1><span class="mw-headline" id="Display">Display</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=66" title="Edit section: Display">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_6">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=67" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section of the porting guide describes the display system with respect to AM35x, AM37x and Beagle board. Display Sub-System hardware integrates one graphics pipeline, two video pipelines, and two overlay managers (one for digital and one for analog interface). Digital interface is used for LCD and DVI output and analog interface is used for TV out.
</p><p><b>Sharp LS037V7DW01 LCD Panel</b> and <b>Sharp LQ043T1DG01 LCD Panel</b> are used on boards OMAP3EVM and AM35x respectively. Porting explanation for <i>Sharp LS037V7DW01 LCD Panel</i> is given in this section
</p>
<h2><span class="mw-headline" id="Features_Overview_6">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=68" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Supports LCD display interface at VGA resolution (480*640)</li>
<li>Supports TV display interface at NTSC/PAL resolutions (both S-Video out and Composite out is supported)</li>
<li>Supports DVI digital interface (mode selection via boot argument).</li>
<li>Supports rotation - 0, 90, 180 and 270 degrees on LCD and TV output</li>
<li>Supports overlay</li></ul>
<h2><span class="mw-headline" id="Android_Display_Subsystem_Overview">Android Display Subsystem Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=69" title="Edit section: Android Display Subsystem Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The block diagram below shows the display subsystem in GingerBread android.
Android display system is based on a Client/Server Architecture.<br />
Server side:
Surface Flinger is a service coded in C++
</p>
<ul><li>Manages access to display subsystem</li>
<li>Seamlessly composites 2D and 3D graphic layers from multiple applications</li></ul>
<p>Client side:
Applications can draw on surfaces using two paths:
</p>
<ul><li>Use widgets/View/Canvas provided by the JAVA APIs and managed by C++ external Skia library</li>
<li>Access OpenGL through JNI to directly create 3D surfaces</li></ul>
<p>Surface Flinger Provides system-wide surface “composer”, handling all surface rendering to frame buffer device. Uses OPENGL and hardware accelerator for composing surfaces. Surfaces passed as buffers via binder IPC calls.
</p>
<div class="floatleft"><a href="File_Display_system_overview.html" class="image" title="Display_system_overview.jpg"><img alt="Display_system_overview.jpg" src="https://processors.wiki.ti.com/images/f/fe/Display_system_overview.jpg" width="800" height="600" /></a></div>
<p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Driver_Configuration_6">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=70" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="V4L2_Driver">V4L2 Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=71" title="Edit section: V4L2 Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Select "Device Drivers" from the main menu.</li></ul>
<pre>    ...
    ...
    Power management options  ---&gt;
[*] Networking support  ---&gt;
    Device Drivers  ---&gt;
    File systems  ---&gt;
    Kernel hacking  ---&gt;
    ...
    ...</pre>
<ul><li>Select "Multimedia support" from the menu.</li></ul>
<pre>    ...
    ...
    Multifunction device drivers  ---&gt;
[*] Voltage and Current Regulator Support  ---&gt;
&lt;*&gt; Multimedia support  ---&gt;
    Graphics support  ---&gt;
&lt;*&gt; Sound card support  ---&gt;
    ...
    ...</pre>
<ul><li>Select "Video For Linux" from the menu.</li></ul>
<pre>    ...
    ...
    *** Multimedia core support ***
&lt;*&gt;   Video For Linux
[*]     Enable Video For Linux API 1 (DEPRECATED)
&lt; &gt;   DVB for Linux
    ...
    ...</pre>
<ul><li>Select "Video capture adapters" from the same menu. Press &lt;ENTER&gt; to enter the corresponding sub-menu.</li></ul>
<pre>    ...
    ...
[ ]   Customize analog and hybrid tuner modules to build  ---&gt;
[*]   Video capture adapters  ---&gt;
[ ]   Memory-to-memory multimedia devices  ---&gt;
    ...
    ...</pre>
<ul><li>Select "OMAP2/OMAP3 V4L2-DSS drivers" from the menu.</li></ul>
<pre>    ...
    ...
-*-   VPSS System module driver
&lt;*&gt;   VPFE Video Capture Driver
&lt;*&gt;     DM6446 CCDC HW module
&lt;*&gt;   OMAP2/OMAP3 V4L2-Display driver
&lt; &gt;   CPiA2 Video For Linux
    ...
    ...</pre>
<h3><span class="mw-headline" id="Frame_Buffer_Driver">Frame Buffer Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=72" title="Edit section: Frame Buffer Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Select "Device Drivers" from the main menu.</li></ul>
<pre>    ...
    ...
    Power management options  ---&gt;
[*] Networking support  ---&gt;
    Device Drivers  ---&gt;
    File systems  ---&gt;
    Kernel hacking  ---&gt;
    ...
    ...</pre>
<ul><li>Select "Graphics support" from the menu.</li></ul>
<pre>    ...
    ...
[*] Voltage and Current Regulator Support  ---&gt;
&lt;*&gt; Multimedia support  ---&gt;
    Graphics support  ---&gt;
&lt;*&gt; Sound card support  ---&gt;
[*] HID Devices  ---&gt;
    ...
    ...</pre>
<ul><li>Select "Support for frame buffer devices" from the menu.</li></ul>
<pre>    ...
    ...
&lt;M&gt; Lowlevel video output switch controls
&lt;*&gt; Support for frame buffer devices  ---&gt;
&lt; &gt; Virtual Frame Buffer support (ONLY FOR TESTING!)
    ...
    ...</pre>
<ul><li>Select "OMAP2/3 Display Subsystem support (EXPERIMENTAL)" from the same menu.</li></ul>
<pre>    ...
    ...
[ ] Check bootloader initialization
-*- OMAP2/3 Display Subsystem support (EXPERIMENTAL)  ---&gt;
[*] Backlight &amp; LCD device support  ---&gt;
    ...
    ...</pre>
<ul><li>Configure default VRAM size to the required/expected size of buffer, the default is 4MB.</li></ul>
<p>Go inside option "OMAP2/3 Display Subsystem support"
</p>
<pre>    ...
    ...
--- OMAP2/3 Display Subsystem support (EXPERIMENTAL)
(4)   VRAM size (MB)
[*]   Debug support
    ...
    ...</pre>
<ul><li>Select "DPI support" from the menu.</li></ul>
<pre>    ...
    ...
[ ]   Debug support
[*]   DPI support
[ ]   RFBI support
    ...
    ...</pre>
<h3><span class="mw-headline" id="TV_Output_Support">TV Output Support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=73" title="Edit section: TV Output Support">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Select "Device Drivers" from the main menu.</li></ul>
<pre>    ...
    ...
    Power management options  ---&gt;
[*] Networking support  ---&gt;
    Device Drivers  ---&gt;
    File systems  ---&gt;
    Kernel hacking  ---&gt;
    ...
    ...</pre>
<ul><li>Select "Graphics support" from the menu.</li></ul>
<pre>    ...
    ...
[*] Voltage and Current Regulator Support  ---&gt;
&lt;*&gt; Multimedia support  ---&gt;
    Graphics support  ---&gt;
&lt;*&gt; Sound card support  ---&gt;
[*] HID Devices  ---&gt;
    ...
    ...</pre>
<ul><li>Select "OMAP2/3 Display Subsystem support (EXPERIMENTAL)" from the same menu.</li></ul>
<pre>    ...
    ...
[ ] Check bootloader initialization
-*- OMAP2/3 Display Subsystem support (EXPERIMENTAL)  ---&gt;
[*] Backlight &amp; LCD device support  ---&gt;
    ...
    ...</pre>
<ul><li>Select "VENC support" from the menu.</li></ul>
<pre>    ...
    ...
[ ]   Debug support
[ ]   RFBI support
[*]   VENC support
      OMAP2_VENC_OUT_TYPE (Use S-Video output interface)  ---&gt;
[ ]   SDI support
    ...
    ...</pre>
<p><b>Note:</b> Confirm OMAP2_VENC_OUT_TYPE is set to "Use S-Video output interface"
</p>
<h3><span class="mw-headline" id="LCD_Driver_Support">LCD Driver Support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=74" title="Edit section: LCD Driver Support">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Select "Device Drivers" from the main menu.</li></ul>
<pre>    ...
    ...
    Power management options  ---&gt;
[*] Networking support  ---&gt;
    Device Drivers  ---&gt;
    File systems  ---&gt;
    Kernel hacking  ---&gt;
    ...
    ...</pre>
<ul><li>Select "Graphics support" from the menu.</li></ul>
<pre>    ...
    ...
[*] Voltage and Current Regulator Support  ---&gt;
&lt;*&gt; Multimedia support  ---&gt;
    Graphics support  ---&gt;
&lt;*&gt; Sound card support  ---&gt;
[*] HID Devices  ---&gt;
    ...
    ...</pre>
<ul><li>Select "OMAP2/3 Display Subsystem support (EXPERIMENTAL)" from the same menu.</li></ul>
<pre>    ...
    ...
[ ] Check bootloader initialization
-*- OMAP2/3 Display Subsystem support (EXPERIMENTAL)  ---&gt;
[*] Backlight &amp; LCD device support  ---&gt;
    ...
    ...</pre>
<ul><li>Select "OMAP2/3 Display Device Drivers" from the next sub-menu:</li></ul>
<pre>    ...
    ...
(1)   Minimum FCK/PCK ratio (for scaling)
&lt;*&gt;   OMAP2/3 frame buffer support (EXPERIMENTAL)  ---&gt;
      OMAP2/3 Display Device Drivers  ---&gt;
    ...
    ...</pre>
<ul><li>Select "Sharp LS037V7DW01 LCD Panel" from the next sub-menu:</li></ul>
<pre>    ...
    ...
&lt;*&gt; Generic Panel
&lt;*&gt; Sharp LS037V7DW01 LCD Panel
&lt; &gt; Sharp LQ043T1DG01 LCD Panel
    ...
    ...</pre>
<h3><span class="mw-headline" id="Modification_in_Board_File_and_LCD_driver">Modification in Board File and LCD driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=75" title="Edit section: Modification in Board File and LCD driver">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>LCD interface related pin mux state and set as per requirement. It may required to check default pin muxing setup in u-boot as well.</li>
<li>Implement display_lcd_init(), display_lcd_enable() and display_lcd_disable() and link to display driver. Where DSS module will use it in runtime. e.g. @<i>arch/arm/mach-omap2/board-omap3evm.c</i></li></ul>
<pre> static struct omap_dss_device omap3_evm_lcd_device = {
	.name			= "lcd",
	.driver_name		= "sharp_ls_panel",
	.type			= OMAP_DISPLAY_TYPE_DPI,
	.phy.dpi.data_lines	= 18,
	.platform_enable	= omap3_evm_enable_lcd,
	.platform_disable	= omap3_evm_disable_lcd,
	.set_backlight		= omap3evm_set_bl_intensity,
 }; </pre>
<ul><li>LCD timing need to set as per datasheet information. e.g. @<i>drivers/video/omap2/displays/panel-*.c</i></li></ul>
<pre> static struct omap_video_timings sharp_ls_timings = {
	.x_res = 480,
	.y_res = 640,

	.pixel_clock	= 19200,

	.hsw		= 2,
	.hfp		= 1,
	.hbp		= 28,

	.vsw		= 1,
	.vfp		= 1,
	.vbp		= 1,
 }; </pre>
<p><b>Note:</b> Colorbar testing of LCD can be done at u-boot level by configuring the set of registers manually.
</p>
<h1><span class="mw-headline" id="MMC">MMC</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=76" title="Edit section: MMC">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_7">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=77" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>TI AM37x/AM3517 has an multimedia card high-speed/secure data/secure
digital I/O (MMC/SD/SDIO) host controller, which provides an interface
between microprocessor and either MMC, SD memory cards, or SDIO
cards. The current version of the user guide talks about the MMC/SD
controller. The MMC driver is implemented on top of host controller as
a HS-MMC controller driver and supports MMC, SD, SD High Speed and
SDHC cards. The salient features of the aforementioned HS-MMC host
controller are:
</p>
<ul><li>Full compliance with MMC/SD command/response sets as defined in the Specification.</li>
<li>Supports 1-bit or 4-bit transfer mode specifications for SD and SDIO cards</li>
<li>Supports 1-bit, 4-bit, or 8-bit transfer mode specifications for MMC cards</li>
<li>Built-in 1024-byte buffer for read or write</li>
<li>32-bit-wide access bus to maximize bus throughput</li>
<li>Single interrupt line for multiple interrupt source events</li>
<li>Two slave DMA channels (1 for TX, 1 for RX)</li>
<li>Designed for low power and Programmable clock generation</li></ul>
<p><br />
</p>
<h2><span class="mw-headline" id="Features_Overview_7">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=78" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The MMC/SD/SDIO driver supports following features
<br />
</p>
<ul><li>The driver is built in-kernel (part of vmlinux).</li>
<li>MMC cards including High Speed cards.</li>
<li>SD cards including SD High Speed and SDHC cards</li>
<li>Uses block bounce buffer to aggregate scattered blocks</li></ul>
<p><br />
</p>
<h2><span class="mw-headline" id="Driver_Configuration_7">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=79" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The default kernel configuration enables support for MMC/SD(built-in to kernel). The selection of MMC/SD/SDIO driver can be modified as follows:
</p>
<ul><li>start Linux Kernel Configuration tool.</li></ul>
<pre>$ make menuconfig  ARCH=arm
</pre>
<ul><li>Select Device Drivers from the main menu.</li></ul>
<pre>...
...
Kernel Features  ---&gt;
Boot options  ---&gt;
CPU Power Management  ---&gt;
Floating point emulation  ---&gt;
Userspace binary formats  ---&gt;
Power management options  ---&gt;
[*] Networking support  ---&gt;
<b>Device Drivers  ---&gt;</b>
...
...
</pre>
<ul><li>Select MMC/SD/SDIO card support from the menu.</li></ul>
<pre>...
...
[*] USB support  ---&gt;
<b>&lt;*&gt; MMC/SD/SDIO card support  ---&gt;</b>
&lt; &gt; Sony MemoryStick card support (EXPERIMENTAL)  ---&gt;
...
...
</pre>
<ul><li>Select OMAP HS MMC driver</li></ul>
<pre>...
[ ] MMC debugging
[ ] Assume MMC/SD cards are non-removable (DANGEROUS)
     *** MMC/SD/SDIO Card Drivers ***
<b>&lt;*&gt; MMC block device driver</b>
<b>[*]  Use bounce buffer for simple hosts</b>
...
<b>&lt;*&gt;   TI OMAP High Speed Multimedia Card Interface support </b>
...
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Android_MMC_HAL_or_Vold_Configuration">Android MMC HAL or Vold Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=80" title="Edit section: Android MMC HAL or Vold Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Android system uses vold as the mount daemon, which detects, mounts and monitors the status of sdcard. The mount daemon needs a configuration file to tell it what the sdcard device is. Since Android 2.2 (froyo), it ships with a new implementation of vold (aka vold2). The configuration is changed to /etc/vold.fstab and its format is also changed. See <b>system/core/rootdir/etc/vold.fstab</b> in the Android source tree for the detailed explanations of the format.
</p><p>However, a fixed vold.fstab can only support block device with fixed name.
</p>
<pre># cat /etc/vold.fstab
dev_mount sdcard /mnt/sdcard 3 /devices/platform/mmci-omap-hs.0/mmc_host/mmc0
</pre>
<p>Depending on the MMC interface this value can change. Best way is to probe sysfs directories to find the fixed name.
</p>
<pre># ls /sys/devices/platform/mmci-omap-hs.X/mmc_host/mmcY
</pre>
<p><br />
</p>
<h1><span class="mw-headline" id="Touchscreen">Touchscreen</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=81" title="Edit section: Touchscreen">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_8">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=82" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The touch controller is ADS7846 with SPI interface (in OMAP35xEVM and AM37xEVM) and TSC2004 with I2C interface (in AM3517EVM). Both are resistive touch screen controllers.
</p>
<h2><span class="mw-headline" id="Features_Overview_8">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=83" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The features supported by Touchscreen in Android are:
</p>
<ul><li>Single touch input</li>
<li>Single click</li>
<li>Single long click</li>
<li>Uni-direction motion touch</li></ul>
<h2><span class="mw-headline" id="Driver_Configuration_8">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=84" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Add_touchscreen_driver_support">Add touchscreen driver support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=85" title="Edit section: Add touchscreen driver support">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Start the <i>Linux Kernel Configuration</i> tool:</li></ul>
<pre>    $ make ARCH=arm menuconfig
</pre>
<ul><li>Select <span style="color: BLUE;"><i>Device Drivers</i></span> from the main menu.</li></ul>
<pre>    ...
    Power management options ---&gt;
    [*] Networking support ---&gt;
    Device Drivers ---&gt;
    File systems ---&gt;
    Kernel hacking ---&gt;
    ...</pre>
<ul><li>Select <span style="color: BLUE;"><i>Input device support</i></span> form the next menu:</li></ul>
<pre>    ...
    [ ] ISDN support  ---&gt;
    &lt; &gt; Telephony support  ---&gt;
    Input device support  ---&gt;
    Character devices  ---&gt;
    -*- I2C support  ---&gt;
    ...</pre>
<ul><li>Select <span style="color: BLUE;"> <i>Touchscreens</i> </span> from the next menu:</li></ul>
<pre>    ...
    [ ]   Joysticks/Gamepads  ---&gt;
    [ ]   Tablets  ---&gt;
    [*]   Touchscreens  ---&gt;
    [*]   Miscellaneous devices  ---&gt;
    Hardware I/O ports  ---&gt;
    ...</pre>
<ul><li>Select <span style="color: BLUE;"><i>ADS7846/TSC2046/AD7873 and AD(S)7843 based touchscreens</i> </span> from the next menu:</li></ul>
<pre>    ...
--- Touchscreens
&lt;*&gt;   ADS7846/TSC2046/AD7873 and AD(S)7843 based touchscreens
&lt; &gt;   AD7877 based touchscreens
&lt; &gt;   Analog Devices AD7879-1/AD7889-1 touchscreen interface
    ...</pre>
<ul><li>Select <span style="color: BLUE;"><i>SPI support</i> </span> from the <span style="color: BLUE;"><i>Device Driver</i></span> menu:</li></ul>
<pre>    ...
    Character devices  ---&gt;
    -*- I2C support  ---&gt;
    [*] SPI support  ---&gt;
        PPS support  ---&gt;
    -*- GPIO Support  ---&gt;
    ...</pre>
<ul><li>Select <span style="color: BLUE;"><i>McSPI driver for OMAP24xx/OMAP34xx</i></span> from the next menu.</li></ul>
<pre>   ....
    &lt; &gt;   GPIO-based bitbanging SPI Master
    &lt;*&gt;   McSPI driver for OMAP24xx/OMAP34xx
    &lt; &gt;   Xilinx SPI controller common module
    ...</pre>
<ul><li>Add the touch controller configuration values in board file (e.g. board-omap3evm.c).</li></ul>
<pre>static struct ads7846_platform_data ads7846_config = {
        .x_max                  = 0x0fff,
        .y_max                  = 0x0fff,
        .x_plate_ohms           = 180,
        .pressure_max           = 255,
        .debounce_max           = 10,
        .debounce_tol           = 3,
        .debounce_rep           = 1,
        .get_pendown_state      = ads7846_get_pendown_state,
        .keep_vref_on           = 1,
        .settle_delay_usecs     = 150,
        .wakeup                 = true,
};
</pre>
<h3><span class="mw-headline" id="Test_touch_driver_using_getevent">Test touch driver using getevent</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=86" title="Edit section: Test touch driver using getevent">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Once Touchscreen and SPI driver is up through board file (e.g. board-omap3evm.c) configuration.</li>
<li>Test with AndroidFS as events are coming while touching the LCD display. Run on command prompt:</li></ul>
<pre>    # getevent
    add device 1: /dev/input/event1
      name:     "ADS7846 Touchscreen"

    /dev/input/event1: 0001 014a 00000001
    /dev/input/event1: 0003 0000 0000089e
    /dev/input/event1: 0003 0001 000005fe
    /dev/input/event1: 0003 0018 0000004f
    /dev/input/event1: 0000 0000 00000000
    </pre>
<ul><li>It confirms that touch inputs and irq based event generation is working fine.</li></ul>
<h3><span class="mw-headline" id="Touch_Calibration">Touch Calibration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=87" title="Edit section: Touch Calibration">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Touch inputs (x, y, pressure) need to calibrate based on touch controller used.</li>
<li>To define the touch input boundaries, the following macros are used in driver (e.g. drivers/input/touchscreen/ads7846.c)
<ul><li><b>OMAP3EVM_XMIN</b> -- Minimum raw x input possible</li>
<li><b>OMAP3EVM_XMAX</b> -- Maximum raw x input possible</li>
<li><b>OMAP3EVM_YMIN</b> -- Minimux raw y input possible</li>
<li><b>OMAP3EVM_YMAX</b> -- Maximum raw y input possible</li></ul></li>
<li>add the log to get print of x, y and pressure values as raw and absolute both in function <b>ads7846_report_state()</b>:</li></ul>
<pre>		printk("raw input x=%d y%d pressure=%d \n", x, y, Rt);
#ifdef CONFIG_MACH_OMAP3EVM
                x = pdata-&gt;x_max -
                        ((pdata-&gt;x_max * (x - OMAP3EVM_XMIN)) / (OMAP3EVM_XMAX- OMAP3EVM_XMIN));
                y = pdata-&gt;y_max -
                        ((pdata-&gt;y_max * (y - OMAP3EVM_YMIN)) / (OMAP3EVM_YMAX - OMAP3EVM_YMIN));
#endif
		printk("abs input x=%d y%d pressure=%d \n", x, y, Rt);
</pre>
<ul><li>Get the debug log for x, y and pressure at following points on the touchscreen
<ul><li>Left Top Most Point</li>
<li>Right Top Most Point</li>
<li>Left Bottom Down Point</li>
<li>Right Bottom Down Point</li></ul></li>
<li>Update the macros based on observation of above input points
<ul><li>set OMAP3EVM_XMIN value as "minimum x input possible value from the reading of left top most touch"</li>
<li>set OMAP3EVM_XMAX value as "maximum x input possible value from the reading of right top most touch"</li>
<li>set OMAP3EVM_YMIN value as "minimux y input possible value from the reading of left top most touch"</li>
<li>set OMAP3EVM_YMAX value as "maximum y input possible value from the reading of left bottom down touch"</li></ul></li></ul>
<p><i>Note:</i> Above four macros need to be fine tune to get the correct absolute value of x and y.
</p>
<ul><li>For example in ads7846.c:</li></ul>
<pre>#ifdef CONFIG_MACH_OMAP3EVM
#define OMAP3EVM_XMIN           0x136
#define OMAP3EVM_XMAX           0xe84
#define OMAP3EVM_YMIN           0x0d9
#define OMAP3EVM_YMAX           0xec6
#endif
</pre>
<p><span style="color: BLUE;"><b>Note:</b> sometimes calculation method return negative values. Then method needs some modification to get positive calculated touch inputs.</span> <br />
</p>
<h3><span class="mw-headline" id="Test_Touch_Calibration_in_Android">Test Touch Calibration in Android</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=88" title="Edit section: Test Touch Calibration in Android">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Run android on the board.</li>
<li>select "Menu" -&gt; "Dev Tools" -&gt; "Pointer Location" utility</li>
<li>Touch and draw on the screen and observe that the expected points are getting marked on the lcd screen.</li>
<li>if drawing on lcd is not proper then driver needs to be fine tune the above mentioned macros.<br /></li></ul>
<h2><span class="mw-headline" id="Improve_Touch_Screen_Sensitivity">Improve Touch Screen Sensitivity</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=89" title="Edit section: Improve Touch Screen Sensitivity">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Observations on the touch screen with touch controller ADS7846 shows that some of the gentle touches are not passed to the kernel input layer.<br />
</p><p>The following patch passes these ignored touch events to the input layer with a medium pressure value.<br />
</p>
<pre>--- a/drivers/input/touchscreen/ads7846.c
+++ b/drivers/input/touchscreen/ads7846.c
@@ -814,14 +814,20 @@ static void ads7846_report_state(struct ads7846 *ts)
                else
                        Rt = 0;
                dev_vdbg(&amp;ts-&gt;spi-&gt;dev, "x/y:&#160;%d/%d, PD&#160;%d\n", x, y, Rt);
-       } else if (likely(x &amp;&amp; z1)) {
+       } else if (likely(x)) {
                /* compute touch pressure resistance using equation #2 */
                Rt = z2;
                Rt -= z1;
                Rt *= x;
                Rt *= ts-&gt;x_plate_ohms;
-               Rt /= z1;
-               Rt = (Rt + 2047) &gt;&gt; 12;
+               if(z1&#160;!= 0) {
+                       Rt /= z1;
+                       Rt = (Rt + 2047) &gt;&gt; 12;
+               }
+               else {
+                       Rt = ts-&gt;pressure_max / 2;
+                       packet-&gt;tc.ignore = false;
+               }
        } else {
                Rt = 0;
        }</pre>
<p>NOTE: The above patch is experimental and should be used with caution.
</p>
<h1><span class="mw-headline" id="Keypad">Keypad</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=90" title="Edit section: Keypad">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_9">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=91" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The matrix keypad controller is TWL4030 with I2C interface (in OMAP35xEVM, AM37xEVM, BEAGLE, BEAGLE-XM) and IO expanded keypad controller is TCA6416 with I2C interface (in AM3517EVM). Here porting explanation for matrix keypad controller.
</p>
<h2><span class="mw-headline" id="Features_Overview_9">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=92" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>8x8 matrix key layout support</li>
<li>single click input</li></ul>
<h2><span class="mw-headline" id="Driver_Configuration_9">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=93" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><b>Add keypad driver support </b>
</p>
<ul><li>start the <i>Linux Kernel Configuration</i> tool:</li></ul>
<pre>    $ make ARCH=arm menuconfig
</pre>
<ul><li>Select <span style="color: BLUE;"><i>Device Drivers</i></span> from the main menu.</li></ul>
<pre>    ...
    Power management options ---&gt;
    [*] Networking support ---&gt;
    Device Drivers ---&gt;
    File systems ---&gt;
    Kernel hacking ---&gt;
    ...</pre>
<ul><li>Select <span style="color: BLUE;"><i>Input device support</i></span> form the next menu:</li></ul>
<pre>    ...
    [ ] ISDN support  ---&gt;
    &lt; &gt; Telephony support  ---&gt;
    Input device support  ---&gt;
    Character devices  ---&gt;
    -*- I2C support  ---&gt;
    ...</pre>
<ul><li>Select <span style="color: BLUE;"> <i>Keyboards</i> </span> from the next menu:</li></ul>
<pre>    ...
    &lt; &gt;   Reset key
          *** Input Device Drivers ***
    [*]   Keyboards  ---&gt;
    [ ]   Mice  ---&gt;
    [ ]   Joysticks/Gamepads  ---&gt;
....</pre>
<ul><li>Select <span style="color: BLUE;"> <i>TI TWL4030/TWL5030/TPS659x0 keypad support</i> </span> from the next menu:</li></ul>
<pre>    ....
    &lt; &gt;   Sun Type 4 and Type 5 keyboard
    &lt;*&gt;   TI TWL4030/TWL5030/TPS659x0 keypad support
    &lt; &gt;   XT keyboard
....</pre>
<p><b>Test keypad driver using getevent </b>
</p>
<ul><li>Once matrix keypad and I2C driver is up through board file (e.g. board-omap3evm.c) configuration.</li>
<li>Test with AndroidFS as events are coming while pressing the keys. Run on command prompt:</li></ul>
<pre>    # getevent
    add device 0: /dev/input/event0
      name:     "TWL4030 Keypad"

    /dev/input/event0: 0001 001c 00000001
    /dev/input/event0: 0000 0000 00000000
    /dev/input/event0: 0001 001c 00000000
    /dev/input/event0: 0000 0000 00000000
    </pre>
<ul><li>It confirms that keypad inputs and irq based event generation is working fine.</li></ul>
<h2><span class="mw-headline" id="Android_Keypad_Configuration">Android Keypad Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=94" title="Edit section: Android Keypad Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>The &lt;matrix keypad driver name&gt;.kl (e.g. TWL4030_Keypad.kl) should be present in root directory of AndroidFS.</li>
<li>Check and confirm the key mappings are same as expected.</li></ul>
<p><br />
</p>
<h1><span class="mw-headline" id="NAND">NAND</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=95" title="Edit section: NAND">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_10">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=96" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section of porting guide will describe the NAND layout present on EVMs and how to integrate Fastboot functionality in u-boot. Micron Nand part (OMAP35x and AM3517) and Hynix Nand part (AM37x) are supported.
</p><p><b>NAND Layout</b>
</p><p>The NAND on the EVM has been configured in the following manner.
</p>
<pre> +------------+--&gt;0x00000000-&gt; X-loader start
 |            |
 |            |--&gt;0x0007FFFF-&gt; X-loader end
 |            |--&gt;0x00080000-&gt; U-Boot start
 |            |
 |            |--&gt;0x001BFFFF-&gt; U-Boot end
 |            |--&gt;0x001C0000-&gt; ENV start
 |            |
 |            |
 |            |--&gt;0x0027FFFF-&gt; ENV end
 |            |--&gt;0x00280000-&gt; Linux Kernel start
 |            |
 |            |
 |            |
 |            |
 |            |--&gt;0x0077FFFF-&gt; Linux Kernel end
 |            |--&gt;0x00780000-&gt; Filesystem start
 |            |
 |            |
 |            |
 |            |
 |            |
 |            |
 |            |
 |            |
 +------------+--&gt;0x20000000-&gt; Filesystem end
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Features_Overview_10">Features Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=97" title="Edit section: Features Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><br />
</p>
<h2><span class="mw-headline" id="Driver_Configuration_10">Driver Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=98" title="Edit section: Driver Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Start the Kernel configuration tool to enable/disable NAND and UBIFS support:</li></ul>
<pre>$ make menuconfig ARCH=arm
</pre>
<ul><li>Enable NAND support from the main menu. Select Device Drivers -&gt; MTD support -&gt; NAND support.</li></ul>
<pre>-&gt; Device Drivers
   -&gt; Memory Technology Device (MTD) support (MTD [=y])
      -&gt; NAND Device Support (MTD_NAND [=y])
</pre>
<ul><li>Enable UBI support. Select Device Drivers -&gt; MTD support -&gt; Enable UBI.</li></ul>
<pre>-&gt; Device Drivers
   -&gt; Memory Technology Device (MTD) support (MTD [=y])
      -&gt; Enable UBI - Unsorted block images (MTD_UBI [=y])
</pre>
<ul><li>Enable UBIFS support. Select Filesystems -&gt; Misc filesystems -&gt; UBIFS support.</li></ul>
<pre>-&gt; File systems
   -&gt; Miscellaneous filesystems (MISC_FILESYSTEMS [=y])
      -&gt; UBIFS file system support (UBIFS_FS [=y])
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Fastboot">Fastboot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=99" title="Edit section: Fastboot">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Fastboot flashing utility is for updating the different software components of Android. Here is a guide to reflash the xloader, u-boot, kernel and root-filesystem (UBIFS image). This guide assume that Rowboat has been compiled before trying out these instructions.
</p>
<h3><span class="mw-headline" id="Establishing_Fastboot_connectivity">Establishing Fastboot connectivity</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=100" title="Edit section: Establishing Fastboot connectivity">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Connect serial port to host PC via null modem cable.</li>
<li>Serial port settings: 115200 8N1, No flow control.</li>
<li>Apply power to the board.</li>
<li>Press any key in serial port utility during boot and get U-boot command prompt.</li>
<li>Run "fastboot" on u-boot command prompt (u-boot will echo "fastboot initialized").</li>
<li>Connect USB cable between USB OTG port of the board and host PC.</li></ul>
<p><b> Setup on linux host </b>
</p>
<ul><li>On command prompt, run</li></ul>
<pre>   $ export ANDROID_ROOT=&lt;rowboat top level directory&gt;
</pre>
<pre>   $ cd $ANDROID_ROOT/out/host/linux-x86/bin
</pre>
<pre>   $ sudo ./fastboot devices
</pre>
<p>if a device number is echoed, fastboot is working.
</p><p><b> Setup on Windows host </b>
</p>
<ul><li>Refer <a rel="nofollow" class="external text" href="TI-Android-FroYo-DevKit-V2_UserGuide.html#adb_over_USB_on_Windows_Machine">ADB over USB on Windows Machine</a></li>
<li>Edit android_winusb.inf - under section [Google.NTx86], add line as below:</li></ul>
<pre>  &#160;%SingleBootLoaderInterface% = USB_Install, USB\VID_0451
</pre>
<ul><li>Proceed installing, with the difference that device to be selected is "Android Bootloader Interface" instead of "Android ADB Interface".</li></ul>
<h3><span class="mw-headline" id="Supported_Fastboot_commands">Supported Fastboot commands</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=101" title="Edit section: Supported Fastboot commands">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<pre>   $ export ANDROID_ROOT=&lt;rowboat_top_level_build_directory&gt;
</pre>
<pre>   $ cd $ANDROID_ROOT/out/host/linux-x86/bin
</pre>
<ul><li>List connected devices</li></ul>
<pre>   $ sudo ./fastboot devices
</pre>
<ul><li>Update <i>images</i>.</li></ul>
<pre>   $ sudo ./fastboot flash image_name &lt;image_path&gt;
</pre>
<ul><li>Erasing <i>images</i> or partition.</li></ul>
<pre>   $ sudo ./fastboot erase &lt;partition name&gt; (eg. xloader)
</pre>
<ul><li>Display fastboot variable</li></ul>
<pre>   $ sudo ./fastboot getvar &lt;variable&gt;
</pre>
<ul><li>Exit fastboot mode in uboot</li></ul>
<pre>   $ sudo ./fastboot continue
</pre>
<p><b>Important</b>
</p>
<ul><li>AM3517evm u-boot doesn't support Full Speed USB mode(USB 1.1) and it expects HOST machine USB port to be High Speed USB (USB 2.0).</li></ul>
<h3><span class="mw-headline" id="Fastboot_Porting_guide">Fastboot Porting guide</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=102" title="Edit section: Fastboot Porting guide">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Fastboot implementation have a generic board independent function driver (cmd_fastboot.c), which will communicate with USB gadget driver, in the present case USB gadget stack is handled by MUSB driver. In the board dependent files, configurations like the available partition name, offset, size, method of <i>nand write</i> etc are defined.
</p><p>In the <i>Config file</i>:
</p>
<ul><li>Enable CONFIG_FASTBOOT</li>
<li>Enable CONFIG_MUSB_UDC, disable CONFIG_MUSB_HCD (assumption: gadget driver used is MUSB)</li>
<li>Enable CONFIG_CMD_FASTBOOT</li>
<li>Define CONFIG_FASTBOOT_TRANSFER_BUFFER (location to which fastboot data has to be downloaded)</li>
<li>Define CONFIG_FASTBOOT_TRANSFER_BUFFER_SIZE (maximum fastboot data that can be downloaded, make sure it does not overlap bootloader memory)</li>
<li>Define FASTBOOT_NAND_BLOCK_SIZE</li>
<li>Define FASTBOOT_NAND_OOB_SIZE</li>
<li>Define FASTBOOT_PRODUCT_NAME, make sure that string is same as value of TARGET_PRODUCT used for compiling Android</li>
<li>Define USB_BCD_VERSION to 0x0200, if HS USB support is required</li></ul>
<p>In the <i>Board file</i>:
</p>
<ul><li>Add header file - fastboot.h</li>
<li>Define "struct fastboot_ptentry" array with entries equal to the number of partitions required</li>
<li>Each entry to have name - this is the variable used for flashing, erasing.</li>
<li>Each entry to provide NAND start address &amp; length</li>
<li>Each entry to specify flags, options as follows,</li>
<li>FASTBOOT_PTENTRY_FLAGS_WRITE_HW_ECC - flash the partition using HW ECC</li>
<li>FASTBOOT_PTENTRY_FLAGS_HW_ECC_LAYOUT_1 - Sets the NANDECC to use Kernel/FS layout for writing</li>
<li>FASTBOOT_PTENTRY_FLAGS_HW_ECC_LAYOUT_2 - Sets the NANDECC to use X-loader/U-boot layout for writing</li>
<li>FASTBOOT_PTENTRY_FLAGS_WRITE_SW_ECC - flash the partition using SW ECC</li>
<li>FASTBOOT_PTENTRY_FLAGS_WRITE_I - Use write.i for NAND write</li>
<li>FASTBOOT_PTENTRY_FLAGS_WRITE_JFFS2 - Use write.jffs2 for NAND write</li>
<li>FASTBOOT_PTENTRY_FLAGS_WRITE_ENV - Add this flag to indicate to fastboot driver the partition for storing environmental variable</li>
<li>FASTBOOT_PTENTRY_FLAGS_REPEAT_4 - Use this to indicate that partition will be written 4 times</li>
<li>Additional flags can be defined to write till 15 times, last 4 bits are reserved for repeat value, Define required value &amp; OR the value in flag</li>
<li>Invoke fastboot API, ' fastboot_flash_add_ptn' for each partition so as to inform about the partition details to fastboot driver.</li></ul>
<p><i>Notes</i>
</p>
<ul><li>Existing USB gadget supported only FS, this was modified so that HS USB can be handled. Changes were done in USB header files, MUSB files.</li>
<li>AM35X was having problems due to the wrapper over MUSB IP. Fix in MUSB UDC; read TI EP interrupt register instead of MUSB register.</li>
<li>A fix with respect to the index for EP array has also been done.</li>
<li>MUSB EP setup has been modified to be more in line with the USB TRM.</li>
<li>Portions of the code that has been ported from OmapZoom is included within the macro FASTBOOT_PORT_OMAPZOOM_NAND_FLASHING.</li></ul>
<p><br />
</p>
<h1><span class="mw-headline" id="Sensors">Sensors</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=103" title="Edit section: Sensors">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_11">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=104" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section of guide provides a step by step explanation of what's involved in adding/porting sensors in a custom Android build like Rowboat.
</p>
<h2><span class="mw-headline" id="Accelerometer">Accelerometer</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=105" title="Edit section: Accelerometer">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Android_sensor_sub_system_overview">Android sensor sub system overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=106" title="Edit section: Android sensor sub system overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><a href="File_AndroidSensor.html" class="image" title="AndroidSensor.jpg"><img alt="AndroidSensor.jpg" src="https://processors.wiki.ti.com/images/2/2c/AndroidSensor.jpg" width="640" height="480" /></a>
</p><p>Above diagram shows the android subsystem overview.
</p>
<ul><li>Application Framework
<ul><li>Sensor Applications use the Sensor application framework to get the sensor data. It communicates with C++ layer through sensor Java native interface (JNI)</li></ul></li>
<li>Sensor Libraries
<ul><li>Sensor middle layer mainly consists of Sensor Manager, Sensor service and Sensor hardware abstraction layer.</li></ul></li>
<li>Input Subsystem
<ul><li>This is a generic Linux framework for all input devices like keyboard, mouse, touchscreen and defines a standard set of events. It interfaces to user space through /sys/class/input interface.</li></ul></li>
<li>Evdev
<ul><li>Evdev provides a generic way for input device events to be accessible under /dev/input/eventX .</li></ul></li>
<li>LIS331DLH Accelerometer Driver
<ul><li>This driver communicates with LIS331DLH accelerometer chip via GPIO and I2C bus. GPIO line is used for generating interrupts while I2C bus for accessing and configuring accelerometer registers.</li></ul></li></ul>
<h3><span class="mw-headline" id="Driver_porting">Driver porting</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=107" title="Edit section: Driver porting">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>On AM37x Flashboard Accelerometer(LIS331DLH) is connected to I2C 1 bus. Its relevant initialization and pin-muxing is done at &lt;kernel&gt;/arch/arm/mach-omap2/board-omap3evm.c file.
</p>
<h4><span class="mw-headline" id="Modify_LIS331DLH_data_structure">Modify LIS331DLH data structure</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=108" title="Edit section: Modify LIS331DLH data structure">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Modify the following structure to change the axes directions (negate_x, negate_y, negate_x) and axis mapping (axis_map_x, axis_map_y, axis_map_z).
This can be used to calibrate the sensor.
</p>
<pre>  struct lis331dlh_platform_data <b>lis331dlh_omap3evm_data</b> = {
       .min_interval = 1,
       .poll_interval = 200,
       .g_range = LIS331DLH_G_8G,
       .axis_map_x = 0,
       .axis_map_y = 1,
       .axis_map_z = 2,
       .negate_x = 0,
       .negate_y = 0,
       .negate_z = 0,
  };
</pre>
<h4><span class="mw-headline" id="Add_I2C_board_info_structure">Add I2C board info structure</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=109" title="Edit section: Add I2C board info structure">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>On Flashboard accelerometer is connected to I2C 1. If your sensor is interfaced on different I2C bus then please do the following changes to your board file.
</p>
<pre>  static struct i2c_board_info __initdata omap3evm_i2c_<b>x</b>_boardinfo[] = {
     {
             I2C_BOARD_INFO("lis331dlh", 0x18),
             .platform_data = &amp;lis331dlh_omap3evm_data,
     },
  };
</pre>
<p>Where 0x18 is the lis331dlh chip address. Please change this address corresponding to your chip address.
</p>
<h4><span class="mw-headline" id="Register_i2c_bus">Register i2c bus</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=110" title="Edit section: Register i2c bus">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Register I2C bus with the i2c sub-system.
</p>
<pre>  static int __init omap3_evm_i2c_init(void)
  {
       .
       .
       omap_register_i2c_bus(<b>x</b>, 100, omap3evm_i2c_<b>x</b>_boardinfo, ARRAY_SIZE(omap3evm_i2c_<b>x</b>_boardinfo));
       .
       .
       return 0;
  }
</pre>
<pre>  Note: where x is i2c bus number.
</pre>
<h4><span class="mw-headline" id="Interrupt_line_modification">Interrupt line modification</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=111" title="Edit section: Interrupt line modification">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>on Flash board accelerometer interrupt line is connected to GPIO 42.Please change the following if your accelerometer interrupt line is connected to different GPIO.
</p>
<h5><span class="mw-headline" id="Pin_mux_change_in_board_configuration_file">Pin mux change in board configuration file</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=112" title="Edit section: Pin mux change in board configuration file">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Add following line to <b>omap36x_board_mux</b> structure to arch/arm/mach-omap2/board-omap3evm.c file.
</p>
<pre>  static struct omap_board_mux omap36x_board_mux[] __initdata = {
  {
      .
      .
      //Ex: Pin mux for GPIO 42.
      <b>OMAP3_MUX(GPMC_A9, OMAP_MUX_MODE4 | OMAP_PIN_INPUT_PULLUP),</b>
  }
</pre>
<pre>  Note: Please change OMAP3_MUX arguments as per your GPIO No.
</pre>
<h5><span class="mw-headline" id="LIS331DLH_driver_file_modification">LIS331DLH driver file modification</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=113" title="Edit section: LIS331DLH driver file modification">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>LIS331DLH accelerometer driver is located at &lt;kernel&gt;/driver/misc/lis331dlh.c file. Change the following macro for your interrupt gpio number.
</p>
<pre>  #define LIS331DLH_INT2_GPIO     GPIO_NO
</pre>
<h3><span class="mw-headline" id="Test_Accelerometer_driver">Test Accelerometer driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=114" title="Edit section: Test Accelerometer driver">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Enable Accelerometer sensor.
</p>
<pre>  #cat 1 &gt; /sys/bus/i2c/drivers/lis331dlh/1-0018/enable
</pre>
<pre>  Note: Please ckeck appropriate sysfs path as per your driver
</pre>
<p>Use getevent command to see accelerometer events
</p>
<pre>  #getevent
     add device 2: /dev/input/event2
     name:     "Acceleromter"
     /dev/input/event2: 0001 014a 00000001
     /dev/input/event2: 0003 0000 0000089e
     /dev/input/event2: 0003 0001 000005fe
</pre>
<h3><span class="mw-headline" id="Android_hardware_abstraction_layer">Android hardware abstraction layer</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=115" title="Edit section: Android hardware abstraction layer">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Sensor hardware abstraction layer (HAL) is located in &lt;android source&gt;/hardware/ti/omap3/libsensors directory.
</p>
<h4><span class="mw-headline" id="Adding_new_sensor_support_in_android_HAL_Ex:_Accelerometer">Adding new sensor support in android HAL Ex: Accelerometer</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=116" title="Edit section: Adding new sensor support in android HAL Ex: Accelerometer">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<h5><span class="mw-headline" id="Implement_a_sensor_class">Implement a sensor class</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=117" title="Edit section: Implement a sensor class">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Accelerometer sensor class in implemented in AccelSensor.h and AccelSensor.cpp file.
</p>
<pre>  class AccelSensor&#160;: public SensorBase {
       int mEnabled;
       .
       .
       int setInitialState();
</pre>
<pre>   public:
</pre>
<pre>       AccelSensor();
       virtual ~AccelSensor();
       <b>virtual int readEvents(sensors_event_t* data, int count);</b>
       <b>virtual bool hasPendingEvents() const;</b>
       <b>virtual int setDelay(int32_t handle, int64_t ns);</b>
       <b>virtual int enable(int32_t handle, int enabled);</b>
   };
</pre>
<h5><span class="mw-headline" id="Add_new_sensor_support">Add new sensor support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=118" title="Edit section: Add new sensor support">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Add new sensor support in sensors.cpp file.
</p>
<ul><li>Add  new sensor to sSensorList Structure</li></ul>
<pre>  /* The SENSORS Module */
  static const struct sensor_t sSensorList[] = {
  .
  .
 <b> { "VTI 3 axis accelerometer",</b>
   <b> "VTI",</b>
  <b>  1, SENSORS_ACCELERATION_HANDLE,</b>
    <b>SENSOR_TYPE_ACCELEROMETER, RANGE_A, RESOLUTION_A, 0.23f, 20000, { } },</b>
  };
</pre>
<ul><li>Create object of new sensor</li></ul>
<pre>  sensors_poll_context_t::sensors_poll_context_t()
  {
       .
       .
       <b>mSensors[accel] = new AccelSensor();</b>
       <b>mPollFds[accel].fd = mSensors[accel]-&gt;getFd();</b>
       <b>mPollFds[accel].events = POLLIN;</b>
       <b>mPollFds[accel].revents = 0;</b>
       .
       .
       int wakeFds[2];
       int result = pipe(wakeFds);
       LOGE_IF(result&lt;0, "error creating wake pipe (%s)", strerror(errno));
       fcntl(wakeFds[0], F_SETFL, O_NONBLOCK);
       fcntl(wakeFds[1], F_SETFL, O_NONBLOCK);
       mWritePipeFd = wakeFds[1];
</pre>
<pre>       mPollFds[wake].fd = wakeFds[0];
       mPollFds[wake].events = POLLIN;
       mPollFds[wake].revents = 0;
</pre>
<pre> }
</pre>
<p><br />
</p>
<ul><li>Update sensors_poll_context_t structure and add new sensor case to handleToDriver function.</li></ul>
<pre>  struct sensors_poll_context_t {
      struct sensors_poll_device_t device; // must be first
      .
      .
  private:
      enum {
           <b>accel           = 0,</b>
           light           = 1,
           proximity       = 2,
           press_temp      = 3,
           numSensorDrivers,
           numFds,
      };
</pre>
<p><br />
</p>
<pre>   int handleToDriver(int handle) const {
           switch (handle) {
                    <b>case ID_A:</b>
                           <b>return accel;</b>
                       .
                       .
       }
           return -EINVAL;
   }
</pre>
<h3><span class="mw-headline" id="Calibration_methods">Calibration methods</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=119" title="Edit section: Calibration methods">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div class="center"><div class="floatnone"><a href="File_Axis_device.html" class="image" title="Axis device.png"><img alt="Axis device.png" src="https://processors.wiki.ti.com/images/3/35/Axis_device.png" width="225" height="269" /></a></div></div>
<p>The sensor coordinate-system is defined relative to the screen of the device in its default orientation.The X axis is horizontal and points to the right, the Y axis is vertical and points up and the Z axis points towards the outside of the front face of the screen. Co-ordinates behind the screen have negative Z values.
</p><p>The sensor calibration involves
</p>
<ul><li>Changing axes directions and swapping axes as per device default orientation.</li>
<li>Zero calibration</li></ul>
<h4><span class="mw-headline" id="Changing_axes_directions_and_swapping_axes">Changing axes directions and swapping axes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=120" title="Edit section: Changing axes directions and swapping axes">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>A sensor in a steady state on a horizontal surface should measure 0 g in X axis and 0 g in Y axis whereas the Z axis will measure 1 g(9.8).
</p>
<ul><li>Identifying whether to swap axes:
<ul><li>Run a standard sensor application which displays the sensor readings and monitor sensor readings.</li>
<li>Point a x-axis towards ground and check whether x-axis reading is getting changed. If some other axis (let's say y-axis) reading is getting changed then you need to swap axes (i.e. treat sensor y-axis as x-axis in software).</li>
<li>Similarly record point other axes towards ground and swap if required.</li></ul></li></ul>
<ul><li>Identifying whether to change axes directions</li></ul>
<p>The axes direction can be verified by pointing the axis of interest towards the ground, noting the output value, rotating the sensor by 180 degrees (pointing to the sky) and noting the output value again. By doing so, ±1 g acceleration is applied to the sensor.
</p>
<ul><li><ul><li>Run a standard sensor application which displays the sensor readings and monitor sensor readings.</li>
<li>Point +x axis towards ground, you should get +g. If you are getting -g then change the direction of the axis.</li>
<li>Similarly point other axes towards ground and change direction if required.</li></ul></li></ul>
<p>This calibration method can be achieved by modifying the driver or android hardware abstraction layer.
</p>
<h5><span class="mw-headline" id="Driver_Modification">Driver Modification</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=121" title="Edit section: Driver Modification">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Accelerometer platform data structure is as follows.
</p>
<pre>  struct lis331dlh_platform_data lis331dlh_omap3evm_data = {
      .min_interval = 1,
      .poll_interval = 200,
      .g_range = LIS331DLH_G_8G,
      .axis_map_x = 0,
      .axis_map_y = 1,
      .axis_map_z = 2,
      .negate_x = 0,
      .negate_y = 0,
      .negate_z = 0,
  };
</pre>
<p>axis_map_x, axis_map_y, axis_map_z can be used to swap x, y and z axes. If axis_map_x is 0 then it will be mapped to x-axis in android, if it is 1 then it will be mapped to y axis in Android and so on.
</p><p>To change the axes direction we can set negate_x, negate_y and negate_z value to 1. If negate_x, negate_y and negate_z values are set to 1 then driver will negate accelerometer axes readings before passing to user space (Android).
</p>
<h5><span class="mw-headline" id="Android_HAL_modification">Android HAL modification</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=122" title="Edit section: Android HAL modification">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>This type of calibration can be achieved in Android HAL as well by modifying readEvents() function in &lt;android source&gt;/hardware/ti/omap3/libsensors/AccelSensor.cpp file.
</p>
<pre>  int AccelSensor::readEvents(sensors_event_t* data, int count)
  {
      .
      .
      while (count &amp;&amp; mInputReader.readEvent(&amp;event)) {
          int type = event-&gt;type;
          if (type == EV_ABS) {
              float value = event-&gt;value;
              if (event-&gt;code == EVENT_TYPE_ACCEL_Y) {
                  mPendingEvent.data[1] =  -(value * CONVERT_A_Y);
              } else if (event-&gt;code == EVENT_TYPE_ACCEL_X) {
                  mPendingEvent.data[0] = -(value * CONVERT_A_X);
              } else if (event-&gt;code == EVENT_TYPE_ACCEL_Z) {
                  mPendingEvent.data[2] = -(value * CONVERT_A_Z);
              }
     .
     .
     .
  }
</pre>
<p>data[<b>index</b>]: index can be changed to swap axes and value can be negated to change the axis direction.
</p>
<h4><span class="mw-headline" id="Accelerometer_zero_calibration">Accelerometer zero calibration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=123" title="Edit section: Accelerometer zero calibration">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>When the device rests on a level surface, X and Y should measure around 0 g where as Z axis should measure 1 g (9.8). The accelerometer can be zero calibrated i.e. adjusted so that the acceleration reads zero at the current acceleration of the device.
</p><p>Procedure for zero calibration:
</p>
<ul><li>Run a standard sensor application and monitor readings.</li>
<li>Take the accelerometer x,y readings when device is in steady state on a horizontal surface.</li>
<li>Ideally x, y readings should be zero. if it is not the case then save x, y readings in dx and dy variables.</li>
<li>Substact dx and dy from data[0], data[1] values for zero calibration.</li>
<li>For z-axis calibration, place the device in a steady state perpendicular to the surface.</li>
<li>Ideally z-axis reading should be zero. If you are not getting zero reading, save z axis reading in dz variable substact dz from data[2].</li></ul>
<p>Lets say you are geting x=1.3 and y=1.7 when device is in steady state on a horizontal surface and z=1.4 when device is in a steady state perpendicular to the surface. Modify the readEvents() function in &lt;android source&gt;/hardware/ti/omap3/libsensors/AccelSensor.cpp file as below.
</p>
<pre>  int AccelSensor::readEvents(sensors_event_t* data, int count)
  {
      <b>float dx=1.3, dy=1.7, dz=1.4;</b>
      .
      .
      while (count &amp;&amp; mInputReader.readEvent(&amp;event)) {
          int type = event-&gt;type;
          if (type == EV_ABS) {
              float value = event-&gt;value;
              if (event-&gt;code == EVENT_TYPE_ACCEL_Y) {
                  mPendingEvent.data[1] =  -(value * CONVERT_A_Y)<b> - dy</b>;
              } else if (event-&gt;code == EVENT_TYPE_ACCEL_X) {
                  mPendingEvent.data[0] = -(value * CONVERT_A_X) <b>- dx</b>;
              } else if (event-&gt;code == EVENT_TYPE_ACCEL_Z) {
                  mPendingEvent.data[2] = -(value * CONVERT_A_Z) <b>- dz</b>;
              }
     .
     .
     .
  }
</pre>
<p><br />
Zero calibration can be achieved in application layer as well.Following links show examples for achieving zero calibration at application level.
</p><p><a rel="nofollow" class="external free" href="http://www.intuitor.com/student/Android Phone Site/StephanAccelerometerAndroid.php">http://www.intuitor.com/student/Android%20Phone%20Site/StephanAccelerometerAndroid.php</a>
</p><p><a rel="nofollow" class="external free" href="http://stuffthathappens.com/blog/2009/03/15/android-accelerometer/">http://stuffthathappens.com/blog/2009/03/15/android-accelerometer/</a>
</p>
<h3><span class="mw-headline" id="Important_files">Important files</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=124" title="Edit section: Important files">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Sensor Manager  Application Layer:   <b>&lt;android source&gt;/frameworks/base/core/java/android/hardware</b> folder</li>
<li>Sensor JNI layer:                    <b>&lt;android source&gt;/frameworks/base/core/jni/android_hardware_SensorManager.cpp</b> file</li>
<li>Sensor Manager Library:              <b>&lt;android source&gt;/frameworks/base/libs/gui</b> folder</li>
<li>Sensor Service:                      <b>&lt;android source&gt;/frameworks/base/services/sensorservice</b> folder</li>
<li>Sensor HAL:                          <b>&lt;android source&gt;/hardware/ti/omap3/libsensors</b> folder</li>
<li>Accelerometer Sensor driver:         <b>&lt;kernel&gt;/drivers/input/misc/lis331dlh.c</b> file</li></ul>
<h1><span class="mw-headline" id="Mass_storage">Mass storage</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=125" title="Edit section: Mass storage">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_12">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=126" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The Android system uses vold as the mount daemon which detects, mounts and monitors the status of external storage.This mount daemon needs a configuration file(vold.fstab) to determine the mount device and location where it should be mounted.<br />
Vold reads /etc/vold.fstab configuration file and mounts the device specified in the file.
The basic format of the vold.fstab is
</p>
<pre>  dev_mount &lt;label&gt; &lt;mount_point&gt; &lt;part&gt; &lt;sysfs_path1...&gt;
</pre>
<pre>  where
  label - Label for the volume
  mount_point - Where the volume will be mounted
  part - Partition # (1 based), or 'auto' for first usable partition.
  &lt;sysfs_path&gt; - List of sysfs paths to source devices
</pre>
<p>sysfs_path is the full or partial path where kernel exports the udev information about the device currently pluged into system.<br />
See system/core/rootdir/etc/vold.fstab in the Android source tree for the detailed explanations of the format.
</p>
<h2><span class="mw-headline" id="Beagleboard_example">Beagleboard example</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=127" title="Edit section: Beagleboard example">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>In case of Beagleboard-XM, Kernel populates udev entries in any one of the following paths based on the port to which external storage device is connected.
</p>
<pre>  /sys/devices/platform/ehci-omap.0/usb1/1-2/1-2.2/
  /sys/devices/platform/ehci-omap.0/usb1/1-2/1-2.3/
  /sys/devices/platform/ehci-omap.0/usb1/1-2/1-2.4/
  /sys/devices/platform/ehci-omap.0/usb1/1-2/1-2.5/
</pre>
<p>To detect connected usb mass storage device and mount/unmount it automatically when pluged/unpluged, follow below mentioned procedure.
</p><p>1. Modify vold.fstab file as per following patch
</p>
<pre>   diff --git a/vold.fstab b/vold.fstab
   index fc83907..2ace73f 100644
   --- a/vold.fstab
   +++ b/vold.fstab
   @@ -1,2 +1,6 @@
   dev_mount sdcard /mnt/sdcard auto /devices/platform/mmci-omap-hs.0/mmc_host/mmc0
   +dev_mount usb /mnt/usb2 auto /devices/platform/ehci-omap.0/usb1/1-2/1-2.2/
   +dev_mount usb /mnt/usb3 auto /devices/platform/ehci-omap.0/usb1/1-2/1-2.3/
   +dev_mount usb /mnt/usb4 auto /devices/platform/ehci-omap.0/usb1/1-2/1-2.4/
   +dev_mount usb /mnt/usb5 auto /devices/platform/ehci-omap.0/usb1/1-2/1-2.5/

</pre>
<p>2. Modify init.rc file as per following patch
</p>
<pre>diff --git a/init.rc b/init.rc
index 4585248..b1a38f2 100644
--- a/init.rc
+++ b/init.rc
@@ -23,6 +23,10 @@ loglevel 3
 # create mountpoints
     mkdir /mnt 0775 root system
     mkdir /mnt/sdcard 0000 system system
+    mkdir /mnt/usb2 0000 system system
+    mkdir /mnt/usb3 0000 system system
+    mkdir /mnt/usb4 0000 system system
+    mkdir /mnt/usb5 0000 system system

 # Create cgroup mount point for cpu accounting
     mkdir /acct
@@ -31,6 +35,10 @@ loglevel 3

 # Backwards Compat - XXX: Going away in G*
     symlink /mnt/sdcard /sdcard
+    symlink /mnt/usb2 /usb2
+    symlink /mnt/usb3 /usb3
+    symlink /mnt/usb4 /usb4
+    symlink /mnt/usb5 /usb5

     mkdir /system
     mkdir /data 0771 system system
</pre>
<h2><span class="mw-headline" id="Test_Mass_storage_in_Android">Test Mass storage in Android</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=128" title="Edit section: Test Mass storage in Android">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Connect USB mass storage device to board and check whether it is mounted properly.
</p>
<ul><li>Use mount command to see the list of mount points. Here is the sample output of mount command.</li></ul>
<pre># mount

rootfs / rootfs rw 0 0
172.24.132.204:/home/workdir/TI_Android_GingerBread_2_3_Sources/out/target/product/beagleboard/android_rootfs / nfs rw,relatime,vers=3,rsize=262144,0
tmpfs /dev tmpfs rw,relatime,mode=755 0 0
devpts /dev/pts devpts rw,relatime,mode=600 0 0
proc /proc proc rw,relatime 0 0
sysfs /sys sysfs rw,relatime 0 0
tmpfs /mnt/asec tmpfs rw,relatime,mode=755,gid=1000 0 0
/dev/block/mmcblk0p3 /part-3 vfat rw,relatime,fmask=0000,dmask=0000,allow_utime=0022,codepage=cp437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro 00
/dev/block/vold/179:3 /mnt/sdcard vfat rw,nosuid,nodev,noexec,relatime,fmask=0000,dmask=0000,allow_utime=0022,codepage=cp437,iocharset=iso8859-1,shortname=0
/dev/block/vold/179:3 /mnt/secure/asec vfat rw,nosuid,nodev,noexec,relatime,fmask=0000,dmask=0000,allow_utime=0022,codepage=cp437,iocharset=iso8859-1,short0
tmpfs /mnt/sdcard/.android_secure tmpfs ro,relatime,size=0k,mode=000 0 0
/dev/block/vold/8:17 /mnt/usb4 vfat rw,dirsync,nosuid,nodev,noexec,relatime,uid=1000,gid=1015,fmask=0702,dmask=0702,allow_utime=0020,codepage=cp437,iochars0
/dev/block/vold/8:17 /mnt/secure/asec vfat rw,dirsync,nosuid,nodev,noexec,relatime,uid=1000,gid=1015,fmask=0702,dmask=0702,allow_utime=0020,codepage=cp437,0
tmpfs /mnt/usb4/.android_secure tmpfs ro,relatime,size=0k,mode=000 0 0
/dev/block/vold/8:1 /mnt/usb2 vfat rw,dirsync,nosuid,nodev,noexec,relatime,uid=1000,gid=1015,fmask=0702,dmask=0702,allow_utime=0020,codepage=cp437,iocharse0
/dev/block/vold/8:1 /mnt/secure/asec vfat rw,dirsync,nosuid,nodev,noexec,relatime,uid=1000,gid=1015,fmask=0702,dmask=0702,allow_utime=0020,codepage=cp437,i0
tmpfs /mnt/usb2/.android_secure tmpfs ro,relatime,size=0k,mode=000 0 0
</pre>
<ul><li>Run file manager application and see whether usb2, usb3, usb4 and usb5 directories are populated with appropriate files and directories.</li></ul>
<p><a href="File_AndroidFileManager.html" class="image"><img alt="AndroidFileManager.png" src="https://processors.wiki.ti.com/images/2/21/AndroidFileManager.png" width="640" height="480" /></a>
</p>
<h1><span class="mw-headline" id="Versioning">Versioning</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=129" title="Edit section: Versioning">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>This is Release DevKit-V2.1 The release is available from <a rel="nofollow" class="external free" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_tii/TI_Android_DevKit/TI_Android_GingerBread_2_3_4_DevKit_2_1/index_FDS.html">http://software-dl.ti.com/dsps/dsps_public_sw/sdo_tii/TI_Android_DevKit/TI_Android_GingerBread_2_3_4_DevKit_2_1/index_FDS.html</a>
<br />
The release notes is available at <a rel="nofollow" class="external free" href="TI-Android-GingerBread-2.3.4-DevKit-4.html">http://processors.wiki.ti.com/index.php/TI-Android-GingerBread-2.3.4-DevKit-2.1_ReleaseNotes</a>
<br />
</p>
<h1><span class="mw-headline" id="Technical_Support_and_Product_Updates">Technical Support and Product Updates</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;section=130" title="Edit section: Technical Support and Product Updates">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>For further information or to report any problems, contact <a rel="nofollow" class="external free" href="http://e2e.ti.com/android">http://e2e.ti.com/android</a> or <a rel="nofollow" class="external free" href="http://support.ti.com/">http://support.ti.com</a>. <br /> For community support join <a rel="nofollow" class="external free" href="http://groups.google.com/group/rowboat">http://groups.google.com/group/rowboat</a> <br /> For IRC #rowboat on irc.freenode.net <br />
</p>
<!-- 
NewPP limit report
Cached time: 20201130131150
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.235 seconds
Real time usage: 0.244 seconds
Preprocessor visited node count: 1404/1000000
Preprocessor generated node count: 2488/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 24147/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:10791-0!canonical and timestamp 20201130131150 and revision id 182413
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>TI-Android-GingerBread-2.3.4-DevKit-2.1 PortingGuides</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;oldid=182413">https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;oldid=182413</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Categories</a>: <ul><li><a href="Category_OMAP35x.html" title="Category:OMAP35x">OMAP35x</a></li><li><a href="Category_AM37x.html" title="Category:AM37x">AM37x</a></li><li><a href="Category_BeagleBoard.html" title="Category:BeagleBoard">BeagleBoard</a></li><li><a href="Category_Android.html" title="Category:Android">Android</a></li><li><a href="Category_Sitara_Android.html" title="Category:Sitara Android">Sitara Android</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=TI-Android-GingerBread-2.3.4-DevKit-2.1+PortingGuides" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="TI-Android-GingerBread-2.3.4-DevKit-3.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="TI-Android-GingerBread-2.3.4-DevKit-3.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/TI-Android-GingerBread-2.3.4-DevKit-3.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/TI-Android-GingerBread-2.3.4-DevKit-3.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;oldid=182413" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 28 July 2014, at 03:58.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.235","walltime":"0.244","ppvisitednodes":{"value":1404,"limit":1000000},"ppgeneratednodes":{"value":2488,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":24147,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20201130131150","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":237});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/TI-Android-GingerBread-2.3.4-DevKit-2.1_PortingGuides by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 04:15:33 GMT -->
</html>
