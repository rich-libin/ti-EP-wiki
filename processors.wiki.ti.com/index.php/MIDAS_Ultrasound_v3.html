<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/MIDAS_Ultrasound_v3.0_Demo by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 13:11:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>MIDAS Ultrasound v3.0 Demo - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"MIDAS_Ultrasound_v3.0_Demo","wgTitle":"MIDAS Ultrasound v3.0 Demo","wgCurRevisionId":88935,"wgRevisionId":88935,"wgArticleId":9890,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"MIDAS_Ultrasound_v3.0_Demo","wgRelevantArticleId":9890,"wgRequestId":"64646df6cbf70cbd82d5c2e4","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-MIDAS_Ultrasound_v3_0_Demo rootpage-MIDAS_Ultrasound_v3_0_Demo skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">MIDAS Ultrasound v3.0 Demo</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#MIDAS_Versions"><span class="tocnumber">1</span> <span class="toctext">MIDAS&#160;Versions</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Overview"><span class="tocnumber">2</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#GForge_Project_Page"><span class="tocnumber">3</span> <span class="toctext">GForge Project Page</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Software_Implementation"><span class="tocnumber">4</span> <span class="toctext">Software Implementation</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Multicore_DSP_.28Mid_End.29"><span class="tocnumber">4.1</span> <span class="toctext">Multicore DSP (Mid End)</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Functional_Overview"><span class="tocnumber">4.1.1</span> <span class="toctext">Functional Overview</span></a>
<ul>
<li class="toclevel-4 tocsection-7"><a href="#Mid_End_Controller"><span class="tocnumber">4.1.1.1</span> <span class="toctext">Mid End Controller</span></a></li>
<li class="toclevel-4 tocsection-8"><a href="#Front_End_Interface"><span class="tocnumber">4.1.1.2</span> <span class="toctext">Front End Interface</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#Mid_End_Processing"><span class="tocnumber">4.1.1.3</span> <span class="toctext">Mid End Processing</span></a></li>
<li class="toclevel-4 tocsection-10"><a href="#Back_End_Interface"><span class="tocnumber">4.1.1.4</span> <span class="toctext">Back End Interface</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-11"><a href="#CE_Implementation_Details"><span class="tocnumber">4.1.2</span> <span class="toctext">CE Implementation Details</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#Performance_Details"><span class="tocnumber">4.1.3</span> <span class="toctext">Performance Details</span></a>
<ul>
<li class="toclevel-4 tocsection-13"><a href="#Overheads_and_Related_Optimizations_in_Multi-core_Implementation"><span class="tocnumber">4.1.3.1</span> <span class="toctext">Overheads and Related Optimizations in Multi-core Implementation</span></a></li>
<li class="toclevel-4 tocsection-14"><a href="#Performance_Measurements"><span class="tocnumber">4.1.3.2</span> <span class="toctext">Performance Measurements</span></a></li>
<li class="toclevel-4 tocsection-15"><a href="#Summary"><span class="tocnumber">4.1.3.3</span> <span class="toctext">Summary</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-16"><a href="#System-on-Chip_.28Back_End.29"><span class="tocnumber">4.2</span> <span class="toctext">System-on-Chip (Back End)</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#Functional_Overview_2"><span class="tocnumber">4.2.1</span> <span class="toctext">Functional Overview</span></a>
<ul>
<li class="toclevel-4 tocsection-18"><a href="#Main"><span class="tocnumber">4.2.1.1</span> <span class="toctext">Main</span></a></li>
<li class="toclevel-4 tocsection-19"><a href="#Acquisition"><span class="tocnumber">4.2.1.2</span> <span class="toctext">Acquisition</span></a></li>
<li class="toclevel-4 tocsection-20"><a href="#Process"><span class="tocnumber">4.2.1.3</span> <span class="toctext">Process</span></a></li>
<li class="toclevel-4 tocsection-21"><a href="#Display"><span class="tocnumber">4.2.1.4</span> <span class="toctext">Display</span></a></li>
<li class="toclevel-4 tocsection-22"><a href="#Control_Thread"><span class="tocnumber">4.2.1.5</span> <span class="toctext">Control Thread</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-23"><a href="#DSP_Module_Integration"><span class="tocnumber">4.2.2</span> <span class="toctext">DSP&#160;Module Integration</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-24"><a href="#Get_Ultrasound_v3.0"><span class="tocnumber">5</span> <span class="toctext">Get Ultrasound v3.0</span></a>
<ul>
<li class="toclevel-2 tocsection-25"><a href="#Demo_Application_Source_Code"><span class="tocnumber">5.1</span> <span class="toctext">Demo Application Source Code</span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="#Hardware_Setup"><span class="tocnumber">5.1.1</span> <span class="toctext">Hardware Setup</span></a>
<ul>
<li class="toclevel-4 tocsection-27"><a href="#Requirements"><span class="tocnumber">5.1.1.1</span> <span class="toctext">Requirements</span></a></li>
<li class="toclevel-4 tocsection-28"><a href="#Procedure"><span class="tocnumber">5.1.1.2</span> <span class="toctext">Procedure</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-29"><a href="#Software_Setup"><span class="tocnumber">5.1.2</span> <span class="toctext">Software Setup</span></a>
<ul>
<li class="toclevel-4 tocsection-30"><a href="#A._Multicore_DSP_.28Mid_End.29"><span class="tocnumber">5.1.2.1</span> <span class="toctext">A. Multicore DSP&#160;(Mid End)</span></a></li>
<li class="toclevel-4 tocsection-31"><a href="#B._System-on-Chip_.28Back_End.29"><span class="tocnumber">5.1.2.2</span> <span class="toctext">B. System-on-Chip (Back End)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-32"><a href="#Algorithm_Source_Code"><span class="tocnumber">5.2</span> <span class="toctext">Algorithm Source Code</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33"><a href="#Questions.2FSupport"><span class="tocnumber">6</span> <span class="toctext">Questions/Support</span></a></li>
<li class="toclevel-1 tocsection-34"><a href="#Disclaimer"><span class="tocnumber">7</span> <span class="toctext">Disclaimer</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="MIDAS_Versions">MIDAS&#160;Versions<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=1" title="Edit section: MIDAS Versions">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Please note that the newer <a href="MIDAS_Ultrasound_v4.html" title="MIDAS Ultrasound v4.0 Demo"><b>MIDAS Ultrasound version 4.0</b></a> is available now.
</p><p>Please see the <a href="Medical_Imaging_Demo_Application_Starter_(MIDAS).html" title="Medical Imaging Demo Application Starter (MIDAS)">main MIDAS&#160;wiki page</a> to compare different versions of MIDAS and see what suits your use-case the best.<br />
</p>
<h1><span class="mw-headline" id="Overview">Overview<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=2" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>The MIDAS&#160;Ultrasound v3.0 demo showcases a system level implementation of midend and backend ultrasound signal processing on Texas Instruments (TI)&#160;Multicore devices, including the homogenous C6472 six-core multicore DSP, and the heterogenous OMAP3530 System-on-Chip that consists of one ARM and one DSP. We use the TI C6472 Low-cost EVM interfaced via an Ethernet-Ethernet connection to the TI OMAP3530 Mistral EVM. The C6472 consists of six high-performance C64x+ DSP cores, each of which can run up to a speed of 700 MHz, held together by a high speed switch fabric. The C6472 provides 768 KB of shared L2 memory and provides an internal mechanism for sharing data amongst cores. The on-chip DMA Engine allows automated movement of data between peripherals and memory. The device also contains high speed I/O ports such as SRIO and Gigabit Ethernet. The OMAP3530 consists of a 720MHz ARM Cortex A-8 general processor and a 520MHz C64x+ DSP core, which together provide a power-efficient solution to handle both system controller and back-end processing functions in diagnostic ultrasound imaging systems.<br /> 
</p><p>The figure below showcases the function of the cores on the C6472 and the OMAP3530. As shown in the diagram, the B-mode Processing Unit (BPU) which includes envelope detection and log compression, and the Doppler Processing Unit (DPU) which includes ensemble aggregation, wall filter and flow estimation, are implemented on separate cores on the C6472 device. The Scan Conversion Unit (SCU) is implemented on the OMAP’s C64x+ DSP core. All the algorithm kernels implemented in this system are from TI's Embedded Processor Software Toolkit for Medical Imaging Applications. In addition, the demo showcases the use of TI's DMAI&#160;APIs on ARM as well as the use of Qt and tslib to create a touchscreen-based Graphical User Interface (GUI) on the SoC that allows users to interact with the ARM and DSP in real-time.<br /> 
</p><p><a href="File_US3_Demo_Functional_Overview.html" class="image" title="Figure 1: Functional Overview of MIDAS Ultrasound Demo v3.0"><img alt="Figure 1: Functional Overview of MIDAS Ultrasound Demo v3.0" src="https://processors.wiki.ti.com/images/2/27/US3_Demo_Functional_Overview.PNG" width="739" height="421" /></a><br /> 
</p><p>The sample raw data used in the demo is from a scan of a Carotid Artery, consisting of 69 frames of post-RF-demodulated data. Each frame worth of input data includes 256 scanlines, 512 samples/scanline of B-mode, and 48 scanlines, 256 samples/scanline, 10 ensembles of doppler (color flow) data.&#160; This input data is initially stored on the NFS/SDcard on OMAP3530. During initialization, all 69 frames worth of input data is sent to the C6472, which stores this in DDR. When the user presses the 'Start' button the user interface, the input data is fed in at a set acquisition interval rate (set at 20 fps in this demo but can be customized), which is then processed through the BPU, DPU (on C6472) and SCU (on OMAP3530's DSP)&#160;modules as shown above, and the final scan-converted image is displayed on the OMAP3530's LCD touchscreen.<br /> 
</p><p>This document covers various aspects of the demo, including a discussion on the software design as well as step-by-step instructions to obtain the source code, and setup your development environment to build and run the demo. <br />
</p>
<h1><span class="mw-headline" id="GForge_Project_Page">GForge Project Page<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=3" title="Edit section: GForge Project Page">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>MIDAS source code is hosted on TI's GForge project portal. The MIDAS project page is located at <a rel="nofollow" class="external free" href="https://gforge.ti.com/gf/project/med_ultrasound/">https://gforge.ti.com/gf/project/med_ultrasound/</a><br /> 
</p>
<h1><span class="mw-headline" id="Software_Implementation">Software Implementation<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=4" title="Edit section: Software Implementation">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>This section discusses the software implementation for Ultrasound v3.0 and showcases how TI's software components including the Multicore Software Development Kit (MCSDK), Software Development Kit for OMAP3530 (DVSDK), Codec Engine (CE), Digital Media Application Interface (DMAI) and iUniversal APIs can be leveraged by developers to create applications for homogeneous and heterogeneous multicore systems like the C6472 and OMAP3530 respectively.<br /> 
</p><p>Both the SoC and Multicore DSP software implementations leverage TI's Codec Engine (CE), a standard software architecture and interface for algorithm execution. CE eases multicore programming and more specifically in the case of an SoC like the OMAP3530, it abstracts the DSP for GPP (ARM) programmers. CE is based on a client-server architecture: for the SoC implementation, the ARM acts as the client, and the DSP as the server (consisting of single/multiple algorithms), while for the multicore DSP, one DSP acts as the client (master core). CE allows easy algorithm plug-in, where DSP developers supply XDAIS-compliant algorithms, and GPP (ARM) developers integrate these DSP algorithms and make remote procedure calls from their ARM applications. Interprocessor communication and DSP resources (like DMA, memory) are managed by CE under the hood, and no manual coding of IPC is required.<br /> 
</p><p>The block diagrams below showcases the TI production software components that the Multicore DSP&#160;application relies on. 
</p><p><a href="File_US3_Demo_MCDSP_Components.html" class="image" title="US3 Demo MCDSP Components.PNG"><img alt="US3 Demo MCDSP Components.PNG" src="https://processors.wiki.ti.com/images/d/dd/US3_Demo_MCDSP_Components.PNG" width="635" height="389" /></a> 
</p><p>TI's SYS/BIOS 6.x is a highly configurable, real-time operating system that caters to a variety of embedded processors and is included as part of TI’s Code Composer Studio integrated development environment. SYS/BIOS provides some key features that enable easy memory management, preemptive multitasking and real-time analysis. Based on the application's requirements, developers can optimize their final runtime image by including/excluding specific SYS/BIOS modules. 
</p><p>The Multicore Software Development Kit (MCSDK) includes key components that ease multicore development including the chip support library, low level drivers, platform software (PDK), Network Developer's Kit (NDK), etc. The Codec Engine, which we describe in more detail later provides a framework and APIs to easily plug-and-play algorithms, and handle Inter-Processor Communication (IPC) under the hood. 
</p><p>The figure below showcases the software components available for development on the System-on-Chip, that our application on OMAP3530 relies on. 
</p><p><a href="File_US3_Demo_SoC_Components.html" class="image" title="US3 Demo SoC Components.PNG"><img alt="US3 Demo SoC Components.PNG" src="https://processors.wiki.ti.com/images/a/ab/US3_Demo_SoC_Components.PNG" width="618" height="433" /></a><br /> 
</p>
<h2><span id="Multicore_DSP_(Mid_End)"></span><span class="mw-headline" id="Multicore_DSP_.28Mid_End.29">Multicore DSP (Mid End)<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=5" title="Edit section: Multicore DSP (Mid End)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The software application that runs on C6472 is based on a Master/Slave model, where Core 0 acts as the centralized controlling core aka the Master core, and Core 1 and Core 2 act as the Slave cores. Note that though in this demo we utilize only three cores since they are enough to demonstrate our use-case, it is ofcourse feasible to use the same programming model to extend the application to utilize all six cores. The processing modules are statically assigned to Core 1 (BPU)&#160;and Core 2 (DPU) and Core 0, which serves as the master, takes care of synchronization and sets up the buffer pointers. Note however that even though distribution is done statically, the assignment of algorithms to cores is done outside of the main application. This allows easy reconfiguration and at the application sotware level, the developer can be agnostic to which core is running which algorithm. <br /> 
</p>
<h3><span class="mw-headline" id="Functional_Overview">Functional Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=6" title="Edit section: Functional Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The software application on C6472's Core 0 is designed to integrate the following functional blocks: <i>Front End Interface</i>, <i>Mid End Controller</i>, <i>Mid End Processing</i> and <i>Back End Interface</i>. 
</p><p><a href="File_US3_Demo_Application_Design.html" class="image" title="US3 Demo Application Design.PNG"><img alt="US3 Demo Application Design.PNG" src="https://processors.wiki.ti.com/images/c/c1/US3_Demo_Application_Design.PNG" width="580" height="483" /></a>&#160; 
</p>
<h4><span class="mw-headline" id="Mid_End_Controller">Mid End Controller<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=7" title="Edit section: Mid End Controller">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>As the name suggests, the Mid End Controller is responsible for initializing and initiating the other blocks. Commands received from the OMAP3530 are also interpreted here. <br /> 
</p>
<h4><span class="mw-headline" id="Front_End_Interface">Front End Interface</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=8" title="Edit section: Front End Interface">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The <i>Front End Interface</i> serves two primary functions: it provides periodic events that mark the availability of incoming input data and it provides functions to access this data that has arrived. Since this version of the demo, Ultrasound v3.0 showcases processing blocks post IQ demodulation, and has no front-end implementation, it becomes necessary to mimic the function of the ultrasound front-end as in a real system, where input frames would be continuously received at a set acquisition frame rate. The <i>Front End Interface</i> serves this role, where in it fires an INPUT_RDY event every <i>(1/acquisition rate)</i> seconds. The clock ticks are derived from the SYS/BIOS <i>Timer </i>module. Note here that though in this design we use a frame-based processing model, where the frame boundary defines the input block size, it is also possible to have partial frames as input boundaries. 
</p>
<h4><span class="mw-headline" id="Mid_End_Processing">Mid End Processing</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=9" title="Edit section: Mid End Processing">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The <i>Mid End Processing</i> function block is pending on the INPUT_RDY event from the <i>Front End Interface</i> and as soon as a new frame is “received,” it initiates processing on that input block. <i>Mid End Processing</i> acts as the Client in the <i>Codec Engine</i> <i>(CE)</i> framework and uses the <i>iUniversal</i> interface to call upon <i>Algorithm Servers</i> that correspond to various functions within the ultrasound midend processing signal chain. In this implementation, there are two algorithm servers implemented, one for each core (Core 1 and Core 2). 
</p><p>Let us now look at the primary execution threads that define the data flow through the <i>Mid End Processing</i> block. The figure below shows four primary tasks that utilize the <i>MessageQ</i> IPC&#160;module for message passing. The messages provide pointers to the data and trigger the execution of tasks in the receiving functions. The actual message buffer is setup in shared memory that both the message sender and the message receiver can access. In this case, the <i>MidEnd_scatterTask()</i> pends on a new input frame. When data becomes available, the <i>MidEnd_scatterTask()</i> allocates memory for the message from heap, and assigns the message pointer to the B-mode input data. It similarly allocates memory for a message that points to the Color flow input data. Using the <i>MessageQ_put</i> blocking call, the <i>MidEnd_scatterTask</i>() passes the input data pointers for B-mode and Color to the <i>BPUcluster_task()&#160;</i>and <i>DPUcluster_task().&#160;</i>The <i>BPUcluster_task() </i>and <i>DPUcluster_Task&#160;</i>use the corresponding <i>MessageQ_get</i> calls to pend on the incoming B-mode and Color data frames. Once a new frame is received, these tasks call the <i>UNIVERSAL_process</i> API&#160;provided by the iUniversal interface, to invoke the <i>BPU</i>&#160;and <i>DPU</i>&#160;processing algorithms on Core 1 and Core 2 respectively. Once the B-mode and Color data are processed, the <i>BPUcluster_task()</i> and <i>DPUcluster_task()</i> use the <i>MessageQ_put</i> API&#160;to pass the output data pointers to the <i>MidEnd_gatherTask()</i>. The <i>MidEnd_gatherTask() </i>ensures that data atomicity is maintained, so that the B-mode and Color data that corresponds to a particular frame always stays together. <br /> 
</p><p>Note that the control tasks that involve data scattering and gathering, viz. <i>MidEnd_scatterTask()</i> and <i>MidEnd_gatherTask() </i>are running on Core 0, the Master core, and the processing tasks, viz. <i>BPUcluster_task()&#160;</i>and&#160;<i>DPUcluster_task()</i> are running on Core 1 and Core 2, respectively. It is important to note here that the IPC between cores is handled under the hood via <i>CE</i> and by using MessageQ, the developer is agnostic to this fact and can simply call the MessageQ APIs for passing data pointers between cores. <br /> 
</p><p><br /> 
</p><p><a href="File_US3_Demo_Data_Flow.html" class="image" title="US3 Demo Data Flow.PNG"><img alt="US3 Demo Data Flow.PNG" src="https://processors.wiki.ti.com/images/d/d8/US3_Demo_Data_Flow.PNG" width="653" height="470" /></a> 
</p>
<h4><span class="mw-headline" id="Back_End_Interface">Back End Interface</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=10" title="Edit section: Back End Interface">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Once the output B-mode and Color data is ready for scan conversion, it is time to pass the data to the OMAP3530 that handles the backend processing and display. The Mid End application's <i>Back End Interface</i> block provides functions to communicate with the OMAP3530 back end. For this example implementation, we use the ethernet ports on both device EVMs to interface the two together. To implement the communication protocol in software, we use RDSP, an application written on top of the MCSDK's Network Development Kit (NDK), that allows easy passing of data and parameters between the C6472 and the OMAP3530. 
</p>
<h3><span class="mw-headline" id="CE_Implementation_Details">CE Implementation Details</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=11" title="Edit section: CE Implementation Details">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>To better understand this, we delve into a brief discussion on <i>CE</i>. The <i>CE&#160;</i>framework is essentially a set of APIs used to instantiate and run <i>XDAIS</i>-compliant algorithms. <i>XDAIS</i> is an algorithm standard that DSP programmers should follow to ensure that their algorithms easily plug-and-play with other algorithms and can be called using <i>CE </i>APIs. <i>CE&#160;</i>requires two essential components to operate in tandem: a <i>CE Client</i> and a <i>CE Algorithm Server. </i>In this demo, the master core, Core 0, serves as the <i>CE Client&#160;</i>and uses <i>CE</i> APIs to make “remote procedure calls” to <i>CE Algorithm Server</i> executables that reside on DSP Core 1 and Core 2. Essentially, the <i>CE Algorithm Server</i> combines the core codec (BPU in the case of Core 1 and DPU for Core 2) along with the other infrastructure pieces (SYS/BIOS, IPC, etc) to produce an executable (.x64P) that is callable by Core 0, the <i>CE Client</i>. The application on Core 0 invokes the BPU and DPU remote algorithms on Core 1 and Core 2 using the <i>iUniversal</i> interface, which is a set of APIs used to provide an easy way for <i>XDAIS</i>-compliant, non-VISA (Video, Image, Speech, Audio) algorithms to run using <i>CE</i> 
</p><p><i>CE&#160;</i>provides some unique features that significantly eases the multicore DSP&#160;software development process. One of the primary advantages is that <i>CE</i> eliminates the need for the developer to manually code any Inter-Processor Communication (IPC) details. Once the developer configures memory for IPC, <i>CE </i>takes care of the rest of IPC&#160;under the hood. This is illustrated later in this section with code snippets. <i>CE </i>also captures some key TI hardware features, where resource management for memory and EDMA are done via CE. CE also enables code reuse and faster time to market since applications can be easily ported from TI's current generation C64x+ based multicore DSPs like the C6472 to next-generation devices based on the C66x architecture like the C6678. For more information on CE and C66x devices please click on the relevant links in the References section. <br /> 
</p>
<h3><span class="mw-headline" id="Performance_Details">Performance Details<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=12" title="Edit section: Performance Details">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>It is of interest to find the speed-up, or the ratio of cycles of single-core to that of multi-core to find the parallelism achieved by the multi-core implementation and get an understanding of the overheads associated in making the application multi-core. Currently the real-time requirements of the carotid-artery example case can be met even by running all the processing on a single-core so the speed-up measurement isn’t really necessary for meeting real-time needs but it is more to get an understanding of what is the actual performance compared to what is expected and where the overheads of this multi-core implementations lie. 
</p><p>The multi-core implementation parallelizes the execution of bpu (b-mode processing) and dpu (color processing) components. Each component is executed monolithically on a single but separate core of the multiple available cores. So the expected parallel cycles are the worst of those of the two components and some overhead due to multi-core. <br /> 
</p>
<h4><span class="mw-headline" id="Overheads_and_Related_Optimizations_in_Multi-core_Implementation">Overheads and Related Optimizations in Multi-core Implementation<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=13" title="Edit section: Overheads and Related Optimizations in Multi-core Implementation">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The overheads can be categorized into two components:<br /> 
</p><p>1. Communication and synchronization overhead between master and each of the slave cores running bpu/dpu components, including any cache operations for coherency. Caching overheads were minimized by configuring the infrastructure (Codec Engine) to disable any caching operations at the boundaries of master and slave cores because both bpu and dpu algorithms only use DMA for I/O.<br /> 
</p><p>2. DDR contention overhead. Each of the components parallelizes DDR memory I/O with CPU kernel execution, there is no cache usage for I/O. When each of the bpu and dpu are executed by themselves without the other, both are CPU bound but bpu has a higher margin (difference between CPU cycles and CPU cycles equivalent of DMA I/O) compared to dpu. The dpu is almost matched in I/O and CPU, mainly because of the RF input transpose operation in the DMA, which takes more cycles than a linear transfer. These higher cycles are because of the scatter operation in internal L2 RAM during the DMA transfer, which results in inefficient utilization of wide on-chip buses to internal memories. When bpu and dpu are run simultaneously on different cores, the two cores simultaneously hit DDR memory, and because DDR is shared, the accesses are serialized. So each execution suffers a greater penalty of I/O transfer than when only one is running. The measurements under the circumstances of same DMA priority for bpu and dpu show that dpu becomes significantly I/O limited, as much as 400 K cycles increase than when running standalone, which results in high overall multi-core cycles. As a result of this observation, the software was modified to prioritize dpu server core over bpu server core for EDMA access. This was accomplished with suitable programming of the channel to TC mapping, TC to queue mapping and system queue priorities. This resulted in a drop of dpu DDR degradation cycles from 400,000 per frame to 27,000 per frame, which resulted in a similar improvement in overall multi-core performance.<br /> 
</p>
<h4><span class="mw-headline" id="Performance_Measurements">Performance Measurements<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=14" title="Edit section: Performance Measurements">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The full application consists of NDK software for communicating processed frames from 6472 to OMAP. Because in a real product an Ethernet interface is unlikely to be used for such communication (here we are constrained by the EVM hardware), it is not realistic to use a network stack. So for the purposes of measurement, the application was made to be build and run stand-alone on the 6472 without any Ethernet communication with OMAP. This can be done by defining MIDEND_STANDALONE, MIDEND_AUTOINIT_PARAMS in the project properties and setting variable midend_standalone to 1 in the midendapp.cfg file. Furthermore, single-core operation can be simulated by uncommenting the following in midend.c file 
</p>
<blockquote><p>define SERIALIZE_EXECUTION_ON_MASTER_CORE </p></blockquote> 
<p>The above simply selects local CE algorithms of bpu and dpu i.e running on master core. Everything else (tasking) is same as multi-core operation. 
</p><p>BPU&#160;or DPU only execution can be configured by commenting appropriate lines below in the same file: 
</p>
<blockquote><p>define ENABLE_BPU<br />#define ENABLE_COLOR </p></blockquote> 
<p>The single algorithm execution using above defines enables estimation of degradation due to DDR in simultaneous operation. 
</p><p>The DSP cycle measurements are shown in the table below, all performed on the master core which runs different tasks. All numbers represent one frame of processing.<br /> 
</p>
<blockquote>
<table cellspacing="1" cellpadding="1" border="1" style="width: 381px; height: 150px;">

<tbody><tr>
<td><br />
</td>
<td>Max latency<br />
</td>
<td>BPU Cycles<br />
</td>
<td>DPU&#160;Cycles<br />
</td></tr>
<tr>
<td>Multi-Core (MC)<br />
</td>
<td>1903650 <br />
</td>
<td>1789126 <br />
</td>
<td>1880914<br />
</td></tr>
<tr>
<td>Single-Core (SC)<br />
</td>
<td>3677756<br />
</td>
<td>1769786<br />
</td>
<td>1840944<br />
</td></tr>
<tr>
<td>MC BPU&#160;only<br />
</td>
<td>1829470<br />
</td>
<td>1785276<br />
</td>
<td><br />
</td></tr>
<tr>
<td>SC&#160;BPU only<br />
</td>
<td>1816277<br />
</td>
<td>1771337<br />
</td>
<td><br />
</td></tr>
<tr>
<td>MC&#160;DPU&#160;only<br />
</td>
<td>1874465<br />
</td>
<td><br />
</td>
<td>1853723<br />
</td></tr>
<tr>
<td>SC&#160;DPU only<br />
</td>
<td>1861450<br />
</td>
<td><br />
</td>
<td>1839771<br />
</td></tr></tbody></table>
</blockquote> 
<p>The max latency column above is calculated from looking at the global variable gPerformanceStats (in watch window) as 
</p><p>max(gPerformanceStats.bmodeLatencyCycles, gPerformanceStats.colorLatencyCycles). 
</p><p>These latencies are measured in the code between entry of each type of frame into the system and its exit. So the maximum is the processing time of the stand-alone application. 
</p><p>The individual component cycles (bpu or dpu columns) in above table are obtained by differencing the cycles in the trace log (gLogBuf) looked backwards from gLogBufIndx between the points of BPU(DPU)_PRE_UNIV_PROCESS and BPU(DPU)_PRE_NOTIFY_PROCESS_DONE. The trace log consists of a time-stamp (it is 0 at the FRONT_END_PRE_EVENT_POST) logged for different events so it gives a good understanding of what events are happening at what times and therefore find what is getting parallelized. 
</p><p>The single-core application cycles cannot directly be used to find the speed-up because there are some overheads of tasking in the multi-core implementation that wouldn’t be in the single-core were single-core case be done naturally. Some overheads are getting hidden in multi-core application because of parallel execution of the algorithms. For example, the bpu’s overhead related to preparation and issuing of processing call as well as freeing of I/O buffer memory is parallelized with the dpu’s execution (we have set task priority of dpu to be higher than bpu knowing dpu takes longer processing cycles than bpu). While this is a good optimization on the multi-core, it gets serialized on the single-core equivalent execution. On the other hand, naturally implemented single-core will not have some of the overhead associated with having multiple tasks. A fair approximation is to use the multi-core overhead to the single-core case. The multi-core overhead is the difference between max latency and max of bpu, dpu cycles OR 1903650 – max{1789126,1880914) = 22736 cycles. So single-core max latency is 22736 + bpu_cycles of single-core + dpu_cycles of single-core = 22736 + 1769786 + 1840944 = 3633466. Thus, 
</p><p>Speed-up = 3633466/1903650 = 1.91. 
</p><p>The maximum possible theoretical speed-up is the one where there is no overhead in the single-core or multi-core case, which is simply the ratio below 
</p><p>Max theoretical speed-up 
</p><p>= (SC bpu cycles + SC dpu cycles)/max{SC bpu cycles, SC dpu cycles} <br /> = (1769786 + 1840944)/max{1769786,1840944}<br /> = 1.96 
</p><p>We can derive overhead numbers related to communication and DDR loading described earlier as follows: 
</p><p>1. Communication overhead (Codec Engine’s IPC or Inter Processor Communication) for dpu = dpu cycles of MC dpu only – dpu cycles of SC dpu only = 1853723 – 1839771 = 13952 <br />2. Communication overhead (Codec Engine’s IPC or Inter Processor Communication) for bpu = bpu cycles of MC bpu only – bpu cycles of SC bpu only = 1785276 – 1771337 = 13939<br />3. Degradation in dpu due to DDR contention with bpu = dpu cycles of MC case – dpu cycles of MC dpu only case = 1880914 – 1853723 = 27191<br />4. Degradation in bpu due to DDR contention with dpu = bpu cycles of MC case – bpu cycles of MC bpu only case = 1789126 – 1785276 = 3850<br /> 
</p>
<h4><span class="mw-headline" id="Summary">Summary<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=15" title="Edit section: Summary">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Following table summarizes the results (DSP speed is 700 MHz):<br /> 
</p>
<table cellspacing="1" cellpadding="1" border="1" style="width: 353px; height: 130px;">

<tbody><tr>
<td>Actual Speed-up<br />
</td>
<td>1.91 (max possible 1.96)<br />
</td></tr>
<tr>
<td>Communication Overhead<br />
</td>
<td>13900 cycles (0.02 ms)<br />
</td></tr>
<tr>
<td>DDR Contention Overhead<br />
</td>
<td>27191 cycles (0.03 ms)<br />
</td></tr></tbody></table>
<p>The use of Codec Engine infrastructure, appropriate optimized implementations of the algorithms and system level tuning (DMA priorities, cache placements) allows a reasonable realization of multi-core performance. The overheads are insignificant at 20 fps (50 ms per frame) processing rate of the application.<br /> 
</p><p><br />
</p>
<h2><span id="System-on-Chip_(Back_End)"></span><span class="mw-headline" id="System-on-Chip_.28Back_End.29">System-on-Chip (Back End)<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=16" title="Edit section: System-on-Chip (Back End)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section discusses the software design for the System-on-Chip application and showcases how TI's SDK for OMAP3530 including the Codec Engine, DMAI and iUniversal APIs can be used to ease SoC software development. 
</p><p>As previously mentioned, the SoC's role is to do backend processing and display, and provide mechanisms for data input/output and a graphical user interface. 
</p><p>The figure below summarizes the implementation. 
</p><p><a href="File_US3_Demo_SoC_Application_Design.html" class="image" title="US3 Demo SoC Application Design.PNG"><img alt="US3 Demo SoC Application Design.PNG" src="https://processors.wiki.ti.com/images/1/1f/US3_Demo_SoC_Application_Design.PNG" width="646" height="370" /></a> 
</p><p>As shown, OMAP3530's ARM&#160;receives data from the C6472 that has undergone B-mode estimation and Color Flow processing. OMAP3530’s C64x+ DSP core runs the DSP/BIOS real-time operating system and runs the Scan Converter Unit (SCU)&#160;algorithm on this received data. The SCUconverts both B-mode and Color Flow data from the acquired polar/cartesian co-ordinates to the display cartesian co-ordinates. Just like in the case of the Multicore DSP&#160;implementation, the algorithm module (SCU&#160;in this case) is packaged into a 'DSP Algorithm Server' that is managed by the Codec Engine and executed on the DSP core. On the ARM, the demo application uses Codec Engine APIs to make a remote procedure call to this 'Algorithm Server'. 
</p><p>The ARM core runs the Linux operating system, and all peripherals are controlled through Linux device drivers, which are part of the PSP. The ARM application resides on this Linux filesystem and uses a multithreaded framework to achieve data FIFO management, and to manage the Qt GUI on the On Screen Display (OSD) and service user interrupts via touchscreen events. 
</p>
<h3><span class="mw-headline" id="Functional_Overview_2">Functional Overview<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=17" title="Edit section: Functional Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The ARM application consists of a main function, and four execution threads running in parallel viz. acquisition, process, display and control threads. All four threads are configured as preemptive/ priority-based scheduled. <br />• The main function draws the Qt GUI and then becomes the event handling loop <br />• The acquire thread (initiated as part of the RDSP&#160;application)&#160;reads the raw input ultrasound data (from C6472) into the SoC<br />• The process thread engages the C64x+ DSP for scan conversion <br />• The display thread transfers ultrasound image frames to the frame buffer of the FBDev display driver<br />• The control thread computes and displays the ARM and DSP loading<br />Fixed-size buffers are exchanged between acquisition-process, and process-display threads for data movement. The thread where the data originates creates and maintains the set of data buffers, and FIFOs are used to put and get buffer pointers. In the following subsections we will delve into each of the threads discussed above. It might be useful to follow along with the source code as we discuss these elements.<br /> 
</p>
<h4><span class="mw-headline" id="Main">Main</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=18" title="Edit section: Main">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The main function in main.cpp performs necessary initialization tasks, which include initiating a connection between 6472 and OMAP3530, sending the input files via TFTP from the SD card on OMAP3530 to 6472's DDR, sending configuration parameters for the algorithm modules (BPU, DPU) on C6472, initiating the acqusition, process, display and control threads and setting up the user interface. Once the main window is setup, this main thread becomes the event handling loop that makes function callbacks in response to touchscreen events. All trigger events (slots) and their associated callback functions (signals) are defined in mainwindow.cpp. The image() function is the most important signal in mainwindow.cpp and is triggered when the user touches the 'Start/Stop' button to begin/end image processing.<br /> 
</p>
<h4><span class="mw-headline" id="Acquisition">Acquisition<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=19" title="Edit section: Acquisition">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The acquisition thread is responsible for receiving raw, pre-scan-converted ultrasound data from the C6472. The Mid End Interface consists of the <i>MidEndIf_getBuffer </i>and <i>MidEndIf_putBuffer</i> functions. The RDSP client application layer calls these functions in the acqusition thread it spawns. The <i>MidEndIf_getBuffer</i> allocates buffer space for the incoming data. All data buffers that are shared between the OMAP3530's ARM and DSP need to be allocated in physically contiguous blocks of memory, which is what the <i>BufTab_create()</i> API call helps achieve for these input buffers. The <i>MidEndIf_putBuffer</i> call pushes the buffer pointers into a FIFO <i>Acq2ProcFif</i>o. Once the Process thread finishes processing the input frame, it releases the used buffer, which the Acqusition thread can then reuse for the next input frame. Note that the Acqusition thread continues to receive data at the acquisition frame interval defined in the C6472 application's Front End Interface. This is to mimic how an actual ultrasound system works where the acquisition rate and the display rate are independent of each other. <br /> 
</p>
<h4><span class="mw-headline" id="Process">Process</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=20" title="Edit section: Process">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The process thread function defined in <i>UsProcess.c</i> interacts with the C64x+ and engages the DSP to run the SCU processing algorithm module. Just like we saw with the acquire thread, since the output buffers will be shared between ARM and DSP, the process thread also allocates contiguous memory for these. When imaging starts, the <i>UsProcess_thrFxn </i>begins and starts receiving input buffers from the acquisition thread on the <i>Acq2ProcFifo/2</i> FIFOs. It passes the input and output buffer pointers to the <i>UsProcess_ScanConvertB&#160;</i>and <i>UsProcess_scanConvertColor</i> calls for the B-mode and Color data respectively. Once scan conversion is complete, the process thread places the pointer to the final output buffer on the <i>Proc2DispFifo</i>. The <i>UsProcess_scanConvertB</i> and <i>UsProcess_scanConvertColor </i>functions invoke the DSP-side scan conversion method using the IUNIVERSAL <i>UNIVERSAL_process()</i> API which in turn invokes the corresponding functions on the DSP-side. When the process thread is fully primed it releases the display thread for it to start accepting buffers on the <i>Proc2DispFifo</i>. Once free running though, the thread continues to process input buffers as fast as it can and sends them to the Display thread. <br /> 
</p>
<h4><span class="mw-headline" id="Display">Display</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=21" title="Edit section: Display">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The Display thread's function defined in UsDisplay.c transfers the final scan-converted ultrasound image frames that it receives on the <i>Proc2DispFifo</i> to the frame buffer of the FBDev display device driver. The <i>Display_create()</i> DMAI method opens the display device driver, and the Display thread uses a handle to this to copy output buffers to the driver. The Display thread uses the H/W resizer to copy the output buffer to the display device driver, instead of using a memcpy() to ensure execution efficiency. DMAI’s Framecopy API is used to perform this buffer copy. The display refresh rate is set at 60 fps but incorporates logic that skips a frame if the frames are received from the process thread too fast, or repeats a frame if there is no new frame available from the process thread. Once the Display thread is triggered, the acquire, process and display threads continue to run till the user touches the 'Stop' button. Since this is a demo with only a limited number of frames, the C6472 loops through the same input dataset which the C6472 and OMAP3530 DSP cores continue to process and output in real time. 
</p>
<h4><span class="mw-headline" id="Control_Thread">Control Thread</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=22" title="Edit section: Control Thread">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The control thread calculates the ARM CPU load and DSP CPU load for the OMAP3530 using the Codec Engine calls to the <i>getArmCpuLoad() </i>and <i>Engine_getCpuLoad()</i> API functions, respectively. The CPU loading is updated every few seconds on the GUI's 'Home' tab and is represented as a percentage. The GUI also displays the DSP loading for the six cores on the C6472, which is sent from the C6472 as part of the B-mode frame's header.<br /> 
</p>
<h3><span class="mw-headline" id="DSP_Module_Integration">DSP&#160;Module Integration <br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=23" title="Edit section: DSP Module Integration">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>In this section we outline some of the steps we took to integrate the BPU, DPU and SCU algorithm modules to plug-and-play with the Codec Engine (CE) using IUNIVERSAL. As CE Application Developers it is possible to use simple API calls to pass data and configuration parameters between the CE&#160;Client and CE&#160;Server cores. <br /> 
</p><p>The BPU, DPU and SCU modules, as provided in the Medical Imaging Software Toolkit, are all XDAIS compliant. You can find many articles on this TI&#160;EP wiki that guide you through the process of making your codecs XDAIS compliant.<br /> 
</p><p>Since the steps for BPU, DPU and SCU modules are similar, we will focus on the SCU module to illustrate how IUNIVERSAL is setup in this scenario where the CE&#160;Client is the ARM&#160;core on OMAP3530 and the CE&#160;Server is the DSP core on the OMAP3530. <br /> 
</p><p>The application capitalizes on the IUNIVERSAL API's capability to make a remote procedure call from the ARM to the DSP algorithm, without the need to write any system software for the C64x+. To initiate the ARM-DSP communication, the ARM creates a Codec Engine instance with an <i>Engine_open() </i>call that resets, loads and starts the DSP Engine and returns a handle to the same. Using this handle hEng, the <i>UNIVERSAL_create() </i>API creates an SCU algorithm instance using parameters from the<i>ISCU_Params</i> structure that specify the size of memory to allocate on the DSP. It is important to note that the SCU header file at “midas/ultrasound/algos/scu/src/scu.h” is shared between the DSP and the ARM, which makes it possible for the two cores to share the same interpretation of SCU-specific structures and datatypes, even when both are compiled using different compilers. The <i>UNIVERSAL_create()</i> call returns a handle to the IUNIVERSAL algorithm instance hAlg as: <br /> 
</p>
<pre>hAlg = UNIVERSAL_create(hEng, algName, (IUNIVERSAL_Params*)&amp;ISCU_ALLOC_PARAMS);
</pre> 
<p>Next, the ARM populates the SCU configuration structure, scuConfig_t, with parameter values from the user-provided configuration file/s, and with the tissue and flow color mapping lookup tables specified in "midas/ultrasound/userdata/LUTs". The SCU configuration structure is also defined in the SCU header file that ARM and DSP share. To send this configuration information to the DSP, the ARM passes a pointer to the scuConfig_t structure and the handle to the SCU algorithm instance hAlg, using the UNIVERSAL_control() API as shown in the code section below. UNIVERSAL_control() calls the corresponding SCU configuration function SCU_TI_control() on the DSP. <br /> 
</p>
<pre>universalStatus.data.numBufs = 1;
universalStatus.data.descs[0].bufSize = sizeof(scuConfig_t);
universalStatus.data.descs[0].buf =(XDAS_Int8 *)(hUsProcess-&gt;pScuConfigB);
status = UNIVERSAL_control(hUsProcess-&gt;hAlg, XDM_SETPARAMS, &amp;universalDynParams, &amp;universalStatus);
</pre> 
<p>It is important to note here that any buffers that the ARM shares with the DSP, it allocates in contiguous memory. This is necessary because unlike the ARM, the DSP does not have a virtual memory manager and therefore assumes that the buffer is aligned to a 64-bit boundary and is contiguous. In this demo implementation, the allocated buffers reside in CMEM, a contiguous memory manager by TI. When the ARM allocates contiguous memory using the Memory_contigAlloc() or BufTab_create() DMAI API, a CMEM pool that fits the buffer size requested is reserved for this buffer. The number and total size of CMEM pools is defined in the 'loadmodules.sh' script (from /opt/midas/. on the target), which the ARM application runs during initialization. Since both ARM and DSP have access to this CMEM memory space, they only need to exchange buffer pointers. <br /> 
</p><p>Once the SCU algorithm instance on the DSP is configured with the parameters it requires, it is ready to begin scan conversion processing. The ARM uses the UNIVERSAL_process() API to call the DSP-side SCU_TI_process() function; based on the scan conversion mode in the configuration, the DSP runs the corresponding processing function. Again, all input and output buffer pointers that the ARM and DSP exchange point to buffers allocated in CMEM. <br /> 
</p>
<pre>status = UNIVERSAL_process(hUsProcess-&gt;hAlg, &amp;inpBufDesc, &amp;outBufDesc, NULL, &amp;inArgs, &amp;outArgs);
</pre> 
<p>Finally, when the application exits, the UNIVERSAL_delete() API deletes the SCU algorithm instance hAlg. This deallocates all the dynamic memory that was associated with the hAlg instance. The algorithm instance deletion is accompanied with an Engine_close() call which deletes the Codec Engine instance created for ARM-DSP interaction as: <br /> 
</p>
<pre>UNIVERSAL_delete(hUsProcess-&gt;hAlg);
Engine_close(hUsProcess-&gt;hEng);
</pre> 
<p>To summarize, the CE and IUNIVERSAL APIs allow application developers to seamlessly plug in XDAIS-compliant algorithm modules into their ARM application. As illustrated in the previous section, the use of IUNIVERSAL&#160;and CE&#160;is similarly used on the C6472 to ease multicore programming.
</p>
<h1><span class="mw-headline" id="Get_Ultrasound_v3.0">Get Ultrasound v3.0</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=24" title="Edit section: Get Ultrasound v3.0">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p><b><br /></b> 
</p>
<h2><span class="mw-headline" id="Demo_Application_Source_Code">Demo Application Source Code <br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=25" title="Edit section: Demo Application Source Code">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Hardware_Setup">Hardware Setup<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=26" title="Edit section: Hardware Setup">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Requirements">Requirements<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=27" title="Edit section: Requirements">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<ol><li>Mistral OMAP3530 EVM Rev G <br />(<a rel="nofollow" class="external free" href="http://focus.ti.com/docs/toolsw/folders/print/tmdsevm3530.html">http://focus.ti.com/docs/toolsw/folders/print/tmdsevm3530.html</a>)<br /></li>
<li>C6472 EVM <br />(<a rel="nofollow" class="external free" href="http://focus.ti.com/docs/toolsw/folders/print/tmdsevm6472.html">http://focus.ti.com/docs/toolsw/folders/print/tmdsevm6472.html</a>)<br /></li>
<li>Linux Development PC with Ubuntu 10.04 LTS<br /></li>
<li>Windows PC</li>
<li>3 Regular Ethernet Cables<br /></li>
<li>Gigabit Ethernet Switch<br /></li>
<li>Serial RS232 Cable</li>
<li>USB cable for on-board emulator OR XDS510/XDS560 or similar</li></ol>
<h4><span class="mw-headline" id="Procedure">Procedure<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=28" title="Edit section: Procedure">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<ol><li>Connect one ethernet cable from OMAP's ethernet port to the gigabit ethernet switch<br /></li>
<li>Connect another ethernet cable from C6472's lower ethernet port to the gigabit ethernet switch.<br /></li>
<li>Connect on-board emulator (or XDS510 or similar) to C6472 and Windows PC</li>
<li>Connect one end of Serial Cable to OMAP's UART1/2 port and other end to Linux PC (if using minicom)<br /></li>
<li>If using NFS, Linux PC and office/home network should also be connected to the same switch via ethernet<br /></li>
<li>Ensure that EVM SW4 Settings are setup as appropriate for NFS boot<br /></li></ol>
<p><a href="File_MIDAS_Ultrasound3_Setup.html" class="image" title="MIDAS Ultrasound3 Setup.jpg"><img alt="MIDAS Ultrasound3 Setup.jpg" src="https://processors.wiki.ti.com/images/9/94/MIDAS_Ultrasound3_Setup.jpg" width="575" height="373" /></a> 
</p>
<h3><span class="mw-headline" id="Software_Setup">Software Setup</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=29" title="Edit section: Software Setup">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span id="A._Multicore_DSP_(Mid_End)"></span><span class="mw-headline" id="A._Multicore_DSP_.28Mid_End.29">A. Multicore DSP&#160;(Mid End)<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=30" title="Edit section: A. Multicore DSP (Mid End)">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>All development for the multicore DSP (C6472) is done on the <b>Windows</b> PC. 
</p>
<ol><li><b>Environment Variables</b><br />a. Windows XP: Right-click on My Computer --&gt; Properties --&gt; Advanced tab --&gt; Environment Variables --&gt; New<br />b. Define new user variable, where variable name is <i>TI_INSTALL_DIR</i> and variable value is <i>C:\ti</i><br />c. Define another new user variable, where variable name is <i>IQMATH_LIB_DIR&#160;</i>and variable value is <i>C:\ti\c64xplus-iqmath_2_01_04_00</i><br /><br /></li>
<li><b>TI Code Composer Studio</b> <b>IDE</b> <b>(CCS)</b><br />Download CCS v 4.2.1 from <a rel="nofollow" class="external free" href="http://software-dl.ti.com/ccs/esd/documents/ccs_downloads.html#Code_Composer_Studio_Version_4_Downloads">http://processors.wiki.ti.com/index.php/Download_CCS#Code_Composer_Studio_Version_4_Downloads</a> and install as C:\ti\ccsv4<br /><br /></li>
<li><b>PERL</b> <b>and 7-Zip<br /></b>Perl and 7-Zip are required to run the automated build script that will be discussed later. <br />a. Install Active Perl from <a rel="nofollow" class="external free" href="http://www.perl.org/get.html">http://www.perl.org/get.html</a>. Installs as C:\Perl by default.<br />b. Once installation is complete, please ensure that C:\Perl\site\bin and C:\Perl\bin are in your <i>Path</i>. To check this, right click on My Computer --&gt; Properties --&gt; Advanced tab --&gt; Environment Variables. The system variable <i>Path</i> should include these paths.<br />c. Install 7-Zip from <a rel="nofollow" class="external free" href="http://www.7-zip.org/">http://www.7-zip.org/</a>. Installs as C:\Program Files\7-Zip by default. Please ensure that <br /> <br /></li>
<li><b>TI Software Components Setup</b><br /> Note that it is assumed in the following steps that C:\ti is TI_INSTALL_DIR<br /><br />a. Code Generation Tools 7.03<br /> Download from <a rel="nofollow" class="external free" href="https://www-a.ti.com/downloads/sds_support/TICodegenerationTools/download.htm">https://www-a.ti.com/downloads/sds_support/TICodegenerationTools/download.htm</a><br /> Double-click the installer and let this install in the default location i.e. C:\Program Files\Texas Instruments\C6000 Code Generation Tools 7.0.3<br /><br />b. XDC Tools 3.20.06.81<br /> <a rel="nofollow" class="external free" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/rtsc/3_20_06_81/index_FDS.html">http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/rtsc/3_20_06_81/index_FDS.html</a><br /> Install as C:\ti\ xdctools_3_20_06_81<br /><br />c. Codec Engine 3.20.01.18<br /> <a rel="nofollow" class="external free" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ce/3_20_01_18/index_FDS.html">http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ce/3_20_01_18/index_FDS.html</a><br /> Extract as C:\ti\ codec_engine_3_20_01_18<br /><br />d. Sys-BIOS 6.30.03.46<br /> <a rel="nofollow" class="external free" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/sysbios/6_30_03_46/index_FDS.html">http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/sysbios/6_30_03_46/index_FDS.html</a><br /> Install as C:\ti\bios_6_30_03_46<br /><br />e. Framework Components 3.20.01.26<br /> <a rel="nofollow" class="external free" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/fc/3_20_01_26/index_FDS.html">http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/fc/3_20_01_26/index_FDS.html</a><br /> Extract as C:\ti\framework_components_3_20_01_26<br /><br />f. IPC 1.22.04.25<br /> <a rel="nofollow" class="external free" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ipc/1_22_04_25/index_FDS.html">http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ipc/1_22_04_25/index_FDS.html</a><br /> Install as C:\ti\ipc_1_22_04_25<br /><br />g. MCSDK 1.00.00.08<br /> <a rel="nofollow" class="external free" href="http://software-dl.ti.com/sdoemb/sdoemb_public_sw/bios_mcsdk/01_00_00_08/index_FDS.html">http://software-dl.ti.com/sdoemb/sdoemb_public_sw/bios_mcsdk/01_00_00_08/index_FDS.html</a><br /> Install as C:\ti\mcsdk_1_00_00_08<br /> (When asked to choose components, leave default setting i.e. all components checked)<br /><br />h. IQ Math Library 2.14<br /> <a rel="nofollow" class="external free" href="http://focus.ti.com/docs/toolsw/folders/print/sprc542.html">http://focus.ti.com/docs/toolsw/folders/print/sprc542.html</a><br /> Install as C:\ti\c64xplus-iqmath_2_01_04_00. Note that this corresponds to IQMATH_LIB_DIR defined above.<br /><br />At the end of these steps your TI_INSTALL_DIR folder should look as follows:<br /><a href="File_MIDAS3_softwaredependencies.html" class="image" title="Software Dependencies"><img alt="Software Dependencies" src="https://processors.wiki.ti.com/images/b/b3/MIDAS3_softwaredependencies.JPG" width="729" height="438" /></a><br /><br /></li>
<li>If you have not already done so, download the source code for MIDAS Ultrasound v3.0 from the GForge page. Unzip midas_usound_demo3_rel.zip as C:\ti\midas_usound_demo3_rel.<br /></li>
<li>Start CCS.&#160;When CCS is starting, it will ask you to choose a workspace. Select "C:\ti\midas_usound_demo3_rel\release\usound_demo3\ccsv4_workspace." If CCS is starting for the first time, it will autodiscover the software components installed. Now to make sure that all software components have been found, go to&#160;Window-&gt;Preferences-&gt;CCS-&gt;RTSC-&gt;Products. The snapshot should look similar to below with TI_INSTALL_DIR (C:/ti) listed under "Tool Discovery Path" and all components listed under "Discovered Tools." <br /><br /> <a href="File_MIDAS3_rtsc_components.html" class="image" title="RTSC Components"><img alt="RTSC Components" src="https://processors.wiki.ti.com/images/6/69/MIDAS3_rtsc_components.JPG" width="815" height="818" /></a><br /><br /></li>
<li><b>Build, Load and Run</b><br />a. Open midas_usound_demo3_rel\common_xdcpaths.mak to ensure that paths defined are as expected. If you followed the recommended paths in the instructions above this should not have to make any changes to this file.<br />b. Use Wordpad (or similar text editor) to open the file midas_usound_demo3\build6472.pl. Please ensure that paths defined are as expected. If you followed the recommended paths in the instructions above you should not have to make any changes to this file.<br />c. Open a command window and 'cd' to the midas_usound_demo3_rel directory.<br />d. Type 'perl build6472.pl' to execute the perl autobuild script. This will automatically build the .out files for all size cores of the C6472, viz. midendapp.out, server1.out, server2.out, server3.out, server4.out and server5.out. Note that midendapp.out corresponds to the main midend application which will run on core 0, server 1 corresponds to the BPU&#160;block, server 2 corresponds to DPU block, while server 3/4/5 don't have any significance in the current demo. <br />e. To load the cores with the relevant .out files, Open CCS --&gt; Load your target configuration that corresponds to your emulator --&gt; 'Connect' all cores of the C6472 EVM&#160;target --&gt; Load cores with corresponding .out files. <br />f. Once all cores are loaded, hit 'Run.' This will execute the program on C6472 and you should see the following message on the CCS console:<br /></li></ol>
<blockquote><pre>HPMP EVM On-board Networking Demo
EVM in StaticIP mode at 192.168.3.201
Set IP address of PC to 192.168.3.202
5:48 ( 7%) 4:96 ( 12%) 2:128 ( 8%) 0:256

1:512 ( 16%) 0:1536 0:3072

(12288/49152 mmAlloc: 12/0/0, mmBulk: 0/0/0)

1 blocks alloced in 512 byte page
4 blocks alloced in 96 byte page
2 blocks alloced in 128 byte page
5 blocks alloced in 48 byte page

emac_init: core 0, port 0, total number of channels/MAC addresses: 1/1
MAC addresses configured for channel 0:
00-24-BA-7A-9A-F2
emac_open core 0 port 0 successfully
Registration of the EMAC Successful, waiting for link up ..
Network Added: If-1:192.168.3.201
Service Status: HTTP&#160;: Enabled&#160;:&#160;: 000
NetworkOpen()
IPADRESS is = 192.168.3.202
Mid End process started
MidEnd_gatherTask started
Successfully created BPU instance
Successfully created DPU instance
Port 0 Link Status: 1000Mb/s Full Duplex on PHY 24
</pre></blockquote> 
<h4><span id="B._System-on-Chip_(Back_End)"></span><span class="mw-headline" id="B._System-on-Chip_.28Back_End.29">B. System-on-Chip (Back End)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=31" title="Edit section: B. System-on-Chip (Back End)">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>All development for the System-on-Chip (OMAP3530) is done on the <b>Linux PC</b> (Ubuntu 10.04).<br /> 
</p>
<ol><li><b>DVSDK Setup</b><br /> <i><b>A. -- Download --</b></i><br /> File is 'dvsdk_omap3530-evm_4_01_00_09_setuplinux' from <a rel="nofollow" class="external free" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/dvsdk/DVSDK_4_00/4_01_00_09/index_FDS.html">http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/dvsdk/DVSDK_4_00/4_01_00_09/index_FDS.html</a><br /> <i><b>B. -- Install --</b></i><br /> 'linuxHost$ chmod +x dvsdk_omap3530-evm_4_01_00_09_setuplinux' <br /> 'linuxHost$ ./dvsdk_omap3530-evm_4_01_00_09_setuplinux'<br />Follow instructions as directed to setup DVSDK&#160;with Network Filesystem. If using defaults, this should install as ~/ti-dvsdk_omap3530-evm_4_01_00_09. <br /> <i><b>C. -- Rebuild DVSDK and Setup Environment --</b></i><br /> 'linuxHost$ cd ~/ti-dvsdk_omap3530-evm_4_01_00_09' <br /> 'linuxHost$ make clean &amp;&amp; make' <br /> 'linuxHost$ setup.sh'<br /> After this step, among other development environment necessities, you should have NFS setup at ~/workdir/filesys, and minicom setup on your linux host with access to the OMAP terminal.<br /></li>
<li><b>IQMath Setup</b><br />Download IQMath from <a rel="nofollow" class="external free" href="http://focus.ti.com/docs/toolsw/folders/print/sprc542.html">http://focus.ti.com/docs/toolsw/folders/print/sprc542.html</a> and install<br /></li>
<li><b>Download MIDAS&#160;package and untar</b><br /> Go to <a rel="nofollow" class="external free" href="https://gforge.ti.com/gf/project/med_ultrasound/frs/">https://gforge.ti.com/gf/project/med_ultrasound/frs/</a>, and download MIDASUltrasound3.0 source code package (midas_usound_demo3_rel.zip)<br /> 'linuxHost$ unzip midas_usound_demo3_rel.zip'<br /></li>
<li><b>Setup Environment</b><br />Edit Paths as per your environment in file ~/ti_midas/miDAS/ultrasound/demo3/backend/Paths.mak<br /></li>
<li><b>Build MIDAS</b><br /> 'linuxHost$ cd ~/ti_midas/miDAS/ultrasound/demo3/backend' <br /> 'linuxHost$ make setup'<br />'linuxHost$ make backend'<br /> This will build both the 'server.x64P' and the OMAP application 'ultrasound' and will copy them to the ${EXEC_INSTALL_DIR} specified in Paths.mak. <br /></li>
<li><b>Calibrate Touchscreen</b><br /> 'target$' ts_calibrate<br /> Touch the crosshairs that appear on the screen to help record touchscreen calibration information <br /></li>
<li><b>Run MIDAS<br /></b>Run the C6472 application from CCS as described in the earlier section. Ensure that you see the last message "Port 0 Link Status: 1000Mb/s Full Duplex on PHY 24" on the CCS console. Once you see this message on the OMAP&#160;console (on minicom), perform the following<b>:<br /> '</b>target$ cd /opt/midas'<br /> 'target$ ./ultrasound -qws -display transformed:Rot270 &amp;'<br /> You will see the MIDAS welcome screen with a message "Initializing" on the OMAP's LCD&#160;screen. After some time you should see a user interface on the OMAP screen. Press the "Start" button on the OMAP to begin the demo. When running, the B-mode/Color button allows you to switch between B-mode and Color Flow modes. The Contrast drop down menu allows you to choose between three contrast settings (which are internally linked to different parameters for the BPU&#160;module). The Hide/Show button allows you to hide the user interface. The UI&#160;transparency changes the transparency of the user interface between transparent, translucent and opaque.<br /></li></ol>
<h2><span class="mw-headline" id="Algorithm_Source_Code">Algorithm Source Code</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=32" title="Edit section: Algorithm Source Code">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The algorithm source code for BPU, DPU&#160;and SCU and other ultrasound processing modules is available at <a rel="nofollow" class="external free" href="http://www.ti.com/tool/s2meddus">http://www.ti.com/tool/s2meddus</a> 
</p><p><br />
</p>
<h1><span id="Questions/Support"></span><span class="mw-headline" id="Questions.2FSupport">Questions/Support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=33" title="Edit section: Questions/Support">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Post questions to TI's Support Portal at e2e.ti.com. Please use the keyword 'MIDAS' as a keyword in your title. 
</p><p><br />
</p>
<h1><span class="mw-headline" id="Disclaimer">Disclaimer<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;section=34" title="Edit section: Disclaimer">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>System and equipment manufacturers and designers are responsible to ensure that their systems (and any TI devices incorporated in their systems) meet all applicable safety, regulatory and system-level performance requirements. All application-related information on this website (including application descriptions, suggested TI devices and other materials) is provided for reference only. This information is subject to customer confirmation, and TI disclaims all liability for system designs and for any applications assistance provided by TI. Use of TI devices in life support and/or safety applications is entirely at the buyer's risk, and the buyer agrees to defend, indemnify and hold harmless TI from any and all damages, claims, suits or expense resulting from such use.
</p><p>All software is licensed under BSD with the following terms and conditions:
</p><p>Copyright (C) 2011 Texas Instruments Incorporated - <a rel="nofollow" class="external free" href="http://www.ti.com/">http://www.ti.com/</a><br />Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:<br />Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.<br />Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.<br />Neither the name of Texas Instruments Incorporated nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.<br />This software is provided by the copyright holders and contributors "as is" and any express or implied warranties, including, but not limited to, the implied warranties of merchantability and fitness for a particular purpose are disclaimed. In no event shall the copyright owner or contributors be liable for any direct, indirect, incidental, special, exemplary, or consequential damages (including, but not limited to, procurement of substitute goods or services; loss of use, data, or profits; or business interruption) however caused and on any theory of liability, whether in contract, strict liability, or tort (including negligence or otherwise) arising in any way out of the use of this software, even if advised of the possibility of such damage.<br />
</p>
<!-- 
NewPP limit report
Cached time: 20201201103310
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.108 seconds
Real time usage: 0.115 seconds
Preprocessor visited node count: 179/1000000
Preprocessor generated node count: 240/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 1499/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:9890-0!canonical and timestamp 20201201103310 and revision id 88935
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>MIDAS Ultrasound v3.0 Demo</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>MIDAS Ultrasound v3.0 Demo</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>MIDAS Ultrasound v3.0 Demo</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>MIDAS Ultrasound v3.0 Demo</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>MIDAS Ultrasound v3.0 Demo</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>MIDAS Ultrasound v3.0 Demo</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>MIDAS Ultrasound v3.0 Demo</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>MIDAS Ultrasound v3.0 Demo</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>MIDAS Ultrasound v3.0 Demo</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;oldid=88935">https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;oldid=88935</a>"					</div>
				<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=MIDAS+Ultrasound+v3.0+Demo" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="MIDAS_Ultrasound_v3.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:MIDAS_Ultrasound_v3.0_Demo&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="MIDAS_Ultrasound_v3.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/MIDAS_Ultrasound_v3.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/MIDAS_Ultrasound_v3.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;oldid=88935" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=MIDAS_Ultrasound_v3.0_Demo&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 9 December 2011, at 03:49.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.108","walltime":"0.115","ppvisitednodes":{"value":179,"limit":1000000},"ppgeneratednodes":{"value":240,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":1499,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20201201103310","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":346});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/MIDAS_Ultrasound_v3.0_Demo by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 13:11:19 GMT -->
</html>
