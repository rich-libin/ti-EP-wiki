<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/Migrating_DCI_Applications_to_CToolsLib by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 09:54:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Migrating DCI Applications to CToolsLib - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Migrating_DCI_Applications_to_CToolsLib","wgTitle":"Migrating DCI Applications to CToolsLib","wgCurRevisionId":55306,"wgRevisionId":55306,"wgArticleId":8985,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Migrating_DCI_Applications_to_CToolsLib","wgRelevantArticleId":8985,"wgRequestId":"b799d81545554c597583b79e","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Migrating_DCI_Applications_to_CToolsLib rootpage-Migrating_DCI_Applications_to_CToolsLib skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">Migrating DCI Applications to CToolsLib</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Migrating_from_DCI_to_the_CToolsLib_family_of_target_libraries"><span class="tocnumber">1</span> <span class="toctext">Migrating from DCI to the CToolsLib family of target libraries</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Overview"><span class="tocnumber">1.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Feature_Comparison"><span class="tocnumber">1.2</span> <span class="toctext">Feature Comparison</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Key_Differences"><span class="tocnumber">1.3</span> <span class="toctext">Key Differences</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#The_CTools_Family_of_Libraries"><span class="tocnumber">1.4</span> <span class="toctext">The CTools Family of Libraries</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#AETLIb"><span class="tocnumber">1.4.1</span> <span class="toctext">AETLIb</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#ETBLib"><span class="tocnumber">1.4.2</span> <span class="toctext">ETBLib</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#DSPTraceLib"><span class="tocnumber">1.4.3</span> <span class="toctext">DSPTraceLib</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-9"><a href="#Functional_API_Migration"><span class="tocnumber">1.5</span> <span class="toctext">Functional API Migration</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#DCI_Control.28DCI_command_.2Acommand.2C_void_.2Aparams.29"><span class="tocnumber">1.5.1</span> <span class="toctext">DCI_Control(DCI_command *command, void *params)</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#DCI_open.28DCI_Config_.2Aconfig.29"><span class="tocnumber">1.5.2</span> <span class="toctext">DCI_open(DCI_Config *config)</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#DCI_close.28.29"><span class="tocnumber">1.5.3</span> <span class="toctext">DCI_close()</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="#Enumeration_Migration"><span class="tocnumber">1.6</span> <span class="toctext">Enumeration Migration</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="#Trigger_Type"><span class="tocnumber">1.6.1</span> <span class="toctext">Trigger Type</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Trigger_Logic_Orientation"><span class="tocnumber">1.6.2</span> <span class="toctext">Trigger Logic Orientation</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Data_Access_Type"><span class="tocnumber">1.6.3</span> <span class="toctext">Data Access Type</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#Reference_Access_Size"><span class="tocnumber">1.6.4</span> <span class="toctext">Reference Access Size</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#Error_Status"><span class="tocnumber">1.6.5</span> <span class="toctext">Error Status</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Code_Example"><span class="tocnumber">2</span> <span class="toctext">Code Example</span></a>
<ul>
<li class="toclevel-2"><a href="#Overview_2"><span class="tocnumber">2.1</span> <span class="toctext">Overview</span></a>
<ul>
<li class="toclevel-3"><a href="#Header_Section"><span class="tocnumber">2.1.1</span> <span class="toctext">Header Section</span></a></li>
<li class="toclevel-3"><a href="#Parameter_Structures_And_Variables"><span class="tocnumber">2.1.2</span> <span class="toctext">Parameter Structures And Variables</span></a></li>
<li class="toclevel-3"><a href="#DoTest_Function"><span class="tocnumber">2.1.3</span> <span class="toctext">DoTest Function</span></a></li>
<li class="toclevel-3"><a href="#Auxilliary_Functions"><span class="tocnumber">2.1.4</span> <span class="toctext">Auxilliary Functions</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-19"><a href="#Additional_Information"><span class="tocnumber">3</span> <span class="toctext">Additional Information</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Migrating_from_DCI_to_the_CToolsLib_family_of_target_libraries">Migrating from DCI to the CToolsLib family of target libraries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=1" title="Edit section: Migrating from DCI to the CToolsLib family of target libraries">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Overview">Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=2" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The Debug Control Interface (DCI) is a target library created to implement a simple API that gives the user access to the Advanced Event Triggering (AET) and Trace capabilities on the 64x+ devices, along with support for logging of EDMA activity.  It was written for the 64x+ family of devices.  As the capabilities of the target's emulation hardware continue to increase, and as target applications continue to make use of this hardware, it became necessary to break this functionality up over a family of libraries in order to minimize the footprint required to get a specific combination of functionalities.  Moving forward, DCI will not be supported, so users that want the same capabilites on the 66x will need to migrate their code to use a new family of libraries, the CToolsLib family of libraries.  The CToolsLib family consists of a number of individual target libraries; AETLib, ETBLib, and DspTraceLib, among others.  AETLib, which DCI was also built on top of, gives the user access to the triggering hardware built into the C66x device.  It has an API very similar to that of DCI.  ETBLib enables configuration of the Embedded Trace Buffers contained within each CorePac.  A limited amount of this functionality was provided directly in DCI on the 64x+.  DspTraceLib enables configuring of a Trace emulator to be used for capturing large amounts of trace data generated by an application.  DCI enabled Export only via the ETB.  The DspTraceLib adds the ability to export to a Trace Emulator.
</p>
<div class="block-note"><span class="block-contents"><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b> EDMA Logging is not supported in CToolsLib. If this capability is needed, it is up to the user to migrate the necessary content from DCI, since the DCI source code is available.  One alternative would be for the user to refactor the DCI layer to sit on top of the CToolsLibs.  AS it exists now, DCI already sits on top of AETLib.  There are a few ETB functions that would need to be migrated to use ETBLib and then the DCI interface could continue to be used.  This is a task for the user as there will be no formal support of DCI moving forward.</span></div>
<p>This document is meant to provide a road map for migration from the Debug Control Interface to the CTools family of libraries.  Functionally, CToolsLib provides all of the capabilities of DCI, except for the support for EDMA logging.  This document is not meant as a substitute for the documentation of each of the individual libraries.  It is merely meant as a roadmap for migration between the two. 
</p><p>Each individual library has doxygen generated documentation that details the APIs and enumerations supported within that library.  This documentation will also be valuable in your migration efforts.
</p>
<h2><span class="mw-headline" id="Feature_Comparison">Feature Comparison</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=3" title="Edit section: Feature Comparison">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The table below details the feature comparison between the DCI Library and the CTools family of libraries.  Note that the CToolsLib feature list is not comprehensive.  Only features with analogous functions in DCI are mentioned here.
</p>
<table class="wikitable" style="text-align: center; border: 0px; width: 50%">
<caption>Comparison of DCI and the CTools Family
</caption>
<tbody><tr>
<th>DCI
</th>
<th>CToolsLib
</th></tr>
<tr>
<td>Advanced Event Triggering (AET) Support
</td>
<td>Advanced Event Triggering (AET) Support
</td></tr>
<tr>
<td>Embedded Trace Buffer (ETB) Support
</td>
<td>Embedded Trace Buffer (ETB) Support
</td></tr>
<tr>
<td>DSP Trace Export Support (Limited to ETB)
</td>
<td>DSP Trace Export Support
</td></tr>
<tr>
<td>DMA Logging
</td>
<td>
</td></tr>
<tr>
<td>
</td>
<td>System Trace (STM) Support
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Key_Differences">Key Differences</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=4" title="Edit section: Key Differences">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ol><li>DCI is a single library that encapsulates the functionality of the AETLib and ETBLib libraries, along with some additional support for EDMA logging.  The CTools family of libraries breaks these functions out into a set of smaller libraries and the user can choose which libraries he prefers to use.</li>
<li>CToolsLib does NOT support the EDMA Logging.</li></ol>
<h2><span class="mw-headline" id="The_CTools_Family_of_Libraries">The CTools Family of Libraries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=5" title="Edit section: The CTools Family of Libraries">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Documentation and the location for download of the CTools Family of libraries can be found {{#tiwikiurl:CToolsLib|here}}
</p>
<h3><span class="mw-headline" id="AETLIb">AETLIb</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=6" title="Edit section: AETLIb">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Find additional information on AETlib {{#tiwikiurl:AETLib|here}}</li></ul>
<p>AETLib is a library that supports programming the Advanced Event Triggering unit to generate specific triggers based on sets of events that occur in an application.  These triggers can be used for halting the CPU, incrementing a counter, generating an interrupt,  telling the trace unit to start or stop capturing Trace data, and much more.  AETLib only configures the AET hardware to generate these triggers.  It does not configure any separate hardware to capture the results of those triggers.  For example, if AET is configured to generate Trace Data, the user must also configure the Trace receiver to capture the data, otherwise, no trace data will be captured.
</p>
<h3><span class="mw-headline" id="ETBLib">ETBLib</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=7" title="Edit section: ETBLib">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>ETBLib is a library that supports configuration and reading of the on-chip embedded trace buffer.
</p>
<h3><span class="mw-headline" id="DSPTraceLib">DSPTraceLib</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=8" title="Edit section: DSPTraceLib">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>DSPTraceLib provides the ability to generate trace information and export it to a Trace buffer on an external emulator such as the XDS560T.  DCI only provided support for exporting trace data to the ETB, so there will be no direct use of DSPTraceLib in this document.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Functional_API_Migration">Functional API Migration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=9" title="Edit section: Functional API Migration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section details the relationship between the APIs provided in DCI, and the corresponding APIs in the CToolsLib family of libraries.
</p>
<h3><span id="DCI_Control(DCI_command_*command,_void_*params)"></span><span class="mw-headline" id="DCI_Control.28DCI_command_.2Acommand.2C_void_.2Aparams.29">DCI_Control(DCI_command *command, void *params)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=10" title="Edit section: DCI Control(DCI command *command, void *params)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The heart of the DCI API is the <i><b>DCI_control(DCI_command *command, void *params)</b></i> function.  This is where the majority of the actions performed by DCI are defined, based on the DCI_command parameter that is passed to the function.  In the Command Migration table, each DCI_command value is correlated with the associated functions that will now be used from CToolsLib. Note that in some cases, there is not a 1-1 correspondence between a DCI command and the function that needs to be called.  This is due to the DCI Layer abstracting away some of the details of the underlying code. 
</p><p><br />
</p>
<table class="wikitable" style="text-align: center; border: 1px; width: 75%">
<caption>DCI Command Migration
</caption>
<tbody><tr>
<th>DCI Command</th>
<th>New Command</th>
<th>New Location</th>
<th>Parameters
</th></tr>
<tr>
<td>DCI_CMD_AET_CLAIM</td>
<td>AET_claim()</td>
<td>AETlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_AET_RELEASE</td>
<td>AET_release()</td>
<td>AETlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_AET_ENABLE</td>
<td>AET_enable()</td>
<td>AETlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_AET_CLEAR_JOB</td>
<td>AET_releaseJob()</td>
<td>AETlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_AET_PAP</td>
<td>AET_setupJob()</td>
<td>AETlib</td>
<td>AET_JOB_TRIG_ON_PC
</td></tr>
<tr>
<td>DCI_CMD_PAR</td>
<td>AET_setupJob()</td>
<td>AETlib</td>
<td>AET_JOB_TRIG_ON_PC_RANGE
</td></tr>
<tr>
<td>DCI_CMD_AET_DAP</td>
<td>AET_setupJob()</td>
<td>AETlib</td>
<td>AET_JOB_TRIG_ON_DATA
</td></tr>
<tr>
<td>DCI_CMD_AET_DAPVAL</td>
<td>AET_setupJob()</td>
<td>AETlib</td>
<td>AET_JOB_TRIG_ON_DATA_WITH_VAL
</td></tr>
<tr>
<td>DCI_CMD_AET_DAR</td>
<td>AET_SetupJob()</td>
<td>AETlib</td>
<td>AET_JOB_TRACE_IN_DATA_RANGE
</td></tr>
<tr>
<td>DCI_CMD_AET_EVT</td>
<td>Multiple Functions</td>
<td>AETlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_AET_CFG_CNT</td>
<td>AET_configCounter</td>
<td>AETlib</td>
<td>Counter Number
</td></tr>
<tr>
<td>DCI_CMD_AET_GET_CNT</td>
<td>AET_readCounter</td>
<td>AETlib</td>
<td>Counter Number
</td></tr>
<tr>
<td>DCI_CMD_ETB_RESET</td>
<td>ETB_close(), ETB_open()</td>
<td>ETBlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_ETB_ENABLE</td>
<td>ETB_enable(), DSPTrace_enable()</td>
<td>ETBlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_ETB_DISABLE</td>
<td>ETB_disable(), DSPTrace_disable()</td>
<td>ETBlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_ETB_DRAIN</td>
<td>ETB_read()</td>
<td>ETBlib</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_ETB_IDLE_EXIT</td>
<td>NOT NEEDED</td>
<td></td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_ALLOC_DMA</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_ALLOC_CPU</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_FREE_DMA</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_FREE_CPU</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_EDMASTART</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_ENABLE</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_DISABLE</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_TRIG_CPU</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
<tr>
<td>DCI_CMD_LOG_GET_TCC_INFO</td>
<td></td>
<td>NOT SUPPORTED</td>
<td>
</td></tr>
</tbody></table>
<h3><span id="DCI_open(DCI_Config_*config)"></span><span class="mw-headline" id="DCI_open.28DCI_Config_.2Aconfig.29">DCI_open(DCI_Config *config)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=11" title="Edit section: DCI open(DCI Config *config)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Purpose: Initialize Debug Hardware and Software</li>
<li>Migration Notes: There are different functions that need to be called in place of DCI open based on the implementation.  Any or all of the following functions may be needed.</li></ul>
<table class="wikitable" style="text-align: center; border: 1px; width: 75%">
<caption>DCI_open Migration
</caption>
<tbody><tr>
<th>Function</th>
<th>Library</th>
<th>Purpose</th>
<th>Needed IF
</th></tr>
<tr>
<td>AET_init()</td>
<td>AETlib</td>
<td>Initializes AET variables and data</td>
<td>Any AET Commands Will Be Used
</td></tr>
<tr>
<td>ETB_open()</td>
<td>ETBLib</td>
<td>Open and initialize ETB</td>
<td>Using ETB To capture Trace Data
</td></tr>
</tbody></table>
<h3><span id="DCI_close()"></span><span class="mw-headline" id="DCI_close.28.29">DCI_close()</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=12" title="Edit section: DCI close()">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Purpose: Close Debug Hardware and Software Cleanup</li>
<li>Migration Notes: There are different functions that need to be called in place of DCI open based on the implementation.  Any or all of the following functions may be needed.</li></ul>
<table class="wikitable" style="text-align: center; border: 1px; width: 75%">
<caption>DCI_open Migration
</caption>
<tbody><tr>
<th>Function</th>
<th>Library</th>
<th>Purpose</th>
<th>Needed IF
</th></tr>
<tr>
<td>AET_release()</td>
<td>AETlib</td>
<td>Relinquishes Ownership of the AET unit</td>
<td>If AET_claim() was called, AET_release() should be called
</td></tr>
<tr>
<td>ETB_close()</td>
<td>ETBLib</td>
<td>Close the ETB and release the ETB Handle Pointer</td>
<td>If ETB_open() was called, ETB_close() should be called
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Enumeration_Migration">Enumeration Migration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=13" title="Edit section: Enumeration Migration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>These tables list AET configuration enumerations from DCI Lib and their equivalent enumerations for AETLIb.
</p>
<h3><span class="mw-headline" id="Trigger_Type">Trigger Type</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=14" title="Edit section: Trigger Type">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The TriggerType Parameter specifies the "Action" that will occur whenever the parameters set by the AET Job are met
</p>
<ul><li><b>Examples (not exhaustive)</b>
<ul><li>CPU Halt</li>
<li>CPU Interrupt</li>
<li>Start Trace</li></ul></li></ul>
<table class="wikitable" style="text-align: center; border: 1px; width: 75%">
<caption>DCI TriggerType / AET TriggerType Correlations
</caption>
<tbody><tr>
<th>DCI Parameter</th>
<th>AETlib Parameter</th>
<th>Description
</th></tr>
<tr>
<td>DCI_TRIG_BAD</td>
<td>No Correlated AET TriggerType</td>
<td>
</td></tr>
<tr>
<td>DCI_TRIG_CPU_HALT</td>
<td>AET_TRIG_HALT_CPU</td>
<td>Halt CPU
</td></tr>
<tr>
<td>DCI_TRIG_CPU_INT</td>
<td>AET_TRIG_AINT</td>
<td>Generate a CPU interrupt
</td></tr>
<tr>
<td>DCI_TRIG_WM0S</td>
<td>AET_TRIG_WM0START</td>
<td>Start watermark 0
</td></tr>
<tr>
<td>DCI_TRIG_WM0E</td>
<td>AET_TRIG_WM0STOP</td>
<td>End watermark 0
</td></tr>
<tr>
<td>DCI_TRIG_WM1S</td>
<td>AET_TRIG_WM1START</td>
<td>Start watermark 1
</td></tr>
<tr>
<td>DCI_TRIG_WM1E</td>
<td>AET_TRIG_WM1STOP</td>
<td>End watermark 1
</td></tr>
<tr>
<td>DCI_TRIG_CNT0S</td>
<td>AET_TRIG_CNT0_START</td>
<td>Start timer / Decrement counter 0
</td></tr>
<tr>
<td>DCI_TRIG_CNT0E</td>
<td>AET_TRIG_CNT0_STOP</td>
<td>End timer / Reload counter 0
</td></tr>
<tr>
<td>DCI_TRIG_CNT1S</td>
<td>AET_TRIG_CNT1_START</td>
<td>Start timer / Decrement counter 1
</td></tr>
<tr>
<td>DCI_TRIG_CNT1E</td>
<td>AET_TRIG_CNT1_STOP</td>
<td>End timer / Reload counter 1
</td></tr>
<tr>
<td>DCI_TRIG_ET0</td>
<td>AET_TRIG_ET0</td>
<td>External Trigger 0
</td></tr>
<tr>
<td>DCI_TRIG_ET1</td>
<td>AET_TRIG_ET1</td>
<td>External Trigger 1
</td></tr>
<tr>
<td>DCI_TRIG_TRCS</td>
<td>AET_TRIG_TRACE_TRIGGER</td>
<td>Start trace
</td></tr>
<tr>
<td>DCI_TRIG_TRCE</td>
<td>AET_TRIG_TRACE_END</td>
<td>End trace
</td></tr>
<tr>
<td>DCI_TRIG_STATE_0_TO_1</td>
<td>AET_TRIG_STATE_0_TO_1</td>
<td>State Machine 0-1
</td></tr>
<tr>
<td>DCI_TRIG_STATE_0_TO_2</td>
<td>AET_TRIG_STATE_0_TO_2</td>
<td>State Machine 0-2
</td></tr>
<tr>
<td>DCI_TRIG_STATE_0_TO_3</td>
<td>AET_TRIG_STATE_0_TO_3</td>
<td>State Machine 0-3
</td></tr>
<tr>
<td>DCI_TRIG_STATE_1_TO_0</td>
<td>AET_TRIG_STATE_1_TO_0</td>
<td>State Machine 1-0
</td></tr>
<tr>
<td>DCI_TRIG_STATE_1_TO_2</td>
<td>AET_TRIG_STATE_1_TO_2</td>
<td>State Machine 1-2
</td></tr>
<tr>
<td>DCI_TRIG_STATE_1_TO_3</td>
<td>AET_TRIG_STATE_1_TO_3</td>
<td>State Machine 1-3
</td></tr>
<tr>
<td>DCI_TRIG_STATE_2_TO_0</td>
<td>AET_TRIG_STATE_2_TO_0</td>
<td>State Machine 2-0
</td></tr>
<tr>
<td>DCI_TRIG_STATE_2_TO_1</td>
<td>AET_TRIG_STATE_2_TO_1</td>
<td>State Machine 2-1
</td></tr>
<tr>
<td>DCI_TRIG_STATE_2_TO_3</td>
<td>AET_TRIG_STATE_2_TO_3</td>
<td>State Machine 2-3
</td></tr>
<tr>
<td>DCI_TRIG_STATE_3_TO_0</td>
<td>AET_TRIG_STATE_3_TO_0</td>
<td>State Machine 3-0
</td></tr>
<tr>
<td>DCI_TRIG_STATE_3_TO_1</td>
<td>AET_TRIG_STATE_3_TO_1</td>
<td>State Machine 3-1
</td></tr>
<tr>
<td>DCI_TRIG_STATE_3_TO_2</td>
<td>AET_TRIG_STATE_3_TO_2</td>
<td>State Machine 3-2
</td></tr>
<tr>
<td>DCI_TRIG_TRCA</td>
<td></td>
<td>Trace Active
</td></tr>
<tr>
<td>DCI_TRIG_TRCI</td>
<td></td>
<td>Trace Inactive
</td></tr>
<tr>
<td>DCI_TRIG_MAX</td>
<td></td>
<td>
</td></tr></tbody></table>
<h3><span class="mw-headline" id="Trigger_Logic_Orientation">Trigger Logic Orientation</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=15" title="Edit section: Trigger Logic Orientation">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The Logic Orientation parameter specifies when AET will trigger.  A Straightforward or Normal trigger specifies to trigger whenever the set of AET parameters is true.  An inverted orientation specifies for the trigger to occur whenever the set of AET Parameters is false.
</p>
<ul><li><b>Example - Consider a Trace in Range job where a range of addresses is specified</b>
<ul><li>A Normal/Straightforward Logic Orientation will trace whenever the PC is within the range of addresses</li>
<li>An Inverted Logic orientation will trace whenever the PC is outside the range of addresses</li></ul></li></ul>
<table class="wikitable" style="text-align: center; border: 1px; width: 50%">
<caption>DCI_TriggerLogicOrientation / AET_triggerLogicOrientation
</caption>
<tbody><tr>
<th>DCI Parameter</th>
<th>AETlib Parameter
</th></tr>
<tr>
<td>DCI_TRIG_LOGIC_NORMAL</td>
<td>AET_TRIG_LOGIC_STRAIGHTFORWARD
</td></tr>
<tr>
<td>DCI_TRIG_LOGIC_INVERTED</td>
<td>AET_TRIG_LOGIC_INVERTED
</td></tr></tbody></table>
<h3><span class="mw-headline" id="Data_Access_Type">Data Access Type</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=16" title="Edit section: Data Access Type">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The Data Access Type determines the type of access to be monitored by AET (read/write). 
</p>
<table class="wikitable" style="text-align: center; border: 1px; width: 50%">
<caption>DCI_DataAccessType / AET_watchReadWrite
</caption>
<tbody><tr>
<th>DCI Parameter</th>
<th>AETlib Parameter
</th></tr>
<tr>
<td>DCI_DATACC_WRITE</td>
<td>AET_WATCH_WRITE
</td></tr>
<tr>
<td>DCI_DATACC_READ</td>
<td>AET_WATCH_READ
</td></tr></tbody></table>
<h3><span class="mw-headline" id="Reference_Access_Size">Reference Access Size</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=17" title="Edit section: Reference Access Size">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The Data Access Size determines the reference size of the access to be monitored by AET.  It is important to make the distinction between the reference size of the access, and the access size.  The reference size of the access essentially is the span of bytes past the read/write address that is considered to be a "Hit"
</p>
<ul><li><b>Example - An AET Job is configured to generate an interrupt when address 0x08000000 is written to.  A 16-bit write to address 0x08000002 occurs </b>
<ul><li>If the Reference Size is Byte (8-bits), no interrupt is generated because the reference size specifies to not look past byte 0x08000000</li>
<li>If the Reference Size is Half Word (16-bits), no interrupt is generated because the reference size specifies to not look past byte 0x08000001</li>
<li>If the Reference Size is Word (32-bits), an interrupt is generated because the reference size specifies to not look past byte 0x08000003 and our write is within that range</li>
<li>If the Reference Size is Double Word (64-bits), an interrupt is generated because the reference size specifies to not look past byte 0x08000007 and our write is within that range</li></ul></li></ul>
<p><br />
</p>
<table class="wikitable" style="text-align: center; border: 1px; width: 50%">
<caption>DCI_DataAccessSizeType / AET_refSize
</caption>
<tbody><tr>
<th>DCI Parameter</th>
<th>AETlib Parameter
</th></tr>
<tr>
<td>DCI_DATACCSIZE_BYTE</td>
<td>AET_REF_SIZE_BYTE
</td></tr>
<tr>
<td>DCI_DATACCSIZE_HALFWORD</td>
<td>AET_REF_SIZE_HALFWORD
</td></tr>
<tr>
<td>DCI_DATACCSIZE_WORD</td>
<td>AET_REF_SIZE_WORD
</td></tr>
<tr>
<td>DCI_DATACCSIZE_DOUBLEWORD</td>
<td>AET_REF_SIZE_DOUBLEWORD
</td></tr></tbody></table>
<h3><span class="mw-headline" id="Error_Status">Error Status</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=18" title="Edit section: Error Status">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Each DCI command can return an error status to be handled by the application.   Each DCI Status is shown below, along with the new status, the library that will generate the new status, and an explanation of the error message.  Note that much of the error handling is now done within DSPTraceLib and ETBLib.  These libraries will typically only give a pass/fail status in the cases where DCI might return a status that is a bit more meaningful.
</p><p><br />
</p>
<table class="wikitable" style="text-align: center; border: 1px; width: 50%">
<caption>DCI Error Status
</caption>
<tbody><tr>
<th>DCI Status</th>
<th>New Status</th>
<th>Generating Lib</th>
<th>Description
</th></tr>
<tr>
<td>DCI_STATUS_BAD</td>
<td>
</td></tr>
<tr>
<td>DCI_STATUS_OK</td>
<td>AET_SOK, eETB_Success</td>
<td>AETLib, ETBLib</td>
<td>Command executed properly
</td></tr>
<tr>
<td>DCI_STATUS_NORESOURCES</td>
<td>AET_FNOTAVAIL, AET_FNOTAVAILACMP, AET_FNOTAVAILAEG, AET_FNOTAVAILCNT, AET_FNOTAVAILDCMP, AET_FNOTAVAILSM, AET_FNOTAVAILTB1, AET_FNOTAVAILTB3, AET_FNOTAVAILTB7</td>
<td>AETLib</td>
<td>Resources were not available - AETlib gives a more descriptive error code based on which resources were not available.
</td></tr>
<tr>
<td>DCI_STATUS_OPENFAIL</td>
<td></td>
<td></td>
<td>DCI interface already open - This error does not exist outside of DCI
</td></tr>
<tr>
<td>DCI_STATUS_AETBUSY</td>
<td>AET_FNOCLAIM</td>
<td>AETLib</td>
<td>Could not claim AET unit access
</td></tr>
<tr>
<td>DCI_STATUS_ETB_DTFINITFAIL</td>
<td>eDSPTrace_Error_Program</td>
<td>DSPTraceLib</td>
<td>DTF CSL could not be initialized -
</td></tr>
<tr>
<td>DCI_STATUS_ETB_DTFOPENFAIL</td>
<td>eDSPTrace_Error_Program</td>
<td>DSPTraceLib</td>
<td>DTF CSL could not be opened
</td></tr>
<tr>
<td>DCI_STATUS_ETB_DTFCLOSEFAIL</td>
<td>eDSPTrace_Error_Program</td>
<td>DSPTraceLib</td>
<td>DTF CSL could not be closed
</td></tr>
<tr>
<td>DCI_STATUS_ETB_DTFBUSY</td>
<td>eDSPTrace_Error_Program</td>
<td>DSPTraceLib</td>
<td>DTF HW could not be accessed
</td></tr>
<tr>
<td>DCI_STATUS_ETB_TRXPBUSY</td>
<td>eDSPTrace_Error_Program</td>
<td>DSPTraceLib</td>
<td>Trace export block could not be accessed
</td></tr>
<tr>
<td>DCI_STATUS_ETB_INITFAIL</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>ETB CSL module could not be initialized
</td></tr>
<tr>
<td>DCI_STATUS_ETB_OPENFAIL</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>ETB CSL module could not be opened
</td></tr>
<tr>
<td>DCI_STATUS_ETB_CLOSEFAIL</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>ETB CSL module could not be closed
</td></tr>
<tr>
<td>DCI_STATUS_ETB_ENAFAIL</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>ETB HW module could not be enabled
</td></tr>
<tr>
<td>DCI_STATUS_ETB_BUSY</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>ETB module could not be accessed
</td></tr>
<tr>
<td>DCI_STATUS_ETB_OVERWRITE</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>ETB buffer has been overwritten by new data before old data has been read out
</td></tr>
<tr>
<td>DCI_STATUS_ETB_DISABLED</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>ETB is disabled
</td></tr>
<tr>
<td>DCI_STATUS_ETB_TCD_TIMEOUT</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>Timeout in disabling trace capture
</td></tr>
<tr>
<td>DCI_STATUS_ETB_TCE_TIMEOUT</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>Timeout in enabling trace capture
</td></tr>
<tr>
<td>DCI_STATUS_ETB_ACQC_TIMEOUT</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>Timeout in Acquisition Completion
</td></tr>
<tr>
<td>DCI_STATUS_ETB_DRAINNUMWORDSFAIL</td>
<td>eETB_Error_Program</td>
<td>ETBLib</td>
<td>etbDrainNumWords too large
</td></tr>
<tr>
<td>DCI_STATUS_ETB_DEPTHERROR</td>
<td>None</td>
<td>None</td>
<td>ETB depth was not expected. This can only be caused by a DCI build configuration error.
</td></tr>
<tr>
<td>DCI_STATUS_INVALIDCOUNTERMODE</td>
<td>AET_FINVALIDCNTMODE</td>
<td>AETLib</td>
<td>Invalid counter mode
</td></tr>
<tr>
<td>DCI_STATUS_INVALIDCOMMAND</td>
<td>AET_FJOBNOTSUPPORTED, AET_FNOJOBIMPLEMENTED</td>
<td>AETLib</td>
<td>Invalid command
</td></tr>
<tr>
<td>DCI_STATUS_INVALIDINDEX</td>
<td>AET_FJOBNOTPROGRAMMED</td>
<td>AETLib</td>
<td>Invalid job index
</td></tr>
<tr>
<td>DCI_STATUS_INVALIDLOGMETHOD</td>
<td>None</td>
<td>None</td>
<td>Invalid log method
</td></tr>
<tr>
<td>DCI_STATUS_LOGNOTSUPPORTED</td>
<td>None</td>
<td>None</td>
<td>Unsupported log type for this channel
</td></tr>
<tr>
<td>DCI_STATUS_LOGSOURCENOTALLOCATED</td>
<td>None</td>
<td>None</td>
<td>Log source is not allocated
</td></tr>
<tr>
<td>DCI_STATUS_LOGFREEFAIL</td>
<td>None</td>
<td>None</td>
<td>Logs did not exist for the channel or source
</td></tr>
<tr>
<td>DCI_STATUS_INVALIDHANDLE</td>
<td></td>
<td></td>
<td>Invalid handle given as parameter
</td></tr>
<tr>
<td>DCI_STATUS_ERROR</td>
<td></td>
<td></td>
<td>Error in executing command
</td></tr></tbody></table>
<h1><span class="mw-headline" id="Code_Example">Code Example</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib/CodeExample&amp;action=edit&amp;section=T-1" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Overview_2">Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib/CodeExample&amp;action=edit&amp;section=T-2" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This example details the migration of an Application using DCI to an equivalent application using the CToolsLib family of libraries. In both cases, the application is attempting to capture trace data into the Embedded Trace Buffer while the Program Counter is within a specified range.  Once the data is captured, the application will read it out of the Embedded trace buffer and store it in a binary file on the host in the same directory as the .out file.  The same flow executes two times and generates two .bin files which can then be translated into human readable trace output by using a utility called bin2tdf supplied with Code Composer Studio.
</p>
<h3><span class="mw-headline" id="Header_Section">Header Section</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib/CodeExample&amp;action=edit&amp;section=T-3" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Note the removal of the DCI header file, and the inclusions of the header files of the CToolsLib libraries that we will need for this specific task.
</p>
<table class="wikitable" style="text-align: left; border: 0px; width: 80%; vertical-align:text-top;">
<tbody><tr>
<th>DCI
</th>
<th>CToolsLib
</th></tr>
<tr valign="top">
<td>&lt;syntaxhighlight lang="c" enclose="div"&gt;
<ol><li>include &lt;stdio.h&gt;</li>
<li>include &lt;stdlib.h&gt;</li>
<li>include &lt;string.h&gt;</li>
<li>include &lt;dci.h&gt;</li>
<li>include &lt;c6x.h&gt;</li>
<li>include &lt;tistdtypes.h&gt;</li></ol>
<p>&lt;/syntaxhighlight&gt;
</p>
</td>
<td>&lt;syntaxhighlight lang="c" enclose="div"&gt;
<ol><li>include &lt;stdio.h&gt;</li>
<li>include &lt;stdlib.h&gt;</li>
<li>include &lt;string.h&gt;</li>
<li>include &lt;c6x.h&gt;</li>
<li>include &lt;tistdtypes.h&gt;</li>
<li>include &lt;aet.h&gt;</li>
<li>include "DSPTraceExport.h"</li>
<li>include "ETBInterface.h"</li></ol>
<p>&lt;/syntaxhighlight&gt;
</p>
</td></tr></tbody></table>
<h3><span class="mw-headline" id="Parameter_Structures_And_Variables">Parameter Structures And Variables</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib/CodeExample&amp;action=edit&amp;section=T-4" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>It up to the user to decide how to allocate these variables, as global or local.  With CToolsLib, there are parameters structures for each of the libraries used.
</p>
<table class="wikitable" style="text-align: left; border: 0px; width: 80%; vertical-align:text-top;">
<tbody><tr>
<th>DCI
</th>
<th>CToolsLib
</th></tr>
<tr valign="top">
<td>&lt;syntaxhighlight lang="c" enclose="div"&gt;
<p>/* ======== DCI command structure ======== */
DCI_Command dciCmd;
/* Trace Configuration Parameters */
DCI_TraceConfig trcCfg;
</p><p>DCI_Config dciCfg = DCI_CONFIG_DEFAULT;  /* Initialize to defaults */
DCI_ActionRange parTrcRange;  /*
&lt;/syntaxhighlight&gt;
</p>
</td>
<td>&lt;syntaxhighlight lang="c" enclose="div"&gt;
<p>/* ======== AETLib Related Variables ======== */
AET_jobParams traceRangeParams = AET_JOBPARAMS;
</p>
<pre>   /* Parameters Structure Initialized to defaults */
</pre>
<p>AET_jobIndex traceRangeJob;
</p>
<pre>   /* Job Index Variable */
</pre>
<p>AET_error aetRet;
</p>
<pre>   /* Function Return Status */
</pre>
<p><br />
/* ======== ETBLib Related Variables ======== */
eETB_Error  etbRet;
</p>
<pre>   /* ETBLib Error Code */
</pre>
<p>ETB_errorCallback pETBErrCallBack =0;
</p>
<pre>   /* Pointer to Error Callback Function */
</pre>
<p>ETBHandle* pETBHandle[NUM_CORES];
</p>
<pre>   /* Array of pointers to ETB Interface
      Handle (one per core) */
</pre>
<p>/* ======== DSPTraceLib Related Variables ======== */
eDSPTrace_Error dspRet;
</p>
<pre>   /* DSPTraceLib Error Code */
</pre>
<p>DSPTrace_errorCallback pDSPErrorCallBack=0;
</p>
<pre>   /* Pointer to Error Callback Function */
</pre>
<p>DSPTraceHandle* pDSPHandle=0;
</p>
<pre>   /* DSPTraceLib Interface Handle */
</pre>
<p>&lt;/syntaxhighlight&gt;
</p>
</td></tr></tbody></table>
<p><br />
</p>
<h3><span class="mw-headline" id="DoTest_Function">DoTest Function</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib/CodeExample&amp;action=edit&amp;section=T-5" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<table class="wikitable" style="text-align: left; border: 0px; width: 80%; vertical-align:text-top;">
<tbody><tr>
<th>DCI
</th>
<th>CToolsLib
</th></tr>
<tr valign="top">
<td>&lt;syntaxhighlight lang="c" enclose=div&gt;
<p>Uint32 doTest()
{
</p>
<pre> Uint32 callCnt, dNum;
</pre>
<pre>   /* DCI config structure */
   DCI_Config dciCfg = DCI_CONFIG_DEFAULT;
</pre>
<pre>   /* Trigger Event Parameters */
   DCI_ActionRange parTrcRange;
   Uint32 iter;
</pre>
<pre>   /* ======== Initialize the Trace PLL ======== */
 trace_pll_init(PLL_DIV_VALUE);
</pre>
<p><br />
</p>
<pre> /* ======== Configure ETB Parameters ======== */
</pre>
<pre> dciCfg.etbDrainBuffer = drainBuffer;
     /* Set the location where the ETB data
        will be drained to */
</pre>
<pre> dciCfg.etbDrainBufferSize = DRAINBUF_SIZE;
       /* Set the size of the ETB drain buffer.
          This should be at least the size of
          the ETB which is device dependent. */
</pre>
<pre> dciCfg.etbDrainNumWords = 1023;
     /* Set the number of words in the ETB drain
        again, this is device dependent.  For the
        TMS320C6474, this is 1023.  For the
        TMS320C6472, this is 511.  */
</pre>
<p><br />
</p>
<pre> /* ======== Initialize DCI =======*/
 if (DCI_open(&amp;dciCfg)!=DCI_STATUS_OK)
 {
     printf ("Could not open DCI.\n");
     return 1;
 }
</pre>
<p><br />
</p>
<pre> /* ======== Configrue Trace Params ========*/
 trcCfg.cpuStallEnable         = 0;
 trcCfg.cpuStallDbgmEnable     = 0;
 trcCfg.cpuStallHpiEnable     = 0;
 trcCfg.mode                 = DCI_TRCMODE_NORMAL;
 trcCfg.timingStreamEnable     = timingStream;
 trcCfg.pcStreamEnable         = pcStream;
 trcCfg.readStreamEnable     = readStream;
 trcCfg.writeStreamEnable     = writeStream;
</pre>
<pre> /* ======== Enable ETB ======== */
   dciCmd.command = DCI_CMD_ETB_ENABLE;
   DCI_control(&amp;dciCmd, &amp;trcCfg);
   if (dciCmd.status!=DCI_STATUS_OK)
   {
       printf ("Could not enable ETB (status = 0x%x).\n",dciCmd.status);
       return 1;
   }
</pre>
<pre>   /* Do two trials */
   for(iter=0; iter&lt;2; iter++)
   {
       /* Initialize output buffers */
     initBuffers();
</pre>
<pre>       /* Reset ETB */
       dciCmd.command = DCI_CMD_ETB_RESET;
       DCI_control(&amp;dciCmd, &amp;dNum);
       if (dciCmd.status!=DCI_STATUS_OK)
       {
           printf ("Could not reset ETB (status = 0x%x).\n",dciCmd.status);
           return 1;
       }
</pre>
<pre>       /* ======== Claim the AET resource ======== */
       dciCmd.command = DCI_CMD_AET_CLAIM;
       DCI_control(&amp;dciCmd, NULL);
       if (dciCmd.status!=DCI_STATUS_OK)
       {
           printf ("Could not claim AET (status = 0x%x).\n",dciCmd.status);
           return 1;
       }
</pre>
<pre>     /* ======== Set the trigger parameters ========*/
       parTrcRange.triggerType = DCI_TRIG_TRCA;
       parTrcRange.startAddr = (Uint32)&amp;func_dummy;
       parTrcRange.endAddr = (Uint32)&amp;func_dummy + (Uint32)&amp;func_dummy_size;
       parTrcRange.trig.pc=pcStream;
       parTrcRange.trig.timing=timingStream;
       parTrcRange.trig.rAddr=readStream;
       parTrcRange.trig.wAddr=writeStream;
       parTrcRange.trig.rData=readStream;
       parTrcRange.trig.wData=writeStream;
       parTrcRange.trig.pcTag=(readStream&amp;pcStream)|(writeStream&amp;pcStream);
</pre>
<pre>       /* Adjust to last non-zero instruction */
       /* Note we use -ml3 and --no_compress to get
         rid of trampolines and fp headers */
       while (!*(Uint8*)(parTrcRange.endAddr-=4));
</pre>
<pre>       /* ======== Program the action range ======== */
       dciCmd.command = DCI_CMD_AET_PAR;
</pre>
<pre>       DCI_control(&amp;dciCmd, &amp;parTrcRange);
</pre>
<pre>       if (dciCmd.status!=DCI_STATUS_OK)
       {
           printf ("Could not configure program action range (status = 0x%x).\n",dciCmd.status);
           return 1;
       }
</pre>
<pre>       /* ======== Enable AET ======== */
     dciCmd.command = DCI_CMD_AET_ENABLE;
       DCI_control(&amp;dciCmd, NULL);
       if (dciCmd.status!=DCI_STATUS_OK)
       {
           printf ("Could not enable AET (status = 0x%x).\n",dciCmd.status);
           return 1;
       }
</pre>
<pre>       /* Loop for NUM_CALLS iterations */
       for(callCnt=0;callCnt&lt;NUM_CALLS;callCnt++)
       {
           func_dummy();
</pre>
<pre>           /* Read all trace data from ETB */
           if (drainEtb()) return 1;
       }
</pre>
<pre>       /* Send the rest of traced data into output buffer */
       sendBuffer(nDrainedWords);
</pre>
<pre>       /* Dump drain buffer to file */
       dumpTraceToFile(iter+1);
</pre>
<pre>     /* ======== Clear AET jobs ======== */
       dciCmd.command = DCI_CMD_AET_CLEAR_JOB;
       DCI_control(&amp;dciCmd, &amp;parTrcRange);
       if (dciCmd.status!=DCI_STATUS_OK)
       {
           printf ("Could not clear program action range (status = 0x%x).\n",dciCmd.status);
           return 1;
       }
</pre>
<pre>       /* ======== Release AET ======== */
       dciCmd.command = DCI_CMD_AET_RELEASE;
       DCI_control(&amp;dciCmd, NULL);
       if (dciCmd.status!=DCI_STATUS_OK)
       {
           printf ("Could not release AET (status = 0x%x).\n",dciCmd.status);
           return 1;
       }
</pre>
<pre>   }
</pre>
<pre> /* ======== Disable ETB ======== */
   dciCmd.command = DCI_CMD_ETB_DISABLE;
   DCI_control(&amp;dciCmd, NULL);
   if (dciCmd.status!=DCI_STATUS_OK)
   {
     printf ("Could not disable ETB (status = 0x%x).\n",dciCmd.status);
     return 1;
   }
</pre>
<pre>   /* ======== Close DCI ======== */
   if (DCI_close()!=DCI_STATUS_OK)
   {
     printf ("Could not close DCI (status = 0x%x).\n",dciCmd.status);
     return 1;
   }
</pre>
<p>&lt;/syntaxhighlight&gt;
</p>
</td>
<td>&lt;syntaxhighlight lang="c" enclose="div"&gt;
<pre> Uint32 callCnt, dNum, i;
</pre>
<pre>   ETB_errorCallback pETBErrCallBack =0;
</pre>
<pre>   Uint32 etbWidth;
</pre>
<pre>   eDSPTrace_Error dspRet;
   DSPTrace_errorCallback pDSPErrorCallBack=0;
   DSPTraceHandle* pDSPHandle=0;
</pre>
<pre>   /* jobParams Structure for the Trace in range job */
   AET_jobParams traceRangeParams = AET_JOBPARAMS;
</pre>
<pre>   /* jobIndex holders for the Trace in range job */
   AET_jobIndex traceRangeJob;
   AET_error aetRet;
</pre>
<pre>   Uint32 iter;
</pre>
<pre>   dNum = DNUM;
</pre>
<pre>   setMPAX();
 syncPtr = (Uint32*)(0xD0000000 + (Uint32)&amp;syncPoint - 0x0C000000);
</pre>
<pre> /* Initialize trace word counters */
 for (i=0; i&lt;NUM_CORES; i++) nTotalTraceWords[i] = 0;
</pre>
<pre> /* ======== Initialize the Trace PLL ======== */
 /* In CToolsLib, this functionality comes from
    DSPTraceLib.  This PLL will get initialized
    later, when we call DSPTrace_setClock() */
</pre>
<pre> /* ======== Configure ETB Parameters ======== */
 /* Since we're using ETBLib, we don't need to
    specify the drain buffer location and size
    ahead of time.  This can be done later.
    What we will do here is to initialize  and
    enable all of the libraries that we are
    using.   */
</pre>
<pre>   /*** Setup ETB receiver ***/
   /* Open the ETB Interface on each core */
   for (i=0; i&lt;NUM_CORES; i++)
   {
       etbRet = ETB_open(pETBErrCallBack, eETB_Circular, (Uint8)i, &amp;pETBHandle[i], &amp;etbWidth);
       if(etbRet&#160;!= eETB_Success)
       {
           printf("Error opening ETB%d (status = 0x%x).\n",i,etbRet);
           return 1;
       }
   }
</pre>
<pre>   /* Enable ETB receiver On This Core */
   etbRet = ETB_enable(pETBHandle[dNum], 0);
   if(etbRet&#160;!= eETB_Success)
   {
       printf("Error enabling ETB (status = 0x%x).\n",etbRet);
       return 1;
   }
</pre>
<pre>   /*** Setup Trace Export ***/
</pre>
<pre>   /* Open DSP Trace export module */
   dspRet = DSPTrace_open( pDSPErrorCallBack, &amp;pDSPHandle);
   if(dspRet&#160;!= eDSPTrace_Success)
   {
       printf("Error opening DSP Trace Export block (status = 0x%x).\n",dspRet);
       return 1;
   }
   /* Setup trace export clock to FCLK/3 */
   dspRet= DSPTrace_setClock(pDSPHandle, PLL_DIV_VALUE);
   if(dspRet&#160;!= eDSPTrace_Success)
   {
       printf("Error setting up DSP trace export clock (status = 0x%x).\n",dspRet);
       return 1;
   }
</pre>
<pre>   dspRet= DSPTrace_enable(pDSPHandle, 0, 0);
</pre>
<pre>   if(dspRet&#160;!= eDSPTrace_Success)
   {
       printf("Error enabling DSP trace export (status = 0x%x).\n",dspRet);
       return 1;
   }
</pre>
<pre>   /* Init the AET resource */
   AET_init();
</pre>
<p><br />
</p>
<pre>   /* Sync the cores */
   if (dNum == 0)
   {
       *syncPtr = 1;
       while(*syncPtr&lt;NUM_CORES);
   }
   else if (dNum == 1)
   {
       while (*syncPtr&lt;1);
       *syncPtr = 2;
       while(*syncPtr&lt;NUM_CORES);
   }
   else if (dNum == 2)
   {
       while (*syncPtr&lt;2);
       *syncPtr = 3;
       while (*syncPtr&lt;NUM_CORES);
   }
   else if (dNum == 3)
   {
       while (*syncPtr&lt;3);
       *syncPtr = 4;
       while (*syncPtr&lt;NUM_CORES);
   }
</pre>
<pre>   /* Do one trial.  At this point, nothing will
      be traced because we haven't yet configured
      AET to generate any triggers. So, while the
      ETB is listening, and Trace is configured
      to output to the ETB, there are no triggers
      to start/stop trace */
</pre>
<pre>   for(iter=0; iter&lt;1; iter++)
   {
     printf("Test iteration started on core&#160;%d\n",dNum);
</pre>
<pre>       /* Initialize output buffers */
       if (dNum==0) initBuffers();
</pre>
<pre>       /* Reset ETB (disable --&gt; enable ETB receiver */
       etbRet = ETB_disable(pETBHandle[dNum]);
       if(etbRet&#160;!= eETB_Success)
       {
           printf("Error disabling ETB 1 (status = 0x%x).\n",etbRet);
           return 1;
       }
       etbRet = ETB_enable(pETBHandle[dNum],0);
       if(etbRet&#160;!= eETB_Success)
       {
           printf("Error enabling ETB (status = 0x%x).\n",etbRet);
           return 1;
       }
</pre>
<p><br />
</p>
<pre>       /* Claim the AET resource */
       if (aetRet = AET_claim())
       {
           printf("Error claiming AET resources (status = 0x%x).\n",aetRet);
           return 1;
       }
</pre>
<pre>       /* Set the trigger parameters */
     traceRangeParams.traceActive = AET_TRACE_ACTIVE;
       traceRangeParams.traceStartAddress = (Uint32)&amp;func_dummy;
     traceRangeParams.traceEndAddress = (Uint32)&amp;dummyfunc;
       /* Adjust to last non-zero instruction */
       /* Note we use -ml3 and --no_compress
           to get rid of trampolines and fp headers */
       while (!*(Uint8*)(traceRangeParams.traceEndAddress-=4));
</pre>
<pre>       traceRangeParams.traceTriggers = timingStream*AET_TRACE_TIMING |
                                        pcStream*AET_TRACE_PA |
                                        readStream*AET_TRACE_RA |
                                        readStream*AET_TRACE_RD |
                                        writeStream*AET_TRACE_WA |
                                        writeStream*AET_TRACE_WD |
                                        readStream*AET_TRACE_RA |
                                        ((readStream&amp;pcStream)|(writeStream&amp;pcStream))*AET_TRACE_PCTAG;
</pre>
<pre>       /* Set up the Trace Start job */
       if (aetRet = AET_setupJob(
                    AET_JOB_TRACE_IN_PC_RANGE,
                    &amp;traceRangeParams))
       {
           printf("Error: could not setup AET job (status = 0x%x).\n",aetRet);
           return 1;
       }
</pre>
<pre>       /* Remember the Number of the Trace Job */
       traceRangeJob = traceRangeParams.jobIndex;
</pre>
<pre>       printf("The Trace in Range Job index is&#160;%d\n", traceRangeJob);
</pre>
<pre>       /* Enable AET */
       if (aetRet = AET_enable())
       {
           printf("Error: could not enable AET (status = 0x%x).\n",aetRet);
           return 1;
       }
</pre>
<pre>       /* Loop for NUM_CALLS iterations */
       for(callCnt=0;callCnt&lt;NUM_CALLS;callCnt++)
       {
           func_dummy();
</pre>
<pre>       }
</pre>
<pre>       /* Sync the cores */
       if (dNum == 0)
       {
           *syncPtr = NUM_CORES+1;
           while(*syncPtr&lt;2*NUM_CORES);
       }
       else if (dNum == 1)
       {
           while (*syncPtr&lt;NUM_CORES+1);
           *syncPtr = NUM_CORES+2;
           while(*syncPtr&lt;2*NUM_CORES+1);
       }
       else if (dNum == 2)
       {
           while (*syncPtr&lt;NUM_CORES+2);
           *syncPtr = NUM_CORES+3;
           while (*syncPtr&lt;2*NUM_CORES+1);
       }
       else if (dNum == 3)
       {
           while (*syncPtr&lt;NUM_CORES+3);
           *syncPtr = NUM_CORES+4;
           while (*syncPtr&lt;2*NUM_CORES+1);
       }
</pre>
<pre>       if (dNum==0)
       {
           /* Drain the ETBs of other cores*/
         /* Read all trace data from ETB */
           for (i=0; i &lt; NUM_CORES; i++)
              if (drainEtb(i)) return 1;
</pre>
<pre>           /* Dump drain buffer to file */
           for (i=0; i &lt; NUM_CORES; i++)
               dumpTraceToFile(iter+1,i);
</pre>
<pre>           *syncPtr = 2*NUM_CORES+1;
       }
</pre>
<pre>       /* Clear AET jobs */
       AET_releaseJob(traceRangeJob);
       /* Release AET */
       AET_release();
   }
</pre>
<pre>   etbRet = ETB_disable(pETBHandle[dNum]);
   if(etbRet&#160;!= eETB_Success)
   {
       printf("Error disabling ETB 3 (status = 0x%x).\n",etbRet);
       return 1;
   }
</pre>
<pre>   /* Disable DSP Trace Export */
   dspRet= DSPTrace_disable(pDSPHandle);
   if(dspRet&#160;!= eDSPTrace_Success)
   {
       printf("Error disabling DSP trace export (status = 0x%x).\n",dspRet);
       return 1;
   }
</pre>
<pre>   /*** Now we are done and close all the handles **/
   etbRet  = ETB_close(pETBHandle[dNum]);
   if(etbRet&#160;!= eETB_Success)
   {
       printf("Error closing ETB (status = 0x%x).\n",etbRet);
       return 1;
   }
</pre>
<p><br />
</p>
<pre>   dspRet= DSPTrace_close(pDSPHandle);
   if(dspRet&#160;!= eDSPTrace_Success)
   {
       printf("Error closing DSP trace export module (status = 0x%x).\n",dspRet);
       return 1;
   }
</pre>
<pre>   AET_releaseJob(traceRangeJob);
   AET_release();
</pre>
<pre>   return 0;
</pre>
<p>&lt;/syntaxhighlight&gt;
</p>
</td></tr></tbody></table>
<h3><span class="mw-headline" id="Auxilliary_Functions">Auxilliary Functions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib/CodeExample&amp;action=edit&amp;section=T-6" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<table class="wikitable" style="text-align: left; border: 0px; width: 80%; vertical-align:text-top;">
<tbody><tr>
<th>DCI
</th>
<th>CToolsLib
</th></tr>
<tr valign="top">
<td>&lt;syntaxhighlight lang="c" enclose="div"&gt;
<p>void trace_pll_init (
</p>
<pre>   Uint32 div_val
</pre>
<p>)
{
</p>
<pre>   /* turn on trace clock from PLL here. */
   volatile Uint32 *pllcmd_addr = (volatile Uint32 *)0x029A0138;
   volatile Uint32 *pllstat_addr = (volatile Uint32 *)0x029A013C;
   volatile Uint32 *plldiv_addr = (volatile Uint32 *)0x029A0184;
</pre>
<pre>   /* Wait for any concurrent GOSET to complete */
   while (*pllstat_addr&amp;0x1);
</pre>
<pre>   /* PLLDIV register value:
   bit 4:0 -- ratio = 00011b (/4), 11111b (/32)
   bit 15 -- DnEn = 1 */
   /* PLL divider value could be from 1 to 32. */
</pre>
<pre>   *plldiv_addr = (1&lt;&lt;15) | (div_val-1);
</pre>
<pre>   /* PLLCMD register value:
   bit 1 -- GOSET */
   *(unsigned int*)pllcmd_addr = 0x1;
</pre>
<pre>   return;
</pre>
<p>}
</p><p>void func_dummy()
{
</p>
<pre> Uint32 i;
</pre>
<pre> for (i=0;i&lt;ARRAY_SIZE;i++)
 {
   array1[i] = rand();
 }
</pre>
<pre> for (i=0;i&lt;ARRAY_SIZE-1;i++)
 {
   array2[i] = array1[i+1]/3 + array1[i]/5;
 }
</pre>
<p>}
</p><p>void func_dummy_kick()
{
</p>
<pre> return;
</pre>
<p>}
</p><p><br />
void dumpTraceToFile(Uint32 testNum)
{
</p>
<pre>   Uint32 *p, i;
   char filename[20];
   sprintf(filename,"myfile%d.bin\0",testNum);
</pre>
<pre>   fid = fopen(filename,"wb");
   /* Dump drain buffer to file */
   p=traceOutputBuffer;
   for (i=0;i&lt;nTotalTraceWords;i++)
       fwrite32(*(p++),fid); //fwrite(p++,4,1,fid);
   fflush(fid);
   fclose(fid);
</pre>
<p>}
</p><p>void sendBuffer(Uint32 nWords)
{
</p>
<pre>   memcpy(&amp;traceOutputBuffer[nTotalTraceWords],&amp;drainBuffer,nWords*4);
   nTotalTraceWords+=nWords;
</pre>
<p>}
</p><p>Uint32 drainEtb()
{
</p>
<pre>   drainParams.etbInstanceNumber = DNUM;
   dciCmd.command = DCI_CMD_ETB_DRAIN;
   do{
       DCI_control(&amp;dciCmd, &amp;drainParams);
       if (dciCmd.status&#160;!= DCI_STATUS_OK)
       {
           printf ("Drain ETB failed (status = 0x%x).\n",dciCmd.status);
           return 1;
       }
       nDrainedWords += drainParams.nWordsRead;
       if (drainParams.etbDrainBufferFull)
       {
           sendBuffer(nDrainedWords);
           nDrainedWords = 0;
       }
   } while(!drainParams.etbEmpty);
</pre>
<p><br />
</p>
<pre>   return 0;
</pre>
<p>}
</p><p>void initBuffers()
{
</p>
<pre>   memset(drainBuffer,0,2*DRAINBUF_SIZE);
   memset(traceOutputBuffer,0,2*DRAINBUF_SIZE*4);
   nTotalTraceWords = 0;
   nDrainedWords = 0;
</pre>
<p>}
&lt;/syntaxhighlight&gt;
</p>
</td>
<td>&lt;syntaxhighlight lang="c" enclose="div"&gt;
<p>void func_dummy()
{
</p>
<pre> Uint32 i, dnum;
</pre>
<pre>dnum=DNUM;
</pre>
<pre> for (i=0;i&lt;ARRAY_SIZE;i++)
 {
   if (dnum==0)
      array1[i]=rand();
   else if (dnum==1)
      array1[i]=i*i;
   else if (dnum==2)
      array1[i]=i^0xFFFF;
   else if (dnum==3)
      array1[i]=_lmbd(1,i);
 }
</pre>
<pre> for (i=0;i&lt;ARRAY_SIZE-1;i++)
 {
   array2[i] = array1[i+1]/3 + array1[i]/5;
 }
</pre>
<ol><li>if defined(__TI_ELFABI__)</li></ol>
<pre> asm ("dummyfunc:");  /* This label marks the end of func1(); */
</pre>
<ol><li>else // COFF ABI</li></ol>
<pre> asm ("_dummyfunc:");  /* This label marks the end of func1(); */
</pre>
<ol><li>endif</li></ol>
<p>}
</p><p>void dumpTraceToFile(Uint32 testNum, Uint32 etbNum)
{
</p>
<pre>   Uint32 *p, i;
   char filename[20];
   sprintf(filename,"etb%d_test%d.bin\0",etbNum,testNum);
</pre>
<pre>   fid = fopen(filename,"wb");
   /* Dump drain buffer to file */
   p=&amp;traceOutputBuffer[0][etbNum];
   for (i=0;i&lt;nTotalTraceWords[etbNum];i++)
       fwrite32(*(p++),fid); //fwrite(p++,4,1,fid);
   fflush(fid);
   fclose(fid);
</pre>
<p>}
</p><p>void sendBuffer(Uint32 nWords, Uint32 etbNum)
{
</p>
<pre>   memcpy(&amp;traceOutputBuffer[nTotalTraceWords[etbNum]][etbNum],drainBuffer,nWords*4);
   nTotalTraceWords[etbNum]+=nWords;
</pre>
<p>}
</p><p>Uint32 drainEtb(Uint32 etbNum)
{
</p>
<pre>   ETBStatus etbStatus;
 Uint32 retSize=0;
</pre>
<p>/* Now disable trace capture - ETB receiver */
</p>
<pre>   etbRet = ETB_disable(pETBHandle[etbNum]);
   if(etbRet&#160;!= eETB_Success)
   {
       printf("Error disabling ETB 2 (status = 0x%x).\n",etbRet);
       return 1;
   }
</pre>
<pre>   /*** Get ETB data ***/
   /* Check the ETB status */
   etbRet= ETB_status(pETBHandle[etbNum], &amp;etbStatus);
   if(etbRet&#160;!= eETB_Success)
   {
       printf("Error getting ETB status (status = 0x%x).\n",etbRet);
       return 1;
   }
</pre>
<pre>   if(etbStatus.canRead == 1)
   {
       if(etbStatus.isWrapped == 1)
           printf ("ETB is wrapped; ETB words =&#160;%d\n", etbStatus.availableWords);
       else
           printf ("ETB is not wrapped; ETB words =&#160;%d\n", etbStatus.availableWords);
</pre>
<pre>       etbRet = ETB_read(pETBHandle[etbNum], drainBuffer, etbStatus.availableWords, 0, etbStatus.availableWords, &amp;retSize);
       if(etbRet&#160;!= eETB_Success)
       {
           printf("Error reading ETB data (status = 0x%x).\n",etbRet);
           return 1;
       }
       sendBuffer(etbStatus.availableWords,etbNum);
   }
   else
   {
       printf("Error reading ETB: ETB status was not readable\n");
       return 1;
   }
</pre>
<p>/* Now re-enable trace capture - ETB receiver */
</p>
<pre>   etbRet = ETB_enable(pETBHandle[etbNum],0);
   if(etbRet&#160;!= eETB_Success)
   {
       printf("Error enabling ETB (status = 0x%x).\n",etbRet);
       return 1;
   }
</pre>
<pre>   return 0;
</pre>
<p>}
</p><p>void initBuffers()
{
</p>
<pre>   int i;
   memset(drainBuffer,0,2*DRAINBUF_SIZE);
   memset(traceOutputBuffer,0,2*DRAINBUF_SIZE*4*NUM_CORES);
   for (i=0;i&lt;NUM_CORES;i++) nTotalTraceWords[i] = 0;
</pre>
<p>}
</p><p>void coreSync()
{
}
</p>
<ol><li>define XMC_CFG_BASE          0x08000000</li></ol>
<p>void setMPAX()
{
</p>
<pre>  /* Mapping for non-cached view for MSMC*/
  *(unsigned int *)(XMC_CFG_BASE+0x18) = 0x00C0003F; /* replacement addr + perm */
  *(unsigned int *)(XMC_CFG_BASE+0x1C) = 0xD0000014; /* base addr + seg size (2MB) */
</pre>
<p>}
&lt;/syntaxhighlight&gt;
</p>
</td></tr></tbody></table>
<p><br />
</p>
<h1><span class="mw-headline" id="Additional_Information">Additional Information</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;section=19" title="Edit section: Additional Information">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Should you need additional information or feel that this document is lacking in some detail, please leave a comment <a href="https://processors.wiki.ti.com/index.php?title=Talk:Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;redlink=1" class="new" title="Talk:Migrating DCI Applications to CToolsLib (page does not exist)">here</a> or click the "Leave a Comment" link below.
</p>
<!-- 
NewPP limit report
Cached time: 20201130222654
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.110 seconds
Real time usage: 0.113 seconds
Preprocessor visited node count: 106/1000000
Preprocessor generated node count: 218/1000000
Post‐expand include size: 23273/2097152 bytes
Template argument size: 1638/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    5.635      1 -total
 43.49%    2.451      1 Migrating_DCI_Applications_to_CToolsLib/CodeExample
 29.73%    1.675      1 Template:Note
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:8985-0!canonical and timestamp 20201130222654 and revision id 55306
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>Migrating DCI Applications to CToolsLib</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>Migrating DCI Applications to CToolsLib</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>Migrating DCI Applications to CToolsLib</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>Migrating DCI Applications to CToolsLib</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>Migrating DCI Applications to CToolsLib</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>Migrating DCI Applications to CToolsLib</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>Migrating DCI Applications to CToolsLib</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>Migrating DCI Applications to CToolsLib</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>Migrating DCI Applications to CToolsLib</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;oldid=55306">https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;oldid=55306</a>"					</div>
				<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=Migrating+DCI+Applications+to+CToolsLib" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="Migrating_DCI_Applications_to_CToolsLib.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:Migrating_DCI_Applications_to_CToolsLib&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="Migrating_DCI_Applications_to_CToolsLib.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/Migrating_DCI_Applications_to_CToolsLib.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/Migrating_DCI_Applications_to_CToolsLib.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;oldid=55306" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=Migrating_DCI_Applications_to_CToolsLib&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 1 April 2011, at 07:52.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.110","walltime":"0.113","ppvisitednodes":{"value":106,"limit":1000000},"ppgeneratednodes":{"value":218,"limit":1000000},"postexpandincludesize":{"value":23273,"limit":2097152},"templateargumentsize":{"value":1638,"limit":2097152},"expansiondepth":{"value":3,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":0,"limit":5000000},"timingprofile":["100.00%    5.635      1 -total"," 43.49%    2.451      1 Migrating_DCI_Applications_to_CToolsLib/CodeExample"," 29.73%    1.675      1 Template:Note"]},"cachereport":{"timestamp":"20201130222654","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":227});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/Migrating_DCI_Applications_to_CToolsLib by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 09:54:55 GMT -->
</html>
