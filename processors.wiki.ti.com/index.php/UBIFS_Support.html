<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/UBIFS_Support by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 06:33:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>UBIFS Support - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"UBIFS_Support","wgTitle":"UBIFS Support","wgCurRevisionId":168589,"wgRevisionId":168589,"wgArticleId":14030,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"UBIFS_Support","wgRelevantArticleId":14030,"wgRequestId":"ea4c24cae89959a3c832e541","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-UBIFS_Support rootpage-UBIFS_Support skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">UBIFS Support</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext"><b>Introduction</b></span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Configuration"><span class="tocnumber">2</span> <span class="toctext"><b>Configuration</b></span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#How_to_enable_UBI.2FUBIFS_support_in_Linux_Kernel_.3F"><span class="tocnumber">2.1</span> <span class="toctext"><b>How to enable UBI/UBIFS support in Linux Kernel&#160;?</b></span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#How_to_enable_UBI.2FUBIFS_support_in_u-boot_.3F"><span class="tocnumber">2.2</span> <span class="toctext"><b>How to enable UBI/UBIFS support in u-boot&#160;?</b></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#UBIFS_User-space_tools"><span class="tocnumber">3</span> <span class="toctext"><b>UBIFS User-space tools</b></span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Creating_UBIFS_file_system"><span class="tocnumber">3.1</span> <span class="toctext"><b>Creating UBIFS file system</b></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Using_UBIFS_file_system"><span class="tocnumber">4</span> <span class="toctext"><b>Using UBIFS file system</b></span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#Preparing_NAND_partition"><span class="tocnumber">4.1</span> <span class="toctext">Preparing NAND partition</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Flashing_UBIFS_image_to_a_NAND_partition"><span class="tocnumber">4.2</span> <span class="toctext">Flashing UBIFS image to a NAND partition</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Using_UBIFS_image_as_root_file_system"><span class="tocnumber">4.3</span> <span class="toctext">Using UBIFS image as root file system</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Mounting_UBIFS_image_as_a_regular_NAND_partition"><span class="tocnumber">4.4</span> <span class="toctext">Mounting UBIFS image as a regular NAND partition</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Mounting_a_NAND_partition_using_UBIFS"><span class="tocnumber">4.5</span> <span class="toctext">Mounting a NAND partition using UBIFS</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction"><b>Introduction</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=1" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>UBIFS is next generation Flash based file-system. Its bit different from other file-systems like JFFS2, YFFS2 because, JFFS2 file system works on top of MTD devices, but UBIFS works on top of UBI volumes and cannot operate directly on top of MTD devices.
In other words, there are 3 subsystems involved:
</p>
<ul><li><b>MTD subsystem</b>, which provides uniform interface to access flash chips. MTD provides an notion of MTD devices (e.g., /dev/mtd0) which basically represents raw flash; <br /></li></ul>
<dl><dd><dl><dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/general.html">http://www.linux-mtd.infradead.org/doc/general.html</a></dd></dl></dd></dl>
<ul><li><b>UBI subsystem</b>, which is a wear-leveling and volume management system for flash devices; UBI works on top of MTD devices and provides a notion of UBI volumes; UBI volumes are higher level entities than MTD devices and they are devoid of many unpleasant issues MTD devices have (e.g., wearing and bad blocks); see here for more information; <br /></li></ul>
<dl><dd><dl><dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubi.html">http://www.linux-mtd.infradead.org/doc/ubi.html</a><br /></dd>
<dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/faq/ubi.html">http://www.linux-mtd.infradead.org/faq/ubi.html</a><br /></dd></dl></dd></dl>
<ul><li><b>UBIFS file system</b>, which works on top of UBI volumes.<br /></li></ul>
<dl><dd><dl><dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubifs.html">http://www.linux-mtd.infradead.org/doc/ubifs.html</a><br /></dd>
<dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/faq/ubifs.html">http://www.linux-mtd.infradead.org/faq/ubifs.html</a><br /></dd>
<dd>And some in-depth background about UBIFS architecture is as presentation from UBI/UBIFS Authors @ <a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubifs.html#L_documentation">http://www.linux-mtd.infradead.org/doc/ubifs.html#L_documentation</a></dd></dl></dd></dl>
<p><br />
</p>
<h1><span class="mw-headline" id="Configuration"><b>Configuration</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=2" title="Edit section: Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h3><span id="How_to_enable_UBI/UBIFS_support_in_Linux_Kernel_?"></span><span class="mw-headline" id="How_to_enable_UBI.2FUBIFS_support_in_Linux_Kernel_.3F"><b>How to enable UBI/UBIFS support in Linux Kernel&#160;?</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=3" title="Edit section: How to enable UBI/UBIFS support in Linux Kernel ?">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>To enable UBIFS support, start the <i><b>Linux Kernel Configuration</b></i>&#160;tool:<br /> 
</p>
<ul><li>Enabling UBI support on MTD devices.</li></ul>
<pre> Device Drivers ---&gt;
     Memory Technology Device (MTD) support  ---&gt;
         Enable UBI - Unsorted block images  ---&gt;
</pre> 
<ul><li>Enabling UBIFS file-system support.</li></ul>
<pre> File systems  ---&gt;
     Miscellaneous filesystems  ---&gt; 
          UBIFS file system support
</pre>
<p><i>Note:</i> Above configurations are enabled default in omap2plus_defconfig
</p><p><br />
</p>
<h3><span id="How_to_enable_UBI/UBIFS_support_in_u-boot_?"></span><span class="mw-headline" id="How_to_enable_UBI.2FUBIFS_support_in_u-boot_.3F"><b>How to enable UBI/UBIFS support in u-boot&#160;?</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=4" title="Edit section: How to enable UBI/UBIFS support in u-boot ?">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The following macros need to be defined in the board config for enabling UBI/UBIFS in uboot
</p>
<pre>#define CONFIG_CMD_NAND
#define CONFIG_CMD_UBI
#define CONFIG_CMD_UBIFS
#define CONFIG_RBTREE
#define CONFIG_MTD_DEVICE
#define CONFIG_MTD_PARTITIONS
#define CONFIG_CMD_MTDPARTS
#define CONFIG_LZO
</pre>
<p><i>Note:</i> Details of UBI command available in u-boot are given in $U-BOOT/doc/README.ubi
</p>
<h1><span class="mw-headline" id="UBIFS_User-space_tools"><b>UBIFS User-space tools</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=5" title="Edit section: UBIFS User-space tools">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>UBI user-space tools, as well as other MTD user-space tools, are available as separate package called <b>mtd-utils</b> <br />
</p>
<dl><dd><dl><dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubi.html#L_usptools">http://www.linux-mtd.infradead.org/doc/ubi.html#L_usptools</a></dd></dl></dd></dl>
<ul><li><b>Compiling UBIFS Tools</b></li></ul>
<p>For instructions on compiling MTD-utils, refer <br />
</p>
<dl><dd><dl><dd><a href="MTD_Utilities.html" title="MTD Utilities">MTD_Utilities</a></dd>
<dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubi.html#L_usptools">MTD User-space utilities for UBIFS</a></dd></dl></dd></dl>
<p><br />
</p>
<ul><li><b>How to creating UBIFS image&#160;?'</b></li></ul>
<dl><dd><dl><dd><a rel="nofollow" class="external text" href="http://free-electrons.com/blog/creating-flashing-ubi-ubifs-images">creating-flashing-ubi-ubifs-images</a></dd>
<dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_mkfubifs">make ubifs</a></dd></dl></dd></dl>
<p><br />
</p>
<ul><li><b>Booting with UBIFS as root file-system'</b></li></ul>
<dl><dd><dl><dd><b>u-boot#&gt; setenv bootargs 'console=ttyO0,115200n8 root=ubi0:rootfs rw ubi.mtd=&lt;partion_id|or name&gt;,2048 noinitrd rootfstype=ubifs mem=256M rootwait=1'</b></dd>
<dd>The value of PARTITION_ID depends on MTD device which holds the root filesystem. The below example assumes UBIFS file system is flashed on MTD partition 7.</dd>
<dd>One may instead pass in the name of the partition as set in the partition table for the device.
<dl><dd><dl><dd>u-boot&gt; setenv bootargs 'console=ttyO0,115200n8 root=ubi0:rootfs rw ubi.mtd=7,2048 noinitrd rootfstype=ubifs mem=256M rootwait=1'</dd></dl></dd></dl></dd></dl></dd></dl>
<ul><li>Remotely updating UBI Volume <a rel="nofollow" class="external autonumber" href="http://www.linux-mtd.infradead.org/doc/ubi.html#L_volupdate">[1]</a></li></ul>
<h2><span class="mw-headline" id="Creating_UBIFS_file_system"><b>Creating UBIFS file system</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=6" title="Edit section: Creating UBIFS file system">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<dl><dd><dl><dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_mkfubifs">http://www.linux-mtd.infradead.org/faq/ubifs.html#L_mkfubifs</a></dd>
<dd><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/faq/ubi.html#L_ubi_mkimg">http://www.linux-mtd.infradead.org/faq/ubi.html#L_ubi_mkimg</a></dd>
<dd><a rel="nofollow" class="external text" href="http://free-electrons.com/blog/creating-flashing-ubi-ubifs-images">creating-flashing-ubi-ubifs-images</a></dd></dl></dd></dl>
<p><br />
<b>white-space-fixup</b><br />
If the UBIFS image is flashed from u-boot using <b>nand write</b> command, then UBIFS image should be built with "white-space-fixup" feature enabled (mkfs.ubifs -F). For details refer
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_free_space_fixup">UBIFS white-space-fixup</a></li>
<li><a rel="nofollow" class="external text" href="http://lists.infradead.org/pipermail/linux-mtd/2014-January/051342.html">Why is white-space-fixup required&#160;?</a></li></ul>
<p><b>subpage support</b><br />
Currently, OMAP NAND drivers do not support subpage, therefore while building and mounting UBI/UBIFS images <br />
</p>
<ul><li><i>subpage-size</i> should set same as <i>page-size</i></li>
<li><i>offset-of-vid-header</i> should also be set same as <i>page-size</i></li></ul>
<p><b>LEB Size Calculations</b><br />
UBIFS adds two headers (erase-header and volume-id-header) at the start of each NAND block for block identification purposes.<br />
</p>
<ul><li>When sub-page feature is not supported then <br /></li></ul>
<dl><dd><dl><dd>erase-header is written to '1st page' and <br /></dd>
<dd>volume-id-header is flashed in '2nd page' of every block, <br /></dd>
<dd>so remaining 'n-2' pages are available for user-data, Hence LEB_SIZE = <i>$BLOCK_SIZE - (2 x $PAGE_SIZE)</i><br /></dd></dl></dd></dl>
<ul><li>When sub-page feature is supported then <br /></li></ul>
<dl><dd><dl><dd>both these headers are packed into '1st page' of the block and <br /></dd>
<dd>remaining 'n-1' pages are available to store user-data. Hence <i>LEB_SIZE = $BLOCK_SIZE - (1 x $PAGE_SIZE)</i><br /></dd></dl></dd></dl>
<p><b><a rel="nofollow" class="external text" href="http://www.linux-mtd.infradead.org/doc/ubi.html#L_overhead">Flash space overhead</a></b>
</p><p><br />
</p>
<h1><span class="mw-headline" id="Using_UBIFS_file_system"><b>Using UBIFS file system</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=7" title="Edit section: Using UBIFS file system">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p><br />
</p>
<h2><span class="mw-headline" id="Preparing_NAND_partition">Preparing NAND partition</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=8" title="Edit section: Preparing NAND partition">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Kindly erase the NAND partition before using it for UBI file system. The partition can be erased from either u-boot or from Linux. 
</p><p>Follow below steps to erase. 
</p>
<ul><li>From U-boot. Assuming NAND partition to be erased starts from "0x780000" and is of size "0xF880000".</li></ul>
<pre> u-boot# nand erase 0x00780000 0xF880000
</pre> 
<ul><li>From Linux. Assuming MTD partition 7 needs to be erased and used for UBI file system.</li></ul>
<pre> root@arago-armv7:~# flash_eraseall /dev/mtd7
</pre> 
<p><br />
</p>
<h2><span class="mw-headline" id="Flashing_UBIFS_image_to_a_NAND_partition">Flashing UBIFS image to a NAND partition<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=9" title="Edit section: Flashing UBIFS image to a NAND partition">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>We can Flash UBIFS image from either Linux Kernel or U-Boot. 
</p><p>Follow steps mentioned <a href="UBIFS_Support.html#Creating_UBIFS_file_system" title="UBIFS Support">here</a> to create an UBIFS image. 
</p><p>From U-Boot, <br /> 
</p><p>Get the UBIFS image to U-Boot from tftp or MMC/SD or UART. Lets consider an example of MMC card. 
</p><p>Since we copy the data to NAND, Empty/Erase the required RAM. Then, get the UBIFS image to U-Boot 
</p>
<pre> u-boot# mw.b 0x82000000 0xFF &lt;filesystem_image_size&gt; &lt;=== filesystem image size is upward aligned to NAND block size,
                                                           This is required to get rid of "Empty Flash" JFFS2 during kernel boot.
 u-boot# mmc rescan
 u-boot# fatload mmc 0 0x82000000 ubi.img
</pre> 
<p>Next, erase the and flash the UBIFS image to correct NAND partition. 
</p>
<div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />On flashing UBIFS image from U-Boot, make sure that ECC selected is in sync with Linux</div>
<p><br /> 
</p>
<div style="padding-right: 5px; padding-left: 5px; background: rgb(238,238,238); padding-bottom: 5px; color: rgb(52,128,23); padding-top: 5px"><b>Example</b> 
<p>Assuming 
</p>
<ol><li>NAND partition to be erased starts from "0x780000",</li>
<li>NAND partition of size "0xF880000" and</li>
<li>File system image size to be flashed is 0xFC0000 which is upward aligned to NAND block size</li></ol>
<pre> 
 u-boot# nand erase 0x780000 0xF880000
 u-boot# nand write 0x82000000 0x780000 0xFC0000
</pre> </div> 
<p><br /> From Linux, <br /> 
</p>
<ul><li>Flash the UBI file system image (ubi.img) to MTD partition "X" <br /></li></ul>
<pre>ubiformat /dev/mtd&lt;X&gt; -f ubi.img -s &lt;subpagesize&gt; -O 2048</pre> 
<p>Here subpage size depends MTD driver. Find subpage size of MTD partition using
</p>
<pre> mtdinfo /dev/mtd&lt;X&gt;</pre>
<p>Assuming <b>7</b>th mtd partition with 2048 byte subpage size, we can use the following command to flash the ubifs image to partition 7.<br /> 
</p>
<pre>#ubiformat /dev/mtd7 -f ubi.img -s 2048 -O 2048</pre> 
<dl><dt><br /></dt></dl>
<h2><span class="mw-headline" id="Using_UBIFS_image_as_root_file_system">Using UBIFS image as root file system</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=10" title="Edit section: Using UBIFS image as root file system">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Set up the bootargs environment variable as below to use the UBIFS file system image present in a MTD partition:</li></ul>
<pre>setenv bootargs 'console=ttyO0,115200n8 noinitrd ip=off mem=256M rootwait=1 rw ubi.mtd=X,YYYY rootfstype=ubifs root=ubi0:rootfs init=/init'</pre> 
<p>Where X is the MTD partition number being used for file system and YYYY is the NAND page size. make sure that an UBI file system is flashed into this partition before passing it as a boot partition for Linux. 
</p><p>Assuming <b>7</b>th mtd partition, 
</p>
<pre>#setenv bootargs 'console=ttyO0,115200n8 noinitrd ip=off mem=256M rootwait=1 rw ubi.mtd=7,2048 rootfstype=ubifs root=ubi0:rootfs init=/init'</pre> 
<div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />On booting with UBIFS as rootfs, the first boot happens successfully. Before subsequent boot-ups, it is recommended to do a manual "sync" from the console. This allows UBIFS meta data properly updated on the partition. This initial sync will help later recovery.</div>
<h2><span class="mw-headline" id="Mounting_UBIFS_image_as_a_regular_NAND_partition">Mounting UBIFS image as a regular NAND partition<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=11" title="Edit section: Mounting UBIFS image as a regular NAND partition">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Assuming UBIFS image is already flashed to a NAND Partition, follow below steps to mount the same.
</p>
<ul><li>Attach MTD device to UBI</li></ul>
<pre>ubiattach /dev/ubi_ctrl -m &lt;X&gt; -O 2048</pre> 
<p>Where "X" is the MTD partition number 
</p><p>Mtd device number <b>7</b> can be attached to ubi using<br /> 
</p>
<pre>#ubiattach /dev/ubi_ctrl -m 7 -O 2048</pre> 
<p><br /> 
</p>
<ul><li>Mount the UBIFS image</li></ul>
<pre>mount -t ubifs ubiX:NAME /mount/point</pre> 
<p>Where "X" - UBI device number and "NAME" - UBI volume name from ubinize.cfg file. 
</p><p>Assuming ubi device <b>0</b> and <b>rootfs</b> is the volume name given in <b>ubinize.cfg</b>, ubifs image can be mounted to <b>/media/card</b> using<br /> 
</p>
<pre>#mount -t ubifs ubi0:rootfs /media/card</pre> 
<p><br /> <br />
</p><p><br />
</p>
<div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />On mounting UBIFS as regular partition, it is recommended to do a manual "sync" from the console after mounting. This allows UBIFS meta data properly updated on the partition. This initial sync will help later recovery.</div>
<h2><span class="mw-headline" id="Mounting_a_NAND_partition_using_UBIFS">Mounting a NAND partition using UBIFS</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit&amp;section=12" title="Edit section: Mounting a NAND partition using UBIFS">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>We can mount a particular NAND partition with UBIFS file system in the following way 
</p>
<ul><li>Format and attach the MTD partition</li></ul>
<pre>ubiformat /dev/mtd&lt;X&gt; -s &lt;subpagesize&gt; -O 2048
ubiattach /dev/ubi_ctrl -m &lt;X&gt; -O 2048</pre> 
<p>Where "X" is the MTD partition number and "subpagesize" determined using mtdinfo command
</p><p>MTD partition number 7 with 2048 subpage size can be formatted and attched using<br /> 
</p>
<pre>ubiformat /dev/mtd7 -s 2048 -O 2048
#ubiattach /dev/ubi_ctrl -m 7 -O 2048</pre>
<p><br />
</p>
<ul><li>Create an UBI volume - the created volume will be empty</li></ul>
<pre>ubimkvol /dev/ubi0 -N &lt;label&gt; -s XXMiB</pre> 
<p>Where "XX" is the size of the partition to be mounted and "label" is the name for the volume. 
</p><p><b>10 MB</b> ubi volume can be created with label <b>ubifs_volume</b> as<br /> 
</p>
<pre>ubimkvol /dev/ubi0 -N ubifs_volume -s 10MiB</pre>
<p>Also, user can create a UBI volume with volume size set to maximum available size
</p>
<pre>ubimkvol /dev/ubi0 -N &lt;label&gt; –m</pre> 
<p>where "label" is the name for the volume.
</p>
<pre>ubimkvol /dev/ubi0 -N ubifs_volume –m</pre>
<p><br />
</p>
<ul><li>Mount the MTD partition</li></ul>
<pre>mount -t ubifs ubi0:&lt;label&gt; /mount/point </pre> 
<p>Make sure that the "label" used during ubimkvol is passed as an argument here. <br /> 
</p><p>Mounting of ubi volume can be achieved using<br /> 
</p>
<pre>#mount -t ubifs ubi0:ubifs_volume /media/card</pre>
<div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />On mounting NAND partition as UBIFS, it is recommended to do a manual "sync" from the console after mounting NAND partition. This allows UBIFS meta data properly updated on the partition. This initial sync will help later recovery.</div>

<!-- 
NewPP limit report
Cached time: 20201201003730
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.045 seconds
Real time usage: 0.046 seconds
Preprocessor visited node count: 241/1000000
Preprocessor generated node count: 620/1000000
Post‐expand include size: 1310/2097152 bytes
Template argument size: 798/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 2203/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    2.954      1 -total
 59.35%    1.753      4 Template:SpNote
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:14030-0!canonical and timestamp 20201201003730 and revision id 168589
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>UBIFS Support</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>UBIFS Support</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>UBIFS Support</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>UBIFS Support</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>UBIFS Support</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>UBIFS Support</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>UBIFS Support</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>UBIFS Support</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>UBIFS Support</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;oldid=168589">https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;oldid=168589</a>"					</div>
				<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=UBIFS+Support" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="UBIFS_Support.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk"><span><a href="Talk_UBIFS_Support.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="UBIFS_Support.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/UBIFS_Support.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/UBIFS_Support.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;oldid=168589" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=UBIFS_Support&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 31 January 2014, at 14:13.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.045","walltime":"0.046","ppvisitednodes":{"value":241,"limit":1000000},"ppgeneratednodes":{"value":620,"limit":1000000},"postexpandincludesize":{"value":1310,"limit":2097152},"templateargumentsize":{"value":798,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":2203,"limit":5000000},"timingprofile":["100.00%    2.954      1 -total"," 59.35%    1.753      4 Template:SpNote"]},"cachereport":{"timestamp":"20201201003730","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":223});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/UBIFS_Support by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 06:33:15 GMT -->
</html>
