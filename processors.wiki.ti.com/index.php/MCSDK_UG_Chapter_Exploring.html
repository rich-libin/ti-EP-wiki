<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/MCSDK_UG_Chapter_Exploring by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 09:47:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>MCSDK UG Chapter Exploring - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"MCSDK_UG_Chapter_Exploring","wgTitle":"MCSDK UG Chapter Exploring","wgCurRevisionId":224110,"wgRevisionId":224110,"wgArticleId":19650,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Linux"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"MCSDK_UG_Chapter_Exploring","wgRelevantArticleId":19650,"wgRequestId":"761d71b256a4789a568530c5","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-MCSDK_UG_Chapter_Exploring rootpage-MCSDK_UG_Chapter_Exploring skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">MCSDK UG Chapter Exploring</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><br /><br />
</p>
<hr />
<div class="center"><div class="floatnone"><a href="File_Ti_hz_2c_pos_rgb_jpg.html" class="image" title="Ti hz 2c pos rgb jpg.jpg"><img alt="Ti hz 2c pos rgb jpg.jpg" src="https://processors.wiki.ti.com/images/b/b5/Ti_hz_2c_pos_rgb_jpg.jpg" width="500" height="115" /></a></div></div>
<hr />
<p><br />
</p>
<table class="FCK&#95;_ShowTableBorders">

<tbody><tr>
<td>
<table class="FCK&#95;_ShowTableBorders" cellspacing="0" cellpadding="10">

<tbody><tr>
<td><a href="File_McsdkUGEXPLORING_NT_.html" class="image" title="McsdkUGEXPLORING NT .jpg"><img alt="McsdkUGEXPLORING NT .jpg" src="https://processors.wiki.ti.com/images/f/f1/McsdkUGEXPLORING_NT_.jpg" width="100" height="100" /></a>
</td></tr></tbody></table>
</td>
<td><font size="6"><b><a href="MCSDK_User_Guide_for_KeyStone_II.html" title="MCSDK User Guide for KeyStone II">MCSDK User Guide</a>:</b></font>
<p><font size="6"><b>Exploring the MCSDK</b></font>
</p>
</td></tr></tbody></table>
<p><font size="2">Last updated: <b>01/06/2017</b></font>
</p>
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#IS_NOT"><span class="tocnumber">1.1</span> <span class="toctext">IS NOT</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#Acronyms"><span class="tocnumber">2</span> <span class="toctext">Acronyms</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#ARM_Subsystem"><span class="tocnumber">3</span> <span class="toctext">ARM Subsystem</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Overview_2"><span class="tocnumber">3.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Linux"><span class="tocnumber">3.2</span> <span class="toctext">Linux</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#Changes_impacting_users"><span class="tocnumber">3.2.1</span> <span class="toctext">Changes impacting users</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="#K2_RT_LINUX_03.10.10_13.11.2FK2_LINUX_03.10.10_13.11"><span class="tocnumber">3.2.1.1</span> <span class="toctext">K2_RT_LINUX_03.10.10_13.11/K2_LINUX_03.10.10_13.11</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#K2_RT_LINUX_03.08.04_13.09_01.2FK2_LINUX_03.08.04_13.09_01"><span class="tocnumber">3.2.1.2</span> <span class="toctext">K2_RT_LINUX_03.08.04_13.09_01/K2_LINUX_03.08.04_13.09_01</span></a></li>
<li class="toclevel-4 tocsection-10"><a href="#DEV.MCSDK-03.08.04.11"><span class="tocnumber">3.2.1.3</span> <span class="toctext">DEV.MCSDK-03.08.04.11</span></a></li>
<li class="toclevel-4 tocsection-11"><a href="#DEV.MCSDK-03.08.04.10"><span class="tocnumber">3.2.1.4</span> <span class="toctext">DEV.MCSDK-03.08.04.10</span></a></li>
<li class="toclevel-4 tocsection-12"><a href="#DEV.MCSDK-03.06.06.08"><span class="tocnumber">3.2.1.5</span> <span class="toctext">DEV.MCSDK-03.06.06.08</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-13"><a href="#Installation_Guide"><span class="tocnumber">3.2.2</span> <span class="toctext">Installation Guide</span></a>
<ul>
<li class="toclevel-4 tocsection-14"><a href="#Prerequisites_for_MCSDK_3.0_Installation"><span class="tocnumber">3.2.2.1</span> <span class="toctext">Prerequisites for MCSDK 3.0 Installation</span></a></li>
<li class="toclevel-4 tocsection-15"><a href="#Toolchain_Installation"><span class="tocnumber">3.2.2.2</span> <span class="toctext">Toolchain Installation</span></a></li>
<li class="toclevel-4 tocsection-16"><a href="#Linux_Software_Installation"><span class="tocnumber">3.2.2.3</span> <span class="toctext">Linux Software Installation</span></a></li>
<li class="toclevel-4 tocsection-17"><a href="#Tag_and_Branch_naming_convention"><span class="tocnumber">3.2.2.4</span> <span class="toctext">Tag and Branch naming convention</span></a>
<ul>
<li class="toclevel-5 tocsection-18"><a href="#U-Boot"><span class="tocnumber">3.2.2.4.1</span> <span class="toctext">U-Boot</span></a></li>
<li class="toclevel-5 tocsection-19"><a href="#Linux_2"><span class="tocnumber">3.2.2.4.2</span> <span class="toctext">Linux</span></a></li>
<li class="toclevel-5 tocsection-20"><a href="#Boot_Monitor"><span class="tocnumber">3.2.2.4.3</span> <span class="toctext">Boot Monitor</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-21"><a href="#Build_Instructions"><span class="tocnumber">3.2.3</span> <span class="toctext">Build Instructions</span></a>
<ul>
<li class="toclevel-4 tocsection-22"><a href="#Build_Prerequisites"><span class="tocnumber">3.2.3.1</span> <span class="toctext">Build Prerequisites</span></a></li>
<li class="toclevel-4 tocsection-23"><a href="#Proxy_Setup"><span class="tocnumber">3.2.3.2</span> <span class="toctext">Proxy Setup</span></a></li>
<li class="toclevel-4 tocsection-24"><a href="#U-Boot_Build_instructions"><span class="tocnumber">3.2.3.3</span> <span class="toctext">U-Boot Build instructions</span></a></li>
<li class="toclevel-4 tocsection-25"><a href="#Boot_Monitor_Build_instructions"><span class="tocnumber">3.2.3.4</span> <span class="toctext">Boot Monitor Build instructions</span></a></li>
<li class="toclevel-4 tocsection-26"><a href="#Linux_kernel_and_the_device_tree_blob_build_instructions"><span class="tocnumber">3.2.3.5</span> <span class="toctext">Linux kernel and the device tree blob build instructions</span></a></li>
<li class="toclevel-4 tocsection-27"><a href="#TransportNetLib_Software_Library_and_Build_instructions"><span class="tocnumber">3.2.3.6</span> <span class="toctext">TransportNetLib Software Library and Build instructions</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-28"><a href="#Running_U-Boot.2C_Boot_Monitor_and_Linux_Kernel_on_EVM"><span class="tocnumber">3.2.4</span> <span class="toctext">Running U-Boot, Boot Monitor and Linux Kernel on EVM</span></a>
<ul>
<li class="toclevel-4 tocsection-29"><a href="#Loading_and_Running_U-Boot_on_EVM_through_UART"><span class="tocnumber">3.2.4.1</span> <span class="toctext">Loading and Running U-Boot on EVM through UART</span></a></li>
<li class="toclevel-4 tocsection-30"><a href="#Loading_and_Running_U-Boot_on_EVM_through_CCS"><span class="tocnumber">3.2.4.2</span> <span class="toctext">Loading and Running U-Boot on EVM through CCS</span></a></li>
<li class="toclevel-4 tocsection-31"><a href="#Loading_and_running_U-Boot_on_EVM_through_SPI_Boot"><span class="tocnumber">3.2.4.3</span> <span class="toctext">Loading and running U-Boot on EVM through SPI Boot</span></a>
<ul>
<li class="toclevel-5 tocsection-32"><a href="#Two_Stage_SPI_Flash_Boot"><span class="tocnumber">3.2.4.3.1</span> <span class="toctext">Two Stage SPI Flash Boot</span></a>
<ul>
<li class="toclevel-6 tocsection-33"><a href="#Burning_First_Stage_u-boot-spl.bin_to_SPI_Flash"><span class="tocnumber">3.2.4.3.1.1</span> <span class="toctext">Burning First Stage u-boot-spl.bin to SPI Flash</span></a></li>
<li class="toclevel-6 tocsection-34"><a href="#Burning_Second_Stage_u-boot.img_to_SPI_Flash"><span class="tocnumber">3.2.4.3.1.2</span> <span class="toctext">Burning Second Stage u-boot.img to SPI Flash</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-35"><a href="#Single_Stage_SPI_Flash_Boot"><span class="tocnumber">3.2.4.3.2</span> <span class="toctext">Single Stage SPI Flash Boot</span></a>
<ul>
<li class="toclevel-6 tocsection-36"><a href="#Burning_Single_Stage_U-Boot_to_SPI_Flash"><span class="tocnumber">3.2.4.3.2.1</span> <span class="toctext">Burning Single Stage U-Boot to SPI Flash</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-37"><a href="#Booting_U-Boot_from_SPI_Flash_on_EVM"><span class="tocnumber">3.2.4.3.3</span> <span class="toctext">Booting U-Boot from SPI Flash on EVM</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-38"><a href="#Loading_and_running_U-Boot_on_EVM_through_NAND_boot_.28Keystone2_Rev2.0_or_Later_EVM_ONLY.29"><span class="tocnumber">3.2.4.4</span> <span class="toctext">Loading and running U-Boot on EVM through NAND boot (Keystone2 Rev2.0 or Later EVM ONLY)</span></a>
<ul>
<li class="toclevel-5 tocsection-39"><a href="#Burning_U-Boot_to_NAND_Flash"><span class="tocnumber">3.2.4.4.1</span> <span class="toctext">Burning U-Boot to NAND Flash</span></a></li>
<li class="toclevel-5 tocsection-40"><a href="#Booting_U-Boot_from_NAND_Flash_on_EVM"><span class="tocnumber">3.2.4.4.2</span> <span class="toctext">Booting U-Boot from NAND Flash on EVM</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-41"><a href="#Loading_and_Running_Linux_Kernel_on_EVM"><span class="tocnumber">3.2.4.5</span> <span class="toctext">Loading and Running Linux Kernel on EVM</span></a>
<ul>
<li class="toclevel-5 tocsection-42"><a href="#Loading_and_Running_Linux_Kernel_on_EVM_using_CCS"><span class="tocnumber">3.2.4.5.1</span> <span class="toctext">Loading and Running Linux Kernel on EVM using CCS</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-43"><a href="#Design.2FImplementation_Notes"><span class="tocnumber">3.2.5</span> <span class="toctext">Design/Implementation Notes</span></a>
<ul>
<li class="toclevel-4 tocsection-44"><a href="#U-Boot_2"><span class="tocnumber">3.2.5.1</span> <span class="toctext">U-Boot</span></a>
<ul>
<li class="toclevel-5 tocsection-45"><a href="#Board_Support"><span class="tocnumber">3.2.5.1.1</span> <span class="toctext">Board Support</span></a></li>
<li class="toclevel-5 tocsection-46"><a href="#SoC_Support"><span class="tocnumber">3.2.5.1.2</span> <span class="toctext">SoC Support</span></a></li>
<li class="toclevel-5 tocsection-47"><a href="#Drivers"><span class="tocnumber">3.2.5.1.3</span> <span class="toctext">Drivers</span></a></li>
<li class="toclevel-5 tocsection-48"><a href="#Ethernet_Driver"><span class="tocnumber">3.2.5.1.4</span> <span class="toctext">Ethernet Driver</span></a></li>
<li class="toclevel-5 tocsection-49"><a href="#10G_Ethernet_Driver"><span class="tocnumber">3.2.5.1.5</span> <span class="toctext">10G Ethernet Driver</span></a></li>
<li class="toclevel-5 tocsection-50"><a href="#I2C_Driver"><span class="tocnumber">3.2.5.1.6</span> <span class="toctext">I2C Driver</span></a></li>
<li class="toclevel-5 tocsection-51"><a href="#NAND_Driver"><span class="tocnumber">3.2.5.1.7</span> <span class="toctext">NAND Driver</span></a></li>
<li class="toclevel-5 tocsection-52"><a href="#SPL"><span class="tocnumber">3.2.5.1.8</span> <span class="toctext">SPL</span></a></li>
<li class="toclevel-5 tocsection-53"><a href="#Thump_mode"><span class="tocnumber">3.2.5.1.9</span> <span class="toctext">Thump mode</span></a></li>
<li class="toclevel-5 tocsection-54"><a href="#Power-On_Self-Test_.28POST.29"><span class="tocnumber">3.2.5.1.10</span> <span class="toctext">Power-On Self-Test (POST)</span></a></li>
<li class="toclevel-5 tocsection-55"><a href="#FDT_command"><span class="tocnumber">3.2.5.1.11</span> <span class="toctext">FDT command</span></a></li>
<li class="toclevel-5 tocsection-56"><a href="#Reserve_DDR_memory"><span class="tocnumber">3.2.5.1.12</span> <span class="toctext">Reserve DDR memory</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-57"><a href="#Boot_Monitor_2"><span class="tocnumber">3.2.5.2</span> <span class="toctext">Boot Monitor</span></a>
<ul>
<li class="toclevel-5 tocsection-58"><a href="#Boot_sequence_of_primary_core"><span class="tocnumber">3.2.5.2.1</span> <span class="toctext">Boot sequence of primary core</span></a></li>
<li class="toclevel-5 tocsection-59"><a href="#Boot_sequence_of_secondary_cores"><span class="tocnumber">3.2.5.2.2</span> <span class="toctext">Boot sequence of secondary cores</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-60"><a href="#LPAE"><span class="tocnumber">3.2.5.3</span> <span class="toctext">LPAE</span></a>
<ul>
<li class="toclevel-5 tocsection-61"><a href="#Using_more_than_2GB_of_DDR3A_memory"><span class="tocnumber">3.2.5.3.1</span> <span class="toctext">Using more than 2GB of DDR3A memory</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-62"><a href="#DDR3_ECC"><span class="tocnumber">3.2.5.4</span> <span class="toctext">DDR3 ECC</span></a>
<ul>
<li class="toclevel-5 tocsection-63"><a href="#DDR3_ECC_Handling_in_U-boot"><span class="tocnumber">3.2.5.4.1</span> <span class="toctext">DDR3 ECC Handling in U-boot</span></a></li>
<li class="toclevel-5 tocsection-64"><a href="#DDR3_ECC_Handling_in_Linux_kernel"><span class="tocnumber">3.2.5.4.2</span> <span class="toctext">DDR3 ECC Handling in Linux kernel</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-65"><a href="#Linux_Kernel"><span class="tocnumber">3.2.5.5</span> <span class="toctext">Linux Kernel</span></a>
<ul>
<li class="toclevel-5 tocsection-66"><a href="#SoC_Support_2"><span class="tocnumber">3.2.5.5.1</span> <span class="toctext">SoC Support</span></a></li>
<li class="toclevel-5 tocsection-67"><a href="#GIC_irq_chip_driver"><span class="tocnumber">3.2.5.5.2</span> <span class="toctext">GIC irq chip driver</span></a></li>
<li class="toclevel-5 tocsection-68"><a href="#Keystone_IPC_irq_chip_driver"><span class="tocnumber">3.2.5.5.3</span> <span class="toctext">Keystone IPC irq chip driver</span></a></li>
<li class="toclevel-5 tocsection-69"><a href="#SMP"><span class="tocnumber">3.2.5.5.4</span> <span class="toctext">SMP</span></a>
<ul>
<li class="toclevel-6 tocsection-70"><a href="#Boot_Setup"><span class="tocnumber">3.2.5.5.4.1</span> <span class="toctext">Boot Setup</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-71"><a href="#Common_Clock_framework"><span class="tocnumber">3.2.5.5.5</span> <span class="toctext">Common Clock framework</span></a></li>
<li class="toclevel-5 tocsection-72"><a href="#AEMIF_Driver"><span class="tocnumber">3.2.5.5.6</span> <span class="toctext">AEMIF Driver</span></a></li>
<li class="toclevel-5 tocsection-73"><a href="#NAND_Driver_2"><span class="tocnumber">3.2.5.5.7</span> <span class="toctext">NAND Driver</span></a></li>
<li class="toclevel-5 tocsection-74"><a href="#SPI_and_SPI_NOR_Flash_Drivers"><span class="tocnumber">3.2.5.5.8</span> <span class="toctext">SPI and SPI NOR Flash Drivers</span></a></li>
<li class="toclevel-5 tocsection-75"><a href="#I2C_and_EEPROM_Drivers"><span class="tocnumber">3.2.5.5.9</span> <span class="toctext">I2C and EEPROM Drivers</span></a></li>
<li class="toclevel-5 tocsection-76"><a href="#Keystone_GPIO_Driver"><span class="tocnumber">3.2.5.5.10</span> <span class="toctext">Keystone GPIO Driver</span></a></li>
<li class="toclevel-5 tocsection-77"><a href="#Keystone_IPC_GPIO_Driver"><span class="tocnumber">3.2.5.5.11</span> <span class="toctext">Keystone IPC GPIO Driver</span></a></li>
<li class="toclevel-5 tocsection-78"><a href="#Watchdog_Driver"><span class="tocnumber">3.2.5.5.12</span> <span class="toctext">Watchdog Driver</span></a></li>
<li class="toclevel-5 tocsection-79"><a href="#Network_Driver"><span class="tocnumber">3.2.5.5.13</span> <span class="toctext">Network Driver</span></a>
<ul>
<li class="toclevel-6 tocsection-80"><a href="#DMA_Engine"><span class="tocnumber">3.2.5.5.13.1</span> <span class="toctext">DMA Engine</span></a></li>
<li class="toclevel-6 tocsection-81"><a href="#Packet_Accelerator"><span class="tocnumber">3.2.5.5.13.2</span> <span class="toctext">Packet Accelerator</span></a></li>
<li class="toclevel-6 tocsection-82"><a href="#PA_Timestamping"><span class="tocnumber">3.2.5.5.13.3</span> <span class="toctext">PA Timestamping</span></a></li>
<li class="toclevel-6 tocsection-83"><a href="#Mark_mcast_match_Special_Packet_Processing_Feature"><span class="tocnumber">3.2.5.5.13.4</span> <span class="toctext">Mark_mcast_match Special Packet Processing Feature</span></a></li>
<li class="toclevel-6 tocsection-84"><a href="#SGMII"><span class="tocnumber">3.2.5.5.13.5</span> <span class="toctext">SGMII</span></a></li>
<li class="toclevel-6 tocsection-85"><a href="#Setting_up_an_NFS_filesystem"><span class="tocnumber">3.2.5.5.13.6</span> <span class="toctext">Setting up an NFS filesystem</span></a></li>
<li class="toclevel-6 tocsection-86"><a href="#Modifying_the_command_line_for_NFS_filesystem_boot"><span class="tocnumber">3.2.5.5.13.7</span> <span class="toctext">Modifying the command line for NFS filesystem boot</span></a></li>
<li class="toclevel-6 tocsection-87"><a href="#Modifying_CPSW_Configurations_Through_Sysfs_User_Interface"><span class="tocnumber">3.2.5.5.13.8</span> <span class="toctext">Modifying CPSW Configurations Through Sysfs User Interface</span></a></li>
<li class="toclevel-6 tocsection-88"><a href="#Using_Ethtool_to_Change_PHY_Settings"><span class="tocnumber">3.2.5.5.13.9</span> <span class="toctext">Using Ethtool to Change PHY Settings</span></a></li>
<li class="toclevel-6 tocsection-89"><a href="#Enabling_MDIO"><span class="tocnumber">3.2.5.5.13.10</span> <span class="toctext">Enabling MDIO</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-90"><a href="#Common_Platform_Time_Sync_.28CPTS.29"><span class="tocnumber">3.2.5.5.14</span> <span class="toctext">Common Platform Time Sync (CPTS)</span></a>
<ul>
<li class="toclevel-6 tocsection-91"><a href="#CPTS_Hardware_Configurations"><span class="tocnumber">3.2.5.5.14.1</span> <span class="toctext">CPTS Hardware Configurations</span></a></li>
<li class="toclevel-6 tocsection-92"><a href="#CPTS_Driver_Internals_Overview"><span class="tocnumber">3.2.5.5.14.2</span> <span class="toctext">CPTS Driver Internals Overview</span></a></li>
<li class="toclevel-6 tocsection-93"><a href="#Using_CPTS_Timestamping"><span class="tocnumber">3.2.5.5.14.3</span> <span class="toctext">Using CPTS Timestamping</span></a></li>
<li class="toclevel-6 tocsection-94"><a href="#Testing_CPTS.2FPTP"><span class="tocnumber">3.2.5.5.14.4</span> <span class="toctext">Testing CPTS/PTP</span></a></li>
<li class="toclevel-6 tocsection-95"><a href="#Who_Is_Timestamping_What.3F"><span class="tocnumber">3.2.5.5.14.5</span> <span class="toctext">Who Is Timestamping What?</span></a></li>
<li class="toclevel-6 tocsection-96"><a href="#Pulse-Per-Second_.28PPS.29"><span class="tocnumber">3.2.5.5.14.6</span> <span class="toctext">Pulse-Per-Second (PPS)</span></a></li>
<li class="toclevel-6 tocsection-97"><a href="#CPTS_Hardware_Timestamp_Push"><span class="tocnumber">3.2.5.5.14.7</span> <span class="toctext">CPTS Hardware Timestamp Push</span></a></li>
<li class="toclevel-6 tocsection-98"><a href="#CPTS_References"><span class="tocnumber">3.2.5.5.14.8</span> <span class="toctext">CPTS References</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-99"><a href="#Quality_of_Service"><span class="tocnumber">3.2.5.5.15</span> <span class="toctext">Quality of Service</span></a>
<ul>
<li class="toclevel-6 tocsection-100"><a href="#QoS_Tree_Configuration"><span class="tocnumber">3.2.5.5.15.1</span> <span class="toctext">QoS Tree Configuration</span></a></li>
<li class="toclevel-6 tocsection-101"><a href="#QoS_Node_Attributes"><span class="tocnumber">3.2.5.5.15.2</span> <span class="toctext">QoS Node Attributes</span></a></li>
<li class="toclevel-6 tocsection-102"><a href="#Traffic_Police_Policy_Attributes"><span class="tocnumber">3.2.5.5.15.3</span> <span class="toctext">Traffic Police Policy Attributes</span></a></li>
<li class="toclevel-6 tocsection-103"><a href="#Sysfs_support"><span class="tocnumber">3.2.5.5.15.4</span> <span class="toctext">Sysfs support</span></a></li>
<li class="toclevel-6 tocsection-104"><a href="#Debug_Filesystem_support"><span class="tocnumber">3.2.5.5.15.5</span> <span class="toctext">Debug Filesystem support</span></a></li>
<li class="toclevel-6 tocsection-105"><a href="#Configuring_QoS_on_an_1-GigE_interface"><span class="tocnumber">3.2.5.5.15.6</span> <span class="toctext">Configuring QoS on an 1-GigE interface</span></a></li>
<li class="toclevel-6 tocsection-106"><a href="#Disabling_QoS_on_an_1-GigE_interface"><span class="tocnumber">3.2.5.5.15.7</span> <span class="toctext">Disabling QoS on an 1-GigE interface</span></a></li>
<li class="toclevel-6 tocsection-107"><a href="#Configuring_QoS_on_a_10-GigE_interface"><span class="tocnumber">3.2.5.5.15.8</span> <span class="toctext">Configuring QoS on a 10-GigE interface</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-108"><a href="#Crypto_Driver"><span class="tocnumber">3.2.5.5.16</span> <span class="toctext">Crypto Driver</span></a></li>
<li class="toclevel-5 tocsection-109"><a href="#USB_Driver"><span class="tocnumber">3.2.5.5.17</span> <span class="toctext">USB Driver</span></a></li>
<li class="toclevel-5 tocsection-110"><a href="#10Gig_Ethernet_Driver"><span class="tocnumber">3.2.5.5.18</span> <span class="toctext">10Gig Ethernet Driver</span></a>
<ul>
<li class="toclevel-6 tocsection-111"><a href="#Enabling_10Gig_Ethernet_Driver_Device_Tree_Bindings"><span class="tocnumber">3.2.5.5.18.1</span> <span class="toctext">Enabling 10Gig Ethernet Driver Device Tree Bindings</span></a></li>
<li class="toclevel-6 tocsection-112"><a href="#Disabling_Support_of_10-GigE"><span class="tocnumber">3.2.5.5.18.2</span> <span class="toctext">Disabling Support of 10-GigE</span></a></li>
<li class="toclevel-6 tocsection-113"><a href="#Enabling_10G-KR_Firmware"><span class="tocnumber">3.2.5.5.18.3</span> <span class="toctext">Enabling 10G-KR Firmware</span></a></li>
<li class="toclevel-6 tocsection-114"><a href="#10G-KR_Firmware_Usage_Notes"><span class="tocnumber">3.2.5.5.18.4</span> <span class="toctext">10G-KR Firmware Usage Notes</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-115"><a href="#PCIe_Driver"><span class="tocnumber">3.2.5.5.19</span> <span class="toctext">PCIe Driver</span></a>
<ul>
<li class="toclevel-6 tocsection-116"><a href="#Procedure_to_boot_Linux_with_FS_on_harddisk"><span class="tocnumber">3.2.5.5.19.1</span> <span class="toctext">Procedure to boot Linux with FS on harddisk</span></a></li>
<li class="toclevel-6 tocsection-117"><a href="#AER_Driver"><span class="tocnumber">3.2.5.5.19.2</span> <span class="toctext">AER Driver</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-118"><a href="#DMA_Coherency"><span class="tocnumber">3.2.5.5.20</span> <span class="toctext">DMA Coherency</span></a></li>
<li class="toclevel-5 tocsection-119"><a href="#RT_Preempt_patch"><span class="tocnumber">3.2.5.5.21</span> <span class="toctext">RT Preempt patch</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-120"><a href="#Capture_kernel_crash_dump_using_kexec"><span class="tocnumber">3.2.5.6</span> <span class="toctext">Capture kernel crash dump using kexec</span></a>
<ul>
<li class="toclevel-5 tocsection-121"><a href="#Kexec.2FKdump_Terminology"><span class="tocnumber">3.2.5.6.1</span> <span class="toctext">Kexec/Kdump Terminology</span></a></li>
<li class="toclevel-5 tocsection-122"><a href="#Kexec.2FKdump_User_Space_tools"><span class="tocnumber">3.2.5.6.2</span> <span class="toctext">Kexec/Kdump User Space tools</span></a>
<ul>
<li class="toclevel-6 tocsection-123"><a href="#Kexec_Usage"><span class="tocnumber">3.2.5.6.2.1</span> <span class="toctext">Kexec Usage</span></a></li>
<li class="toclevel-6 tocsection-124"><a href="#Reserving_size_of_crashkernel"><span class="tocnumber">3.2.5.6.2.2</span> <span class="toctext">Reserving size of crashkernel</span></a></li>
<li class="toclevel-6 tocsection-125"><a href="#.2Fproc.2Fvmcore"><span class="tocnumber">3.2.5.6.2.3</span> <span class="toctext">/proc/vmcore</span></a></li>
</ul>
</li>
<li class="toclevel-5 tocsection-126"><a href="#makedumpfile"><span class="tocnumber">3.2.5.6.3</span> <span class="toctext">makedumpfile</span></a></li>
<li class="toclevel-5 tocsection-127"><a href="#Crashkernel_and_crash_kernel_device-tree"><span class="tocnumber">3.2.5.6.4</span> <span class="toctext">Crashkernel and crash kernel device-tree</span></a></li>
<li class="toclevel-5 tocsection-128"><a href="#Init-script_to_run_in_the_crash_kernel.27s_filesystem"><span class="tocnumber">3.2.5.6.5</span> <span class="toctext">Init-script to run in the crash kernel's filesystem</span></a></li>
<li class="toclevel-5 tocsection-129"><a href="#How_to_enable_crashdump_kernel_with_MCSDK_on_K2HK-EVM"><span class="tocnumber">3.2.5.6.6</span> <span class="toctext">How to enable crashdump kernel with MCSDK on K2HK-EVM</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-130"><a href="#Graceful_Power_shutdown"><span class="tocnumber">3.2.6</span> <span class="toctext">Graceful Power shutdown</span></a></li>
<li class="toclevel-3 tocsection-131"><a href="#Smart_Reflex_Class_0"><span class="tocnumber">3.2.7</span> <span class="toctext">Smart Reflex Class 0</span></a></li>
<li class="toclevel-3 tocsection-132"><a href="#EVM_Setup"><span class="tocnumber">3.2.8</span> <span class="toctext">EVM Setup</span></a></li>
<li class="toclevel-3 tocsection-133"><a href="#Tests"><span class="tocnumber">3.2.9</span> <span class="toctext">Tests</span></a></li>
<li class="toclevel-3 tocsection-134"><a href="#configuration"><span class="tocnumber">3.2.10</span> <span class="toctext">configuration</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-135"><a href="#Yocto"><span class="tocnumber">3.3</span> <span class="toctext">Yocto</span></a>
<ul>
<li class="toclevel-3 tocsection-136"><a href="#Prerequisite"><span class="tocnumber">3.3.1</span> <span class="toctext">Prerequisite</span></a></li>
<li class="toclevel-3 tocsection-137"><a href="#Configuration_2"><span class="tocnumber">3.3.2</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-3 tocsection-138"><a href="#Build"><span class="tocnumber">3.3.3</span> <span class="toctext">Build</span></a></li>
<li class="toclevel-3 tocsection-139"><a href="#Using_the_snapshot_of_the_source_packages_in_MCSDK_release"><span class="tocnumber">3.3.4</span> <span class="toctext">Using the snapshot of the source packages in MCSDK release</span></a></li>
<li class="toclevel-3 tocsection-140"><a href="#Build_procedure"><span class="tocnumber">3.3.5</span> <span class="toctext">Build procedure</span></a>
<ul>
<li class="toclevel-4 tocsection-141"><a href="#Building_other_components_in_Yocto"><span class="tocnumber">3.3.5.1</span> <span class="toctext">Building other components in Yocto</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-142"><a href="#Updating_a_user_space_component_in_MCSDK_filesystem"><span class="tocnumber">3.3.6</span> <span class="toctext">Updating a user space component in MCSDK filesystem</span></a>
<ul>
<li class="toclevel-4 tocsection-143"><a href="#Step1:_Update_the_component_recipe"><span class="tocnumber">3.3.6.1</span> <span class="toctext">Step1: Update the component recipe</span></a></li>
<li class="toclevel-4 tocsection-144"><a href="#Step_2:_Build_the_component"><span class="tocnumber">3.3.6.2</span> <span class="toctext">Step 2: Build the component</span></a></li>
<li class="toclevel-4 tocsection-145"><a href="#Step_3:_Add_package_to_filesystem"><span class="tocnumber">3.3.6.3</span> <span class="toctext">Step 3:  Add package to filesystem</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-146"><a href="#FAQ"><span class="tocnumber">3.3.7</span> <span class="toctext">FAQ</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-147"><a href="#Flattened_Device_Tree"><span class="tocnumber">3.4</span> <span class="toctext">Flattened Device Tree</span></a>
<ul>
<li class="toclevel-3 tocsection-148"><a href="#creating_dtb_image"><span class="tocnumber">3.4.1</span> <span class="toctext">creating dtb image</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-149"><a href="#UBI.2FUBIFS"><span class="tocnumber">3.5</span> <span class="toctext">UBI/UBIFS</span></a>
<ul>
<li class="toclevel-3 tocsection-150"><a href="#UBI"><span class="tocnumber">3.5.1</span> <span class="toctext">UBI</span></a></li>
<li class="toclevel-3 tocsection-151"><a href="#UBIFS"><span class="tocnumber">3.5.2</span> <span class="toctext">UBIFS</span></a></li>
<li class="toclevel-3 tocsection-152"><a href="#UBIFS_User-space_tools"><span class="tocnumber">3.5.3</span> <span class="toctext">UBIFS User-space tools</span></a></li>
<li class="toclevel-3 tocsection-153"><a href="#NAND_Layout"><span class="tocnumber">3.5.4</span> <span class="toctext">NAND Layout</span></a></li>
<li class="toclevel-3 tocsection-154"><a href="#Compiling_UBIFS_Tools"><span class="tocnumber">3.5.5</span> <span class="toctext">Compiling UBIFS Tools</span></a>
<ul>
<li class="toclevel-4 tocsection-155"><a href="#Creating_UBIFS_file_system"><span class="tocnumber">3.5.5.1</span> <span class="toctext">Creating UBIFS file system</span></a></li>
<li class="toclevel-4 tocsection-156"><a href="#Creating_UBI_image"><span class="tocnumber">3.5.5.2</span> <span class="toctext">Creating UBI image</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-157"><a href="#Calculations"><span class="tocnumber">3.5.6</span> <span class="toctext">Calculations</span></a></li>
<li class="toclevel-3 tocsection-158"><a href="#Using_UBIFS_file_system"><span class="tocnumber">3.5.7</span> <span class="toctext">Using UBIFS file system</span></a></li>
<li class="toclevel-3 tocsection-159"><a href="#Updating_Boot_volume_images_from_Linux_kernel"><span class="tocnumber">3.5.8</span> <span class="toctext">Updating Boot volume images from Linux kernel</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-160"><a href="#SYS.2FBIOS"><span class="tocnumber">3.6</span> <span class="toctext">SYS/BIOS</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-161"><a href="#DSP_Subsystem"><span class="tocnumber">4</span> <span class="toctext">DSP Subsystem</span></a>
<ul>
<li class="toclevel-2 tocsection-162"><a href="#Overview_3"><span class="tocnumber">4.1</span> <span class="toctext">Overview</span></a>
<ul>
<li class="toclevel-3 tocsection-163"><a href="#API_and_LLD_User_Guides"><span class="tocnumber">4.1.1</span> <span class="toctext">API and LLD User Guides</span></a></li>
<li class="toclevel-3 tocsection-164"><a href="#Tools_Overview"><span class="tocnumber">4.1.2</span> <span class="toctext">Tools Overview</span></a></li>
<li class="toclevel-3 tocsection-165"><a href="#Hardware_-_EVM_Overview"><span class="tocnumber">4.1.3</span> <span class="toctext">Hardware - EVM Overview</span></a></li>
<li class="toclevel-3 tocsection-166"><a href="#Hardware_-_Processor_Overview"><span class="tocnumber">4.1.4</span> <span class="toctext">Hardware - Processor Overview</span></a></li>
<li class="toclevel-3 tocsection-167"><a href="#Related_Software"><span class="tocnumber">4.1.5</span> <span class="toctext">Related Software</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-168"><a href="#Platform_Development_Kit_.28PDK.29"><span class="tocnumber">4.2</span> <span class="toctext">Platform Development Kit (PDK)</span></a>
<ul>
<li class="toclevel-3 tocsection-169"><a href="#Chip_Support_Library_.28CSL.29"><span class="tocnumber">4.2.1</span> <span class="toctext">Chip Support Library (CSL)</span></a></li>
<li class="toclevel-3 tocsection-170"><a href="#Low_Level_Drivers"><span class="tocnumber">4.2.2</span> <span class="toctext">Low Level Drivers</span></a>
<ul>
<li class="toclevel-4 tocsection-171"><a href="#Multicore_Navigator"><span class="tocnumber">4.2.2.1</span> <span class="toctext">Multicore Navigator</span></a>
<ul>
<li class="toclevel-5 tocsection-172"><a href="#Packet_DMA_.28CPPI.29"><span class="tocnumber">4.2.2.1.1</span> <span class="toctext">Packet DMA (CPPI)</span></a></li>
<li class="toclevel-5 tocsection-173"><a href="#Queue_Manager_.28QMSS.29"><span class="tocnumber">4.2.2.1.2</span> <span class="toctext">Queue Manager (QMSS)</span></a></li>
<li class="toclevel-5 tocsection-174"><a href="#Packet_Library_.28PKTLIB.29"><span class="tocnumber">4.2.2.1.3</span> <span class="toctext">Packet Library (PKTLIB)</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-175"><a href="#Network_Co-processor_.28NETCP.29"><span class="tocnumber">4.2.2.2</span> <span class="toctext">Network Co-processor (NETCP)</span></a>
<ul>
<li class="toclevel-5 tocsection-176"><a href="#Security_Accelerator_.28SA.29"><span class="tocnumber">4.2.2.2.1</span> <span class="toctext">Security Accelerator (SA)</span></a></li>
<li class="toclevel-5 tocsection-177"><a href="#Packet_Accelerator_.28PA.29"><span class="tocnumber">4.2.2.2.2</span> <span class="toctext">Packet Accelerator (PA)</span></a></li>
<li class="toclevel-5 tocsection-178"><a href="#Network_Adaptation_Layer_.28NWAL.29"><span class="tocnumber">4.2.2.2.3</span> <span class="toctext">Network Adaptation Layer (NWAL)</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-179"><a href="#I.2FO_and_Buses"><span class="tocnumber">4.2.2.3</span> <span class="toctext">I/O and Buses</span></a>
<ul>
<li class="toclevel-5 tocsection-180"><a href="#Antenna_Interface_.28AIF2.29"><span class="tocnumber">4.2.2.3.1</span> <span class="toctext">Antenna Interface (AIF2)</span></a></li>
<li class="toclevel-5 tocsection-181"><a href="#IQN2"><span class="tocnumber">4.2.2.3.2</span> <span class="toctext">IQN2</span></a></li>
<li class="toclevel-5 tocsection-182"><a href="#Digital_Radio_Front_End_.28DFE.29"><span class="tocnumber">4.2.2.3.3</span> <span class="toctext">Digital Radio Front End (DFE)</span></a></li>
<li class="toclevel-5 tocsection-183"><a href="#Serial_RapidIO_.28SRIO.29"><span class="tocnumber">4.2.2.3.4</span> <span class="toctext">Serial RapidIO (SRIO)</span></a></li>
<li class="toclevel-5 tocsection-184"><a href="#Peripheral_Component_Interconnect_Express.28PCIe.29"><span class="tocnumber">4.2.2.3.5</span> <span class="toctext">Peripheral Component Interconnect Express(PCIe)</span></a></li>
<li class="toclevel-5 tocsection-185"><a href="#Hyperlink"><span class="tocnumber">4.2.2.3.6</span> <span class="toctext">Hyperlink</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-186"><a href="#Co-processors"><span class="tocnumber">4.2.2.4</span> <span class="toctext">Co-processors</span></a>
<ul>
<li class="toclevel-5 tocsection-187"><a href="#Bit-rate_Coprocessor_.28BCP.29"><span class="tocnumber">4.2.2.4.1</span> <span class="toctext">Bit-rate Coprocessor (BCP)</span></a></li>
<li class="toclevel-5 tocsection-188"><a href="#Turbo_Coprocessor_Decoder_.28TCP3d.29"><span class="tocnumber">4.2.2.4.2</span> <span class="toctext">Turbo Coprocessor Decoder (TCP3d)</span></a></li>
<li class="toclevel-5 tocsection-189"><a href="#FFT_Accelerator_Coprocessor.28FFTC.29"><span class="tocnumber">4.2.2.4.3</span> <span class="toctext">FFT Accelerator Coprocessor(FFTC)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-190"><a href="#Instrumentation"><span class="tocnumber">4.2.3</span> <span class="toctext">Instrumentation</span></a>
<ul>
<li class="toclevel-4 tocsection-191"><a href="#Fault_Management_.28FM.29_Library"><span class="tocnumber">4.2.3.1</span> <span class="toctext">Fault Management (FM) Library</span></a></li>
<li class="toclevel-4 tocsection-192"><a href="#Watchdog_Timer_Module"><span class="tocnumber">4.2.3.2</span> <span class="toctext">Watchdog Timer Module</span></a></li>
<li class="toclevel-4 tocsection-193"><a href="#Trace_framework_.28TF.29_Library"><span class="tocnumber">4.2.3.3</span> <span class="toctext">Trace framework (TF) Library</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-194"><a href="#Keystone-II_CSL.2FLLD_API_Migration"><span class="tocnumber">4.2.4</span> <span class="toctext">Keystone-II CSL/LLD API Migration</span></a></li>
<li class="toclevel-3 tocsection-195"><a href="#Platform_Library"><span class="tocnumber">4.2.5</span> <span class="toctext">Platform Library</span></a></li>
<li class="toclevel-3 tocsection-196"><a href="#Transport"><span class="tocnumber">4.2.6</span> <span class="toctext">Transport</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-197"><a href="#EDMA3_Low_Level_Driver"><span class="tocnumber">4.3</span> <span class="toctext">EDMA3 Low Level Driver</span></a></li>
<li class="toclevel-2 tocsection-198"><a href="#SYS.2FBIOS_2"><span class="tocnumber">4.4</span> <span class="toctext">SYS/BIOS</span></a></li>
<li class="toclevel-2 tocsection-199"><a href="#Inter-Processor_Communication_.28IPC.29"><span class="tocnumber">4.5</span> <span class="toctext">Inter-Processor Communication (IPC)</span></a></li>
<li class="toclevel-2 tocsection-200"><a href="#Network_Development_Kit_.28NDK.29"><span class="tocnumber">4.6</span> <span class="toctext">Network Development Kit (NDK)</span></a>
<ul>
<li class="toclevel-3 tocsection-201"><a href="#Network_Interface_Management_Unit_.28NIMU.29_Driver"><span class="tocnumber">4.6.1</span> <span class="toctext">Network Interface Management Unit (NIMU) Driver</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-202"><a href="#Algorithm_Libraries"><span class="tocnumber">4.7</span> <span class="toctext">Algorithm Libraries</span></a>
<ul>
<li class="toclevel-3 tocsection-203"><a href="#DSP_Library_.28DSPLIB.29"><span class="tocnumber">4.7.1</span> <span class="toctext">DSP Library (DSPLIB)</span></a></li>
<li class="toclevel-3 tocsection-204"><a href="#Image_Processing_Library_.28IMGLIB.29"><span class="tocnumber">4.7.2</span> <span class="toctext">Image Processing Library (IMGLIB)</span></a></li>
<li class="toclevel-3 tocsection-205"><a href="#Floating_Point_Math_Library_.28MATHLIB.29"><span class="tocnumber">4.7.3</span> <span class="toctext">Floating Point Math Library (MATHLIB)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-206"><a href="#OMP"><span class="tocnumber">4.8</span> <span class="toctext">OMP</span></a></li>
<li class="toclevel-2 tocsection-207"><a href="#Resource_Manager"><span class="tocnumber">4.9</span> <span class="toctext">Resource Manager</span></a></li>
<li class="toclevel-2 tocsection-208"><a href="#DSP_Management"><span class="tocnumber">4.10</span> <span class="toctext">DSP Management</span></a>
<ul>
<li class="toclevel-3 tocsection-209"><a href="#Boot_Utilities"><span class="tocnumber">4.10.1</span> <span class="toctext">Boot Utilities</span></a>
<ul>
<li class="toclevel-4 tocsection-210"><a href="#Overview_4"><span class="tocnumber">4.10.1.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-4 tocsection-211"><a href="#Flash_and_Flash_Utilities"><span class="tocnumber">4.10.1.2</span> <span class="toctext">Flash and Flash Utilities</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-212"><a href="#c6x_DSP_Linux_Community"><span class="tocnumber">4.11</span> <span class="toctext">c6x DSP Linux Community</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-213"><a href="#DSP_Acceleration.2CProfiling_utilities_and_Libraries"><span class="tocnumber">5</span> <span class="toctext">DSP Acceleration,Profiling utilities and Libraries</span></a>
<ul>
<li class="toclevel-2 tocsection-214"><a href="#DSP_Acceleration"><span class="tocnumber">5.1</span> <span class="toctext">DSP Acceleration</span></a>
<ul>
<li class="toclevel-3 tocsection-215"><a href="#OpenCL"><span class="tocnumber">5.1.1</span> <span class="toctext">OpenCL</span></a></li>
<li class="toclevel-3 tocsection-216"><a href="#OpenMP"><span class="tocnumber">5.1.2</span> <span class="toctext">OpenMP</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-217"><a href="#DSP_Debug_and_Profiling_Utilities"><span class="tocnumber">5.2</span> <span class="toctext">DSP Debug and Profiling Utilities</span></a>
<ul>
<li class="toclevel-3 tocsection-218"><a href="#DSPTOP"><span class="tocnumber">5.2.1</span> <span class="toctext">DSPTOP</span></a></li>
<li class="toclevel-3 tocsection-219"><a href="#C66x_GDB"><span class="tocnumber">5.2.2</span> <span class="toctext">C66x GDB</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-220"><a href="#Libraries"><span class="tocnumber">5.3</span> <span class="toctext">Libraries</span></a>
<ul>
<li class="toclevel-3 tocsection-221"><a href="#FFTW"><span class="tocnumber">5.3.1</span> <span class="toctext">FFTW</span></a></li>
<li class="toclevel-3 tocsection-222"><a href="#Linear_Algebra"><span class="tocnumber">5.3.2</span> <span class="toctext">Linear Algebra</span></a></li>
<li class="toclevel-3 tocsection-223"><a href="#Machine_Learning_Libraries"><span class="tocnumber">5.3.3</span> <span class="toctext">Machine Learning Libraries</span></a></li>
<li class="toclevel-3 tocsection-224"><a href="#Graph_Libraries"><span class="tocnumber">5.3.4</span> <span class="toctext">Graph Libraries</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-225"><a href="#Tools"><span class="tocnumber">6</span> <span class="toctext">Tools</span></a>
<ul>
<li class="toclevel-2 tocsection-226"><a href="#Multicore_System_Analyzer_.28MCSA.29"><span class="tocnumber">6.1</span> <span class="toctext">Multicore System Analyzer (MCSA)</span></a></li>
<li class="toclevel-2 tocsection-227"><a href="#Eclipse_RTSC_Tools_.28XDC.29"><span class="tocnumber">6.2</span> <span class="toctext">Eclipse RTSC Tools (XDC)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-228"><a href="#Demonstrations"><span class="tocnumber">7</span> <span class="toctext">Demonstrations</span></a>
<ul>
<li class="toclevel-2 tocsection-229"><a href="#Utility_Application"><span class="tocnumber">7.1</span> <span class="toctext">Utility Application</span></a></li>
<li class="toclevel-2 tocsection-230"><a href="#Image_Processing"><span class="tocnumber">7.2</span> <span class="toctext">Image Processing</span></a></li>
<li class="toclevel-2 tocsection-231"><a href="#Inter-Processor_Communication"><span class="tocnumber">7.3</span> <span class="toctext">Inter-Processor Communication</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-232"><a href="#Running_examples_of_OpenCL.2COpenMP_and_Libraries"><span class="tocnumber">8</span> <span class="toctext">Running examples of OpenCL,OpenMP and Libraries</span></a>
<ul>
<li class="toclevel-2 tocsection-233"><a href="#Add_user_to_.27keystone.27_group"><span class="tocnumber">8.1</span> <span class="toctext">Add user to 'keystone' group</span></a></li>
<li class="toclevel-2 tocsection-234"><a href="#Compile_the_examples"><span class="tocnumber">8.2</span> <span class="toctext">Compile the examples</span></a>
<ul>
<li class="toclevel-3 tocsection-235"><a href="#Copy_the_example_to_a_directory"><span class="tocnumber">8.2.1</span> <span class="toctext">Copy the example to a directory</span></a></li>
<li class="toclevel-3 tocsection-236"><a href="#Run_the_make_command"><span class="tocnumber">8.2.2</span> <span class="toctext">Run the make command</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-237"><a href="#Run_the_examples"><span class="tocnumber">8.3</span> <span class="toctext">Run the examples</span></a></li>
<li class="toclevel-2 tocsection-238"><a href="#Running_Automated_Tests"><span class="tocnumber">8.4</span> <span class="toctext">Running Automated Tests</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-239"><a href="#How_To"><span class="tocnumber">9</span> <span class="toctext">How To</span></a>
<ul>
<li class="toclevel-2 tocsection-240"><a href="#How_to_run_Linux_kernel_from_a_different_physical_address_than_default_.280x80000000.29_.3F"><span class="tocnumber">9.1</span> <span class="toctext">How to run Linux kernel from a different physical address than default (0x80000000)&#160;?</span></a></li>
<li class="toclevel-2 tocsection-241"><a href="#How_to_boot_with_a_combined_kernel_and_initramfs_image.3F"><span class="tocnumber">9.2</span> <span class="toctext">How to boot with a combined kernel and initramfs image?</span></a>
<ul>
<li class="toclevel-3 tocsection-242"><a href="#Create_target_file_system"><span class="tocnumber">9.2.1</span> <span class="toctext">Create target file system</span></a></li>
<li class="toclevel-3 tocsection-243"><a href="#Configure_kernel_to_embed_initramfs"><span class="tocnumber">9.2.2</span> <span class="toctext">Configure kernel to embed initramfs</span></a></li>
<li class="toclevel-3 tocsection-244"><a href="#Setup_u-boot_environment_and_boot_combined_image"><span class="tocnumber">9.2.3</span> <span class="toctext">Setup u-boot environment and boot combined image</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-245"><a href="#How_to_change_Tetris_and_Core_PLL_speed.3F"><span class="tocnumber">9.3</span> <span class="toctext">How to change Tetris and Core PLL speed?</span></a></li>
<li class="toclevel-2 tocsection-246"><a href="#How_to_boot_Linux_using_uinitrd.3F"><span class="tocnumber">9.4</span> <span class="toctext">How to boot Linux using uinitrd?</span></a></li>
<li class="toclevel-2 tocsection-247"><a href="#How_to_use_fixed_IP_address_instead_of_DHCP.3F"><span class="tocnumber">9.5</span> <span class="toctext">How to use fixed IP address instead of DHCP?</span></a></li>
<li class="toclevel-2 tocsection-248"><a href="#If_using_multiple_interfaces.2C_DHCP_and_NFS_filesystem"><span class="tocnumber">9.6</span> <span class="toctext">If using multiple interfaces, DHCP and NFS filesystem</span></a></li>
<li class="toclevel-2 tocsection-249"><a href="#How_to_boot_from_USB_Flash_drive.3F"><span class="tocnumber">9.7</span> <span class="toctext">How to boot from USB Flash drive?</span></a>
<ul>
<li class="toclevel-3 tocsection-250"><a href="#On_Ubuntu_Host"><span class="tocnumber">9.7.1</span> <span class="toctext">On Ubuntu Host</span></a>
<ul>
<li class="toclevel-4 tocsection-251"><a href="#I_-_Install_gparted"><span class="tocnumber">9.7.1.1</span> <span class="toctext">I - Install gparted</span></a></li>
<li class="toclevel-4 tocsection-252"><a href="#II_-_Partition_the_device"><span class="tocnumber">9.7.1.2</span> <span class="toctext">II - Partition the device</span></a></li>
<li class="toclevel-4 tocsection-253"><a href="#III_-_Copy_images_and_rootfs_files_to_partitions"><span class="tocnumber">9.7.1.3</span> <span class="toctext">III - Copy images and rootfs files to partitions</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-254"><a href="#On_EVM"><span class="tocnumber">9.7.2</span> <span class="toctext">On EVM</span></a>
<ul>
<li class="toclevel-4 tocsection-255"><a href="#Setup_u-boot_env_variables"><span class="tocnumber">9.7.2.1</span> <span class="toctext">Setup u-boot env variables</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-256"><a href="#Why_can.27t_I_connect_to_DSP_cores_from_CCS_in_latest_u-boot.3F"><span class="tocnumber">9.8</span> <span class="toctext">Why can't I connect to DSP cores from CCS in latest u-boot?</span></a></li>
<li class="toclevel-2 tocsection-257"><a href="#How_to_turn_OFF_ARM_core_0.3F"><span class="tocnumber">9.9</span> <span class="toctext">How to turn OFF ARM core 0?</span></a></li>
<li class="toclevel-2 tocsection-258"><a href="#How_to_debug_kernel_through_CCS.3F"><span class="tocnumber">9.10</span> <span class="toctext">How to debug kernel through CCS?</span></a></li>
<li class="toclevel-2 tocsection-259"><a href="#How_to_workaround_the_UBI_boot_.22bad_image_sequence_number.22_problem_.3F"><span class="tocnumber">9.11</span> <span class="toctext">How to workaround the UBI boot "bad image sequence number" problem&#160;?</span></a></li>
<li class="toclevel-2 tocsection-260"><a href="#How_to_boot_a_custom_images_on_Keystone2_devices.3F"><span class="tocnumber">9.12</span> <span class="toctext">How to boot a custom images on Keystone2 devices?</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-261"><a href="#Trouble_shooting_and_FAQ"><span class="tocnumber">10</span> <span class="toctext">Trouble shooting and FAQ</span></a>
<ul>
<li class="toclevel-2 tocsection-262"><a href="#For_K2e_EVM.2C_not_able_to_do_.22.3Emon_install_0x0c5f0000.22_and_stuck_there_.3F"><span class="tocnumber">10.1</span> <span class="toctext">For K2e EVM, not able to do "&gt;mon_install 0x0c5f0000" and stuck there&#160;?</span></a></li>
<li class="toclevel-2 tocsection-263"><a href="#In_CCS_version:_5.5.0.00077.2C_how_to_do_target_configuration_in_.2A.ccxml_file_as_I_do_not_see_K2E_option_under_.22Board_or_device.22_column.3F"><span class="tocnumber">10.2</span> <span class="toctext">In CCS version: 5.5.0.00077, how to do target configuration in *.ccxml file as I do not see K2E option under "Board or device" column?</span></a></li>
<li class="toclevel-2 tocsection-264"><a href="#After_loading_the_loadlin-evm-uboot.js_file.2C_not_able_to_connect_to_target."><span class="tocnumber">10.3</span> <span class="toctext">After loading the loadlin-evm-uboot.js file, not able to connect to target.</span></a></li>
<li class="toclevel-2 tocsection-265"><a href="#MCSDK_3.01.04.07_YOCTO_EDMA3LLD_build_error"><span class="tocnumber">10.4</span> <span class="toctext">MCSDK 3.01.04.07 YOCTO EDMA3LLD build error</span></a></li>
</ul>
</li>
</ul>
</div>

<p><br />
</p>
<hr />
<p><br />
</p>
<h1><span class="mw-headline" id="Overview">Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=1" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>The Multicore Software Development Kit (MCSDK) provides foundational software for TI KeyStone II device platforms. It encapsulates a collection of software elements and tools intended to enable customer application development and migration.
</p><p>The foundational components include:
</p>
<dl><dd><dl><dd><ul><li>SYS/BIOS real-time embedded operating system on DSP cores</li>
<li>Linux high-level operating system running on ARM A15 cluster (SMP mode)</li>
<li>DSP chip support libraries, DSP/ARM drivers, and basic platform utilities</li>
<li>Interprocessor communication for communication across cores and devices</li>
<li>SoC resource management</li>
<li>Optimized application-specific (transport) and application non-specific algorithm libraries</li>
<li>Trace debug and instrumentation</li>
<li>Bootloaders and boot utilities, power-on self test</li>
<li>Demonstrations and examples</li>
<li>ARM software libraries available in Linux devkit or via Arago/Yocto</li>
<li>Latest toolchain (ARM Linaro, DSP TI CodeGen)</li>
<li>Host tools, integrated development environment</li></ul></dd></dl></dd></dl>
<p>This Chapter provides a high level overview of the different pieces so you will gain a sense of what they are and what they do. After reading this chapter you should have a sense of the different pieces that make up the MCSDK. You can then refer to the chapter, Developing with the MCSDK to get the details.
</p><p><br />
</p><p>Here is a high-level picture of the software ecosystem that MCSDK is a part of: <a href="File_800px-MCSDK-KSII-picture.html" class="image" title="800px-MCSDK-KSII-picture.jpg"><img alt="800px-MCSDK-KSII-picture.jpg" src="https://processors.wiki.ti.com/images/9/96/800px-MCSDK-KSII-picture.jpg" width="800" height="495" /></a>
</p><p><br />
</p><p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  Not all items in the genric picture above applies to all parts.
</p><p>Please see the release notes for the comprehensive list of components and version; the latest release notes is
<a rel="nofollow" class="external text" href="http://software-dl.ti.com/sdoemb/sdoemb_public_sw/mcsdk/latest/exports/MCSDK_Release_Notes.pdf">MCSDK Release Notes</a>.
For licensing information, please see the software manifest; the latest software manifest is
<a rel="nofollow" class="external text" href="http://software-dl.ti.com/sdoemb/sdoemb_public_sw/mcsdk/latest/exports/MCSDK_Software_Manifest.pdf">MCSDK Software Manifest</a>.
</p>
<h2><span class="mw-headline" id="IS_NOT">IS NOT</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=2" title="Edit section: IS NOT">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<dl><dd><dl><dd><ul><li>Support for BIOS5 or older releases</li>
<li>Support for CCS 4.x or older releases</li>
<li>Support for platforms not listed <a rel="nofollow" class="external text" href="MCSDK_UG_Chapter_Getting_Started.html#Supported_Devices_and_Platforms">here</a></li>
<li>DSP image format other than ELF (e.g., COFF)</li>
<li>Big endian ARM</li>
<li>Big endian DSP with ARM Little endian configuration</li></ul></dd></dl></dd></dl>
<h1><span class="mw-headline" id="Acronyms">Acronyms</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=3" title="Edit section: Acronyms">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p><b>Put a condensed acronym table here. That is one that addresses acronyms that this Chapter uses. This means you should add/remove from the Table below.</b><br />
</p><p>The following acronyms are used throughout this chapter.<br />
</p>
<table style="width: 75%; height: 212px" id="acronymtable" border="1">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Acronym</b>
</td>
<td bgcolor="#c0c0c0"><b>Meaning</b>
</td></tr>
<tr>
<td>AMC
</td>
<td>Advanced Mezzanine Card
</td></tr>
<tr>
<td>CCS
</td>
<td>Texas Instruments Code Composer Studio
</td></tr>
<tr>
<td>CSL
</td>
<td>Texas Instruments Chip Support Library
</td></tr>
<tr>
<td>DDR
</td>
<td>Double Data Rate
</td></tr>
<tr>
<td>DHCP
</td>
<td>Dynamic Host Configuration Protocol
</td></tr>
<tr>
<td>DSP
</td>
<td>Digital Signal Processor
</td></tr>
<tr>
<td>DVT
</td>
<td>Texas Instruments Data Analysis and Visualization Technology
</td></tr>
<tr>
<td>EDMA
</td>
<td>Enhanced Direct Memory Access
</td></tr>
<tr>
<td>EEPROM
</td>
<td>Electrically Erasable Programmable Read-Only Memory
</td></tr>
<tr>
<td>EVM
</td>
<td>Evaluation Module, hardware platform containing the Texas Instruments DSP
</td></tr>
<tr>
<td>HUA
</td>
<td>High Performance Digital Signal Processor Utility Application
</td></tr>
<tr>
<td>HTTP
</td>
<td>HyperText Transfer Protocol
</td></tr>
<tr>
<td>IP
</td>
<td>Internet Protocol
</td></tr>
<tr>
<td>IPC
</td>
<td>Texas Instruments Inter-Processor Communication Development Kit
</td></tr>
<tr>
<td>JTAG
</td>
<td>Joint Test Action Group
</td></tr>
<tr>
<td>MCSA
</td>
<td>Texas Instruments Multi-Core System Analyzer
</td></tr>
<tr>
<td>MCSDK
</td>
<td>Texas Instruments Multi-Core Software Development Kit
</td></tr>
<tr>
<td>NDK
</td>
<td>Texas Instruments Network Development Kit (IP Stack)
</td></tr>
<tr>
<td>NIMU
</td>
<td>Network Interface Management Unit
</td></tr>
<tr>
<td>PDK
</td>
<td>Texas Instruments Programmers Development Kit
</td></tr>
<tr>
<td>RAM
</td>
<td>Random Access Memory
</td></tr>
<tr>
<td>RTSC
</td>
<td>Eclipse Real-Time Software Components
</td></tr>
<tr>
<td>SPL
</td>
<td>Secondary Program Loader
</td></tr>
<tr>
<td>SRIO
</td>
<td>Serial Rapid IO
</td></tr>
<tr>
<td>TCP
</td>
<td>Transmission Control Protocol
</td></tr>
<tr>
<td>TI
</td>
<td>Texas Instruments
</td></tr>
<tr>
<td>UART
</td>
<td>Universal Asynchronous Receiver/Transmitter
</td></tr>
<tr>
<td>UDP
</td>
<td>User Datagram Protocol
</td></tr>
<tr>
<td>UIA
</td>
<td>Texas Instruments Unified Instrumentation Architecture
</td></tr>
<tr>
<td>USB
</td>
<td>Universal Serial Bus
</td></tr></tbody></table>
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  We use the abbreviation TMS when referring to a specific TI device (processor) and the abbreviation TMD when referring to a specific platform that the processor is on. For example, TMS320C6678 refers to the C6678 DSP processor and TMDSEVM6678L refers to the actual hardware EVM that the processor is on. <br />
</p>
<h1><span class="mw-headline" id="ARM_Subsystem">ARM Subsystem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=4" title="Edit section: ARM Subsystem">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Overview_2">Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=5" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>ARM subsystem runs following software components:-
</p>
<dl><dd><ul><li>U-Boot - Boot loader</li>
<li>Boot Monitor - Monitor and other secure functions</li>
<li>SMP Linux - ARM A15 port of SMP Linux</li></ul></dd></dl>
<p>This section describes details of these components delivered as part the Linux ecosystem in MCSDK.
</p>
<h2><span class="mw-headline" id="Linux">Linux</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=6" title="Edit section: Linux">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section provides information on the features, functions, delivery package and compile tools for the Linux Kernel release for KeyStone II. This document describes how to install and work with Texas Instruments' Linux Kernel for the KeyStone II&#160;platform. The MCSDK provides a fundamental Linux based software platform for development, deployment and execution on the ARM A15 processor of the KeyStone II&#160;architecture. In this context, the document contains instructions to:
</p>
<ul><li>Install the release</li>
<li>Build the sources contained in the release and run it on the target keystone II EVM</li>
<li>Kernel and peripheral driver design and/or implementation details</li></ul>
<h3><span class="mw-headline" id="Changes_impacting_users">Changes impacting users</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=7" title="Edit section: Changes impacting users">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>It is strongly recommended to upgrade all images to the same release which includes: uboot, boot monitor, kernel and file system.</b>
</p><p>This section describes the list of changes that impacts the user
</p>
<h4><span id="K2_RT_LINUX_03.10.10_13.11/K2_LINUX_03.10.10_13.11"></span><span class="mw-headline" id="K2_RT_LINUX_03.10.10_13.11.2FK2_LINUX_03.10.10_13.11">K2_RT_LINUX_03.10.10_13.11/K2_LINUX_03.10.10_13.11</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=8" title="Edit section: K2 RT LINUX 03.10.10 13.11/K2 LINUX 03.10.10 13.11">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Starting with this release, the git repo for linux, boot monitor and u-boot has been moved to git.ti.com (previously on Arago). Also Linux kernel is rebased to v3.10.10. Please see the build location for the URL for these repos.
</p>
<h4><span id="K2_RT_LINUX_03.08.04_13.09_01/K2_LINUX_03.08.04_13.09_01"></span><span class="mw-headline" id="K2_RT_LINUX_03.08.04_13.09_01.2FK2_LINUX_03.08.04_13.09_01">K2_RT_LINUX_03.08.04_13.09_01/K2_LINUX_03.08.04_13.09_01</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=9" title="Edit section: K2 RT LINUX 03.08.04 13.09 01/K2 LINUX 03.08.04 13.09 01">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>In these tags, kernel started using 512M capacity of the NAND available on the EVM. The ubifs partion size in dts file is changed accordingly to use the increased size.
The u-boot is upgraded to increase the mtd partition size to reflect the new size. The u-boot tag for this
is K2_UBOOT_2013-01_13.09_01. There are dts changes that requires the kernel to be in sync with DTS.
</p>
<h4><span class="mw-headline" id="DEV.MCSDK-03.08.04.11">DEV.MCSDK-03.08.04.11</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=10" title="Edit section: DEV.MCSDK-03.08.04.11">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<dl><dd><dl><dd><ul><li>DTS file name is changed to match with EVM name, k2hk-evm.dts. So the DTB file name has k2hk to indicate the EVM name.</li></ul></dd></dl></dd></dl>
<h4><span class="mw-headline" id="DEV.MCSDK-03.08.04.10">DEV.MCSDK-03.08.04.10</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=11" title="Edit section: DEV.MCSDK-03.08.04.10">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<dl><dd><dl><dd><ul><li>Linux upstream kernel changed to 3.8.4. Last release was based on 3.6.6. As a side effect, the location of dtb file generated by the Linux kernel build is now at arch/arm/boot/dts folder.</li>
<li>Changed the name of dtb file populated in the release to uImage-tci6638-evm.dtb.</li></ul></dd></dl></dd></dl>
<h4><span class="mw-headline" id="DEV.MCSDK-03.06.06.08">DEV.MCSDK-03.06.06.08</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=12" title="Edit section: DEV.MCSDK-03.06.06.08">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<dl><dd><dl><dd><ul><li>Changed the name of u-boot command install_skern() to mon_install()</li>
<li>Changed the name of dtb file populated in the release binaries from tci6638-evm.dtb to uImage-keystone-evm.dtb</li></ul></dd></dl></dd></dl>
<h3><span class="mw-headline" id="Installation_Guide">Installation Guide</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=13" title="Edit section: Installation Guide">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Prerequisites_for_MCSDK_3.0_Installation">Prerequisites for MCSDK 3.0 Installation</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=14" title="Edit section: Prerequisites for MCSDK 3.0 Installation">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Before you begin with the installation of this package please make sure you have met the following system requirements:
</p>
<ul><li>CCS v5.3.0 or later: Available on Windows or Linux Host</li>
<li>Keystone II Simulator: Available on Windows or Linux Host</li>
<li>Toolchain: <b>Must</b> be installed on Linux Host. Ubuntu 12.04 recommended.</li>
<li>Terminal Emulator: Tera Term on Windows or Minicom on Linux Host can be used.</li></ul>
<p><b>For CCS and Simulator installation</b>
<br /> please refer to corresponding documentation, which comes with CCS and/or Simulator.
Please see <a rel="nofollow" class="external text" href="CCSv5_Getting_Started_Guide.html">CCS Getting started guide</a>
<br />
</p>
<h4><span class="mw-headline" id="Toolchain_Installation">Toolchain Installation</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=15" title="Edit section: Toolchain Installation">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Please refer to <a rel="nofollow" class="external text" href="MCSDK_UG_Chapter_Tools.html#Linaro_toolchain">Linaro toolchain</a>
</p>
<h4><span class="mw-headline" id="Linux_Software_Installation">Linux Software Installation</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=16" title="Edit section: Linux Software Installation">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The Linux kernel related utilities and pre-built binaries are provided in the release under the folder mcsdk_linux_&lt;version&gt;.
</p><p>Please refer the "Getting Started" section for more details on installation.
</p>
<h4><span class="mw-headline" id="Tag_and_Branch_naming_convention">Tag and Branch naming convention</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=17" title="Edit section: Tag and Branch naming convention">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<h5><span class="mw-headline" id="U-Boot">U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=18" title="Edit section: U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>U-Boot release tag is named in the following format:-
</p>
<dl><dd><dl><dd><dl><dd><ul><li>K2_UBOOT_&lt;upstream release version&gt;&lt;year_&gt; &lt;month_&gt;&lt;[iteration]&gt;</li></ul></dd></dl></dd></dl></dd></dl>
<p>For Example, K2_UBOOT_2013-01_13.08 indicates, the u-boot is based on upstream version 2013-01 and the release is done in August 2013. This done to make it intuitive for anyone to identify the baseline upstream u-boot version used in a release from the tag name.
</p>
<h5><span class="mw-headline" id="Linux_2">Linux</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=19" title="Edit section: Linux">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Linux release tag is named in the following format:-
</p>
<dl><dd><dl><dd><dl><dd><ul><li>K2_LINUX_<rt></rt>-&lt;upstream release version_&gt;&lt;year_&gt; &lt;month_&gt;&lt;[iteration]&gt;</li></ul></dd></dl></dd></dl></dd></dl>
<p>For example K2_LINUX_03.08.04_13.08_01 indictaes the Linux kernel is based on upstream kernel version 03.08.04 and the release is done in August 2013 and iteration is 1. Iteration is optional and is used when multiple tags are to be used for the same month for what ever reason.
</p><p>For RT Preempt patched kernel, the tag name also include the word "RT"
</p><p>RT Preempt patched Linux kernel is available on a seperate master branch (master-rt). master branch is without RT patches. This will be available under release_&lt;build number&gt;/master-rt and release_&lt;build number&gt;/master branches respectively on Arago git repo.
</p><p><br />
</p>
<h5><span class="mw-headline" id="Boot_Monitor">Boot Monitor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=20" title="Edit section: Boot Monitor">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Boot Monitor release tag is named in the following format:-
</p>
<dl><dd><dl><dd><dl><dd><ul><li>K2_BM_&lt;year_&gt; &lt;month_&gt;&lt;[iteration]&gt;</li></ul></dd></dl></dd></dl></dd></dl>
<p>For example K2_BM_13.08 is released in August 2013
</p>
<h3><span class="mw-headline" id="Build_Instructions">Build Instructions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=21" title="Edit section: Build Instructions">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>There are two possible ways to build the linux kernel:
</p>
<ul><li>The first is to build the standalone kernel by cloning the kernel Yocto git repository on the local host. Please refer the Yocto section below for details.</li>
<li>The second is to build the kernel together with the filesystem using Yocto project on Arago</li></ul>
<h4><span class="mw-headline" id="Build_Prerequisites">Build Prerequisites</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=22" title="Edit section: Build Prerequisites">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<dl><dd><dl><dd><ul><li>Ubuntu 12.04 LTS distribution and sudo access should be available to the user.</li>
<li>Install the tool chain as described in the section <b>Toolchain Installation</b> above for cross compiling.</li>
<li>Install and configure git in the Ubuntu machine. Use the following command to install git:</li></ul></dd></dl></dd></dl>
<pre> $ apt-get install git-core
</pre>
<dl><dd><dl><dd><ul><li>To configure git please refer here<a rel="nofollow" class="external autonumber" href="http://kernel.org/pub/software/scm/git/docs/git-config.html">[1]</a>. If your network is behind a proxy, those settings need to be configured as well.</li>
<li>Packages needed at build-time can be fetched with a simple command on Ubuntu 12.04:</li></ul></dd></dl></dd></dl>
<pre> $ sudo apt-get install build-essential subversion ccache sed wget cvs coreutils unzip texinfo docbook-utils gawk help2man diffstat file g++ texi2html bison flex htmldoc chrpath libxext-dev xserver-xorg-dev doxygen bitbake uboot-mkimage libncurses5-dev
</pre>
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  If you are running a distribution other than Ubuntu 12.04 LTS, please refer to your distribution documentation for instructions on installing these required packages.
</p><p><br />
<img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  From the MCSDK 3.0.4 release onward, the size of the the rootfs has increased beyond 80MB. As a result use of ramfs is not possible. The filesystem needs to be under 80M for use with ramfs
</p>
<h4><span class="mw-headline" id="Proxy_Setup">Proxy Setup</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=23" title="Edit section: Proxy Setup">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>If your network is behind a firewall/proxy additional settings are needed for bitbake to be able to download source code repositories for various open source projects. Some of these configuration items are:
</p>
<dl><dd><dl><dd><ul><li>wgetrc: A .wgetrc needs to be created under the $HOME directory. A sample wgetrc can be found here<a rel="nofollow" class="external autonumber" href="http://www.gnu.org/software/wget/manual/html_node/Sample-Wgetrc.html">[2]</a>. Please update configuration variables http_proxy, https_proxy and ftp_proxy as per your network environment.</li></ul></dd></dl></dd></dl>
<dl><dd><dl><dd><ul><li>Set proxy environment variables. These may be added to your .bashrc or shell initialization script:</li></ul></dd></dl></dd></dl>
<hr />
<dl><dd><dl><dd><dl><dd>export http_proxy="http://&lt;your_proxy&gt;:&lt;port&gt;"</dd>
<dd>export ftp_proxy="http://&lt;your_proxy&gt;:&lt;port&gt;"</dd>
<dd>export https_proxy="http://&lt;your_proxy&gt;:&lt;port&gt;"</dd></dl></dd></dl></dd></dl>
<hr />
<dl><dd><dl><dd><ul><li>$HOME/.subversion/servers needs to be updated if the network is behind a proxy. The following lines need to be modified as per settings for your network:</li></ul></dd></dl></dd></dl>
<hr />
<dl><dd><dl><dd><dl><dd>http-proxy-exceptions = exceptions</dd>
<dd>http-proxy-host = proxy-host-for-your-network</dd>
<dd>http-proxy-port = 80</dd></dl></dd></dl></dd></dl>
<hr />
<h4><span class="mw-headline" id="U-Boot_Build_instructions">U-Boot Build instructions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=24" title="Edit section: U-Boot Build instructions">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>First clone the U-Boot source tree from Arago git repository
</p>
<dl><dd><dl><dd><dl><dd>$ git clone <a rel="nofollow" class="external free" href="git://git.ti.com/keystone-linux/u-boot.git">git://git.ti.com/keystone-linux/u-boot.git</a> u-boot-keystone</dd>
<dd>$ cd u-boot-keystone</dd>
<dd>$ git reset --hard &lt;Release tag&gt;</dd>
<dd>where release tag can be obtained from the release notes. For example, release tag used is DEV.MCSDK-2013-01.11</dd></dl></dd></dl></dd></dl>
<p>1. To build u-boot.bin that can be loaded and run from MSMC SRAM, do the following
</p>
<dl><dd><dl><dd><dl><dd>make &lt;soc&gt;_evm_config</dd>
<dd>make</dd></dl></dd></dl></dd></dl>
<p>To do 2 stage SPI NOR boot, following images are to be built.
</p><p>2. To build u-boot-spl.bin that can be booted from SPI NOR flash, do the following:-
</p>
<dl><dd><dl><dd><dl><dd>make &lt;soc&gt;_evm_config</dd>
<dd>make spl/u-boot-spl.bin</dd></dl></dd></dl></dd></dl>
<p>The u-boot-spl.bin will be available at spl/ folder
</p><p>3. To build secondary boot u-boot.img (in uImage firmware format) that can be flashed and booted through SPI NOR flash do the following:-
</p>
<dl><dd><dl><dd><dl><dd>make &lt;soc&gt;_evm_config</dd>
<dd>make u-boot.img</dd></dl></dd></dl></dd></dl>
<p>The u-boot.img will be created at root directory of u-boot source tree.
</p><p>Alternately both u-boot-spl.bin and u-boot.img can be combined and flashed to SPI NOR flash. To do so, use the following command to build a single gph image for programming on SPI NOR flash
</p>
<dl><dd><dl><dd><dl><dd>make &lt;soc&gt;_evm_config</dd>
<dd>make u-boot-spi.gph</dd></dl></dd></dl></dd></dl>
<p>The u-boot-spi.gph image will be created in the root folder.
</p><p>4. To build a single u-boot-nand.gph image that can be programmed on EMIF16 NAND flash, do the following:-
</p>
<dl><dd><dl><dd><dl><dd>make &lt;soc&gt;_evm_config</dd>
<dd>make u-boot-nand.gph</dd></dl></dd></dl></dd></dl>
<p>Note: &lt;soc&gt; is "k2hk", "k2l" or "k2e"; for MCSDK 3.0.x, &lt;soc&gt; is "tci6638"
</p>
<hr />
<h4><span class="mw-headline" id="Boot_Monitor_Build_instructions">Boot Monitor Build instructions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=25" title="Edit section: Boot Monitor Build instructions">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>To build boot monitor code, first clone the git repository as
</p>
<dl><dd><dl><dd><dl><dd>$ git clone <a rel="nofollow" class="external free" href="git://git.ti.com/keystone-linux/boot-monitor.git">git://git.ti.com/keystone-linux/boot-monitor.git</a></dd>
<dd>$ cd boot-monitor</dd>
<dd>$ git reset --hard &lt;Release tag&gt;</dd>
<dd>where release tag can be obtained from the release notes. For example, DEV.MCSDK-03.00.00.11 is the release tag.</dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><dl><dd>$ make clean</dd>
<dd>$ make</dd></dl></dd></dl></dd></dl>
<p>skern-&lt;soc&gt;.bin (for MCSDK 3.0.x, skern.bin) will be created in the current working directory.
</p><p>Note: &lt;SOC&gt; is "k2hk", "k2l" or "k2e"
</p>
<h4><span class="mw-headline" id="Linux_kernel_and_the_device_tree_blob_build_instructions">Linux kernel and the device tree blob build instructions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=26" title="Edit section: Linux kernel and the device tree blob build instructions">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>This section assumes that the Linaro toolchain for ARM is installed and environment variables CROSS_COMPILE, ARCH are set up as per instructions given in section Toolchain Installation <a rel="nofollow" class="external text" href="MCSDK_UG_Chapter_Tools.html#Linaro_toolchain">Linaro_toolchain</a>. <br />
(e.g) <br />
export CROSS_COMPILE=arm-linux-gnueabihf-<br />
export ARCH=arm<br />
PATH=&lt;path to installed toolchain&gt;/bin:$PATH<br />
</p><p>The first step in building the kernel is downloading the kernel source code from the git repositories to the local Ubuntu 12.04 host. This is performed as follows:
</p>
<dl><dd><dl><dd><dl><dd>$ git clone <a rel="nofollow" class="external free" href="git://git.ti.com/keystone-linux/linux.git">git://git.ti.com/keystone-linux/linux.git</a> linux-keystone</dd>
<dd>$ cd linux-keystone</dd>
<dd>$ git reset --hard &lt;Release tag&gt; where release tag can be obtained from Release notes. For example tag is DEV.MCSDK-03.08.04.11 for the release.</dd></dl></dd></dl></dd></dl>
<p>Before building the linux kernel for Simulator, user has to modify the source file linux-keystone/drivers/net/ethernet/ti/keystone_ethss.c
</p><p>The line u8 mac_addr_nic[6] = {0x5c, 0x26, 0x0a, 0x80, 0x0d, 0x43}; /* NIC addr */ has to be modified
</p><p>The NIC address should be appropriately modified with the NIC address of the host where CCS and the simulator are installed.
</p><p>To build the kernel for execute the following commands inside the linux-keystone folder:
</p>
<dl><dd><dl><dd><dl><dd>$ make keystone2_defconfig</dd>
<dd>$ make uImage</dd></dl></dd></dl></dd></dl>
<p>The next step is to build the device tree file:
</p><p>For building DTB for EVM use the following command:-
</p>
<dl><dd><dl><dd><dl><dd>$ make &lt;soc&gt;-evm.dtb</dd></dl></dd></dl></dd></dl>
<p>Note: &lt;soc&gt; is "k2hk", "k2l" or "k2e"
</p><p>For building DTB for simulator use the following command:-
</p>
<dl><dd><dl><dd><dl><dd>$ make keystone-sim.dtb</dd></dl></dd></dl></dd></dl>
<p>Note that starting 3.8.4, location of dtb binary is moved to arch/arm/boot/dts.
</p><p>To Build Linux for Full RT Preempt mode, do the following
</p>
<dl><dd><dl><dd><dl><dd>$ git reset --hard &lt;Release tag&gt; where release tag can be obtained from Release notes. For example tag for RT kernel is DEV.MCSDK-RT-03.08.04.11 for the release.</dd>
<dd>$ make keystone2_fullrt_defconfig</dd>
<dd>$ make uImage</dd></dl></dd></dl></dd></dl>
<h4><span class="mw-headline" id="TransportNetLib_Software_Library_and_Build_instructions">TransportNetLib Software Library and Build instructions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=27" title="Edit section: TransportNetLib Software Library and Build instructions">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>TransportNetLib software package provides a library for ARM user space application to gain direct access to networking h/w. This is for such use cases as fast path packet processing.  The TransportNetLib includes HighPerformanceLib(HPLIB) and Network API(NetAPI) modules. Detailed description of these modules and build insructions are available at <a rel="nofollow" class="external free" href="TransportNetLib_UsersGuide.html">http://processors.wiki.ti.com/index.php/TransportNetLib_UsersGuide</a>.
</p>
<h3><span id="Running_U-Boot,_Boot_Monitor_and_Linux_Kernel_on_EVM"></span><span class="mw-headline" id="Running_U-Boot.2C_Boot_Monitor_and_Linux_Kernel_on_EVM">Running U-Boot, Boot Monitor and Linux Kernel on EVM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=28" title="Edit section: Running U-Boot, Boot Monitor and Linux Kernel on EVM">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Loading_and_Running_U-Boot_on_EVM_through_UART">Loading and Running U-Boot on EVM through UART</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=29" title="Edit section: Loading and Running U-Boot on EVM through UART">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Before loading the u-boot to EVM you need to create u-boot.uart blob. That is the u-boot.bin binary with preceding 4096 zeros. Assuming you are in the u-boot source top level directory execute the following commands after building u-boot:
</p>
<pre>&gt; dd if=/dev/zero of=4k_zeros bs=4096 count=1
&gt; cat 4k_zeros u-boot.bin &gt; u-boot.uart
</pre>
<p>You should run two terminals on a PC. One connected to the BMC and another to the UART0 of the K2HK SOC. The terminal connected the the SOC UART0 port must support xmodem protocol. For example to use minicom on Linux, follow the steps at [<a rel="nofollow" class="external autonumber" href="http://software-dl.ti.com/processor-sdk-android/esd/docs/latest/android/Overview_Getting_Started_Guide.html#run-setup-scripts">[3]</a>]
</p><p>At the UART0 terminal, user should initiate transfer of the u-boot.uart file using the xmodem protocol. User should see
</p>
<pre>'s: Give your local XMODEM receive command now."
</pre>
<p>Using BMC console set the ARM UART boot mode and reboot the K2HK SOC.
</p>
<pre>BMC&gt; bootmode #4
BMC&gt; reboot
</pre>
<p>This would initiate the transfer. Once transfer is complete, user would see 
</p>
<pre>Transfer complete                                                 
READY: press any key to continue... 
</pre>
<p>Once any key is pressed, u-boot starts up and boot up log is seen at the UART0 terminal
</p><p><br />
</p>
<h4><span class="mw-headline" id="Loading_and_Running_U-Boot_on_EVM_through_CCS">Loading and Running U-Boot on EVM through CCS</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=30" title="Edit section: Loading and Running U-Boot on EVM through CCS">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>If you do not have a target configuration for the EVM, you have to create one. Create a new target configuration for the TCI6638 device using the "Texas Instruments XDS2xx USB Emulator" connection. You have to do that only once.
</p><p>Launch the target configuration.
</p><p><a href="File_Tci6638_ccxml_1.html" class="image"><img alt="Tci6638 ccxml 1.png" src="https://processors.wiki.ti.com/images/1/19/Tci6638_ccxml_1.png" width="527" height="279" /></a>
</p><p>Power on the EVM and connect CCS to the CortexA15_1 target.
</p><p>Connect serial cable between the PC and the EVM. Open Teraterm or Hyper Terminal, create a connection with 115200 baud rate, 8 data bits, no parity, 1 stop bits and no flow control.
</p><p>Copy the images from the images folder of the installed release directory to the loadlin folder. Copy the latest tci6638-evm.ccxml to the loadlin folder. Also the script may need tweaking to suite the environment on which you are running this
script. The example given here is for reference only.
</p><p>Edit the loadlin-evm-uboot.js java script from the &lt;release folder&gt;/host-tools/loadlin folder for the following
</p>
<pre>PATH_LOADLIN = &lt;path of release folder&gt;/host-tools/loadlin
var pathUboot = PATH_LOADLIN + "/u-boot-keystone-evm.bin";
var pathSKern = PATH_LOADLIN + "/skern-keystone-evm.bin";
</pre>
<p>Save the file. Copy the image files (u-boot-keystone-evm.bin and skern-keystone-evm.bin) from &lt;release folder&gt;/images to &lt;release folder&gt;/host-tools/loadlin. Open the scripting console and type
</p>
<ul><li>loadJSFile "&lt;path of release folder&gt;/host-tools/loadlin/loadlin-evm-uboot.js"</li></ul>
<p>This will load, u-boot image to MSMC RAM at 0xc001000 and boot monitor image to MSMC RAM at address 0xc5f0000. Make sure PC is currently pointing to 0xc001000. Click Resume button on the CCS window to run u-boot.
</p><p><a href="File_Uboot_tci6638_1.html" class="image"><img alt="Uboot tci6638 1.png" src="https://processors.wiki.ti.com/images/e/e7/Uboot_tci6638_1.png" width="619" height="287" /></a>
</p><p><a href="File_Uboot_tci6638_2.html" class="image"><img alt="Uboot tci6638 2.png" src="https://processors.wiki.ti.com/images/7/75/Uboot_tci6638_2.png" width="594" height="292" /></a>
</p><p><br />
</p>
<h4><span class="mw-headline" id="Loading_and_running_U-Boot_on_EVM_through_SPI_Boot">Loading and running U-Boot on EVM through SPI Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=31" title="Edit section: Loading and running U-Boot on EVM through SPI Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<h5><span class="mw-headline" id="Two_Stage_SPI_Flash_Boot">Two Stage SPI Flash Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=32" title="Edit section: Two Stage SPI Flash Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The two stage SPI flash u-boot image consists of a first stage u-boot SPL binary with a header and a footer,
and a second stage full u-boot binary.  These two binaries can be programmed to SPI flash in two ways.
</p>
<dl><dd><ul><li>Using a combined single GPH image (u-boot-spi-&lt;soc&gt;-evm.gph from release) to program the SPI NOR flash.</li></ul></dd></dl>
<p>Where &lt;soc&gt; is k2hk/k2e/k2l. If you build u-boot from source code, u-boot-spi.gph will be created in the root source directory and is to be used as u-boot-spi-&lt;soc&gt;.gph.  This is the quick and easiest way to upgrade u-boot image if you have u-boot running already on the evm. This implemented using a u-boot env script which is added to very recent version of the u-boot. To see if current u-boot on EVM support this, do
</p>
<pre> &gt;printenv
</pre>
<p>and check if get_uboot_net and burn_uboot env variables are present. Also name_uboot is set to u-boot-spi-&lt;soc&gt;-evm.gph. If so do following to upgrade u-boot assuming gph image is copied to root directory of tftp server
</p>
<pre> env default -f -a
 setenv serverip &lt;ip address of tftp server&gt;
 setenv tftp_root &lt;tftp root directory&gt;
 run get_uboot_net
 run burn_uboot
 reset
</pre>
<p>The EVM now boots with latest version of u-boot image.
</p><p>'<b>NOTE:'</b> User might want to check the value of mem_reserve env variable to ensure only reserved memory is used by applications as described in <a href="#Reserve_DDR_memory"> Reserve DDR memory</a>
</p>
<dl><dd><ul><li>Program the two stage binaries separately, follow the steps in the below section</li></ul></dd></dl>
<h6><span class="mw-headline" id="Burning_First_Stage_u-boot-spl.bin_to_SPI_Flash">Burning First Stage u-boot-spl.bin to SPI Flash</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=33" title="Edit section: Burning First Stage u-boot-spl.bin to SPI Flash">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Follow the same procedure described in section <a href="#Burning_Single_Stage_U-Boot_to_SPI_Flash">Burning Single Stage U-Boot to SPI Flash</a>, but use the u-boot-spl.bin image instead. The SPL U-Boot reside in SPI flash at offset 0.
</p>
<h6><span class="mw-headline" id="Burning_Second_Stage_u-boot.img_to_SPI_Flash">Burning Second Stage u-boot.img to SPI Flash</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=34" title="Edit section: Burning Second Stage u-boot.img to SPI Flash">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>First step is to load u-boot.img to MSMC SRAM address 0xc300000 through CCS or other means. Then do the following steps:-
</p>
<ul><li>sf probe</li>
<li>sf erase 0x10000 &lt;size of image in hex rounded to sector boundary of 0x10000&gt;</li></ul>
<dl><dd>for example if the size of image is hex 0x4500b, round it to 0x50000</dd></dl>
<ul><li>sf write 0xc300000 0x10000 &lt;size of image in hex&gt;</li></ul>
<p><br />
</p>
<h5><span class="mw-headline" id="Single_Stage_SPI_Flash_Boot">Single Stage SPI Flash Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=35" title="Edit section: Single Stage SPI Flash Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>In the single stage SPI flash boot, the image to be burnt into the SPI flash contains the u-boot.bin
with a header and a footer added.
</p>
<h6><span class="mw-headline" id="Burning_Single_Stage_U-Boot_to_SPI_Flash">Burning Single Stage U-Boot to SPI Flash</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=36" title="Edit section: Burning Single Stage U-Boot to SPI Flash">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>This section assumes that u-boot is booted up and running on EVM, e.g. using CCS (see section above)
</p><p>Load u-boot.bin to memory to be saved to SPI flash through CCS
</p>
<pre>* Have a copy of u-boot.bin ready in a directory on host PC running CCS
* Start and connect CCS to ARM core 0
* CCS &gt; Run &gt; "Suspend"
* CCS &gt; Tools &gt; Load Memory &gt; browse to the copy of u-boot.bin and load it to address 0x0c300000
* CCS &gt; Run &gt; "Resume"
where 0x0c300000 is an example address to temporarily keep the u-boot.bin image.
</pre>
<p>Now a copy of u-boot.bin is loaded to 0x0c300000.
</p><p>At the u-boot prompt:
</p>
<ul><li>Format the u-boot.bin image loaded in memory to SPI boot format</li></ul>
<pre>&gt; fmtimg spi 0x0c001000 0x0c300000 &lt;hex_size&gt;
where hex_size is the size of the u-boot.bin in hex bytes,
and 0x0c001000 is the address that u-boot.bin will be loaded by RBL and starts execution.
Note down the formatted image hex size printed out at the end of the command, call this fmt_img_size.
</pre>
<ul><li>Alternatively issue following commands to perform the formatting</li></ul>
<pre>&gt; setenv fileaddr 0x0c300000
&gt; setenv filesize &lt;hex_size&gt;
&gt; fmtimg spi 0x0c001000
where command fmtimg takes the hex size of u-boot.bin from env variable "filesize",
and the address where u-boot.bin is situated is taken from env variable "fileaddr".
This is useful if u-boot.bin is loaded to memory by using tftp. In that case, filesize and fileaddr are set in the process.
Note down the formatted image hex size printed out at the end of the command, call this fmt_img_size.
</pre>
<ul><li>Prepare SPI flash for saving formatted u-boot.bin later</li></ul>
<pre>&gt; sf probe
&gt; sf erase 0 &lt;hex_len&gt;
erases hex_len bytes in SPI flash starting from offset 0,
where hex_len must be at least the formatted image size shown in the fmtimg command and on flash sector boundary,
sector size of SPI flash on EVM is 0x10000
e.g. if formatted image size is 0x2FBA0, then "sf erase 0 0x30000"
</pre>
<ul><li>Save formatted u-boot.bin image to SPI flash</li></ul>
<pre>&gt; sf write 0x0c300000 0 &lt;fmt_img_size&gt;
where fmt_img_size is the hex size of the formatted image printed out in the fmtimg command above.
</pre>
<p><br />
</p>
<h5><span class="mw-headline" id="Booting_U-Boot_from_SPI_Flash_on_EVM">Booting U-Boot from SPI Flash on EVM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=37" title="Edit section: Booting U-Boot from SPI Flash on EVM">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<pre>* Power off EVM
* Set Boot Setting DIP Switch (SW1) on EVM to 0010 (ARM SPI boot mode)
     - i.e SW1: 1(OFF) 2(OFF) 3(ON) 4(OFF)
* If any, disconnect CCS from EVM
* Power up EVM
</pre>
<h4><span id="Loading_and_running_U-Boot_on_EVM_through_NAND_boot_(Keystone2_Rev2.0_or_Later_EVM_ONLY)"></span><span class="mw-headline" id="Loading_and_running_U-Boot_on_EVM_through_NAND_boot_.28Keystone2_Rev2.0_or_Later_EVM_ONLY.29">Loading and running U-Boot on EVM through NAND boot (Keystone2 Rev2.0 or Later EVM ONLY)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=38" title="Edit section: Loading and running U-Boot on EVM through NAND boot (Keystone2 Rev2.0 or Later EVM ONLY)">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<h5><span class="mw-headline" id="Burning_U-Boot_to_NAND_Flash">Burning U-Boot to NAND Flash</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=39" title="Edit section: Burning U-Boot to NAND Flash">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>This section assumes that u-boot is booted up and running on EVM, e.g. using <a href="#Loading_and_Running_U-Boot_on_EVM_through_CCS">CCS</a> or <a href="#Loading_and_running_U-Boot_on_EVM_through_SPI_Boot">SPI boot</a>.  Also the EVM is connected to a network where a tftp server is available.
</p>
<ul><li>compile the nand u-boot image on host (refer to U-Boot Build instructions section)</li>
<li>place u-boot-nand.gph in tftp server</li>
<li>under u-boot prompt, do</li></ul>
<pre>&gt; setenv serverip &lt;tftp-server-ip-address&gt;
&gt; setenv bootfile '/tftp/server/path/to/u-boot-nand.gph'
&gt; dhcp ${fileaddr}
&gt; nand ecclayout set 1
&gt; nand erase.part bootloader
&gt; # For K2HK EVM
&gt; nand write ${fileaddr} bootloader ${filesize}
&gt; # For K2E or K2L EVM
&gt; nand write ${fileaddr} &lt;offset&gt; ${filesize}
&gt; nand ecclayout set 0
</pre>
<p>'<b>NOTE:'</b>
There is an errata for K2L and K2E PG 1.0 that NAND boot does not distinguish between a block that has been pre-marked as bad vs one that is declared bad due to error correction failure. When a bad block is found, the ROM bootloader moves to the next block and re-initializes the boot data processor. When the block is pre-marked as bad the boot data processor should not be reset.
</p><p>The workaround to this problem is to burn a multi-block image in the NAND with contiguous good blocks. Users can check the bad block list using "nand bad" command and skip any bad blocks.
</p><p>The NAND device on K2L EVM has a block size of 256KB, and u-boot-nand.gph is over 300KB which will uses 2 blocks, starting from block 0 (offset address 0). Similarly the nand device on K2E EVM has a block size of 128KB, and u-boot-nand.gph will uses 3 blocks. If any of the 2 or 3 blocks are marked bad, we should skip the bad block and use the next 2 or 3 good blocks.
</p><p>E.g. block 0 is good but block 1 is bad, and block 2 - 4 are good, the &lt;offset&gt; should be set to 0x80000 (starting offset address of block 2) for K2L EVM, and 0x40000 for K2E EVM.
</p><p>'<b>NOTE:'</b> User might want to check the value of mem_reserve env variable to ensure only reserved memory is used by applications as described in <a href="#Reserve_DDR_memory"> Reserve DDR memory</a>
</p>
<h5><span class="mw-headline" id="Booting_U-Boot_from_NAND_Flash_on_EVM">Booting U-Boot from NAND Flash on EVM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=40" title="Edit section: Booting U-Boot from NAND Flash on EVM">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>To boot u-boot from NAND flash, do one of the following:
</p>
<ul><li>By setting boot pin:</li></ul>
<pre>* Power off EVM
* Set Boot Setting DIP Switch (SW1) on EVM to 0000 (ARM NAND boot mode)
     - i.e SW1: 1(OFF) 2(OFF) 3(OFF) 4(OFF)
* Power up EVM
</pre>
<ul><li>From BMC terminal on Rev2.0 EVM</li></ul>
<pre>BMC&gt; bootmode #0
BMC&gt; reboot
</pre>
<h4><span class="mw-headline" id="Loading_and_Running_Linux_Kernel_on_EVM">Loading and Running Linux Kernel on EVM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=41" title="Edit section: Loading and Running Linux Kernel on EVM">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<h5><span class="mw-headline" id="Loading_and_Running_Linux_Kernel_on_EVM_using_CCS">Loading and Running Linux Kernel on EVM using CCS</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=42" title="Edit section: Loading and Running Linux Kernel on EVM using CCS">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>First step is to load <b>u-boot</b> (eg. u-boot-keystone-evm.bin) and <b>boot monitor</b> (eg. skern-keystone-evm.bin) images onto MSMC RAM and run u-boot to get the u-boot prompt. See the instructions in section <a href="#Loading_and_Running_U-Boot_on_EVM_through_CCS">Loading and Running U-boot on EVM using CCS</a>.
</p><p>Now follow the steps below to load and run Linux through CCS.
</p><p>Copy the images from the images folder of the release directory to the loadlin folder.
</p><p>Edit the loadlin-evm-kern.js file and make sure the following variables points to valid paths for the images.
</p>
<pre>PATH_LOADLIN = &lt;path of lsp-release-folder&gt;/host-tools/loadlin
var pathKernel		= PATH_LOADLIN + "/uImage-keystone-evm.bin";
var pathDtb		= PATH_LOADLIN + "/uImage-k2hk-evm.dtb";
var pathInitrd           = PATH_LOADLIN + "/&lt;name of min root file system, eg. tisdk-rootfs.cpio.gz&gt;".
If the root fs image size is greater than 9M, make sure the bootargs in u-boot is set correctly to reflect the size.
Currently it defaults to 9M.
</pre>
<dl><dd><dl><dd><b>Note</b> For RT Preempt images, use image file names uImage-rt-keystone-evm.bin and uImage-rt-k2hk-evm.dtb for kernel and dtb files.</dd></dl></dd></dl>
<p>Save the file and exit.
</p>
<ul><li>Click onto the suspend button or Alt+F8</li></ul>
<p>Open scripting console and run
</p>
<ul><li>loadJSFile "&lt;path of loadlin from release folder&gt;/loadlin-evm-kern.js"</li></ul>
<p><a href="File_Loadlin-evm.html" class="image"><img alt="Loadlin-evm.jpg" src="https://processors.wiki.ti.com/images/9/98/Loadlin-evm.jpg" width="800" height="341" /></a>
</p>
<ul><li>The script loads Linux kernel image, DTB and file system image to DDR. Once script execution is complete, click onto the Resume button on CCS.</li>
<li>At u-boot prompt, update the env variable bootargs, for example:</li></ul>
<pre>&gt; setenv bootargs 'console=ttyS0,115200n8 rootwait=1 earlyprintk rdinit=/sbin/init rw root=/dev/ram0 initrd=0x802000000,9M'
&gt; saveenv
</pre>
<p>If the size of the file system image is greater than 9M, update 9M to the correct size.
</p><p>Next, type the following command to install boot monitor code.
</p>
<pre>&gt; mon_install 0x0c5f0000
</pre>
<p>Now boot Linux using the u-boot command below.
</p>
<pre>&gt; bootm 0x88000000 - 0x87000000
</pre>
<p>A sample SMP Linux boot log is shown below for reference
</p>
<pre>## Started boot kernel successfully
TCI6638 EVM # bootm 0x88000000 - 0x87000000
## Booting kernel from Legacy Image at 88000000 ...
   Image Name:   Linux-3.6.6-rt17-01071-g898535d-
   Created:      2013-01-28  16:17:47 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    3215872 Bytes = 3.1 MiB
   Load Address: 80008000
   Entry Point:  80008000
   Verifying Checksum ... OK
## Flattened Device Tree blob at 87000000
   Booting using the fdt blob at 0x87000000
   Loading Kernel Image ... OK
OK
   Loading Device Tree to 87ff8000, end 87fff2ea ... OK
</pre>
<pre>Starting kernel ...
</pre>
<pre>&gt;&gt;&gt;&gt; skern_poweron_cpu &gt;&gt;&gt;&gt;
Message2 from Secure Mode
&gt;&gt;&gt;&gt; skern_poweron_cpu &gt;&gt;&gt;&gt;
Message2 from Secure Mode
&gt;&gt;&gt;&gt; skern_poweron_cpu &gt;&gt;&gt;&gt;
Message2 from Secure Mode
[    0.000000] Booting Linux on physical CPU 0
[    0.000000] Linux version 3.6.6-rt17-01071-g898535d-dirty (a0868495@ares-ubun
tu.am.dhcp.ti.com) (gcc version 4.7.2 20120701 (prerelease) (crosstool-NG linaro
-1.13.1-2012.07-20120720 - Linaro GCC 2012.07) ) #1 SMP PREEMPT Mon Jan 28 11:17
:38 EST 2013
[    0.000000] CPU: ARMv7 Processor [412fc0f4] revision 4 (ARMv7), cr=10c5387d
[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, PIPT instruction cache
[    0.000000] Machine: KeyStone2, model: Texas Instruments Keystone 2 SoC
[    0.000000] cma: CMA: reserved 16 MiB at 86c00000
[    0.000000] Memory policy: ECC disabled, Data cache writealloc
[    0.000000] On node 0 totalpages: 32768
[    0.000000] free_area_init_node: node 0, pgdat c05ff440, node_mem_map c062b00
0
[    0.000000]   Normal zone: 256 pages used for memmap
[    0.000000]   Normal zone: 0 pages reserved
[    0.000000]   Normal zone: 32512 pages, LIFO batch:7
[    0.000000] PERCPU: Embedded 8 pages/cpu @c0735000 s11776 r8192 d12800 u32768
[    0.000000] pcpu-alloc: s11776 r8192 d12800 u32768 alloc=8*4096
[    0.000000] pcpu-alloc: [0] 0 [0] 1 [0] 2 [0] 3
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pag
es: 32512
[    0.000000] Kernel command line: console=ttyS0,115200n8 debug earlyprintk  rd
init=/bin/ash rw root=/dev/ram0 initrd=0x85000000,9M
[    0.000000] PID hash table entries: 512 (order: -1, 2048 bytes)
[    0.000000] Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
[    0.000000] Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Memory: 128MB = 128MB total
[    0.000000] Memory: 97800k/97800k available, 33272k reserved, 0K highmem
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector &#160;: 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap &#160;: 0xfff00000 - 0xfffe0000   ( 896 kB)
[    0.000000]     vmalloc&#160;: 0xc8800000 - 0xff000000   ( 872 MB)
[    0.000000]     lowmem &#160;: 0xc0000000 - 0xc8000000   ( 128 MB)
[    0.000000]     pkmap  &#160;: 0xbfe00000 - 0xc0000000   (   2 MB)
[    0.000000]     modules&#160;: 0xbf000000 - 0xbfe00000   (  14 MB)
[    0.000000]       .text&#160;: 0xc0008000 - 0xc0596c08   (5692 kB)
[    0.000000]       .init&#160;: 0xc0597000 - 0xc05cbe00   ( 212 kB)
[    0.000000]       .data&#160;: 0xc05cc000 - 0xc0601ea8   ( 216 kB)
[    0.000000]        .bss&#160;: 0xc0601ecc - 0xc062a1cc   ( 161 kB)
[    0.000000] SLUB: Genslabs=11, HWalign=64, Order=0-3, MinObjects=0, CPUs=4, N
odes=1
[    0.000000] Preemptible hierarchical RCU implementation.
[    0.000000] NR_IRQS:16 nr_irqs:16 16
[    0.000000] main_pll_clk rate is 983040000, postdiv = 2, pllm = 15,plld = 0
[    0.000000] tci6614-timer: no matching node
[    0.000000] arch_timer: found timer irqs 29 30
[    0.000000] Architected local timer running at 166.66MHz.
[    0.000000] Switching to timer-based delay loop
[    0.000000] sched_clock: 32 bits at 166MHz, resolution 6ns, wraps every 25769
ms
[    0.000000] Console: colour dummy device 80x30
[    0.000092] Calibrating delay loop (skipped), value calculated using timer fr
equency.. 333.33 BogoMIPS (lpj=1666666)
[    0.000113] pid_max: default: 4096 minimum: 301
[    0.000364] Mount-cache hash table entries: 512
[    0.008205] CPU: Testing write buffer coherency: ok
[    0.008399] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000
[    0.008435] hw perfevents: enabled with ARMv7 Cortex-A15 PMU driver, 7 counte
rs available
[    0.008503] Setting up static identity map for 0x804074b0 - 0x804074e4
[    0.104891] CPU1: Booted secondary processor
[    0.104932] CPU1: thread -1, cpu 1, socket 0, mpidr 80000001
[    0.154985] CPU2: Booted secondary processor
[    0.155031] CPU2: thread -1, cpu 2, socket 0, mpidr 80000002
[    0.205092] CPU3: Booted secondary processor
[    0.205141] CPU3: thread -1, cpu 3, socket 0, mpidr 80000003
[    0.205335] Brought up 4 CPUs
[    0.205375] SMP: Total of 4 processors activated (1333.33 BogoMIPS).
[    0.232209] NET: Registered protocol family 16
[    0.247428] DMA: preallocated 256 KiB pool for atomic coherent allocations
[    0.256104] hw-breakpoint: found 5 (+1 reserved) breakpoint and 4 watchpoint
registers.
[    0.256114] hw-breakpoint: halting debug mode enabled. Assuming maximum watch
point size of 4 bytes.
[    0.275902] bio: create slab &lt;bio-0&gt; at 0
[    0.277188] SCSI subsystem initialized
[    0.278040] usbcore: registered new interface driver usbfs
[    0.278235] usbcore: registered new interface driver hub
[    0.278478] usbcore: registered new device driver usb
[    0.282607] Switching to clocksource arch_sys_counter
[    0.313194] NET: Registered protocol family 2
[    0.313891] TCP established hash table entries: 4096 (order: 3, 32768 bytes)
[    0.314031] TCP bind hash table entries: 4096 (order: 3, 32768 bytes)
[    0.314165] TCP: Hash tables configured (established 4096 bind 4096)
[    0.314195] TCP: reno registered
[    0.314212] UDP hash table entries: 128 (order: 0, 4096 bytes)
[    0.314237] UDP-Lite hash table entries: 128 (order: 0, 4096 bytes)
[    0.314570] NET: Registered protocol family 1
[    0.314914] RPC: Registered named UNIX socket transport module.
[    0.314927] RPC: Registered udp transport module.
[    0.314938] RPC: Registered tcp transport module.
[    0.314949] RPC: Registered tcp NFSv4.1 backchannel transport module.
[    0.315232] Unpacking initramfs...
[    0.357371] Initramfs unpacking failed: junk in compressed archive
[    0.366886] Freeing initrd memory: 9216K
[    0.512036] Installing knfsd (copyright (C) 1996 okir@monad.swb.de).
[    0.512661] NTFS driver 2.1.30 [Flags: R/O].
[    0.513335] jffs2: version 2.2. (NAND)  2001-2006 Red Hat, Inc.
[    0.516214] NET: Registered protocol family 38
[    0.516738] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 2
54)
[    0.516754] io scheduler noop registered
[    0.516766] io scheduler deadline registered
[    0.517099] io scheduler cfq registered (default)
[    0.629016] Serial: 8250/16550 driver, 4 ports, IRQ sharing disabled
[    0.631409] 2530c00.serial: ttyS0 at MMIO 0x2530c00 (irq = 309) is a 16550A
[    1.272067] console [ttyS0] enabled
[    1.282480] loop: module loaded
[    1.285920] at24 0-0050: 131072 byte 24c1024 EEPROM, writable, 1 bytes/write
[    1.294796] Generic platform RAM MTD, (c) 2004 Simtec Electronics
[    1.317849] ONFI param page 0 valid
[    1.321286] ONFI flash detected
[    1.324406] NAND device: Manufacturer ID: 0x2c, Chip ID: 0xa1 (Micron MT29F1G
08ABBDAHC), page size: 2048, OOB size: 64
[    1.335350] Bad block table found at page 65472, version 0x01
[    1.341652] Bad block table found at page 65408, version 0x01
[    1.347821] 3 ofpart partitions found on MTD device 30000000.nand
[    1.353839] Creating 3 MTD partitions on "30000000.nand":
[    1.359157] 0x000000000000-0x000000100000&#160;: "u-boot"
[    1.365625] 0x000000100000-0x000000180000&#160;: "params"
[    1.371894] 0x000000180000-0x000008000000&#160;: "ubifs"
[    1.378210] davinci_nand 30000000.nand: controller rev. 2.5
[    1.385151] spi_davinci 21000400.spi: master is unqueued, this is deprecated
[    1.396627] m25p80 spi32766.0: unrecognized JEDEC id 20bb18
[    1.402144] spi_davinci 21000400.spi: Controller at 0xc8886400
[    1.411193] Initializing USB Mass Storage driver...
[    1.416251] usbcore: registered new interface driver usb-storage
[    1.422163] USB Mass Storage support registered.
[    1.427169] mousedev: PS/2 mouse device common for all mice
[    1.433274] i2c /dev entries driver
[    1.438539] usbcore: registered new interface driver usbhid
[    1.444048] usbhid: USB HID core driver
[    1.448904] oprofile: using timer interrupt.
[    1.453217] Netfilter messages via NETLINK v0.30.
[    1.457862] nf_conntrack version 0.5.0 (1928 buckets, 7712 max)
[    1.464255] ctnetlink v0.93: registering with nfnetlink.
[    1.470064] IPv4 over IPv4 tunneling driver
[    1.475125] gre: GRE over IPv4 demultiplexor driver
[    1.479929] ip_gre: GRE over IPv4 tunneling driver
[    1.485851] ip_tables: (C) 2000-2006 Netfilter Core Team
[    1.491305] ipt_CLUSTERIP: ClusterIP Version 0.8 loaded successfully
[    1.497642] arp_tables: (C) 2002 David S. Miller
[    1.502261] TCP: cubic registered
[    1.505545] Initializing XFRM netlink socket
[    1.510969] NET: Registered protocol family 10
[    1.516455] NET: Registered protocol family 17
[    1.520858] NET: Registered protocol family 15
[    1.525257] 8021q: 802.1Q VLAN Support v1.8
[    1.529761] sctp: Hash tables configured (established 4096 bind 4096)
[    1.536950] NET: Registered protocol family 40
[    1.541512] rpmsg_proto_init: registered rpmsg network protocol
[    1.547471] VFP support v0.3: not present
[    1.551440] Registering SWP/SWPB emulation handler
[    1.564498] Freeing init memory: 208K
/bin/ash: can't access tty; job control turned off
/ #
</pre>
<h3><span id="Design/Implementation_Notes"></span><span class="mw-headline" id="Design.2FImplementation_Notes">Design/Implementation Notes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=43" title="Edit section: Design/Implementation Notes">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="U-Boot_2">U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=44" title="Edit section: U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The MCSDK U-boot is based on the Universal Boot Loader (U-boot) public project. The documentation is available on <a rel="nofollow" class="external free" href="http://www.denx.de/wiki/U-Boot/">http://www.denx.de/wiki/U-Boot/</a><br />The release is based on upstream v2013.01 U-boot release. This section gives information specific to the TCI6638EVM board and drivers only.
</p>
<h5><span class="mw-headline" id="Board_Support">Board Support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=45" title="Edit section: Board Support">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The Keystone EVM board file islocated at board/ti/ks2_evm (for MCSDK 3.0.x, it is located at board/ti/tci6638_evm directory). It has PLL, DDR3 configurations and initialization functions.
</p>
<h5><span class="mw-headline" id="SoC_Support">SoC Support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=46" title="Edit section: SoC Support">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The Keystone chip specific code is located at arch/arm/cpu/armv7/keystone directory. It has the following files:
</p>
<ul><li>aemif.c  Asynchronous EMIF configuration.</li>
<li>init.c  chip configuration</li>
<li>clock.c  clock related functions</li>
<li>cmd_clock.c, cmd_mon.c, cmd_fmtimg.c  implementation of psc, getclk, pllset, fmtimg and mon_install shell commands.</li>
<li>psc.c  PSC driver.</li>
<li>cppi_dma.c  simple CPPI_DMA driver.</li></ul>
<h5><span class="mw-headline" id="Drivers">Drivers</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=47" title="Edit section: Drivers">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The Keystone EVM uses the following drivers:
</p>
<ul><li>SPI - drivers/spi/davinci_spi.c.</li>
<li>I2C - drivers/i2c/keystone_i2c.c.</li>
<li>UART - serial.c, ns16550.c and serial_ns16550.c at drivers/serial directory.</li>
<li>NAND - drivers/mtd/nand/davinci_nand.c</li>
<li>ETH - drivers/net/keystone_net.c</li>
<li>USB - generic xhci support from patches patchwork.ozlabs.org/patch/193476/ and patchwork.ozlabs.org/patch/193477/. Platform specific xhci support in drivers/usb/host/xhci-keystone.c</li></ul>
<h5><span class="mw-headline" id="Ethernet_Driver">Ethernet Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=48" title="Edit section: Ethernet Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The K2HK EVM has 4 Ethernet ports (port 0 - 3) with K2HK_EMAC, K2HK_EMAC1, K2HK_EMAC2, K2HK_EMAC3 interface names. The K2L EVM has 4 Ethernet ports (port 0 - 3) with K2L_EMAC0, K2L_EMAC1, K2L_EMAC2, K2L_EMAC3 interface names.   The "ethact" environment variable selects the currently active Ethernet interface. For example:
</p>
<pre>set ethact K2HK_EMAC1
</pre>
<p>selects the port 1 to be used for following network commands.
</p><p>You may change the active interface on runtime.
</p><p>The <b>ethact</b> variable is set on start of u-boot to the name of the first registered interface. The TCI6638_EMAC is registered first and therefore ethact is always set to that name. You may want to use another environment variable to set desirable interface. You can do that extending init_${boot} variables.
</p><p>MAC address of the port 0 is taken from SOC e-fuse. You may want to overwrite it setting the ethaddr environment variable. The SoC doesnt have an e-fuse for second port MAC address. You have to set the eth1addr explicitly for that port.
</p><p><i>NOTE: U-boot does not allow to change the "ethaddr" variable if it is already set. If you want to change it you need to use the "env default -a" command, which resets all environment variabels to default values and deletes the "ethaddr" variable as well.</i>
</p><p>The board_k2x.c file has the eth_priv_cfg array, which has the default configuration of the both interfaces.
</p>
<pre>eth_priv_t eth_priv_cfg[] = {
        {
                .int_name       = "K2HK_EMAC",
                .rx_flow        = CPSW_PORT_RX_FLOW(0),
                .phy_addr       = 0,
                .slave_port     = 1,
                .sgmii_link_type = SGMII_LINK_MAC_PHY,
        },
        {
                .int_name       = "K2HK_EMAC1",
                .rx_flow        = CPSW_PORT_RX_FLOW(1),
                .phy_addr       = 1,
                .slave_port     = 2,
                .sgmii_link_type = SGMII_LINK_MAC_PHY,
        },
        {
                .int_name       = "K2HK_EMAC2",
                .rx_flow        = CPSW_PORT_RX_FLOW(2),
                .phy_addr       = 2,
                .slave_port     = 3,
                .sgmii_link_type = SGMII_LINK_MAC_MAC_FORCED,
        },
        {
                .int_name       = "K2HK_EMAC3",
                .rx_flow        = CPSW_PORT_RX_FLOW(3),
                .phy_addr       = 3,
                .slave_port     = 4,
                .sgmii_link_type = SGMII_LINK_MAC_MAC_FORCED,
        },
};
</pre>
<p>where
</p>
<ul><li>"phy_addr" is the phy address on mdio bus.</li>
<li>"slave_port" is the port number starting from "1"</li>
<li>"sgmii_link_type" - type of SGMII link.</li></ul>
<p>The emac_def.h defines possible sgmii link types
</p>
<pre>#define SGMII_LINK_MAC_MAC_AUTONEG	0
#define SGMII_LINK_MAC_PHY		1
#define SGMII_LINK_MAC_MAC_FORCED	2
#define SGMII_LINK_MAC_FIBER		3
#define SGMII_LINK_MAC_PHY_FORCED	4
</pre>
<p>By default Ethernet driver assumes that phys are not connected to MDIO bus. Using the has_mdio environment variable you may override this default:
</p>
<pre>setenv has_mdio 1  tells the driver that PHYs are connected to MDIO.
</pre>
<p>If has_mdio=0 or there is no such environment variable the sgmii_link_type for each port is set to SGMII_LINK_MAC_PHY_FORCED. Be aware that the sgmii_link_type for each interface may be overridden by setting the sgmiiN_link_type environment variable. For example:
</p>
<pre>setenv sgmii1_link_type 2 -  sets the SGMII_LINK_MAC_MAC_FORCED link type for port 1.
</pre>
<p>Driver doesn't perform sanity check of the settings. It is your responsibility to set correct values.
</p><p>The K2 SOC has 4 SGMII port and you can add configurations for port2 and port3 to the eth_priv_cfg[]. Though driver supports four ports, as K2K EVM has only 2 ports the port2 and port3 functionality wasnt tested.
</p><p>Network driver supports Multicast tftp. To enable this feature, add following in the respective config.h file (example include/configs/k2hk_evm.h for K2HK)
</p>
<pre>#define CONFIG_MCAST_TFTP
</pre>
<p><br />
</p>
<h5><span class="mw-headline" id="10G_Ethernet_Driver">10G Ethernet Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=49" title="Edit section: 10G Ethernet Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>K2HK and K2E supports 10G ethernet connections through a 3-port (1 host and 2 slaves) 10G ethernet switch.  On K2HK and K2E EVMs, the physical 10G ethernet connection is brought out to a Rear Transition Module-Break Out Card (RTM-BOC).  This implementation <b>supports only the Rev.C RTM-BOC with Dual Retimers</b>.
</p><p>The U-boot implementation of the 10G ethernet driver can be considered as an extension of the 1G ethernet driver framework.  It adds two interfaces to the data structure eth_priv_cfg[] in the corresponding board_k2x.c files:
</p>
<pre>eth_priv_t eth_priv_cfg[] = {
	...
	{
		.int_name       = "K2HK_XMAC0",
		.rx_flow        = 0,
		.slave_port     = 1,
		.sgmii_link_type = XGMII_LINK_MAC_MAC_FORCED,
	},
	{
		.int_name       = "K2HK_XMAC1",
		.rx_flow        = 8,
		.slave_port     = 2,
		.sgmii_link_type = XGMII_LINK_MAC_MAC_FORCED,
	},
};
</pre>
<p>with a new interface sgmii_link_type of XGMII_LINK_MAC_MAC_FORCED.  The interface names are K2HK_XMAC0 and K2HK_XMAC1 on K2HK; and K2E_XMAC0 and K2E_XMAC1 on K2E.
</p><p>From the user perspective, there is no difference in configuring and using the 10G interfaces except that there is no has_mdio or sgmii_link_type setenv settings.  See <a href="#Ethernet_Driver">Ethernet Driver</a> for more configuration details.
</p><p>When U-boot boots up, it will only show the 10G interface names if the proper RTM-BOC is connected to the EVM.  If so, they are the 4th and 5th (0-based) interfaces on K2HK; and 8th and 9th on K2E.  Hence to properly configure the corresponding MAC addresses, eth4addr and eth5addr on K2HK should be used, while they are eth8addr and eth9addr on K2E .
</p><p><br />
</p>
<h5><span class="mw-headline" id="I2C_Driver">I2C Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=50" title="Edit section: I2C Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The keystone_i2c.c driver supports multiple I2C buses. Thus K2 SoC has three buses 0, 1 and 2. Only one bus can be uses at the same time. Use the
</p>
<pre>int i2c_set_bus_num(unsigned int bus)</pre>
<p>function to set desired bus number. You may get the current bus number by calling the
</p>
<pre>unsigned int i2c_get_bus_num(void)</pre>
<p>function.
</p><p>In order to set/get current bus number from u-boot shell use i2c dev command.
</p>
<pre>TCI6638 EVM # i2c dev
Current bus is 0
TCI6638 EVM # i2c dev 1
Setting bus to 1
TCI6638 EVM #
</pre>
<h5><span class="mw-headline" id="NAND_Driver">NAND Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=51" title="Edit section: NAND Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The NAND driver used is davinci_nand.c. For K2L, NAND part is 2G vs other EVMs that has 512M part. The EVM by default create 3 partitions.
</p><p>1. bootloader
2. params (env)
3. ubifs. This has boot volume to hold the images and rootfs to volume to hold the file system
</p><p>UBI boot time is dependent on the ubifs partition size. So on K2L since the size is much bigger, it takes more time because the mount is done on a bigger nand parition. To reduce the boot time customer may resize the partition to a smaller to hold the file system. Additional partitions can be defined to use as data storage or other applications. Same change needs to be reflected in the DTS as well as mtdparts env variable in u-boot.
</p>
<h5><span class="mw-headline" id="SPL">SPL</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=52" title="Edit section: SPL">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>SPL stands for Secondary Program Loader. This is a framework added to unpstream U-Boot in version 2012-10. SPL is supported in U-Boot for keystone II devices. This feature is configured using the config option CONFIG_SPL. It allows creation of a small first stage boot loader (SPL) that can be loaded by ROM Boot loader (RBL) which would then load and run the second stage boot loader (full version of U-Boot) from NOR or NAND. The required config options are added to tci6638_evm.h. User may refer the README text file in the U-Boot root source directory for more details.
</p><p>For keystone II, RBL loads SPL image from offset 0 of the SPI NOR flash in spi boot mode. The first 64K of the SPI NOR flash is flashed with SPL followed by u-boot.img. The initial 64K is padded with zeros.
</p>
<h5><span class="mw-headline" id="Thump_mode">Thump mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=53" title="Edit section: Thump mode">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>U-Boot build uses ARM thump mode. This is configured using CONFIG_SYS_THUMB_BUILD option.
</p>
<h5><span id="Power-On_Self-Test_(POST)"></span><span class="mw-headline" id="Power-On_Self-Test_.28POST.29">Power-On Self-Test (POST)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=54" title="Edit section: Power-On Self-Test (POST)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>POST will perform the following functional tests:
</p>
<ul><li>EEPROM read test</li>
<li>NAND read test</li>
<li>External memory read/write test</li></ul>
<p>By default the POST is enabled. Set "no_post" environment variable to disable it.
</p>
<pre>set no_post 1
</pre>
<p>Note: If needed to disable POST on next reboot, this variable can be saved using saveenv.
</p>
<h5><span class="mw-headline" id="FDT_command">FDT command</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=55" title="Edit section: FDT command">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Using FDT commands, user will be able to tweak the FDT before boot to Linux. An example of this command usage to enable the PSC module and Power domain for SRIO and Hyperlink IP is discussed here. The device tree bindings for the clock node for these IPs (functional blocks) have the status property defined and set to "disabled" by default. If user wants to enabled this so that user space drivers can be used for these IPs, the status property can be updated in the DTB blob through fdt command before boot to Linux. Following env variables can be set in u-boot to achieve this:-
</p>
<pre>setenv modify_fdt 'fdt addr ${addr_fdt}; fdt set /soc/clocks/clkhyperlink0
status "enabled"; fdt set /soc/clocks/clkhyperlink1 status "enabled"; fdt
set /soc/clocks/clksrio status "enabled";'
setenv bootcmd 'run init_${boot} get_fdt_${boot} get_mon_${boot} get_kern_${boot}
modify_fdt run_mon run_kern'
</pre>
<p>User may modify the above based on which IP is to be enabled. In the above example, two hyperlink and one srio IPs are enabled (LPSC module is enabled as well the Power Domain). This command will be useful to fix up DT bindings in the DTB before booting to Linux.
</p>
<h5><span class="mw-headline" id="Reserve_DDR_memory">Reserve DDR memory</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=56" title="Edit section: Reserve DDR memory">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>U-Boot has mem_reserve env variable to reserve DDR3 memory at the end of the 32 bit address space. This will be useful for reserving memory for DSP. Based on the memory
availability on the board, the address range of this region will change. So any users of this feature need to make sure the address match with what is reserved through
this mechanism. Otherwise the user application can step into kernel memory space and
cause kernel crash during system operation. By default 512M memory is reserved at the end of the address space. To change the default size, user need to update this env variable and save the configuration using saveenv command.
</p>
<h4><span class="mw-headline" id="Boot_Monitor_2">Boot Monitor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=57" title="Edit section: Boot Monitor">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Boot Monitor software provides secure privilege level execution service for Linux kernel code through SMC calls. ARM cortex A15 requires certain functions to be executed in the PL1 privilege level. Boot monitor code provides this service. A high level architecture of the boot moinitor software is shown below
</p><p><a href="File_Boot-kernel-arch.html" class="image"><img alt="Boot-kernel-arch.jpg" src="https://processors.wiki.ti.com/images/7/79/Boot-kernel-arch.jpg" width="356" height="424" /></a>
</p><p>Boot monitor code is built as a standalone image and is loaded into MSMC SRAM at 0xc5f0000 and occupies top 64K of the memory. The image has to be loaded to the at the above address either through CCS or through tftp or other means. It gets initialized through the u-boot command install_skern. The command takes the load address above as the argument.
</p>
<h5><span class="mw-headline" id="Boot_sequence_of_primary_core">Boot sequence of primary core</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=58" title="Edit section: Boot sequence of primary core">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>In the primary ARM core, ROM boot loader (RBL) code is run on Power on reset. After completing its task, RBL load and run u-boot code in the non secure mode. Boot monitor gets install through the command mon_install(). As part of this following will happen
</p>
<dl><dd><dl><dd><dl><dd><ul><li>boot monitor primary core entry point is entered via the branch address 0xc5f0000</li>
<li>As part of non secure entry, boot monitor calls the RBL API (smc #0) through SMC call passing the _skern_init() as the argument. This function get called as part of the RBL code</li>
<li>_skern_init() assembly function copies the RBL stack to its own stack. It initialize the monitor vector and SP to point to its own values. It then calls skern_init() C function to initialize to do Core or CPU specific initialization. r0 points to where it enters from primary core or secondary core, r1 points to the Tetris PSC base address and r2 points to the ARM Arch timer clock rate. RBL enters this code in monitor mode. skern_init() does the following:-</li>
<li>Initialize the arch timer CNTFREQ</li>
<li>Set the secondary core non secure entry point address in the ARM magic address for each core</li>
<li>Configure GIC controller to route IPC interrupts</li></ul></dd></dl></dd></dl></dd></dl>
<p>Finally the control returns to RBL and back to non secure primary core boot monitor entry code.
</p>
<dl><dd><dl><dd><dl><dd><ul><li>On the primary core, booting of Linux kernel happens as usual through the bootm command.</li>
<li>At Linux start up, primary core make smc call to power on each of the secondary core. smc call is issued with r0 pointing to the command (0 - power ON). r1 points to the CPU number and r2 to secondary core kernel entry point address. Primary core wait for secondary cores to boot up and then proceeds to rest of booting sequence.</li></ul></dd></dl></dd></dl></dd></dl>
<h5><span class="mw-headline" id="Boot_sequence_of_secondary_cores">Boot sequence of secondary cores</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=59" title="Edit section: Boot sequence of secondary cores">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>At the secondary core, following squence happens
</p>
<dl><dd><dl><dd><dl><dd><ul><li>On power ON reset, RBL initializes. It then enters the secondary entry point address of the boot monitor core. The init code calls smc #0 to invoke _skern_init() as a privilege function and in turn sets its own stack, vectors and smc service functions. _skern_init() calls skern_init() C function to initialize per CPU variables. It initialize the arch timer CNTFREQ to desired value.</li>
<li>On return from _skern_init(), it jumps to the secondary kernel entry point address and start booting secondary instance of Linux kernel.</li></ul></dd></dl></dd></dl></dd></dl>
<h4><span class="mw-headline" id="LPAE">LPAE</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=60" title="Edit section: LPAE">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The DDR3A memory address space is 0x800000000-0x9FFFFFFFF. That range is outside the first 4GB of address space. Even if Cortex-A15 supports Large Physical Address Extension (LPAE), which allows 40 bits address bus, and may access the DDR3A address space, that is possible only when ARM turns MMU on. Before that ARM has 32-bits effective address bus and can access only first 4GB of address space.
</p><p>In order to give access to the DDR3A when MMU is off, MSMC maps first 2GB of DDR3A to the 0x0080000000-0x00FFFFFFFF address space. That aliased address space of the first 2GB of the DDR3A may be used not only when MMU is off, but when it is on as well. Be aware that Keystone2 doesnt support cache coherency for the aliased address space.
</p><p>The memory property in the tci6638-evm.dts file specifies the memory range available for kernel. The default sets 0x80000000 as start address and 0x20000000 as size. That corresponds to the aliased DDR3A memory range.
</p><p>When u-boot boots the kernel, it can modify the start address of the memory in the DTB. If the <b>mem_lpae</b> environment variable is 0, u-boot doesnt modify the start address. If the <b>mem_lpae=1</b>, u-boot sets the start address to 0x800000000, which corresponds to non-aliased start address of the DDR3A.
</p>
<h5><span class="mw-headline" id="Using_more_than_2GB_of_DDR3A_memory">Using more than 2GB of DDR3A memory</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=61" title="Edit section: Using more than 2GB of DDR3A memory">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>U-boot works without MMU enabled and its address range is limited to the first 4GB. The 2GB of that range is the DDR3A aliased address range. Therefore u-boot without MMU enabled cannot detect more than 2GB of DDR3A size. Kernel works with MMU enabled and when LPAE is enable may use up to 8GB of the DDR3A memory.
</p><p>To pass the memory size information to the kernel u-boot fixes the memory node of the DTB. If the SO-DIMM size is less or equal 2GB u-boot creates memory node with one bank only:
</p>
<pre>memory {
	reg = &lt;0x00000008 0x00000000 0x00000000 0x80000000&gt;;
};
</pre>
<p>U-boot may reserve part of the memory at the beginning or end of the first 2GB. If the "mem_reserve_head" variable is set, u-boot modifies the start address and the size of the memory bank on the mem_reserve_head. For example if the mem_reserve_mem=256M u-boot creates the following memory node:
</p>
<pre>memory {
	reg = &lt;0x00000008 0x10000000 0x00000000 0x70000000&gt;;
};
</pre>
<p>If the mem_reserve variable is set, u-boot reserves the memory at the end of the first bank. For example if the mem_reserve=512M u-boot creates the following memory node:
</p>
<pre>memory {
	reg = &lt;0x00000008 0x00000000 0x00000000 0x60000000&gt;;
};
</pre>
<p>If the board has SO-DIMM bigger than 2GB user has to set the ddr3a_size environment variable. The variable may be set to 4 or 8. If u-boot detects the 2GB of memory (maximum it may detect), it checks the "mem_lpae" and "ddr3a_size" variables. If the mem_lpae=1 and ddr3a_size=4 or 8, u-boot creates the memory node with two banks. The first bank represents first 2GB of memory with possible reserved memory. The second bank represent the remaining memory. That memory starts at the fixed address and size equal "ddr3a_size - 2".
</p><p>For example if mem_lpae=1, mem_reserve=512M and ddr3a_size=8 u-boot creates the following memory node:
</p>
<pre>memory {
        reg = &lt;0x00000008 0x00000000 0x00000000 0x60000000
               0x00000008 0x80000000 0x00000001 0x80000000&gt;;
};
</pre>
<p>It is important that u-boot creates two memory banks. That allows to reserve memory at the first bank (first 2GB of memory). There are SOC masters which have only 32 bit address bus and may access the first 2GB of the DDR3A only.
</p><p>It is possible to reserve memory at the second bank. A customer has to modify the u-boot ft_board_setup() function to do that.
</p>
<h4><span class="mw-headline" id="DDR3_ECC">DDR3 ECC</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=62" title="Edit section: DDR3 ECC">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>DDR3 error detection and correction feature is enabled on K2H/K2K PG 2.0 devices and K2L/K2E devices. The DDR3 controller supports ECC on the data written or read from the SDRAM and is enabled by programming the ECC Control register. 8-bit ECC is calculated over 64-bit data quanta. The ECC is calculated for all accesses that are within the address ranges protected by ECC. 1-bit error is correctable by ECC and 2-bit error is not correctable and will be treated as unrecoverable error by sotware and trigger the reset of the device.
</p>
<h5><span class="mw-headline" id="DDR3_ECC_Handling_in_U-boot">DDR3 ECC Handling in U-boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=63" title="Edit section: DDR3 ECC Handling in U-boot">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>U-boot checks if the DDR3 controller supports ECC RMW or not. If ECC RMW is not supported (in K2H/K2K PG1.x devices), U-boot will disable the ECC by default, otherwise it always enables ECC (in K2H/K2K PG2.0 devices and K2L/K2E devices)
</p><p>During the ECC initialization, U-boot fills the entire memory (up to 8GB) to zeros using an EDMA channel after ECC is enabled. For K2H/K2K/K2L device, U-boot configures the chip level interrupt controller to route the DDR3 ECC error interrupt to ARM interrupt controller. For K2E device, since DDR3 ECC error interrupt is directly routed to ARM interrupt controller, there is no need to configure the chip level interrupt controller.
</p><p>A new DDR3 command is added to simulate the ECC error, the command format is:
</p>
<pre>ddr ecc_err &lt;addr in hex&gt; &lt;bit_err in hex&gt; - generate bit errors in DDR data at &lt;addr&gt;, the command will read a 32-bit data from &lt;addr&gt;, and write (data ^ bit_err) back to &lt;addr&gt;

E.g.:
ddr ecc_err 0x90000000 0x1 (this will genereate a 1-bit error on bit 0 of the data in ddr address 0x9000_0000)
ddr ecc_err 0xa0000000 0x1001 (this will genereate 2-bit error on bit 0 &amp; 3 of the data in ddr address 0xa000_0000)
</pre>
<p>A new environment variable "ecc_test" is also introduced to test ECC. By default, ecc_test = 0, and any detection of 2-bit error will reset the device. If ecc_test = 1, U-boot will bypass the error and continues to boot Linux kernel so that Linux kernel can handle the error in interrupt service.
</p>
<h5><span class="mw-headline" id="DDR3_ECC_Handling_in_Linux_kernel">DDR3 ECC Handling in Linux kernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=64" title="Edit section: DDR3 ECC Handling in Linux kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Linux kernel requests an IRQ handler for DDR3 ECC error interrupt, the handler checks the DDR3 controller interrupt status register, if the error is 2-bit error, Linux kernel will reboot the device. User can also use a user mode command to read the DDR3 ECC registers (e.g. 1-bit error count register, etc.), the DDR3 controller register and interrupt mapping are defined in the sysctrl node of device tree binding:
</p>
<pre>E.g. K2HK SOC device tree:
sysctrl {
	reg = &lt;0x21010000 0x0200&gt;; /* DDR3 controller reg */
	interrupts = &lt;0 24 0xf01    /* L1L2 ECC error interrupt */
		      0 448 0xf01&gt;; /* DDR3 ECC error interrupt */
};
</pre>
<h4><span class="mw-headline" id="Linux_Kernel">Linux Kernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=65" title="Edit section: Linux Kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The Keystone II devices runs SMP Linux and is based on upstream Linux version. The Linux port uses arch/arm/mach-keystone for the machine specific intialization code. Linux is boot up through U-boot on the primary ARM core. Linux depends on the Boot Monitor software that gets installed through U-Boot for SMP boot up. Please refer the Boot Monitor section for more details on Linux boot up sequence.
</p><p>Device Tree bindings are used to define the configuration of the board to use for Linux boot up. This makes it easy for users to define bindings for their custom board so that same image provided in the release may be used to run on their board. Note that any additional peripheral drivers required on the custom board is ther responsobility of the user. User will be able to use the Device Tree bindings to configure the driver. The traditional machine setup code based device initialization support is not available for Keystone devices.
</p>
<h5><span class="mw-headline" id="SoC_Support_2">SoC Support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=66" title="Edit section: SoC Support">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>SoC specifc initialization and setup code is located under arch/arm/mach-keystone folder. Here are the basic init done for Keystone II devices.
</p>
<dl><dd><dl><dd><ul><li>pmc.c - Power Management Run time init code</li>
<li>platsmp.c - Provides smp_operations for SMP Linux operation. This is where code to Power ON secondary cores resides.</li>
<li>keystone.c - DT_MACHINE_START macro for Keystone I and Keystone II devices are defined in this file. This also does clock, arch timers and Device Tree specific initialization. It provides machine specific restart() function for Linux.</li></ul></dd></dl></dd></dl>
<h5><span class="mw-headline" id="GIC_irq_chip_driver">GIC irq chip driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=67" title="Edit section: GIC irq chip driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>gic irqchip driver is re-used for the Keystone II devices. This the parent irq controller. Most of the peripheral driver bindings include phandle for this irq controller. This driver is currently located under arch/arm/common folder and is moved to drivers/irqchip folder in recent upstream kernel releases. Device bindings for the driver can be found in Linux kernel tree under Documentation/arm/gic.txt
</p>
<h5><span class="mw-headline" id="Keystone_IPC_irq_chip_driver">Keystone IPC irq chip driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=68" title="Edit section: Keystone IPC irq chip driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>This is the irq controller driver for receiving IPC interrupts from DSPs. It manages the IPCGRx and IPCARx registers for the Host. It uses GIC irq controller as the parent. The bindings are similar to that for GIC. However it uses "interrupts" property in the bindings to define the parent interrupt line to the GIC interrupt controller. Two cells are used to identify an interrupt line to IPC IRQ chip. Up to 28 interrupt lines (Logical) are terminated on this device and maps to bits of the above IPC registers. One user of this driver is the remote proc user driver that uses these interrupts to receive interrupts from DSPs. The bindings for rproc user driver provides "interrupts" property to identify the specific interrupts terminated on this device.
</p>
<h5><span class="mw-headline" id="SMP">SMP</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=69" title="Edit section: SMP">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<h6><span class="mw-headline" id="Boot_Setup">Boot Setup</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=70" title="Edit section: Boot Setup">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>SMP Linux boot support is implemented in U-Boot, Boot Monitor and Linux. In the U-Boot, a command mon_install() is added to allow initialization of boot monitor. This command is to be included in bootcmd as part of U-Boot environment setup. This command assumes that boot monitor image is loaded in MSMC Memory prior to the invokation of the command. More details on Boot Monitor is provided elsewhere in this document. Linux platform code uses the SMC calls to inoke monitor services provided by boot monitor, for example smc call to Power ON secondary core is one such service.
</p>
<h5><span class="mw-headline" id="Common_Clock_framework">Common Clock framework</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=71" title="Edit section: Common Clock framework">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>In this release, all of the clock hardware nodes in the platform are represented in device tree. Here is the high level view of the clock tree
</p>
<pre> refclkmain (fixed clock)
   - mainpllclk (Main PLL clock)
      - mainmuxclk (Mux clock)
         - chipclk1 (chip fixed factor clocks)
            - clkusb (PSC clocks)
</pre>
<p>Please refer the Device data manual for the description of various clocks available on the SoC. The devices gets the Main PLL input clock from the external source. The refclkmain represents this fixed clock. Main PLL output clock is represented bu mainpllclk node. The output of this clock is fed to the mainmuxclk which can either select refclk directly (bypassing the Main PLL) or the output of the Main PLL to pass to the next stage which are divider clocks. The SYSCLKx are the divider clocks that then gets distributed to various IPs. The PSC clocks represents the LPSC (local power sleep controller) availale for individual IPs.
</p><p>The driver for each of the above clock device is shown below
</p><p>1. fixed clock - example refclkmain
</p>
<pre>  drivers/clk/clk-fixed-rate.c
</pre>
<p>2. Main PLL clock - example mainpllclk
</p>
<pre>  drivers/clk/clk-keystone-pll.c
</pre>
<p>3. (Mux clock) - example mainmuxclk
</p>
<pre>  drivers/clk/clk-mux.c
</pre>
<p>4. fixed factor clocks (example chipclk1)
</p>
<pre>  drivers/clk/clk-fixed-factor.c
</pre>
<p>5. Psc clocks (example - clkusb)
</p>
<pre>  drivers/clk/davinci/clk-davinci-psc.c
</pre>
<p>6. Common clock init code
</p>
<pre>  drivers/clk/davinci/davinci-clock.c
</pre>
<p>More details on common clock framework is part of Linux kernel documentation at Documentation/clk.txt Device clock bindings are documented at Documentation/devicetree/bindings/clock/*
</p><p>The common clock code is enable through the CONFIG_COMMON_CLK KConfig option.
</p><p>There are debugfs entries for each clock node to display the rates, usecounts etc. This replace the old debugfs entry to display the clock information. For example to show the main PLL clock rate, use the following command
</p>
<pre>root@tci6614-evm:~# mount -t debugfs debugfs /debug
root@tci6638-evm:~# cat /sys/kernel/debug/clk/refclk-main/mainpllclk/clk_rate
798720000
</pre>
<h5><span class="mw-headline" id="AEMIF_Driver">AEMIF Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=72" title="Edit section: AEMIF Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>DaVinci AEMIF driver is re-used for Keystone devices. The driver is implemented in drivers/memory/davinci-aemif.c. The binding definitions are given in Documentation/devicetree/bindings/memory/davinci-aemif.txt. This driver allows configuration of the AEMIF bus connected to slave devices such as NAND. The bindings exposes the timing parameters required for the slave device.
</p>
<h5><span class="mw-headline" id="NAND_Driver_2">NAND Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=73" title="Edit section: NAND Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Davinci NAND controller driver is re-used for the Keystone devices. The required bindings are defined under Documentation/devicetree/bindings/mtd/davinci-nand.txt. Driver file is drivers/mtd/nand/davinci_nand.c
</p>
<h5><span class="mw-headline" id="SPI_and_SPI_NOR_Flash_Drivers">SPI and SPI NOR Flash Drivers</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=74" title="Edit section: SPI and SPI NOR Flash Drivers">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>DaVinci SPI controller driver is re-used for keystone devices. Driver is implemented in drivers/spi/spi-davinci.c and the bindings in Documentation/devicetree/bindings/spi/spi-davinci.txt. The SPI NOR flash driver used is m25p80.c under drivers/mtd/devices/m25p80.c. The bindings for this driver is available under Documentation/devicetree/bindings/mtd/st-m25p.txt
</p>
<h5><span class="mw-headline" id="I2C_and_EEPROM_Drivers">I2C and EEPROM Drivers</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=75" title="Edit section: I2C and EEPROM Drivers">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>DaVinci I2C controller driver is re-used for Keystone devices. The driver file is drivers/i2c/chip/i2c-davinci.c and the binding is defined in Documentation/devicetree/bindings/i2c/davinci.txt. EEPROM driver is a i2c client driver and is implemented in drivers/misc/eeprom/at24.c. The binding for this is also part of the davinci i2c driver bindings.
</p>
<h5><span class="mw-headline" id="Keystone_GPIO_Driver">Keystone GPIO Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=76" title="Edit section: Keystone GPIO Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>GPIO driver is implemented in drivers/gpio/gpio-keystone.c. Each instance of the driver support 32 GPIO pins (2 Banks). Currently only 2 banks are tested on keystone devices. The driver also implements gpio irq chip driver that exposes gpio pin as irq pins and maps them to the corresponding irq pins input of GIC. This driver allow user drivers to define the GPIO pins that it uses as bindings and points to the bindings of this device. Also allows user driver to use a GPIO pin as interrupt. The irq chip driver supports upto 32 irq pins. Driver uses the pin as irq or GPIO, not both. Please refer to bindings documenation at Documentation/devicetree/gpio/gpio-keystone.txt for details of usage. Note that user driver can also use the GPIO pins using the GPIO LIB APIs. User needs to choose either defining the GPIOs through bindings or using API, and not both for a specific pin.
</p>
<h5><span class="mw-headline" id="Keystone_IPC_GPIO_Driver">Keystone IPC GPIO Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=77" title="Edit section: Keystone IPC GPIO Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Keystone IPC GPIO driver exposes IRQs to DSPs (using IPCGRx register of each DSP) as GPIO pins. Software users allocates a GPIO pin using GPIO lib API or using a gpio bindings in the driver using phandle to the corresponding gpio ipc device binding. This driver allows defining one instance of the GPIO driver per DSP and allows up to 28 GPIO pins per GPIO instance. The bindings for each instance is defined in the dts file for the platform. The driver is implemented in drivers/gpio/gpio-keystone-ipc.c. Documentation/devicetree/bindings/gpio/gpio.txt has description on how to define bindings in the user driver to use a GPIO pin. The user driver uses GPIO lib API calls to write a value of 1 to the GPIO output pin that will raise IRQ to the DSP.
</p>
<h5><span class="mw-headline" id="Watchdog_Driver">Watchdog Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=78" title="Edit section: Watchdog Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The Watchdog driver is implemented in drivers/watchdog/davinci_wdt.c. For an explanation on the device tree bindings required see Documentation/devicetree/bindings/watchdog/davinci-wdt.txt.
</p><p><br />
</p>
<h5><span class="mw-headline" id="Network_Driver">Network Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=79" title="Edit section: Network Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p><a href="File_Netstack.html" class="image"><img alt="Netstack.png" src="https://processors.wiki.ti.com/images/e/e4/Netstack.png" width="822" height="543" /></a>
</p><p><br />
</p><p><br />
</p>
<ul><li>The NETCP driver code is at <b>/drivers/net/ethernet/ti/keystone_net_core.c</b> in the linux kernel. <br /></li></ul>
<p>Model:
</p><p><br />1) Open:
</p><p>On device open, we request DMA channels using standard dma engine APIs provided by the dmaengine layer. <br />The capabilities of the DMA are appropriately set and the appropriate channels are requested by name. <br />We invoke the dma_request_channel_by_name API to acquire dma engine channels. <br />The netdev open also sets up the streaming switch, SGMII, Serdes, switch and mac sliver. On Open we also configure the packet accelerator module. <br />
</p><p><br />2) Stop:
</p><p>A standard netdev stop operation that stops the netif queue. <br />It sets the receive state to teardown and calls dmaengine_pause APIs from the dmaengine layer to pause both the RX and TX channel. <br />After NAPI is disabled, the operation goes onto release the dma channels by calling the dma_release_channel API. <br />The RX state is set to invalid and the ethernet susbsystem is stopped
</p><p><br />3) Polling
</p><p>A NAPI poll function is implemented, which sets the RX state to poll and resume the dma engine. <br />It will then go onto initialize the queues. We allocate memory for each packet and initialize the scatter list. <br />We iterate in a loop till we run out memory for the descriptors. These dma descriptors are acquired using a dmaengine API called device_prep_slave_sg. <br />We pass appropriate arguments to the API. At this instant we are not concerned about the Software info and PS info associated with each descriptor. <br />netcp_rx_complete is the callback associated with the dma engine on the RX side. <br />The callback function checks for the correct DMA and RX state and warns the user on seeing abnormal behavior. <br />It then goes onto stahs the received packet to the tail of a linked list.
</p><p><br />4) Xmit
</p><p>netcp_ndo_start_xmit is the standard netdev operation that is used to push an outgoing packet. <br />Again we have a structure for each packet. This will contain an array of scatterlists and the number of scatterlist entries which at this point should be 1. <br />We then call the device_prep_slave_sg API with appropriate parameters to acquire a descriptor for the TX operation. <br />'netcp_tx_complete' is the callback fucntion attached to each TX dma callback. <br />All the network statistics are appropriately updated on a successful transfer. The callback then proceeds to free the skb with the dev_kfree_skb_any API.
</p><p><br />5) Receive
</p><p>In the napi_poll netdev operation, we call the netcp_refill_rx function which will allocate skbs and attch these skbs to a descriptor until we run out of descriptor memory. the deliver_stash routine fills the appropriate RX
</p><p><br />
</p>
<h6><span class="mw-headline" id="DMA_Engine">DMA Engine</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=80" title="Edit section: DMA Engine">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The PktDMA interface is an extension of the Linux DMA Engine subsystem. <br />It is worth reviewing the following documentation found in the kernel source tree <br />
</p>
<ul><li>Documentation/dmaengine.txt <br /></li>
<li>Documentation/devicetree/bindings/dma/keystone-pktdma.txt <br /></li></ul>
<p><br /><b>Device Tree Requirements</b> <br />
</p><p>Each PktDMA channel must be defined in the device tree prior to use. <br />The device tree channel description associates the channel with one or more hardware queues that must also be described in the device tree.<br />The PktDMA code generally identifies a device tree description by the channel label string. <br />For example, the Keystone Ethernet driver uses two channels, named nettx and netrx, used for outbound and inbound traffic respectively. <br />Transmit channels must define the submit-queue tag, while receive channels must define the flow tag. <br />
</p><p><br /><b>DMA Channel Configuration</b> <br />
</p><p>First, open a DMA channel by calling dma_request_channel_by_name(), passing in a mask requesting the DMA_SLAVE <br />capability and the desired channel name. <br />The returned pointer is used as a handle for all subsequent operations on the channel.<br />Note that while a NULL pointer indicates an error, there are non-NULL values that also indicate errors; <br />use the IS_ERR_OR_NULL() macro to test the returned value. &lt;The next step is to configure the channel using <br />the dma_keystone_config() function, which takes a dma_keystone_info structure. <br />The fields that must be filled in depend on whether the channel is to be used as a transmit or receive channel. <br />In both cases, all unused fields must be zero.<br />
</p><p>For a transmit channel, set these fields: <br />
</p>
<ul><li>Set the direction field to DMA_MEM_TO_DEV. <br /></li>
<li>Set the tx_queue_depth field to the the number of transmit buffers that can be outstanding at any one time.<br /></li></ul>
<p>Attempting to prepare a buffer or chain of buffers for transmission when there is insufficient depth remaining will result in an error. <br />
</p><p>For a receive channel, set these fields:
</p>
<ul><li>Set the direction field to DMA_DEV_TO_MEM. <br /></li>
<li>Set the scatterlist_size field to the number of entries in the array of scatterlist structures that will be used for reception. If the application does not support scatter/gather, then this will be between 1 and 3. <br /></li>
<li>Set the rxpool_allocator field to be a pointer to a function that the DMA engine will call to replenish the pool of free receive buffers. <br /></li>
<li>Set the rxpool_destructor field to be a pointer to a function that the DMA engine will call to free the pool of free receive buffers during channel shutdown and certain error conditions. <br /></li>
<li>The rxpool_param field is a pointer to a void that is passed to the rxpool allocator and destructor functions to make them easier to write. The PktDMA subsystem makes no other use of this field. <br /></li>
<li>Set the rxpool_thresh_enable field to DMA_THRESH_NONE. In the future the PktDMA interface will support selection of free buffer queue by packet size, but this is not currently supported. <br /></li>
<li>The rxpools array determines how the four free buffer queues are configured. If neither scatter/gather nor size thresholds are being used, fill in only the first entry in the array (rxpools[0]); this is likely to be the normal case. Each entry contains a buffer size and desired pool depth. If using packet size thresholds, the array must be filled in from smallest to largest. <br /></li>
<li>Set the rxpool_count to the number of rxpools array entries being used. <br /></li></ul>
<p>The dma_keystone_config() function will handle the opening and initialization of hardware queues, and allocation of hwqueue descriptors. <br />For transmit channels the number of descriptors is given by the tx_queue_depth field. <br />For receive channels the number of descriptors is the sum of the pool_depth fields in the rxpools array. <br />
</p><p><br /><b>Notification and Completion Handlers</b><br />
</p><p>When an outgoing packet has been transmitted, the hardware will place the descriptor on a completion queue. <br />Similarly, when an incoming packet has been received, the hardware places the descriptor on a receive queue. <br />In either case, an interrupt may be generated.<br />The driver can register to be notified of the interrupt by establishing a notification handler using the dma_set_notify() function. <br />Note that the notification handler is called from within the hardware interrupt service routine, <br />and thus runs in hard interrupt context with the IRQ disabled.<br />Only a minimum of processing should be done in this context; typically disabling further interrupts <br />on the channel using the dmaengine_pause() function, and scheduling deferred work in a tasklet or work queue. <br />
</p><p>When the deferred work function is invoked, it should invoke the dma_poll() function. <br />This will cause the PktDMA subsystem to pop packet descriptors from the completion queue and invoke the associated completion functions. <br />This process continues until the completion queue is empty or the budget of descriptors has been exhausted. <br />The return value from dma_poll() is the number of packets processed. <br />
</p><p>The hwqueue subsystem configures the queues with interrupts enabled. <br />If a notification handler is not established for a channel and interrupts remain enabled, <br />the packet completion functions will be called from hard interrupt context. <br />This is generally not desirable. It is recommended that either a notification function and a deferred work mechanism be established, <br />or the completion interrupt should be disabled and the dma_poll() function called periodically. <br />
</p><p><br />
</p><p><b>Packet Transmission Initiation</b><br />
</p><p>To transmit a packet, initialize an array of scatterlist structures. If the packet descriptor is to contain an Extended Packet Information Block, <br />this should be described by the first entry in the scatterlist array. If the descriptor is to contain a Protocol Specific data block, this should be described next. <br />These areas a copied into the descriptor from system virtual address space by the CPU and are not subject to DMA requirements. <br />The remaining entries in the scatterlist array describe the data buffer. <br />A data buffer for transmission must reside in an area of memory that is (1) in an address space accessible to the PktDMA hardware, and (2) will not be <br />modified or reallocated until the operation has completed. If the entire data area is not physically contiguous, <br />each physically contiguous section must be described by a separate scatterlist array entry  a so-called gather operation. <br />Once the scatterlist array is complete, the data buffer segments must be mapped for the DMA_TO_DEVICE transfer. <br />If it is known that there will be only one data segment this done using the dma_map_single() function, or dma_map_sg() function if there may be multiple segments. <br />Do not access the buffer after it has been mapped; this transfers ownership of the buffer to the PktDMA device and doing so will result in unpredictable behavior. <br />Do not map the EPIB or PSINFO segments. <br />After mapping the data buffer segments, pass the scatterlist array to the dmaengine_prep_slave_sg() function, <br />the number of scatterlist array entries used, and flags indicating whether scatterlist array includes EPIB or PSINFO segments. <br />If there are no problems, this function returns the address of a dma_async_tx_descriptor structure. <br />Each packet should be associated with a completion routine that will be called by the PktDMA subsystem after the packet has been accepted. <br />To do this, fill in the callback field of the dma_async_tx_descriptor structure with the address of the completion routine. <br />To make coding easier, the content of the callback_param field of this structure (a void pointer) is passed to the completion routine as a parameter. <br />The packet is now ready for transmission. Call dmaengine_submit(), passing the address of the dma_async_tx_descriptor. <br />The return value is a cookie that will be used later to check the completion status of the packet. <br />
</p><p><br />
</p><p><b>Packet Transmission Completion</b><br />
</p><p>The packet completion routine for transmission is relatively simple. <br />The completion status should be checked by calling the dma_async_is_tx_complete() function.<br />Unfortunately, this routine requires the cookie returned by dmaengine_submit(), which makes for a possible race condition. <br />The data buffers, which were mapped for DMA earlier, must be unmapped using the dma_unmap_sg() function or equivalent. <br />
</p><p><br /><b>Receive Free Queue Management</b><br />
</p><p>Before the PktDMA hardware can transfer a received packet to the host, the receive free queue or queues must be populated. <br />The desired buffer sizes and depths of these queues is established when the channel is configured. <br />To populate the queue, call the dma_rxfree_refill() function. <br />This will call the rxpool_allocator function repeatedly until the pool reaches its configured depth, or until the allocator function returns a NULL pointer. <br />This is done for each configured queue. <br />
</p><p>The first is the value of rxpool_param set during configuration. <br />The second is the free queue number, an integer value between 0 and 3, indicating which free queue is being populated. <br />The third is the size of the buffer to be allocated, as passed in the rxpools array. <br />The buffer size is not used by the PktDMA code, and is provided only for the convenience of the allocator and destructor functions. <br />
</p><p>The rxpool_allocator function must return the address of a dma_async_tx_descriptor structure (or NULL). <br />The sequence for this is very similar to transmission, with these exceptions: <br />
</p>
<ul><li>Only single buffers may be returned, no multi-buffer chains.</li>
<li>The scatterlist arrays used for preparing buffers that may be used as the first buffer in a packet (typically queue number 0) must be discrete and persistent until the buffer is returned in a completion queue or passed to the rxpool_destructor function.</li>
<li>The scatterlist arrays used for preparing buffers that may be used as the first buffer in a packet must contain at least the number of elements specified in the scatterlist_size configuration field.</li>
<li>If the DMA_HAS_EPIB or DMA_HAS_PSINFO flag bits are set, the first one or two entries in the scatterlist array must be filled in with info about these buffers. The buffers themselves must be writable and persistently allocated, as they will be written to before the completion function is called.</li>
<li>Bits 27:24 of the flags argument to dmaengine_prep_slave_sg() function must contain the queue number passed in as parameter 2.</li></ul>
<p>The receive code must call dma_rxfree_refill() to replenish the free buffer pools as needed. <br />This probably is best done at the end of the deferred work routine that also calls dma_poll(), but this depends on the circumstances. <br />When a receive channel is closed, and in certain exception situations, the rxpool_destructor function will be called to release the buffer. <br />This function is not called when a packet is returned through a completion queue. <br />The rxpool_destructor must unmap the buffer using dma_unmap_single(), dma_unmap_sg(), or similar functions. The buffer should then be freed. <br />
</p><p><br /><b>Packet Reception Completion</b><br />
</p><p>When the PktDMA hardware has assembled a packet it places the address of the packet descriptor for the first buffer in the completion queue. <br />This may trigger an interrupt, causing the notification routine to be called, which may schedule deferred work. <br />The deferred work routine or other mechanism must then call the dma_poll() function, which will dequeue packet descriptors<br />from the completion queue and invoke the per-packet completion functions. <br />Note that in the case of a packet formed from a chain of buffers, only the completion routine for the first buffer in the chain will be invoked. <br />
</p><p>The per-packet completion function is passed a parameter whose value was set when the packet was allocated. <br />This value is not used by the PktDMA subsystem; however, it is the only mechanism for the completion function to find the received packet. <br />The Ethernet driver passes the address of a per-packet data structure that contains the scatterlist array, the cookie, and other critical data. <br />
</p><p>The completion function must perform several operations: <br />
</p>
<ul><li>Check the completion status of the packet using dma_async_is_tx_complete(). <br /></li>
<li>Process the content of the EPIB and/or PSinfo sections. <br /></li>
<li>Unmap the buffer or chain of buffers. If a chain of buffers has been returned, the scatterlist array for the first buffer in the chain will be populated with the addresses and sizes of all the buffers in the chain.<br /></li>
<li>Free the buffer or buffers, or pass them to another subsystem that will. <br /></li></ul>
<p><b>DMA Channel Teardown</b><br />
</p><p>To tear down a PktDMA channel, bring the channel to a quiescent state, then call the dma_release_channel() function. <br />Any packets queued for transmission in a TX queue will be flushed by passing them to the completion routine with an error status. <br />Buffers queued to the RX free buffer pools will be passed to the rxpool_destructor function for disposal. <br />
</p><p><br />
</p><p><br />
</p>
<h6><span class="mw-headline" id="Packet_Accelerator">Packet Accelerator</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=81" title="Edit section: Packet Accelerator">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<ul><li>The Packet Accelerator driver is at <b>drivers/net/ethernet/ti/keystone_pa.c</b>.
<ul><li>The Packet Accelerator has 6 PDSPs.</li>
<li>The packet classifier image 1 is downloaded to PDSP0, PDSP1 and PDSP2.</li>
<li>The packet classifier image 2 is downloaded to PDSP3.</li>
<li>The packet modifier image is downloaded to PDSP4 and PDSP5.</li></ul></li></ul>
<p><br /><br />
</p>
<h6><span class="mw-headline" id="PA_Timestamping">PA Timestamping</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=82" title="Edit section: PA Timestamping">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<ul><li>PA timestamping has been implemented in the network driver.</li></ul>
<ul><li>All Receive packets will be timestamped and this timestamped by PDSP0 and this timestamp will be available in the timestamp field of the descriptor itself.</li></ul>
<ul><li>To obtain the TX timestamp, we call a PA API to format the TX packet. Essentially what we do is to add a set of params to the "PSDATA" section of the descriptor. This packet is then sent to PDSP5. Internally this will route the packet to the switch. The TX timestamp is obtained in a return packet and we have designed the network driver in such a way to obtain both ethernet RX packet and the TX timestamp packet on the same queue and flow.</li></ul>
<ul><li>The way we differentiate between an Ethernet RX packet and a TX timestmap packet is based on the "Software info 0" field of the descriptor.</li></ul>
<ul><li>To obtain the timestamps itself, we use generic kernel APIs and features.</li></ul>
<ul><li>Appropriate documentation for this can be found at <a rel="nofollow" class="external text" href="http://www.mjmwired.net/kernel/Documentation/networking/timestamping.txt">Timestamping Documentation</a></li></ul>
<ul><li>The timestamping was tested with open source timestamping test code found at <a rel="nofollow" class="external text" href="http://git.kernel.org/?p=linux/kernel/git/stable/linux-stable.git;a=tree;f=Documentation/networking/timestamping;h=9756a1d6b7fa1945c452e52b14c13cd0ca575090;hb=805a6af8dba5dfdd35ec35dc52ec0122400b2610">Timestamping Test Code</a></li></ul>
<pre> ./timestamping eth0 SOF_TIMESTAMPING_TX_HARDWARE SOF_TIMESTAMPING_SYS_HARDWARE SOF_TIMESTAMPING_RAW_HARDWARE
</pre>
<ul><li>Please refer to <a rel="nofollow" class="external text" href="http://processors.wiki.ti.com/images/c/cb/Testing_timestamp_using_timestamping_app.pdf">this</a> document for testing PA timestamps in MCSDK3.0</li></ul>
<p><br />
</p>
<h6><span class="mw-headline" id="Mark_mcast_match_Special_Packet_Processing_Feature">Mark_mcast_match Special Packet Processing Feature</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=83" title="Edit section: Mark mcast match Special Packet Processing Feature">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>This feature provide for special packet egress processing for specific marked packets.
The intended use is:
</p>
<pre> 1) SOC Configured in multiple-interface mode
 2) CPSW ALE re-enabled via /sys/class/net/eth0/device/ale_control (so that SOC switch is
    active behind the scenes)
 3) NetCP interfaces slaved to a bridge
 4) NetCP interfaces feed a common QoS tree
 5) Bridge forwarding disabled via "ebtables -P FORWARD DROP" (because CPSW is
    doing the port to port forwarding)
</pre>
<p>In this rather odd situation, the bridge will transmit locally generated multicast (and
broadcast) packets by sending one on each of the slaved interfaces (i.e. bridge flooding).
This has two ramifications:
</p>
<pre>  (a) This results in multiple packets (copies of these locally generated
      muliticasts) through a common QoS, which is considered "bad"
      because the common QOS tree is configured assuming only one copy.
  (b) even if QOS is not present, sending multiple copies of these multicasts is
      sub-optimal since the CPSW switch is capable of doing the forwarding itself given
      just one copy of the original packet.
</pre>
<p>To avoid these ramifications, such local multicast packets can be marked via ebtables for special
processing in the NetCP PA module before the packets are queued for
transmission. Packets thus recognized are NOT marked for egress via a
specific slave port, and thus will be transmitted through all slave ports
by the CPSW h/w forwarding logic.
</p><p>To do this, a new DTS parameter "mark_mcast_match" has been added. This
parameter takes two u32 values: a "match" value and a "mask" value.
</p><p>When the NetCP PA module encounters a packet with a non-zero skb-&gt;mark
field, it bitwise-ANDs the skb-&gt;mark value with the "mask" value and
then compares the result with the "match" value. If these do not match,
the mark is ignored and the packet is processed normally.
</p><p>However, if the "match" value matches, then the low-order 8 bits of the
skb-&gt;mark field is used as a bitmask to determine whether the packet
should be dropped. If the packet would normally have been directed to
slave port 1, then bit 0 of skb-&gt;mark is checked; slave port 2 checks
bit 1, etc. If the bit is set, then the packet is enqueued for ALE
processing but <i>with the CPSW engress port field in the descriptor set to 0</i>
(indicating that CPSW is responsible for selecting the egress port(s) to forward the
packet too)&#160;; if the bit is NOT set, the packet is silently dropped.
</p><p>An example...
</p><p>The device tree contains this PA definition:
</p><p>mark_mcast_match = &lt;0x12345a00 0xffffff00&gt;;
</p><p>The runtime configuration scripts execute this command:
</p><p>ebtables -A OUTPUT -d Multicast -j mark \
--mark-set 0x12345a01 --mark-target ACCEPT
</p><p>When the bridge attempts to send an ARP (broadcast) packet, it will send
one packet to each of the slave interfaces. The packet sent by the bridge
to slave interface eth0 (CPSW slave port 1) will be passed to the CPSW,
and the ALE will broadcast this packet on all slave ports. The packets
sent by the bridge to other slave interfaces (eth1, CPSW slave port 2)
will be silently dropped.
</p><p><br />
</p>
<h6><span class="mw-headline" id="SGMII">SGMII</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=84" title="Edit section: SGMII">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<ul><li>The SGMII driver code is at <b>drivers/net/ethernet/ti/keystone_sgmii.c</b>. <br /></li></ul>
<p>The SGMII module on Keystone 2 devices can be configured to operate in various modes. <br />The modes are as follows <br />
</p>
<ul><li>mac mac autonegotiate <br /></li>
<li>mac phy <br /></li>
<li>mac mac forced <br /></li>
<li>mac fiber <br /></li></ul>
<p>The mode of operation can be decided through the device tree bindings. An example is shown below <br />
</p><p><a href="File_Sgmii.html" class="image"><img alt="Sgmii.png" src="https://processors.wiki.ti.com/images/b/b0/Sgmii.png" width="400" height="196" /></a>
</p><p><br />AS we can see in the above diagrarm, the <b>link-interface</b> attribute must be appropriately changed to decide the mode of operation.
</p>
<ul><li>For mac mac auto negotiate use 0 <br /></li>
<li>For mac phy use 1 <br /></li>
<li>For mac mac forced use 2 <br /></li>
<li>For mac fiber use 3<br /></li></ul>
<p><br />
</p><p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  66AK2E supports 8 Ethernet (SGMII) ports, 2 ports to the EVM PHYs, 2 ports to AMC connector, and 4 ports to RTM connector. When using Mistral RTM BoC for those 4 PHYs on it, the SGMII ports are connected in reverse order. Instead of SGMII4 connected to PHY0 on the RTM BoC, it is connected to PHY3. Therefore, the device tree for the Mistral RTM BoC looks like:
</p>
<dl><dd>mdio: mdio@24200f00 {
<dl><dd>phy4: phy@4 {
<dl><dd>compatible = "marvell,88e1145";</dd>
<dd>reg = &lt;4&gt;;</dd></dl></dd>
<dd>};</dd>
<dd>phy5: phy@5 {
<dl><dd>compatible = "marvell,88e1145";</dd>
<dd>reg = &lt;5&gt;;</dd></dl></dd>
<dd>};</dd>
<dd>phy6: phy@6 {
<dl><dd>compatible = "marvell,88e1145";</dd>
<dd>reg = &lt;6&gt;;</dd></dl></dd>
<dd>};</dd>
<dd>phy7: phy@7 {
<dl><dd>compatible = "marvell,88e1145";</dd>
<dd>reg = &lt;7&gt;;</dd></dl></dd>
<dd>};</dd></dl></dd>
<dd>};</dd></dl>
<dl><dd>netcp {
<dl><dd>cpsw: cpsw@24200000 {
<dl><dd>slaves {
<dl><dd>slave4 {
<dl><dd>label           = "slave4";</dd>
<dd>link-interface  = &lt;1&gt;;</dd>
<dd>phy-handle      = &lt;&amp;phy7&gt;;</dd></dl></dd>
<dd>};</dd>
<dd>slave5 {
<dl><dd>label           = "slave5";</dd>
<dd>link-interface  = &lt;1&gt;;</dd>
<dd>phy-handle      = &lt;&amp;phy6&gt;;</dd></dl></dd>
<dd>};</dd>
<dd>slave6 {
<dl><dd>label           = "slave6";</dd>
<dd>link-interface  = &lt;1&gt;;</dd>
<dd>phy-handle      = &lt;&amp;phy5&gt;;</dd></dl></dd>
<dd>};</dd>
<dd>slave7 {
<dl><dd>label           = "slave7";</dd>
<dd>link-interface  = &lt;1&gt;;</dd>
<dd>phy-handle      = &lt;&amp;phy4&gt;;</dd></dl></dd>
<dd>};</dd></dl></dd>
<dd>};</dd></dl></dd>
<dd>};</dd></dl></dd>
<dd>};</dd></dl>
<h6><span class="mw-headline" id="Setting_up_an_NFS_filesystem">Setting up an NFS filesystem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=85" title="Edit section: Setting up an NFS filesystem">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>An NFS filesystem can be setup during development.
</p><p>To setup an NFS filesystem, first obtain a tarball of the filesystem. This should be untarred on the linux host machine. <br />This section will explain how to setup an NFS server on a Ubuntu linux host. <br />
</p>
<ul><li>Untar the filesystem that is made as part of the release into location <b>/opt/filesys</b></li></ul>
<ul><li>On the linux host open file <b>/etc/exports</b> and add the following line</li></ul>
<pre> <b>/opt/filesys *(rw,subtree_check,no_root_squash,no_all_squash,sync)</b>
</pre>
<p><br />
</p>
<ul><li>Please note that the location of the fielsystem on the host should be the same as that in /etc/exports</li></ul>
<ul><li>Next we have to start the nfs server and this is achieved by giving the following command</li></ul>
<pre> /etc/init.d/nfs-kernel-server restart
</pre>
<p><br />
</p>
<h6><span class="mw-headline" id="Modifying_the_command_line_for_NFS_filesystem_boot">Modifying the command line for NFS filesystem boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=86" title="Edit section: Modifying the command line for NFS filesystem boot">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The kernel command line should be appropriately modified to enable kernel boot up with an NFS filesystem
</p><p>Add the following to the kernel command line <b>root=/dev/nfs nfsroot=192.168.1.140:/opt/filesys,v3,tcp rw ip=dhcp</b>
</p><p><i>To use eth1 set <b>ip=dhcp:eth1</b></i>
</p><p>During kernel boot up, in the boot up log we should be able to see the following
</p><p>Kernel command line: earlyprintk debug console=ttyS0,115200n8 ip=dhcp mem=512M rootwait=1 rootfstype=nfs root=/dev/nfs rw nfsroot=192.168.1.140:/opt/filesys,v3,tcp
</p>
<h6><span class="mw-headline" id="Modifying_CPSW_Configurations_Through_Sysfs_User_Interface">Modifying CPSW Configurations Through Sysfs User Interface</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=87" title="Edit section: Modifying CPSW Configurations Through Sysfs User Interface">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Through sysfs, an user can show or modify some ALE control, ALE table and CPSW control configurations from user space by using the commands described in the following sub-sections.
</p><p>1. Showing ALE Table
</p>
<ul><li>Command to show the table entries.</li></ul>
<pre>   $ cat /sys/devices/soc.0/2090000.netcp/ale_table
</pre>
<ul><li>One execution of the command may show only part of the table. Consecutive executions of the command will show the remaining parts of the table (see example below).</li></ul>
<ul><li>The '+' sign at the end of the show indicates that there are entries in the remaining table not shown in the current execution of the command (see example below).</li></ul>
<p>2. Showing RAW ALE Table
</p>
<ul><li>Command to show the raw table entries.</li></ul>
<pre>   $ cat /sys/devices/soc.0/2090000.netcp/ale_table_raw
</pre>
<ul><li>Command to set the start-showing-index to n.</li></ul>
<pre>   $ echo n &gt; /sys/devices/soc.0/2090000.netcp/ale_table_raw
</pre>
<ul><li>Only raw entries (without interpretation) will be shown.</li>
<li>Depending on the number of occupied entries, it is more likely to show the whole table with one execution of the raw table show command. If not, consecutive executions of the command will show the remaining parts of the table.</li>
<li>The '+' sign at the end of the show indicates that there are entries in the remaining table not shown in the current execution of the command (see example below).</li></ul>
<p>3. Showing ALE Controls
</p>
<ul><li>Command to show the ale controls.</li></ul>
<pre>   $ cat /sys/devices/soc.0/2090000.netcp/ale_control
</pre>
<p>4. Showing CPSW Controls
</p>
<ul><li>Command to show various CPSW controls</li></ul>
<pre>   $ cat /sys/devices/soc.0/2090000.netcp/cpsw/file_name
</pre>
<p>where file_name is a file under the directory /sys/devices/soc.0/2090000.netcp/cpsw.
</p>
<ul><li>Files or directories under the cpsw directory are</li></ul>
<dl><dd><dl><dd><ul><li>control</li>
<li>flow_control</li>
<li>port_tx_pri_map/</li>
<li>port_vlan/</li>
<li>priority_type</li>
<li>version</li></ul></dd></dl></dd></dl>
<ul><li>For example, to see the CPSW version, use the command</li></ul>
<pre>   $ cat /sys/devices/soc.0/2090000.netcp/cpsw/version
</pre>
<p>5. Adding/Deleting ALE Table Entries
</p>
<ul><li>In general, the ALE Table add command is of the form</li></ul>
<pre>   $ echo "add_command_format" &gt; /sys/devices/soc.0/2090000.netcp/ale_table
</pre>
<p>or
</p>
<pre>   $ echo "add_command_format" &gt; /sys/devices/soc.0/2090000.netcp/ale_table_raw
</pre>
<ul><li>The delete command is of the form</li></ul>
<pre>   $ echo "n:" &gt; /sys/devices/soc.0/2090000.netcp/ale_table
</pre>
<p>or
</p>
<pre>   $ echo "n:" &gt; /sys/devices/soc.0/2090000.netcp/ale_table_raw
</pre>
<p>where n is the index of the table entry to be deleted.
</p>
<ul><li>Command Formats</li></ul>
<dl><dd><ul><li>Adding VLAN command format</li></ul></dd></dl>
<pre>  v.vid=(int).force_untag_egress=(hex 3b).reg_fld_mask=(hex 3b).unreg_fld_mask=(hex 3b).mem_list=(hex 3b)
</pre>
<dl><dd><ul><li>Adding OUI Address command format</li></ul></dd></dl>
<pre>  o.addr=(aa:bb:cc)
</pre>
<dl><dd><ul><li>Adding Unicast Address command format</li></ul></dd></dl>
<pre>  u.port=(int).block=(1|0).secure=(1|0).ageable=(1|0).addr=(aa:bb:cc:dd:ee:ff)
</pre>
<dl><dd><ul><li>Adding Multicast Address command format</li></ul></dd></dl>
<pre>  m.port_mask=(hex 3b).supervisory=(1|0).mc_fw_st=(int 0|1|2|3).addr=(aa:bb:cc:dd:ee:ff)
</pre>
<dl><dd><ul><li>Adding VLAN Unicast Address command format</li></ul></dd></dl>
<pre>  vu.port=(int).block=(1|0).secure=(1|0).ageable=(1|0).addr=(aa:bb:cc:dd:ee:ff).vid=(int)
</pre>
<dl><dd><ul><li>Adding VLAN Multicast Address command format</li></ul></dd></dl>
<pre>  vm.port_mask=(hex 3b).supervisory=(1|0).mc_fw_st=(int 0|1|2|3).addr=(aa:bb:cc:dd:ee:ff).vid=(int)
</pre>
<dl><dd><ul><li>Deleting ALE Table Entry</li></ul></dd></dl>
<pre>  entry_index:
</pre>
<dl><dd><ul><li>Remark: any field that is not specified defaults to 0, except vid which defaults to -1 (i.e. no vid).</li></ul></dd></dl>
<ul><li>Examples</li></ul>
<dl><dd><ul><li>Add a VLAN with vid=100 reg_fld_mask=0x7 unreg_fld_mask=0x2 mem_list=0x4</li></ul></dd></dl>
<pre>   $ echo "v.vid=100.reg_fld_mask=0x7.unreg_fld_mask=0x2.mem_list=0x4" &gt; /sys/class/net/eth0/device/ale_table
</pre>
<dl><dd><ul><li>Add a persistent unicast address 02:18:31:7E:3E:6F</li></ul></dd></dl>
<pre>   $ echo "u.addr=02:18:31:7E:3E:6F" &gt; /sys/class/net/eth0/device/ale_table
</pre>
<dl><dd><ul><li>Delete the 100-th entry in the table</li></ul></dd></dl>
<pre>   $ echo "100:"  &gt; /sys/class/net/eth0/device/ale_table
</pre>
<p>5. Modifying ALE Controls
</p>
<ul><li>Access to the ALE Controls&#160;is available through&#160; the /sys/class/net/eth0/device/ale_control&#160; pseudo file.&#160; This file contains the following:</li>
<li>&#160; version: the ALE version information</li>
<li> <b>enable</b>: 0 to disable the ALE, 1 to enable ALE (should be 1 for normal operations)</li>
<li> <b>clear</b>: set to 1 to clear the table (refer to [1] for description)</li>
<li> <b>ageout</b>&#160;: set to 1 to force age out of entries (refer to [1] for description])</li>
<li> <b>p0_uni_flood_en</b>&#160;: set to 1 to enable unknown unicasts to be flooded to host port. Set to 0 to not flood such unicasts. Note: if set to 0, CPSW may delay sending packets to the SOC host until it learns what mac addresses the host is using.</li>
<li> <b>vlan_nolearn</b>&#160;: set to 1 to prevent VLAN id from being learned along with source address.</li>
<li> <b>no_port_vlan</b>&#160;: set to 1 to allow processing of packets received with VLAN ID=0; set to 0 to replace received packets with VLAN ID=0 to the VLAN set in the ports default VLAN register.</li>
<li> <b>oui_deny</b>&#160;: 0/1 (refer to [1] for a description of this bit)</li>
<li> <b>bypass</b>: set to 1 to enable ALE bypass. In this mode the CPSW will not act as switch on receive; instead it will forward all received traffic from external ports to the host port. Set to 0 for normal (switched) operations.</li>
<li> <b>rate_limit_tx</b>: set to 1 for rate limiting to apply to transmit direction, set to 0 for receive direction. Refer to [1] for a description of this bit.</li>
<li> <b>vlan_aware</b>: set to 1 to force the ALE into VLAN aware mode</li>
<li> <b>auth_enable</b>: set to 1 to enable table update by host only. Refer to [1] for more details on this feature</li>
<li> <b>rate_limit</b>: set to 1 to enable multicast/broadcast rate limiting feature. Refer to [1] for more details.</li>
<li> <b>port_state.0</b>= set the port 0 (host port) state. State can be:</li>
<li>o 0: disabled</li>
<li>o 1: blocked</li>
<li>o 2: learning</li>
<li>o 3: forwarding</li>
<li> <b>port_state.1</b>: set the port 1 state.</li>
<li> <b>port_state.2</b>: set the port 2 state</li>
<li> <b>drop_untagged.0</b>&#160;: set to 1 to drop untagged packets received on port 0 (host port)</li>
<li> <b>drop_untagged.1</b>&#160;: set to 1 to drop untagged packets received on port 1</li>
<li> <b>drop_untagged.2</b>&#160;: set to 1 to drop untagged packets received on port 2</li>
<li> <b>drop_unknown.0</b>&#160;: set to 1 to drop packets received on port 0 (host port) with unknown VLAN tags. Set to 0 to allows these to be processed</li>
<li> <b>drop_unknown.1</b>&#160;: set to 1 to drop packets received on port 1 with unknown VLAN tags. Set to 0 to allow these to be processed.</li>
<li> <b>drop_unknown.2</b>&#160;: set to 1 to drop packets received on port 2 with unknown VLAN tags. Set to 0 to allow these to be processed.</li>
<li> <b>nolearn.0</b>&#160;: set to 1 to disable address learning for port 0</li>
<li> <b>nolearn.1</b>&#160;: set to 1 to disable address learning for port 1</li>
<li> <b>nolearn.2</b>&#160;: set to 1 to disable address learning for port 2</li>
<li> <b>unknown_vlan_member</b>&#160;: this is the port mask for packets received with unknown VLAN IDs. The port mask is a 5 bit number with a bit representing each port. Bit 0 refers to the host port. A 1 in bit position N means include the port in further forwarding decision. (e.g., port mask = 0x7 means ports 0 (internal), 1 and 2 should be included in the forwarding decision). Refer to [1] for more details.</li>
<li> <b>unknown_mcast_flood</b>=&#160;: this is the port mask for packets received with unkwown VLAN ID and unknown (un-registered) destination multicast address. This port_mask will be used in the multicast flooding decision. unknown multicast flooding.</li>
<li> <b>unknown_reg_flood</b>: this is the port mask for packets received with unknown VLAN ID and registered (known) destination multicast address. It is used in the multicast forwarding decision.</li>
<li> <b>unknown_force_untag_egress</b>: this is a port mask to control if VLAN tags are stripped off on egress or not. Set to 1 to force tags to be stripped by h/w prior to transmission</li>
<li> <b>bcast_limit.0</b>&#160;: threshold for broadcast pacing on port 0 .</li>
<li> <b>bcast_limit.1</b>: threshold for broadcast pacing on port 1.</li>
<li> <b>bcast_limit.2</b>&#160;: threshold for broadcast pacing on port 2 .</li>
<li> <b>mcast_limit.0</b>: threshold for multicast pacing on port 0 .</li>
<li> <b>mcast_limit.1</b>: threshold for multicast pacing on port 1 ..</li>
<li> <b>mcast_limit.2</b>: threshold for multicast pacing on port 2 .</li>
<li>Command format for each modifiable ALE control is the same as what is displayed for that field from showing the ALE table.</li>
<li>For example, to disable ALE learning on port 0, use the command</li></ul>
<pre>   $ echo "nolearn.0=0" &gt; cat /sys/devices/soc.0/2090000.netcp/ale_control
</pre>
<p>6. Modifying CPSW Controls
</p>
<ul><li>Command format for each modifiable CPSW control is the same as what is displayed for that field from showing the CPSW controls.</li>
<li>For example, to enable flow control on port 2, use the command</li></ul>
<pre>   $ echo "port2_flow_control_en=1" &gt; /sys/devices/soc.0/2090000.netcp/cpsw/flow_control
</pre>
<p>7. Resetting CPSW Statistics
</p>
<ul><li>Use the command</li></ul>
<pre>   $ echo 0 &gt; /sys/devices/soc.0/2090000.netcp/cpsw/stats/A
</pre>
<p>or
</p>
<pre>   $ echo 0 &gt; /sys/devices/soc.0/2090000.netcp/cpsw/stats/B
</pre>
<p>to reset statistics module A or B counters.
</p><p>8.&#160; Additional Examples
</p><p><b>To enable CPSW:</b>
</p><p>//enable unknown unicast flood to host, disable bypass, enable VID=0 processing<br /><i>echo p0_uni_flood_en=1 &gt; /sys/class/net/eth0/device/ale_control <br />echo bypass=0 &gt; /sys/class/net/eth0/device/ale_control <br />echo no_port_vlan=1 &gt; /sys/class/net/eth0/device/ale_control <br /></i>
</p><p><b>To disable CPSW:<br /></b>// disable port 0 flood for unknown unicast;<br />//enable bypass mode<br /><i>echo p0_uni_flood_en=0 &gt; /sys/class/net/eth0/device/ale_control <br />echo bypass=1 &gt; /sys/class/net/eth0/device/ale_control <br /></i>
</p><p><br /><b>To set port 1 state to forwarding:<br /></b><i>echo port_state.1=3 &gt; /sys/class/net/eth0/device/ale_control <br /></i>
</p><p><b>To set CPSW to VLAN aware mode</b>:<br /><i>echo vlan_aware=1 &gt; /sys/class/net/eth0/device/cpsw/control <br />echo ale_vlan_aware=1 &gt; /sys/class/net/eth0/device/ale_control <br /></i>(set these to 0 to disable vlan aware mode)
</p><p><br /><b>To set port 1s Ingress VLAN defaults</b>:<br /><i>echo port.1._vlan_id=5 &gt; /sys/class/net/eth0/device/cpsw/port_vlan/1<br />echo port.1._cfi=0 &gt; /sys/class/net/eth0/device/cpsw/port_vlan/1<br />echo port.1._vlan_pri=0 &gt; /sys/class/net/eth0/device/cpsw/port_vlan/1<br /></i>
</p><p><b>To set port 1 to use the above default vlan id on ingress:<br /></b><i>echo port.1.pass_pri_tagged=0 &gt; /sys/class/net/eth0/device/cpsw/control<br /></i>
</p><p><b>To set port 1s Egress VLAN defaults</b>:<br /> For registered VLANs, the egress policy is set in the force_untag_egress field of the ALE entry for that VLAN. This field is a bit map with one bit per port. Port 0 is the host port. For example, to set VLAN #100 to force untagged egress on port 2 only:<br /><i>echo "v.vid=100.force_untag_egress=0x4.reg_fld_mask=0x7.unreg_fld_mask=0x2.mem_list=0x4" &gt; /sys/class/net/eth0/device/ale_table<br /></i> For un-registered VLANs, the egress policy is set in the ALE unknown vlan register, which is accessed via the ale_control pseudo file. The value is a bit map, one bit per port (port 0 is the host port).&#160; for example, set every port to drop unknown VLAN tags on egress<br /><i>echo unknown_force_untag_egress=7 &gt; /sys/class/net/eth0/device/ale_control</i>
</p><p><i><b>To set to Port 1 to Admit tagged (i.e. drop un-tagged)&#160;:<br /></b></i><i>echo drop_untagged.1=1 &gt; /sys/class/net/eth0/device/ale_control</i>
</p><p><i><b>To set to Port 1 to Admit all&#160;:<br /></b>echo drop_untagged.1=0 &gt; /sys/class/net/eth0/device/ale_control</i>
</p><p><i><br /><b>To set to Port 1 to Admit unknown VLAN:<br /></b>echo drop_unknown.1=0 &gt; /sys/class/net/eth0/device/ale_control <br /></i>
</p><p><i><b>To set to Port 1 to Drop unknown VLAN:<br /></b></i><i>echo drop_unknown.1=1 &gt; /sys/class/net/eth0/device/ale_control <br /></i>
</p><p>9. Sample Display
</p>
<pre>root@keystone-evm:~#
root@keystone-evm:~# ls -l /sys/devices/soc.0/2090000.netcp/
-rw-r--r--    1 root     root          4096 Feb 28 20:32 ale_control
-r--r--r--    1 root     root          4096 Feb 28 20:30 ale_table
drwxr-xr-x    2 root     root             0 Feb 28 20:46 cpsw
lrwxrwxrwx    1 root     root             0 Jan  1  1970 driver -&gt; ../../../bus/platform/drivers/keystone-netcp
-r--r--r--    1 root     root          4096 Feb 28 20:46 modalias
drwxr-xr-x    4 root     root             0 Jan  1  1970 net
drwxr-xr-x    2 root     root             0 Feb 28 20:46 power
lrwxrwxrwx    1 root     root             0 Jan  1  1970 subsystem -&gt; ../../../bus/platform
-rw-r--r--    1 root     root          4096 Jan  1  1970 uevent
root@keystone-evm:~#
root@keystone-evm:~#
root@keystone-evm:~# ls -l /sys/devices/soc.0/2090000.netcp/cpsw
-rw-r--r--    1 root     root          4096 Feb 28 20:31 control
-rw-r--r--    1 root     root          4096 Feb 28 20:31 flow_control
drwxr-xr-x    2 root     root             0 Feb 28 20:31 port_tx_pri_map
drwxr-xr-x    2 root     root             0 Feb 28 20:31 port_vlan
-rw-r--r--    1 root     root          4096 Feb 28 20:31 priority_type
drwxr-xr-x    2 root     root             0 Feb 28 20:31 stats
-r--r--r--    1 root     root          4096 Feb 28 20:31 version
root@keystone-evm:~#
root@keystone-evm:~# ls -l /sys/class/net/eth0/device/
-rw-r--r--    1 root     root          4096 Feb 28 20:32 ale_control
-r--r--r--    1 root     root          4096 Feb 28 20:32 ale_table
drwxr-xr-x    2 root     root             0 Feb 28 20:30 cpsw
lrwxrwxrwx    1 root     root             0 Jan  1  1970 driver -&gt; ../../../bus/platform/drivers/keystone-netcp
-r--r--r--    1 root     root          4096 Feb 28 20:32 modalias
drwxr-xr-x    4 root     root             0 Jan  1  1970 net
drwxr-xr-x    2 root     root             0 Feb 28 20:32 power
lrwxrwxrwx    1 root     root             0 Jan  1  1970 subsystem -&gt; ../../../bus/platform
-rw-r--r--    1 root     root          4096 Jan  1  1970 uevent
root@keystone-evm:~#
root@keystone-evm:~# ls -l /sys/class/net/eth0/device/cpsw/
-rw-r--r--    1 root     root          4096 Feb 28 20:31 control
-rw-r--r--    1 root     root          4096 Feb 28 20:31 flow_control
drwxr-xr-x    2 root     root             0 Feb 28 20:31 port_tx_pri_map
drwxr-xr-x    2 root     root             0 Feb 28 20:31 port_vlan
-rw-r--r--    1 root     root          4096 Feb 28 20:31 priority_type
drwxr-xr-x    2 root     root             0 Feb 28 20:31 stats
-r--r--r--    1 root     root          4096 Feb 28 20:31 version
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/version
cpsw version 1.3 (1) SGMII identification value 0x4ed1
root@keystone-evm:~#
root@keystone-evm:~#
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/control
fifo_loopback=0
vlan_aware=1
p0_enable=1
p0_pass_pri_tagged=0
p1_pass_pri_tagged=0
p2_pass_pri_tagged=0
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/flow_control
port0_flow_control_en=1
port1_flow_control_en=0
port2_flow_control_en=0
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/priority_type
escalate_pri_load_val=0
port0_pri_type_escalate=0
port1_pri_type_escalate=0
port2_pri_type_escalate=0
root@keystone-evm:~#
root@keystone-evm:~#
root@keystone-evm:~# ls -l /sys/class/net/eth0/device/cpsw/port_tx_pri_map/
-rw-r--r--    1 root     root          4096 Feb 28 21:06 1
-rw-r--r--    1 root     root          4096 Feb 28 21:06 2
-rw-r--r--    1 root     root          4096 Feb 28 21:06 3
-rw-r--r--    1 root     root          4096 Feb 28 21:06 4
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_tx_pri_map/1
port_tx_pri_0=1
port_tx_pri_1=0
port_tx_pri_2=0
port_tx_pri_3=1
port_tx_pri_4=2
port_tx_pri_5=2
port_tx_pri_6=3
port_tx_pri_7=3
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_tx_pri_map/2
port_tx_pri_0=1
port_tx_pri_1=0
port_tx_pri_2=0
port_tx_pri_3=1
port_tx_pri_4=2
port_tx_pri_5=2
port_tx_pri_6=3
port_tx_pri_7=3
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_tx_pri_map/3
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_tx_pri_map/4
root@keystone-evm:~#
root@keystone-evm:~# ls -l /sys/class/net/eth0/device/cpsw/port_vlan/
-rw-r--r--    1 root     root          4096 Feb 28 20:30 0
-rw-r--r--    1 root     root          4096 Feb 28 20:30 1
-rw-r--r--    1 root     root          4096 Feb 28 20:30 2
-rw-r--r--    1 root     root          4096 Feb 28 20:30 3
-rw-r--r--    1 root     root          4096 Feb 28 20:30 4
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_vlan/0
port_vlan_id=0
port_cfi=0
port_vlan_pri=0
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_vlan/1
port_vlan_id=0
port_cfi=0
port_vlan_pri=0
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_vlan/2
port_vlan_id=0
port_cfi=0
port_vlan_pri=0
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_vlan/3
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/cpsw/port_vlan/4
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/ale_control
version=(ALE_ID=0x0029) Rev 1.3
enable=1
clear=0
ageout=0
p0_uni_flood_en=0
vlan_nolearn=0
no_port_vlan=1
oui_deny=0
bypass=1
rate_limit_tx=0
vlan_aware=1
auth_enable=0
rate_limit=0
port_state.0=3
port_state.1=3
port_state.2=0
drop_untagged.0=0
drop_untagged.1=0
drop_untagged.2=0
drop_unknown.0=0
drop_unknown.1=0
drop_unknown.2=0
nolearn.0=0
nolearn.1=0
nolearn.2=0
unknown_vlan_member=7
unknown_mcast_flood=6
unknown_reg_flood=7
unknown_force_untag_egress=7
bcast_limit.0=0
bcast_limit.1=0
bcast_limit.2=0
mcast_limit.0=0
mcast_limit.1=0
mcast_limit.2=0
root@keystone-evm:~# echo "p0_uni_flood_en=1" &gt;  /sys/class/net/eth0/device/ale_control
root@keystone-evm:~#
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/ale_control | grep p0_uni_flood_en
p0_uni_flood_en=1
root@keystone-evm:~#
root@keystone-evm:~# echo "drop_unknown.1=1" &gt; /sys/class/net/eth0/device/ale_control
root@keystone-evm:~#
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/ale_control | grep drop_unknown
drop_unknown.0=0
drop_unknown.1=1
drop_unknown.2=0
root@keystone-evm:~#
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/ale_table
index 0, raw: 0000001c d000ffff ffffffff, type: addr(1), addr: ff:ff:ff:ff:ff:ff, mcstate: f(3), port mask: 7, no super
index 1, raw: 00000000 10000017 eaf4323a, type: addr(1), addr: 00:17:ea:f4:32:3a, uctype: persistant(0), port: 0
index 2, raw: 0000001c d0003333 00000001, type: addr(1), addr: 33:33:00:00:00:01, mcstate: f(3), port mask: 7, no super
index 3, raw: 0000001c d0000100 5e000001, type: addr(1), addr: 01:00:5e:00:00:01, mcstate: f(3), port mask: 7, no super
index 4, raw: 00000004 f0000001 297495bf, type: vlan+addr(3), addr: 00:01:29:74:95:bf, vlan: 0, uctype: touched(3), port: 1
index 5, raw: 0000001c d0003333 fff4323a, type: addr(1), addr: 33:33:ff:f4:32:3a, mcstate: f(3), port mask: 7, no super
index 6, raw: 00000004 f0000000 0c07acca, type: vlan+addr(3), addr: 00:00:0c:07:ac:ca, vlan: 0, uctype: touched(3), port: 1
index 7, raw: 00000004 7000e8e0 b75db25e, type: vlan+addr(3), addr: e8:e0:b7:5d:b2:5e, vlan: 0, uctype: untouched(1), port: 1
index 9, raw: 00000004 f0005c26 0a69440b, type: vlan+addr(3), addr: 5c:26:0a:69:44:0b, vlan: 0, uctype: touched(3), port: 1
index 11, raw: 00000004 70005c26 0a5b2ea6, type: vlan+addr(3), addr: 5c:26:0a:5b:2e:a6, vlan: 0, uctype: untouched(1), port: 1
index 12, raw: 00000004 f000d4be d93db6b8, type: vlan+addr(3), addr: d4:be:d9:3d:b6:b8, vlan: 0, uctype: touched(3), port: 1
index 13, raw: 00000004 70000014 225b62d9, type: vlan+addr(3), addr: 00:14:22:5b:62:d9, vlan: 0, uctype: untouched(1), port: 1
index 14, raw: 00000004 7000000b 7866c6d3, type: vlan+addr(3), addr: 00:0b:78:66:c6:d3, vlan: 0, uctype: untouched(1), port: 1
index 15, raw: 00000004 f0005c26 0a6952fa, type: vlan+addr(3), addr: 5c:26:0a:69:52:fa, vlan: 0, uctype: touched(3), port: 1
index 16, raw: 00000004 f000b8ac 6f7d1b65, type: vlan+addr(3), addr: b8:ac:6f:7d:1b:65, vlan: 0, uctype: touched(3), port: 1
index 17, raw: 00000004 7000d4be d9a34760, type: vlan+addr(3), addr: d4:be:d9:a3:47:60, vlan: 0, uctype: untouched(1), port: 1
index 18, raw: 00000004 70000007 eb645149, type: vlan+addr(3), addr: 00:07:eb:64:51:49, vlan: 0, uctype: untouched(1), port: 1
index 19, raw: 00000004 f3200000 0c07acd3, type: vlan+addr(3), addr: 00:00:0c:07:ac:d3, vlan: 800, uctype: touched(3), port: 1
index 20, raw: 00000004 7000d067 e5e7330c, type: vlan+addr(3), addr: d0:67:e5:e7:33:0c, vlan: 0, uctype: untouched(1), port: 1
index 22, raw: 00000004 70000026 b9802a50, type: vlan+addr(3), addr: 00:26:b9:80:2a:50, vlan: 0, uctype: untouched(1), port: 1
index 23, raw: 00000004 f000d067 e5e5aa12, type: vlan+addr(3), addr: d0:67:e5:e5:aa:12, vlan: 0, uctype: touched(3), port: 1
index 24, raw: 00000004 f0000011 430619f6, type: vlan+addr(3), addr: 00:11:43:06:19:f6, vlan: 0, uctype: touched(3), port: 1
index 25, raw: 00000004 7000bc30 5bde7ee2, type: vlan+addr(3), addr: bc:30:5b:de:7e:e2, vlan: 0, uctype: untouched(1), port: 1
index 26, raw: 00000004 7000b8ac 6f92c3d3, type: vlan+addr(3), addr: b8:ac:6f:92:c3:d3, vlan: 0, uctype: untouched(1), port: 1
index 28, raw: 00000004 f0000012 01f7d6ff, type: vlan+addr(3), addr: 00:12:01:f7:d6:ff, vlan: 0, uctype: touched(3), port: 1
index 29, raw: 00000004 f000000b db7789a5, type: vlan+addr(3), addr: 00:0b:db:77:89:a5, vlan: 0, uctype: touched(3), port: 1
index 31, raw: 00000004 70000018 8b2d9433, type: vlan+addr(3), addr: 00:18:8b:2d:94:33, vlan: 0, uctype: untouched(1), port: 1
index 32, raw: 00000004 70000013 728a0dc0, type: vlan+addr(3), addr: 00:13:72:8a:0d:c0, vlan: 0, uctype: untouched(1), port: 1
index 33, raw: 00000004 700000c0 b76f6e82, type: vlan+addr(3), addr: 00:c0:b7:6f:6e:82, vlan: 0, uctype: untouched(1), port: 1
index 34, raw: 00000004 700014da e9096f9a, type: vlan+addr(3), addr: 14:da:e9:09:6f:9a, vlan: 0, uctype: untouched(1), port: 1
index 35, raw: 00000004 f0000023 24086746, type: vlan+addr(3), addr: 00:23:24:08:67:46, vlan: 0, uctype: touched(3), port: 1
index 36, raw: 00000004 7000001b 11b4362f, type: vlan+addr(3), addr: 00:1b:11:b4:36:2f, vlan: 0, uctype: untouched(1), port: 1
[0..36]: 32 entries, +
root@keystone-evm:~# cat /sys/class/net/eth0/device/ale_table
index 37, raw: 00000004 70000019 b9382f7e, type: vlan+addr(3), addr: 00:19:b9:38:2f:7e, vlan: 0, uctype: untouched(1), port: 1
index 38, raw: 00000004 f3200011 93ec6fa2, type: vlan+addr(3), addr: 00:11:93:ec:6f:a2, vlan: 800, uctype: touched(3), port: 1
index 40, raw: 00000004 f0000012 01f7a73f, type: vlan+addr(3), addr: 00:12:01:f7:a7:3f, vlan: 0, uctype: touched(3), port: 1
index 41, raw: 00000004 f0000011 855b1f3c, type: vlan+addr(3), addr: 00:11:85:5b:1f:3c, vlan: 0, uctype: touched(3), port: 1
index 42, raw: 00000004 7000d4be d900d37e, type: vlan+addr(3), addr: d4:be:d9:00:d3:7e, vlan: 0, uctype: untouched(1), port: 1
index 45, raw: 00000004 f3200012 01f7d6ff, type: vlan+addr(3), addr: 00:12:01:f7:d6:ff, vlan: 800, uctype: touched(3), port: 1
index 46, raw: 00000004 f0000002 fcc039df, type: vlan+addr(3), addr: 00:02:fc:c0:39:df, vlan: 0, uctype: touched(3), port: 1
index 47, raw: 00000004 f0000000 0c07ac66, type: vlan+addr(3), addr: 00:00:0c:07:ac:66, vlan: 0, uctype: touched(3), port: 1
index 48, raw: 00000004 f000d4be d94167da, type: vlan+addr(3), addr: d4:be:d9:41:67:da, vlan: 0, uctype: touched(3), port: 1
index 49, raw: 00000004 f000d067 e5e72bc0, type: vlan+addr(3), addr: d0:67:e5:e7:2b:c0, vlan: 0, uctype: touched(3), port: 1
index 50, raw: 00000004 f0005c26 0a6a51d0, type: vlan+addr(3), addr: 5c:26:0a:6a:51:d0, vlan: 0, uctype: touched(3), port: 1
index 51, raw: 00000004 70000014 22266425, type: vlan+addr(3), addr: 00:14:22:26:64:25, vlan: 0, uctype: untouched(1), port: 1
index 53, raw: 00000004 f3200002 fcc039df, type: vlan+addr(3), addr: 00:02:fc:c0:39:df, vlan: 800, uctype: touched(3), port: 1
index 54, raw: 00000004 f000000b cd413d26, type: vlan+addr(3), addr: 00:0b:cd:41:3d:26, vlan: 0, uctype: touched(3), port: 1
index 55, raw: 00000004 f3200000 0c07ac6f, type: vlan+addr(3), addr: 00:00:0c:07:ac:6f, vlan: 800, uctype: touched(3), port: 1
index 56, raw: 00000004 f000000b cd413d27, type: vlan+addr(3), addr: 00:0b:cd:41:3d:27, vlan: 0, uctype: touched(3), port: 1
index 57, raw: 00000004 f000000d 5620cdce, type: vlan+addr(3), addr: 00:0d:56:20:cd:ce, vlan: 0, uctype: touched(3), port: 1
index 58, raw: 00000004 f0000004 e2fceead, type: vlan+addr(3), addr: 00:04:e2:fc:ee:ad, vlan: 0, uctype: touched(3), port: 1
index 59, raw: 00000004 7000d4be d93db91b, type: vlan+addr(3), addr: d4:be:d9:3d:b9:1b, vlan: 0, uctype: untouched(1), port: 1
index 60, raw: 00000004 70000019 b9022455, type: vlan+addr(3), addr: 00:19:b9:02:24:55, vlan: 0, uctype: untouched(1), port: 1
index 61, raw: 00000004 f0000027 1369552b, type: vlan+addr(3), addr: 00:27:13:69:55:2b, vlan: 0, uctype: touched(3), port: 1
index 62, raw: 00000004 70005c26 0a06d1cd, type: vlan+addr(3), addr: 5c:26:0a:06:d1:cd, vlan: 0, uctype: untouched(1), port: 1
index 63, raw: 00000004 7000d4be d96816aa, type: vlan+addr(3), addr: d4:be:d9:68:16:aa, vlan: 0, uctype: untouched(1), port: 1
index 64, raw: 00000004 70000015 f28e329c, type: vlan+addr(3), addr: 00:15:f2:8e:32:9c, vlan: 0, uctype: untouched(1), port: 1
index 66, raw: 00000004 7000d067 e5e53caf, type: vlan+addr(3), addr: d0:67:e5:e5:3c:af, vlan: 0, uctype: untouched(1), port: 1
index 67, raw: 00000004 f000d4be d9416812, type: vlan+addr(3), addr: d4:be:d9:41:68:12, vlan: 0, uctype: touched(3), port: 1
index 69, raw: 00000004 f3200012 01f7a73f, type: vlan+addr(3), addr: 00:12:01:f7:a7:3f, vlan: 800, uctype: touched(3), port: 1
index 75, raw: 00000004 70000014 22266386, type: vlan+addr(3), addr: 00:14:22:26:63:86, vlan: 0, uctype: untouched(1), port: 1
index 80, raw: 00000004 70000030 6e5ee4b4, type: vlan+addr(3), addr: 00:30:6e:5e:e4:b4, vlan: 0, uctype: untouched(1), port: 1
index 83, raw: 00000004 70005c26 0a695379, type: vlan+addr(3), addr: 5c:26:0a:69:53:79, vlan: 0, uctype: untouched(1), port: 1
index 85, raw: 00000004 7000d4be d936b959, type: vlan+addr(3), addr: d4:be:d9:36:b9:59, vlan: 0, uctype: untouched(1), port: 1
index 86, raw: 00000004 7000bc30 5bde7ec2, type: vlan+addr(3), addr: bc:30:5b:de:7e:c2, vlan: 0, uctype: untouched(1), port: 1
[37..86]: 32 entries, +
root@keystone-evm:~# cat /sys/class/net/eth0/device/ale_table
index 87, raw: 00000004 7000b8ac 6f7f4712, type: vlan+addr(3), addr: b8:ac:6f:7f:47:12, vlan: 0, uctype: untouched(1), port: 1
index 88, raw: 00000004 f0005c26 0a694420, type: vlan+addr(3), addr: 5c:26:0a:69:44:20, vlan: 0, uctype: touched(3), port: 1
index 89, raw: 00000004 f0000018 8b2d92e2, type: vlan+addr(3), addr: 00:18:8b:2d:92:e2, vlan: 0, uctype: touched(3), port: 1
index 93, raw: 00000004 7000001a a0a0c9df, type: vlan+addr(3), addr: 00:1a:a0:a0:c9:df, vlan: 0, uctype: untouched(1), port: 1
index 94, raw: 00000004 f000e8e0 b736b25e, type: vlan+addr(3), addr: e8:e0:b7:36:b2:5e, vlan: 0, uctype: touched(3), port: 1
index 96, raw: 00000004 70000010 18af5bfb, type: vlan+addr(3), addr: 00:10:18:af:5b:fb, vlan: 0, uctype: untouched(1), port: 1
index 99, raw: 00000004 70003085 a9a63965, type: vlan+addr(3), addr: 30:85:a9:a6:39:65, vlan: 0, uctype: untouched(1), port: 1
index 101, raw: 00000004 70005c26 0a695312, type: vlan+addr(3), addr: 5c:26:0a:69:53:12, vlan: 0, uctype: untouched(1), port: 1
index 104, raw: 00000004 7000f46d 04e22fc9, type: vlan+addr(3), addr: f4:6d:04:e2:2f:c9, vlan: 0, uctype: untouched(1), port: 1
index 105, raw: 00000004 7000001b 788de114, type: vlan+addr(3), addr: 00:1b:78:8d:e1:14, vlan: 0, uctype: untouched(1), port: 1
index 109, raw: 00000004 7000d4be d96816f4, type: vlan+addr(3), addr: d4:be:d9:68:16:f4, vlan: 0, uctype: untouched(1), port: 1
index 111, raw: 00000004 f0000010 18a113b5, type: vlan+addr(3), addr: 00:10:18:a1:13:b5, vlan: 0, uctype: touched(3), port: 1
index 115, raw: 00000004 f000f46d 04e22fbd, type: vlan+addr(3), addr: f4:6d:04:e2:2f:bd, vlan: 0, uctype: touched(3), port: 1
index 116, raw: 00000004 7000b8ac 6f8ed5e6, type: vlan+addr(3), addr: b8:ac:6f:8e:d5:e6, vlan: 0, uctype: untouched(1), port: 1
index 118, raw: 00000004 7000001a a0b2ebee, type: vlan+addr(3), addr: 00:1a:a0:b2:eb:ee, vlan: 0, uctype: untouched(1), port: 1
index 119, raw: 00000004 7000782b cbab87d4, type: vlan+addr(3), addr: 78:2b:cb:ab:87:d4, vlan: 0, uctype: untouched(1), port: 1
index 126, raw: 00000004 70000018 8b09703d, type: vlan+addr(3), addr: 00:18:8b:09:70:3d, vlan: 0, uctype: untouched(1), port: 1
index 129, raw: 00000004 70000050 b65f189e, type: vlan+addr(3), addr: 00:50:b6:5f:18:9e, vlan: 0, uctype: untouched(1), port: 1
index 131, raw: 00000004 f000bc30 5bd07ed1, type: vlan+addr(3), addr: bc:30:5b:d0:7e:d1, vlan: 0, uctype: touched(3), port: 1
index 133, raw: 00000004 f0003085 a9a26425, type: vlan+addr(3), addr: 30:85:a9:a2:64:25, vlan: 0, uctype: touched(3), port: 1
index 147, raw: 00000004 f000b8ac 6f8bae7f, type: vlan+addr(3), addr: b8:ac:6f:8b:ae:7f, vlan: 0, uctype: touched(3), port: 1
index 175, raw: 00000004 700090e2 ba02c6e4, type: vlan+addr(3), addr: 90:e2:ba:02:c6:e4, vlan: 0, uctype: untouched(1), port: 1
index 186, raw: 00000004 70000013 728c27fd, type: vlan+addr(3), addr: 00:13:72:8c:27:fd, vlan: 0, uctype: untouched(1), port: 1
index 197, raw: 00000004 f0000012 3f716cb1, type: vlan+addr(3), addr: 00:12:3f:71:6c:b1, vlan: 0, uctype: touched(3), port: 1
index 249, raw: 00000004 7000e89d 877c862f, type: vlan+addr(3), addr: e8:9d:87:7c:86:2f, vlan: 0, uctype: untouched(1), port: 1
[87..1023]: 25 entries
root@keystone-evm:~#
root@keystone-evm:~# cat /sys/class/net/eth0/device/ale_table_raw
0: 1c d000ffff ffffffff
1: 00 10000017 eaf4323a
2: 1c d0003333 00000001
3: 1c d0000100 5e000001
4: 04 f0000001 297495bf
5: 1c d0003333 fff4323a
6: 04 f0000000 0c07acca
7: 04 7000e8e0 b75db25e
9: 04 f0005c26 0a69440b
11: 04 70005c26 0a5b2ea6
12: 04 f000d4be d93db6b8
13: 04 f0000014 225b62d9
14: 04 7000000b 7866c6d3
15: 04 f0005c26 0a6952fa
16: 04 f000b8ac 6f7d1b65
17: 04 7000d4be d9a34760
18: 04 70000007 eb645149
19: 04 f3200000 0c07acd3
20: 04 7000d067 e5e7330c
22: 04 70000026 b9802a50
23: 04 f000d067 e5e5aa12
24: 04 f0000011 430619f6
25: 04 f000bc30 5bde7ee2
26: 04 f000b8ac 6f92c3d3
28: 04 f0000012 01f7d6ff
29: 04 f000000b db7789a5
31: 04 70000018 8b2d9433
32: 04 70000013 728a0dc0
33: 04 700000c0 b76f6e82
34: 04 700014da e9096f9a
35: 04 f0000023 24086746
36: 04 7000001b 11b4362f
37: 04 f0000019 b9382f7e
38: 04 f3200011 93ec6fa2
39: 04 f0005046 5d74bf90
40: 04 f0000012 01f7a73f
41: 04 f0000011 855b1f3c
42: 04 f000d4be d900d37e
45: 04 f3200012 01f7d6ff
46: 04 f0000002 fcc039df
47: 04 f0000000 0c07ac66
48: 04 f000d4be d94167da
49: 04 f000d067 e5e72bc0
50: 04 f0005c26 0a6a51d0
51: 04 70000014 22266425
53: 04 f3200002 fcc039df
54: 04 f000000b cd413d26
55: 04 f3200000 0c07ac6f
56: 04 f000000b cd413d27
57: 04 f000000d 5620cdce
58: 04 f0000004 e2fceead
59: 04 7000d4be d93db91b
60: 04 70000019 b9022455
61: 04 f0000027 1369552b
62: 04 70005c26 0a06d1cd
63: 04 7000d4be d96816aa
64: 04 70000015 f28e329c
66: 04 7000d067 e5e53caf
67: 04 f000d4be d9416812
69: 04 f3200012 01f7a73f
75: 04 70000014 22266386
80: 04 70000030 6e5ee4b4
83: 04 70005c26 0a695379
85: 04 7000d4be d936b959
86: 04 7000bc30 5bde7ec2
87: 04 7000b8ac 6f7f4712
88: 04 f0005c26 0a694420
89: 04 f0000018 8b2d92e2
93: 04 7000001a a0a0c9df
94: 04 f000e8e0 b736b25e
96: 04 70000010 18af5bfb
99: 04 f0003085 a9a63965
101: 04 70005c26 0a695312
104: 04 7000f46d 04e22fc9
105: 04 7000001b 788de114
109: 04 7000d4be d96816f4
111: 04 f0000010 18a113b5
115: 04 f000f46d 04e22fbd
116: 04 7000b8ac 6f8ed5e6
118: 04 7000001a a0b2ebee
119: 04 7000782b cbab87d4
126: 04 70000018 8b09703d
129: 04 f0000050 b65f189e
131: 04 f000bc30 5bd07ed1
133: 04 f0003085 a9a26425
147: 04 f000b8ac 6f8bae7f
175: 04 700090e2 ba02c6e4
181: 04 f0000012 3f99c9dc
182: 04 f000000c f1d2df6b
186: 04 70000013 728c27fd
197: 04 f0000012 3f716cb1
249: 04 7000e89d 877c862f
[0..1023]: 92 entries
root@keystone-evm:~#
root@keystone-evm:~# ls -l /sys/devices/soc.0/2090000.netcp/cpsw/stats
--w-------    1 root     root          4096 Feb 28 20:32 A
--w-------    1 root     root          4096 Feb 28 20:33 B
root@keystone-evm:~#
root@keystone-evm:~#
root@keystone-evm:~# ethtool -S eth0
NIC statistics:
     CPSW_A:rx_good_frames: 133
     CPSW_A:rx_broadcast_frames: 0
     CPSW_A:rx_multicast_frames: 0
     CPSW_A:rx_pause_frames: 0
     CPSW_A:rx_crc_errors: 0
     CPSW_A:rx_align_code_errors: 0
     CPSW_A:rx_oversized_frames: 0
     CPSW_A:rx_jabber_frames: 0
     CPSW_A:rx_undersized_frames: 0
     CPSW_A:rx_fragments: 0
     CPSW_A:rx_bytes: 20878
     CPSW_A:tx_good_frames: 1469
     CPSW_A:tx_broadcast_frames: 553
     CPSW_A:tx_multicast_frames: 805
     CPSW_A:tx_pause_frames: 0
     CPSW_A:tx_deferred_frames: 0
     CPSW_A:tx_collision_frames: 0
     CPSW_A:tx_single_coll_frames: 0
     CPSW_A:tx_mult_coll_frames: 0
     CPSW_A:tx_excessive_collisions: 0
     CPSW_A:tx_late_collisions: 0
     CPSW_A:tx_underrun: 0
     CPSW_A:tx_carrier_sense_errors: 0
     CPSW_A:tx_bytes: 148064
     CPSW_A:tx_64byte_frames: 335
     CPSW_A:tx_65_to_127byte_frames: 834
     CPSW_A:tx_128_to_255byte_frames: 384
     CPSW_A:tx_256_to_511byte_frames: 45
     CPSW_A:tx_512_to_1023byte_frames: 4
     CPSW_A:tx_1024byte_frames: 0
     CPSW_A:net_bytes: 168942
     CPSW_A:rx_sof_overruns: 0
     CPSW_A:rx_mof_overruns: 0
     CPSW_A:rx_dma_overruns: 0
     CPSW_B:rx_good_frames: 923
     CPSW_B:rx_broadcast_frames: 355
     CPSW_B:rx_multicast_frames: 499
     CPSW_B:rx_pause_frames: 0
     CPSW_B:rx_crc_errors: 0
     CPSW_B:rx_align_code_errors: 0
     CPSW_B:rx_oversized_frames: 0
     CPSW_B:rx_jabber_frames: 0
     CPSW_B:rx_undersized_frames: 0
     CPSW_B:rx_fragments: 0
     CPSW_B:rx_bytes: 95208
     CPSW_B:tx_good_frames: 77
     CPSW_B:tx_broadcast_frames: 0
     CPSW_B:tx_multicast_frames: 0
     CPSW_B:tx_pause_frames: 0
     CPSW_B:tx_deferred_frames: 0
     CPSW_B:tx_collision_frames: 0
     CPSW_B:tx_single_coll_frames: 0
     CPSW_B:tx_mult_coll_frames: 0
     CPSW_B:tx_excessive_collisions: 0
     CPSW_B:tx_late_collisions: 0
     CPSW_B:tx_underrun: 0
     CPSW_B:tx_carrier_sense_errors: 0
     CPSW_B:tx_bytes: 12654
     CPSW_B:tx_64byte_frames: 201
     CPSW_B:tx_65_to_127byte_frames: 527
     CPSW_B:tx_128_to_255byte_frames: 236
     CPSW_B:tx_256_to_511byte_frames: 33
     CPSW_B:tx_512_to_1023byte_frames: 4
     CPSW_B:tx_1024byte_frames: 0
     CPSW_B:net_bytes: 107862
     CPSW_B:rx_sof_overruns: 0
     CPSW_B:rx_mof_overruns: 0
     CPSW_B:rx_dma_overruns: 0
root@keystone-evm:~# echo 0 &gt; /sys/devices/soc.0/2090000.netcp/cpsw/stats/A
root@keystone-evm:~#
root@keystone-evm:~# echo 0 &gt; /sys/devices/soc.0/2090000.netcp/cpsw/stats/B
root@keystone-evm:~#
root@keystone-evm:~# ethtool -S eth0
NIC statistics:
     CPSW_A:rx_good_frames: 5
     CPSW_A:rx_broadcast_frames: 0
     CPSW_A:rx_multicast_frames: 0
     CPSW_A:rx_pause_frames: 0
     CPSW_A:rx_crc_errors: 0
     CPSW_A:rx_align_code_errors: 0
     CPSW_A:rx_oversized_frames: 0
     CPSW_A:rx_jabber_frames: 0
     CPSW_A:rx_undersized_frames: 0
     CPSW_A:rx_fragments: 0
     CPSW_A:rx_bytes: 766
     CPSW_A:tx_good_frames: 5
     CPSW_A:tx_broadcast_frames: 0
     CPSW_A:tx_multicast_frames: 0
     CPSW_A:tx_pause_frames: 0
     CPSW_A:tx_deferred_frames: 0
     CPSW_A:tx_collision_frames: 0
     CPSW_A:tx_single_coll_frames: 0
     CPSW_A:tx_mult_coll_frames: 0
     CPSW_A:tx_excessive_collisions: 0
     CPSW_A:tx_late_collisions: 0
     CPSW_A:tx_underrun: 0
     CPSW_A:tx_carrier_sense_errors: 0
     CPSW_A:tx_bytes: 814
     CPSW_A:tx_64byte_frames: 0
     CPSW_A:tx_65_to_127byte_frames: 2
     CPSW_A:tx_128_to_255byte_frames: 8
     CPSW_A:tx_256_to_511byte_frames: 0
     CPSW_A:tx_512_to_1023byte_frames: 0
     CPSW_A:tx_1024byte_frames: 0
     CPSW_A:net_bytes: 1580
     CPSW_A:rx_sof_overruns: 0
     CPSW_A:rx_mof_overruns: 0
     CPSW_A:rx_dma_overruns: 0
     CPSW_B:rx_good_frames: 4
     CPSW_B:rx_broadcast_frames: 0
     CPSW_B:rx_multicast_frames: 1
     CPSW_B:rx_pause_frames: 0
     CPSW_B:rx_crc_errors: 0
     CPSW_B:rx_align_code_errors: 0
     CPSW_B:rx_oversized_frames: 0
     CPSW_B:rx_jabber_frames: 0
     CPSW_B:rx_undersized_frames: 0
     CPSW_B:rx_fragments: 0
     CPSW_B:rx_bytes: 814
     CPSW_B:tx_good_frames: 5
     CPSW_B:tx_broadcast_frames: 0
     CPSW_B:tx_multicast_frames: 0
     CPSW_B:tx_pause_frames: 0
     CPSW_B:tx_deferred_frames: 0
     CPSW_B:tx_collision_frames: 0
     CPSW_B:tx_single_coll_frames: 0
     CPSW_B:tx_mult_coll_frames: 0
     CPSW_B:tx_excessive_collisions: 0
     CPSW_B:tx_late_collisions: 0
     CPSW_B:tx_underrun: 0
     CPSW_B:tx_carrier_sense_errors: 0
     CPSW_B:tx_bytes: 766
     CPSW_B:tx_64byte_frames: 0
     CPSW_B:tx_65_to_127byte_frames: 2
     CPSW_B:tx_128_to_255byte_frames: 8
     CPSW_B:tx_256_to_511byte_frames: 0
     CPSW_B:tx_512_to_1023byte_frames: 0
     CPSW_B:tx_1024byte_frames: 0
     CPSW_B:net_bytes: 1580
     CPSW_B:rx_sof_overruns: 0
     CPSW_B:rx_mof_overruns: 0
     CPSW_B:rx_dma_overruns: 0
root@keystone-evm:~#
</pre>
<h6><span class="mw-headline" id="Using_Ethtool_to_Change_PHY_Settings">Using Ethtool to Change PHY Settings</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=88" title="Edit section: Using Ethtool to Change PHY Settings">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Use the Linux "ethtool -s" command to change PHY settings of selected parameters as shown below
</p>
<pre>        ethtool -s|--change DEVNAME     Change generic options
               [ speed&#160;%d ]
               [ duplex half|full ]
               [ port tp|aui|bnc|mii|fibre ]
               [ autoneg on|off ]
               [ advertise&#160;%x ]
</pre>
<p><br />
</p>
<h6><span class="mw-headline" id="Enabling_MDIO">Enabling MDIO</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=89" title="Edit section: Enabling MDIO">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>In the default K2HK DTS, currently MDIO is disabled as a software workaround for the MDIO hardware issue on K2HK EVM. To enable MDIO driver on custom board, add the following bindings in the K2HK DTS for 1G. For u-boot has_mdio env variable should be set as well to enable MDIO hardware IP.
</p><p>For K2HK EVM:
</p>
<pre>              mdio: mdio@2090300 {
                      compatible      = "ti,davinci_mdio";
                      #address-cells = &lt;1&gt;;
                      #size-cells = &lt;0&gt;;
                      reg             = &lt;0x2090300 0x100&gt;;
                      bus_freq        = &lt;1000000&gt;;
                      clocks          = &lt;&amp;clkcpgmac&gt;;
                      clock-names     = "fck";
                      phy0: phy@0 {
                              compatible = "marvell,88e1111";
                              reg = &lt;0&gt;;
                      };
                      phy1: phy@1 {
                              compatible = "marvell,88e1111";
                              reg = &lt;1&gt;;
                      };
              };
</pre>
<p>Also modify the slaveX nodes in the netcp node to the following:
</p>
<pre>       netcp {
               ...
               slaves {
                       slave0 {
                               label           = "slave0";
                               link-interface  = &lt;1&gt;;
                               phy-handle      = &lt;&amp;phy0&gt;;
                       };
                       slave1 {
                               label           = "slave1";
                               link-interface  = &lt;1&gt;;
                               phy-handle      = &lt;&amp;phy1&gt;;
                       };
               };
       };
</pre>
<p>Starting from MCSDK release 3.1.1, K2E and K2L MDIO are enabled by default.  To enable MDIO on these platforms in previous MCSDK releases, see the k2e-net.dtsi or k2l-net.dtsi DTS file in MCSDK release 3.1.1.
</p><p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  Enabling MDIO will have impact on the system bootup time due to the time spent in auto-negotiation on each ethernet port.
<br />
<br />
<br />
</p>
<h5><span id="Common_Platform_Time_Sync_(CPTS)"></span><span class="mw-headline" id="Common_Platform_Time_Sync_.28CPTS.29">Common Platform Time Sync (CPTS)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=90" title="Edit section: Common Platform Time Sync (CPTS)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The Common Platform Time Sync (CPTS) module is used to facilitate host control of time sync operations. It enables compliance with the IEEE 1588-2008 standard for a precision clock synchronization protocol.
</p><p>Although CPTS timestamping co-exists with PA timestamping, CPTS timestamping is only for PTP packets and in that case, PA will not timestamp those packets.
</p>
<h6><span class="mw-headline" id="CPTS_Hardware_Configurations">CPTS Hardware Configurations</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=91" title="Edit section: CPTS Hardware Configurations">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p><b>1.</b>  CPTS Device Tree Bindings Following are the CPTS related device tree bindings
</p>
<ul><li>cpts_reg_ofs</li></ul>
<dl><dd><dl><dd>cpts register offset in cpsw module</dd></dl></dd></dl>
<ul><li>cpts_rftclk_sel</li></ul>
<dl><dd><dl><dd>chooses the input rftclk, default is 0</dd></dl></dd></dl>
<ul><li>cpts_rftclk_freq</li></ul>
<dl><dd><dl><dd>ref clock frequency in Hz if it is an <b>external</b> clock</dd></dl></dd></dl>
<ul><li>cpsw_cpts_rft_clk</li></ul>
<dl><dd><dl><dd>ref clock name if it is an <b>internal</b> clock</dd></dl></dd></dl>
<ul><li>cpts_ts_comp_length</li></ul>
<dl><dd><dl><dd>PPS Asserted Length (in Ref Clk Cycles)</dd></dl></dd></dl>
<ul><li>cpts_ts_comp_polarity</li></ul>
<dl><dd><dl><dd>if 1, PPS is assered high; otherwise asserted low</dd></dl></dd></dl>
<ul><li>cpts_clock_mult, cpts_clock_shift, cpts_clock_div</li></ul>
<dl><dd><dl><dd>multiplier and divider for converting cpts counter value to timestamp time</dd></dl></dd></dl>
<pre>  Example:
</pre>
<pre>     netcp: netcp@2090000 {
        ...
        clocks = &lt;&amp;papllclk&gt;, &lt;&amp;clkcpgmac&gt;, &lt;&amp;chipclk12&gt;;
        clock-names = "clk_pa", "clk_cpgmac", "cpsw_cpts_rft_clk";
        ...
        cpsw: cpsw@2090000 {
        ...
           cpts_reg_ofs = &lt;0xd00&gt;;
           ...
           cpts_rftclk_sel=&lt;8&gt;;
           /*cpts_rftclk_freq = &lt;122800000&gt;;*/
           cpts_ts_comp_length = &lt;3&gt;;
           cpts_ts_comp_polarity = &lt;1&gt;;  /* 1 - assert high */
           /* cpts_clock_mult = &lt;6250&gt;; */
           /* cpts_clock_shift = &lt;8&gt;; */
           /* cpts_clock_div = &lt;3&gt;; */
           ...
        };
        ...
     };
</pre>
<p><br /><b>2.</b>  Configurations during driver initialization
</p><p>By default, cpts is configured with the following configurations at boot up:
</p>
<ul><li>Tx and Rx Annex D support but only one vlan tag (ts_vlan_ltype1_en)</li>
<li>Tx and Rx Annex E support but only one vlan tag (ts_vlan_ltype1_en)</li>
<li>Tx and Rx Annex F support but only one vlan tag (ts_vlan_ltype1_en)</li>
<li>ts_vlan_ltype1 = 0x8100 (default)</li>
<li>uni-cast enabled</li>
<li>ttl_nonzero enabled</li></ul>
<p><br /><b>3.</b>  Configurations during runtime (Sysfs)
</p><p>Currently the following sysfs are available for cpts related runtime configuration
</p>
<ul><li>/sys/devices/soc.0/2090000.netcp/cpsw/port_ts/n/uni_en</li></ul>
<dl><dd>(where n is slave port number)
<ul><li>Read/Write</li>
<li>1 (enable unicast)</li>
<li>0 (disable unicast)</li></ul></dd></dl>
<ul><li>/sys/devices/soc.0/2090000.netcp/cpsw/port_ts/n/mcast_addr</li></ul>
<dl><dd>(where n is slave port number)
<ul><li>Read/Write</li>
<li>bit map for mcast addr .132 .131 .130 .129 .107</li></ul>
<dl><dd><dl><dd><ul><li>bit[4]: 224.0.1.132</li>
<li>bit[3]: 224.0.1.131</li>
<li>bit[2]: 224.0.1.130</li>
<li>bit[1]: 224.0.1.129</li>
<li>bit[0]: 224.0.0.107</li></ul></dd></dl></dd></dl></dd></dl>
<ul><li>/sys/devices/soc.0/2090000.netcp/cpsw/port_ts/n/config</li></ul>
<dl><dd>(where n is slave port number)
<ul><li>Read Only</li>
<li>shows the raw values of the cpsw port ts register configurations</li></ul></dd></dl>
<p><br />
</p>
<pre> Examples:
</pre>
<pre> 1. Checking whether uni-cast enabled
    $ cat /sys/devices/soc.0/2090000.netcp/cpsw/port_ts/1/uni_en
    $ 0
</pre>
<pre> 2. Enabling uni-cast
    $ echo 1 &gt; /sys/devices/soc.0/2090000.netcp/cpsw/port_ts/1/uni_en
</pre>
<pre> 3. Checking which multi-cast addr is enabled (when uni_en=0)
    $ cat /sys/devices/soc.0/2090000.netcp/cpsw/port_ts/1/mcast_addr
    $ 0x1f
</pre>
<pre> 4. Disabling 224.0.1.131 and 224.0.0.107 but enabling the rest (when uni_en=0)
    $ echo 0x16 &gt; /sys/devices/soc.0/2090000.netcp/cpsw/port_ts/1/mcast_addr
</pre>
<pre> 5. Showing the current port time sync config
    $ cat /sys/devices/soc.0/2090000.netcp/cpsw/port_ts/1/config
    000f06bb 001e88f7 81008100 01a088f7 00040000
</pre>
<pre>    where the displayed hex values correspond to the port registers
    ts_ctl, ts_seq_ltype, ts_vlan_ltype, ts_ctl_ltype2 and ts_ctl2
</pre>
<p><br />
Note 1: Although the above configurations are done through command line, they can also be done by using standard Linux open()/read()/write() file function calls.
</p><p>Note 2: When uni-cast is enabled, ie. uni_en=1, mcast_addr configuration will not take effect since uni-cast will allow any uni-cast and multi-cast address.
</p>
<h6><span class="mw-headline" id="CPTS_Driver_Internals_Overview">CPTS Driver Internals Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=92" title="Edit section: CPTS Driver Internals Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p><b>1.</b>  Driver Initialization
</p><p>On start up, the cpts driver
</p>
<ul><li>initializes the input clock if it is an internal clock:</li></ul>
<dl><dd><ul><li>enable the input clock</li>
<li>get the clock frequency</li></ul></dd></dl>
<ul><li>gets the frequency configuration of the input clock from the device tree bindings if it is an external clock</li></ul>
<ul><li>selects/calculates (see Notes below for details) the multiplier (M), shift (S) and divisor (D) corresponding to the frequency for internal usage, ie. converting counter cycles to nsec by using the formula</li></ul>
<dl><dd><dl><dd><dl><dd>nsec = ((cycles * M) &gt;&gt; S) / D</dd></dl></dd></dl></dd></dl>
<ul><li>gets the cpts_rftclk_sel value and program the CPTS RFTCLK_SEL register.</li></ul>
<ul><li>configures the cpsw Px_TS_CTL, Px_TS_SEQ_LTYPE, Px_TS_VLAN_LTYPE, Px_TS_CTL_LTYPE2 and Px_TS_CTL2 registers (see section Configurations)</li></ul>
<ul><li>registers itself to the Linux kernel ptp layer as a clock source (doing so makes sure the Linux kernel ptp layer and standard user space API's can be used)</li></ul>
<ul><li>mark the currnet cpts counter value to the current system time</li></ul>
<ul><li>schedule a periodic work to catch the cpts counter overflow events and updates the driver's internal time counter and cycle counter values accordingly.</li></ul>
<p>Note 1: For a rftclk freq of 400MHz, the counter overflows at about every 10.73 secs. It is the responsibility of the software (ie. the driver) to keep track of the overflows and hence the correct time passed.
<br />
</p><p><br />
Note 2: The multiplier (M) shift (S) and divisor (D) depends on the rftclk frequency (F).  Ideally, "good" values of M/S/D should be chosen so that when converting counter value when it reaches the rftclk frequency value (F) to timestamp time, i.e.
</p>
<dl><dd><dl><dd><dl><dd>((F * M) &gt;&gt; S) / D</dd></dl></dd></dl></dd></dl>
<p>gives exactly 1000000000 nsec for accuracy and D should be 1 (if possible) to avoid long division for efficiency.
</p><p>For example, if F = 614400000, to find M/S/D such that
</p>
<dl><dd><dl><dd><dl><dd>1000000000 = 614400000 * M / (2^S * D)</dd></dl></dd></dl></dd></dl>
<p>simplify and rewrite both sides so that
</p>
<dl><dd><dl><dd><dl><dd>2^4 * 5^4 = 2^11 * 3 * M / (2^S * D)</dd></dl></dd></dl></dd></dl>
<p>or
</p>
<dl><dd><dl><dd><dl><dd>M / (2^S * D) = 5000 / (2^10 * 3)</dd></dl></dd></dl></dd></dl>
<p>hence
</p>
<dl><dd><dl><dd><dl><dd>M = 5000, S = 10, D = 3</dd></dl></dd></dl></dd></dl>
<p><br />
</p><p>Note 3: cpts driver keeps a table of M/S/D for some common frequencies
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Freq (Hz)</b>
</td>
<td bgcolor="#c0c0c0"><b>M</b>
</td>
<td bgcolor="#c0c0c0"><b>S</b>
</td>
<td bgcolor="#c0c0c0"><b>D</b>
</td></tr>
<tr>
<td>400000000
</td>
<td>2560
</td>
<td>10
</td>
<td>1
</td></tr>
<tr>
<td>425000000
</td>
<td>5120
</td>
<td>7
</td>
<td>17
</td></tr>
<tr>
<td>500000000
</td>
<td>2048
</td>
<td>10
</td>
<td>1
</td></tr>
<tr>
<td>600000000
</td>
<td>5120
</td>
<td>10
</td>
<td>3
</td></tr>
<tr>
<td>614400000
</td>
<td>5000
</td>
<td>10
</td>
<td>3
</td></tr>
<tr>
<td>625000000
</td>
<td>4096
</td>
<td>9
</td>
<td>5
</td></tr>
<tr>
<td>675000000
</td>
<td>5120
</td>
<td>7
</td>
<td>27
</td></tr>
<tr>
<td>700000000
</td>
<td>5120
</td>
<td>9
</td>
<td>7
</td></tr>
<tr>
<td>750000000
</td>
<td>4096
</td>
<td>10
</td>
<td>3
</td></tr></tbody></table>
<p><br />
</p><p>Note 4: At start up, cpts driver selects or calculates the M/S/D for the rftclk frequency according to the following
</p>
<dl><dd>a. if M/S/D is defined in devicetree bindings, use them; otherwise</dd>
<dd>b. if the rftclk frequency matches one of the frequencies in the table above, select the corresponding M/S/D; otherwise</dd>
<dd>c. if the rftclk frequency differs from one of the frequencies in the table above by less than 1 MHz, select the M/S/D that corresponds to the frequency with the minimum difference; otherwise</dd>
<dd>d. call clocks_calc_mult_shift( ) to calculate the M &amp; S and set D = 1</dd></dl>
<p><br />
</p><p>Note 5: (<b>WARNING</b>) On Keystone 2 platforms, the default rftclk select is the internal SYSCLK2.  On K2L, core pll is configured (based on the programmed efuse of max speed of 1 GHz and ref clk of 122880000 Hz) to 1000594244 Hz.  As such, SYSCLK2 = 1000594244 / 2 = 500297122 Hz.  With such a rftclk frequency, it is unlikely that some "good" M/S/D can be found so that 1000000000 = ((500297122 * M) &gt;&gt; S) / D.  Hence based on the algorithm in Note 4, the M/S/D corresponding to 500000000 Hz will be used and unfortunately inaccuracy will be observed in timestamping.  However, this issue is not observed on K2HK and K2E since the respective core pll is configured to exactly 1200000000 Hz and 1000000000 Hz, thus the cpts rftclk frequency is 600000000 and 500000000 Hz respectively and "good" M/S/D exist for these rftclk frequencies.
<br />
</p><p><br />
Note 6: Instead of an internal rftclk, cpts can be provided with an external rftclk.  Also custom M/S/D can be configured in devicetree bindings.
<br />
</p><p><br /><b>2.</b>  Timestamping in Tx
</p><p>In the tx direction during runtime, the driver
</p>
<ul><li>marks the submitted packet to be CPTS timestamped if the the packet passes the PTP filter rules</li>
<li>retrieves the timestamp on the transmitted ptp packet (packets submitted to a socket with proper socket configurations, see below) from CPTS's event FIFO</li>
<li>converts the counter value to nsec (recall the internal time counter and the cycle counter kept internally by the driver)</li>
<li>packs the retrieved timestamp with a clone of the transmitted packet in a buffer</li>
<li>returns the buffer to the app which submits the packet for transmission through the socket's error queue</li></ul>
<p><br /><b>3.</b>  Timestamping in Rx
</p><p>In the rx direction during runtime, the driver
</p>
<ul><li>examines the received packet to see if it matches the PTP filter requirements</li>
<li>if it does, then it retrieves the timestamp on the received ptp packet from the CPTS's event FIFO</li>
<li>coverts the counter value to nsec (recall the internal time counter and the cycle counter kept internally by the driver)</li>
<li>packs the retrieved timestamp with received packet in a buffer</li>
<li>pass the packet buffer onwards</li></ul>
<p><br />
</p><p><br />
</p>
<h6><span class="mw-headline" id="Using_CPTS_Timestamping">Using CPTS Timestamping</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=93" title="Edit section: Using CPTS Timestamping">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>CPTS user applications use standard Linux APIs to send and receive PTP packets, and to adjust CPTS clock.
</p><p><br />
<b>1.</b>  Send/receive L4 PTP messages (Annex D and E)
</p><p>User application sends and receives L4 PTP messages by calling Linux standard socket API functions
</p>
<pre>  Example (see <a href="#CPTS_References">Reference</a> i):
</pre>
<pre>     a. open UDP socket
     b. call ioctl(sock, SIOCHWTSTAMP, ...) to set the hw timestamping
        socket config
     c. bind to PTP event port
     d. set dst address to socket
     d. setsockopt to join multicast group (if using multicast)
     f. setsockopt to set socket option SO_TIMESTAMP
     g. sendto to send PTP packets
     h. recvmsg( ... MSG_ERRQUEUE ...) to receive timestamped packets
</pre>
<p><br />
<b>2.</b>  Send/receive L2 PTP messages (Annex F)
</p><p>User application sends and receives PTP messages over Ethernet by opening Linux RAW sockets.
</p>
<pre>  Example (see file raw.c in <a href="#CPTS_References">Reference</a> iii):
</pre>
<pre>     int fd
     fd = socket(PF_PACKET, SOCK_RAW, htons(ETH_P_ALL));
     ...
</pre>
<p>In this case, PTP messages are encapsulated directly in Ethernet frames with EtherType 0x88f7.
</p><p><br />
<b>3.</b>  Send/receive PTP messages in VLAN
</p><p>When sending L2/L4 PTP messages over VLAN, <b>step b</b> in above example need to be applied to the actual interface instead of the VLAN interface.
</p>
<pre>  Example (see <a href="#CPTS_References">Reference</a> i):
</pre>
<pre>  Suppose a VLAN interface with vid=10 is added to the eth0 interface.
</pre>
<pre>  $ vconfig add eth0 10
  $ ifconfig eth0.10 192.168.1.200
  $ ifconfig
  eth0      Link encap:Ethernet  HWaddr 00:17:EA:F4:32:3A
            inet addr:132.168.138.88  Bcast:0.0.0.0  Mask:255.255.254.0
            UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
            RX packets:647798 errors:0 dropped:158648 overruns:0 frame:0
            TX packets:1678 errors:0 dropped:0 overruns:0 carrier:0
            collisions:0 txqueuelen:1000
            RX bytes:58765374 (56.0 MiB)  TX bytes:84321 (82.3 KiB)
</pre>
<pre>  eth0.10   Link encap:Ethernet  HWaddr 00:17:EA:F4:32:3A
            inet addr:192.168.1.200  Bcast:192.168.1.255  Mask:255.255.255.0
            inet6 addr: fe80::217:eaff:fef4:323a/64 Scope:Link
            UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
            RX packets:6 errors:0 dropped:0 overruns:0 frame:0
            TX packets:61 errors:0 dropped:0 overruns:0 carrier:0
            collisions:0 txqueuelen:0
            RX bytes:836 (836.0 B)  TX bytes:6270 (6.1 KiB)
</pre>
<pre>  To enable hw timestamping on the <b>eth0.10</b> interface, the ioctl(sock, SIOCHWTSTAMP, ...)
  function call needs to be on the actual interface eth0:
</pre>
<pre>     int sock;
     struct ifreq hwtstamp;
     struct hwtstamp_config hwconfig;
</pre>
<pre>     ...
</pre>
<pre>     sock = socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP);
</pre>
<pre>     /* enable hw timestamping for interfaces eth0 or eth0.10 */
     strncpy(hwtstamp.ifr_name, "<b>eth0</b>", sizeof(hwtstamp.ifr_name));
     hwtstamp.ifr_data = (void *)&amp;hwconfig;
     memset(&amp;hwconfig, 0, sizeof(hwconfig));
     hwconfig.tx_type = HWTSTAMP_TX_ON
     hwconfig.rx_filter = HWTSTAMP_FILTER_PTP_V1_L4_SYNC
     ioctl(sock, SIOCSHWTSTAMP, &amp;hwtstamp);
     ...
</pre>
<p><br />
<b>4.</b>  Clock Adjustments
</p><p>User application needs to inform the CPTS driver of any time or reference clock frequency adjustments, for example, as a result of running PTP protocol.
</p>
<ul><li>It's the application's responsibility to modify the (physical) rftclk frequency.</li>
<li>However, the frequency change needs to be sent to the cpts driver by calling the standard Linux API clock_adjtime() with a flag ADJ_FREQUENCY. This is needed so that the CPTS driver can calculate the time correctly.</li></ul>
<ul><li>As indicated above, CPTS driver keeps a pair of numbers, the multiplier and divisor, to represent the reference clock frequency. When the frequency change API is called and passed with the ppb change, the CPTS driver updates its internal multiplier as follows:</li></ul>
<dl><dd><dl><dd><dl><dd>new_mult = init_mult + init_mult * (ppb / 1000000000)</dd></dl></dd></dl></dd></dl>
<dl><dd>Note: the ppb change is always applied to the initial orginal frequency, NOT the current frequency.</dd></dl>
<pre>  Example (see <a href="#CPTS_References">Reference</a> ii):
</pre>
<pre>     struct timex tx;
     ...
     fd = open("/dev/ptp0", O_RDWR);
     clkid = get_clockid(fd);
     ...
     memset(&amp;tx, 0, sizeof(tx));
     tx.modes = ADJ_FREQUENCY;
     tx.freq = ppb_to_scaled_ppm(adjfreq);
     if (clock_adjtime(clkid, &amp;tx)) {
     	perror("clock_adjtime");
     } else {
     	puts("frequency adjustment okay");
     }
</pre>
<ul><li>To set time (due to shifting +/-), call the the standard Linux API clock_adjtime() with a flag ADJ_SETOFFSET</li></ul>
<pre>  Example (see <a href="#CPTS_References">Reference</a> ii):
</pre>
<pre>     memset(&amp;tx, 0, sizeof(tx));
     tx.modes = ADJ_SETOFFSET;
     tx.time.tv_sec = adjtime;
     tx.time.tv_usec = 0;
     if (clock_adjtime(clkid, &amp;tx) &lt; 0) {
     	perror("clock_adjtime");
     } else {
     	puts("time shift okay");
     }
</pre>
<ul><li>To get time, call the the standard Linux API clock_gettime()</li></ul>
<pre>  Example (see <a href="#CPTS_References">Reference</a> ii):
</pre>
<pre>     if (clock_gettime(clkid, &amp;ts)) {
     	perror("clock_gettime");
     } else {
     	printf("clock time:&#160;%ld.%09ld or&#160;%s",
     	       ts.tv_sec, ts.tv_nsec, ctime(&amp;ts.tv_sec));
     }
</pre>
<ul><li>To set time, call the the standard Linux API clock_settime()</li></ul>
<pre>  Example (see <a href="#CPTS_References">Reference</a> ii):
</pre>
<pre>     clock_gettime(CLOCK_REALTIME, &amp;ts);
     if (clock_settime(clkid, &amp;ts)) {
     	perror("clock_settime");
     } else {
     	puts("set time okay");
     }
</pre>
<p><br />
</p>
<h6><span id="Testing_CPTS/PTP"></span><span class="mw-headline" id="Testing_CPTS.2FPTP">Testing CPTS/PTP</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=94" title="Edit section: Testing CPTS/PTP">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>To check the ptp clock adjustment with PTP protocol, a PTP slave (client) and a PTP master (server) applications are needed to run on separate devices (EVM or PC).  Open source application package linuxptp (<a href="#CPTS_References">Reference</a> iii) can be used as slave and as well as master.  Another option for PTP master is the open source project ptpd (<a href="#CPTS_References">Reference</a> iv).
</p>
<ul><li>Slave Side Examples</li></ul>
<p>The following command can be used to run a ptp-over-L4 client on the evm in slave mode
</p>
<pre>./ptp4l -E -4 -H -i eth0 -s -l 7 -m -q -p /dev/ptp0
</pre>
<p>For ptp-over-L2 client, use the command
</p>
<pre>./ptp4l -E -2 -H -i eth0 -s -l 7 -m -q -p /dev/ptp0
</pre>
<p>ptp4l runtime configuartions can be applied by saving desired configurations in a configuration file and start the ptp4l with an argument "-f &lt;config_filename&gt;"
Note: Only ptp4l supports L2 ethernet, ptpd2 does not support L2.
For example, put the following two lines
</p>
<pre>[global]
tx_timestamp_timeout  15
</pre>
<p>in a file named config, and start a ptp4l-over-L2 client with command
</p>
<pre>./ptp4l -E -2 -H -i eth0 -s -l 7 -m -q -p /dev/ptp0 -f config
</pre>
<p>the tx poll timeout interval will be set to 15 msec instead of the default 1 msec.
</p><p>The adjusted time can be checked by cross compiling the testptp application from the linux kernel: Documentation/ptp/testptp.c. ( e.g) ./testptp -g
</p><p><br />
</p>
<ul><li>Master Side Examples</li></ul>
<p>ptp4l can also be run in master mode. For example, the following command starts a ptp4l-over-L2 master on an EVM using <b>hardware timestamping</b>,
</p>
<pre>./ptp4l -E -2 -H -i eth0 -l 7 -m -q -p /dev/ptp0 -f config
</pre>
<p>On a Linux PC which does not supoort hardware timestamping, the following command starts a ptp4l-over-L2 master using <b>software timestamping</b>.
</p>
<pre>./ptp4l -E -2 -S -i eth0 -l 7 -m -q -p -f config
</pre>
<p><br />
<br />
</p>
<h6><span id="Who_Is_Timestamping_What?"></span><span class="mw-headline" id="Who_Is_Timestamping_What.3F">Who Is Timestamping What?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=95" title="Edit section: Who Is Timestamping What?">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Notice that PA timestamping and CPTS timestamping are running simultaneously.  This is desirable in some use cases because, for example, NTP timestamping is also needed in some systems and CPTS timestamping is only for PTP.  However, CPTS has priority over PA to timestamp PTP messages.  When CPTS timestamps a PTP message, PA will not timestamp it.  See the section <a href="#PA_Timestamping"> PA Timestamping</a> for more details about PA timestamping.
</p><p>If needed, PA timestamping can be completely disabled by adding force_no_hwtstamp to the device tree.
</p>
<pre>  Example:
</pre>
<pre>     pa: pa@2000000 {
             label = "keystone-pa";
             ...
             <b>force_no_hwtstamp</b>;
     };
</pre>
<p>CPTS timestamping can be completely disabled by removing the following line from the device tree
</p>
<pre>  cpts_reg_ofs = &lt;0xd00&gt;;
</pre>
<p><br />
</p>
<h6><span id="Pulse-Per-Second_(PPS)"></span><span class="mw-headline" id="Pulse-Per-Second_.28PPS.29">Pulse-Per-Second (PPS)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=96" title="Edit section: Pulse-Per-Second (PPS)">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The CPTS driver uses the timestamp compare (TS_COMP) output to support PPS.
</p><p>The TS_COMP output is asserted for ts_comp_length[15:0] RCLK periods when the time_stamp value compares with the ts_comp_val[31:0] and the length value is non-zero. The TS_COMP rising edge occurs three RCLK periods after the values compare. A timestamp compare event is pushed into the event FIFO when TS_COMP is asserted. The polarity of the TS_COMP output is determined by the ts_polarity bit. The output is asserted low when the polarity bit is low.
</p><p><br /><b>1.</b>  CPTS Driver PPS Initialization
</p>
<ul><li>The driver enables its pps support capability when it registers itself to the Linux PTP layer.</li></ul>
<ul><li>Upon getting the pps support information from CPTS driver, the Linux PTP layer registers CPTS as a pps source with the Linux PPS layer. Doing so allows user applications to manage the PPS source by using Linux standard API.</li></ul>
<p><br /><b>2.</b>  CPTS Driver PPS Operation
</p>
<ul><li>Upon CPTS pps being enabled by user application, the driver programs the TS_COMP_VAL for a pulse to be generated at the next (absolute) 1 second boundary. The TS_COMP_VAL to be programmed is calculated based on the reference clock frequency.</li></ul>
<ul><li>Driver polls the CPTS event FIFO 5 times a second to retrieve the timestamp compare event of an asserted TS_COMP output signal.</li></ul>
<ul><li>The driver reloads the TS_COMP_VAL register with a value equivalent to one second from the timestamp value of the retrieved event.</li></ul>
<ul><li>The event is also reported to the Linux PTP layer which in turn reports to the PPS layer.</li></ul>
<p><br /><b>3.</b>  PPS User Application
</p>
<ul><li>Enabling CPTS PPS by using standard Linux ioctl PTP_ENABLE_PPS</li></ul>
<pre>  Example (<a href="#CPTS_References">Reference</a> ii: Documentation/ptp/testptp.c):
</pre>
<pre>     fd = open("/dev/ptp0", O_RDWR);
     ...
</pre>
<pre>     if (ioctl(fd, PTP_ENABLE_PPS, 1))
          perror("PTP_ENABLE_PPS");
     else
          puts("pps for system time enable okay");
</pre>
<pre>     if (ioctl(fd, PTP_ENABLE_PPS, 0))
          perror("PTP_ENABLE_PPS");
     else
          puts("pps for system time disable okay");
</pre>
<p><br />
</p>
<ul><li>Reading PPS last timstamp by using standard Linux ioctl PPS_FETCH</li></ul>
<pre>  Example (<a href="#CPTS_References">Reference</a> iii: linuxptp-1.2/phc2sys.c)
</pre>
<pre>     ...
     struct pps_fdata pfd;
</pre>
<pre>     pfd.timeout.sec = 10;
     pfd.timeout.nsec = 0;
     pfd.timeout.flags = ~PPS_TIME_INVALID;
     if (ioctl(fd, PPS_FETCH, &amp;pfd)) {
     	pr_err("failed to fetch PPS:&#160;%m");
     	return 0;
     }
</pre>
<pre>     ...
</pre>
<p><br />
</p>
<ul><li>Enabling PPS from sysfs</li></ul>
<dl><dd><ul><li>The Linux PTP layer provides a sysfs for enabling/disabling PPS.</li></ul></dd></dl>
<pre>      $ cat /sys/devices/soc.0/2090000.netcp/ptp/ptp0/pps_available
      1
      $ echo 1 &gt; /sys/devices/soc.0/2090000.netcp/ptp/ptp0/pps_enable
</pre>
<p><br />
</p>
<ul><li>Sysfs Provided by Linux PPS Layer (see <a href="#CPTS_References">Reference</a> v for more details)</li></ul>
<dl><dd><ul><li>The Linux PPS layer implements a new class in the sysfs for supporting PPS.</li></ul></dd></dl>
<pre>      $ ls /sys/class/pps/
      pps0/
      $
      $ ls /sys/class/pps/pps0/
      assert	clear  echo  mode  name  path  subsystem@  uevent
</pre>
<dl><dd><ul><li>Inside each "assert" you can find the timestamp and a sequence number:</li></ul></dd></dl>
<pre>      $ cat /sys/class/pps/pps0/assert
      1170026870.983207967#8
</pre>
<pre>      where before the "#" is the timestamp in seconds; after it is the sequence number.
</pre>
<p><br />
</p><p><b>4.</b>  Effects of Clock Adjustments on PPS
</p><p>The user application calls the API functions clock_adjtime() or clock_settime() to inform the CPTS driver about any clock adjustment as a result of running the PTP protocol. The PPS may also need to be adjusted by the driver accordingly.
</p><p>See <b>Clock Adjustments</b> in the <a href="#CPTS_User">CPTS User</a> section for more details on clock adjustments.
</p>
<ul><li>Shifting Time</li></ul>
<dl><dd>The user application informs CPTS driver of the shifts the clock by calling clock_adjtime() with a flag ADJ_SETOFFSET.</dd></dl>
<dl><dd>Shifting time may result in shifting the 1 second boundary. As such the driver recalculates the TS_COMP_VAL for the next pulse in order to align the pulse with the 1 second boundary after the shift.</dd></dl>
<pre>  Example 1. Positive Shift
</pre>
<pre>  Assuming a reference clock with freq = 100 Hz and the cpts counter is 1208
  at the 10-th second (sec-10).
</pre>
<pre>  If no shifting happens, a pulse is asserted according to the following
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1508   13      ^
  1608   14      ^
  1708   15      ^
  .
  .
  .
</pre>
<pre>  Suppose a shift of +0.25 sec occurs at cntr=1458
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.5                &lt;- adjtime(ADJ_SETOFFSET, +0.25 sec)
  1508   13
  1608   14
  1708   15
  .
  .
  .
</pre>
<pre>  Instead of going out at cntr=1508 (which was sec-13 but is now sec-13.25 after
  the shift), a pulse will go out at cntr=1583 (or sec-14) after the
  re-alignment at the 1-second boundary.
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.75             (after +0.25 sec shift)
  1483   13
  1508   13.25             (realign orig pulse to cntr=1583)
  1583   14      ^
  1608   14.25
  1683   15      ^
  1708   15.25
  .
  .
  .
</pre>
<p><br />
</p>
<pre>  Example 2. Negative Shift
</pre>
<pre>  Assuming a reference clock with freq = 100 Hz and the cpts counter is 1208
  at the 10-th second (sec-10).
</pre>
<pre>  If no shifting happens, a pulse is asserted according to the following
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1508   13      ^
  1608   14      ^
  1708   15      ^
  .
  .
  .
</pre>
<pre>  Suppose a shift of -3.25 sec occurs at cntr=1458
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.5                &lt;- adjtime(ADJ_SETOFFSET, -3.25 sec)
  1508   13
  1608   14
  1708   15
  .
  .
  .
</pre>
<pre>  Instead of going out at cntr=1508 (which was sec-13 but is now sec-9.75
  after the shift), a pulse will go out at cntr=1533 (or sec-10) after the
  re-alignment at the 1-second boundary.
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   9.25             (after -3.25 sec shift)
  1508   9.75             (realign orig pulse to cntr=1533)
  1533   10      ^
  1558   10.25
  1608   10.75
  1633   11      ^
  1658   11.25
  1708   11.75
  .
  .
  .
</pre>
<dl><dd>Remark: If a second time shift is issued before the next re-aligned pulse is asserted after the first time shift, shifting of the next pulse can be accumulated.</dd></dl>
<pre>  Example 3. Accumulated Pulse Shift
</pre>
<pre>  Assuming a reference clock with freq = 100 Hz and the cpts counter is 1208
  at the 10-th second (sec-10).
</pre>
<pre>  If no shifting happens, a pulse is asserted according to the following
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1508   13      ^
  1608   14      ^
  1708   15      ^
  .
  .
  .
</pre>
<pre>  Suppose a shift of +0.25 sec occurs at cntr=1458
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.5                &lt;- adjtime(ADJ_SETOFFSET, +0.25 sec)
  1508   13
  1608   14
  1708   15
  .
  .
  .
</pre>
<pre>  Instead of going out at cntr=1508 (which was sec-13 but is now sec-13.25 after
  the shift), a pulse will go out at cntr=1583 (or sec-14) after the
  re-alignment at the 1-second boundary.
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.75             (after +0.25 sec shift)
  1483   13
  1508   13.25             (realign orig pulse to cntr=1583)
  1583   14      ^
  1608   14.25
  1683   15      ^
  1708   15.25
  .
  .
  .
</pre>
<p><br />
</p>
<pre>  Suppose another +0.25 sec time shift is issued at cntr=1533 before the
  re-align pulse at cntr=1583 is asserted.
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.75
  1483   13
  1508   13.25
  1533   13.5              &lt;- adjtime(ADJ_SETOFFSET, +0.25 sec)
  1583   14
  1608   14.25
  1683   15
  1708   15.25
  .
  .
  .
</pre>
<p><br />
</p>
<pre>  In this case the scheduled pulse at cntr=1583 is further shifted to cntr=1658.
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.75
  1483   13
  1508   13.25
  1533   13.75              (after +0.25 sec shift)
  1583   14.25
  1608   14.5
  1658   15      ^          (realign the cntr-1583-pulse to cntr=1658)
  1683   15.25
  1708   15.5
  1758   16      ^
  .
  .
  .
</pre>
<p><br />
</p>
<ul><li>Setting Time</li></ul>
<dl><dd>The user application may set the internal timecounter kept by the CPTS driver by calling clock_settime().</dd></dl>
<dl><dd>Setting time may result in changing the 1-second boundary. As such the driver recalculates the TS_COMP_VAL for the next pulse in order to align the pulse with the 1 second boundary after the shift. The TS_COMP_VAL recalculation is similar to shifting time.</dd></dl>
<pre>  Example.
</pre>
<pre>  Assuming a reference clock with freq = 100 Hz and the cpts counter is 1208
  at the 10-th second (sec-10).
</pre>
<pre>  If no time setting happens, a pulse is asserted according to the following
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1508   13      ^
  1608   14      ^
  1708   15      ^
  .
  .
  .
</pre>
<pre>  Suppose at cntr=1458, time is set to 100.25 sec
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.5                &lt;- settime(100.25 sec)
  1508   13
  1608   14
  1708   15
  .
  .
  .
</pre>
<pre>  Instead of going out at cntr=1508 (which was sec-13 but is now sec-100.75 after
  the shift), a pulse will go out at cntr=1533 (or sec-101) after the
  re-alignment at the 1-second boundary.
</pre>
<pre>        (abs)
  cntr   sec      pulse
  ----   ---      -----
  1208   10        ^
  1308   11        ^
  1408   12        ^
  1458   100.25            (after setting time to 100.25 sec)
  1508   100.75            (realign orig pulse to cntr=1533)
  1533   101       ^
  1608   101.75
  1633   102       ^
  1708   102.75
  1733   103       ^
  .
  .
  .
</pre>
<ul><li>Changing Reference Clock Frequency</li></ul>
<dl><dd>The user application informs the CPTS driver of the changes of the reference clock frequency by calling clock_adjtime() with a flag ADJ_FREQUENCY.</dd></dl>
<dl><dd>In this case, the driver re-calculates the TS_COMP_VAL value for the next pulse, and the following pulses, based on the new frequency.</dd></dl>
<pre>  Example.
</pre>
<pre>  Assuming a reference clock with freq = 100 Hz and the cpts counter is 1208
  at the 10-th second (sec-10).
</pre>
<pre>  If no time setting happens, a pulse is asserted according to the following
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1508   13      ^
  1608   14      ^
  1708   15      ^
  .
  .
  .
</pre>
<pre>  Suppose at cntr=1458, reference clock freq is changed to 200Hz
</pre>
<pre>  *** Remark: The change to 200Hz is only for illustration.  The
              change should usually be parts-per-billion or ppb.
</pre>
<pre>        (abs)
  cntr   sec    pulse
  ----   ---    -----
  1208   10      ^
  1308   11      ^
  1408   12      ^
  1458   12.5                &lt;- adjtime(ADJ_FREQUENCY, +100Hz)
  1508   13
  1608   14
  1708   15
  .
  .
  .
</pre>
<pre>  Instead of going out at cntr=1508 (which was sec-13 but is now sec-12.75 after
  the freq change), a pulse will go out at cntr=1558 (or sec-13 in the new freq)
  after the re-alignment at the 1-second boundary.
</pre>
<pre>        (abs)
  cntr   sec      pulse
  ----   ---      -----
  1208   10        ^
  1308   11        ^
  1408   12        ^
  1458   12.5              (after freq changed to 200Hz)
  1508   12.75             (realign orig pulse to cntr=1558)
  1558   13        ^
  1608   13.25
  1658   13.5
  1708   13.75
  1758   14        ^
  .
  .
  .
</pre>
<h6><span class="mw-headline" id="CPTS_Hardware_Timestamp_Push">CPTS Hardware Timestamp Push</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=97" title="Edit section: CPTS Hardware Timestamp Push">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>There are eight hardware time stamp inputs (HW1/8_TS_PUSH) that can cause hardware time stamp push events to be loaded into the event FIFO.  The CPTS driver supports the reporting of such timestamps by using the PTP EXTTS feature of the Linux PTP infrastructure.
</p><p><br />
User applications can request such timestamps through ioctl() and read() function calls.
</p><p><br />
</p>
<pre>   Example (<a href="#CPTS_References">Reference</a> ii: Documentation/ptp/testptp.c):
</pre>
<pre>       struct ptp_extts_event event;
       struct ptp_extts_request extts_request;
</pre>
<pre>       /* which pin to get timestamp from, index is 0 based */
       extts_request.index = 3;
       extts_request.flags = PTP_ENABLE_FEATURE;
</pre>
<pre>       fd = open("/dev/ptp0", O_RDWR);
</pre>
<pre>       /* enabling */
       ioctl(fd, PTP_EXTTS_REQUEST, &amp;extts_request);
</pre>
<pre>       /* reading timestamps */
       for (i=0; i &lt; 10; i++) {
               read(fd, &amp;event, sizeof(event));
               printf("event index&#160;%u at&#160;%lld.%09u\n", event.index,
                       event.t.sec, event.t.nsec);
       }
</pre>
<pre>       /* disabling */
       extts_request.flags = 0;
       ioctl(fd, PTP_EXTTS_REQUEST, &amp;extts_request);
</pre>
<p><br />
</p><p><b>Testing HW_TS_PUSH on Keystone2 (K2HK) EVM</b>
</p><p>Note: On K2HK EVM, only two HW_TS_PUSH pins are brought out. These are HW3_TS_PUSH and HW4_TS_PUSH.  Refer to K2HK schematic for more details.
</p><p>To use the TS_COMP_OUT signal to test HW_TS_PUSH:
</p>
<ol><li>Connect jumper pins CN17-5 (TSCOMPOUT_E) and CN17-3 (TSPUSHEVt0)</li>
<li>Connect pins CN3-114 (TSPUSHEVt0) and CN3-109 (TSPUSHEVt0_E).  A ZX102-QSH 060-ST card is needed.</li>
<li>Modify testptp.c to "extts_request.index = 3", ie. reading timestamp from HW4_TS_PUSH pin</li>
<li>Compile testptp</li>
<li>Bootup K2HK Linux kernel</li>
<li>Under Linux prompt, issue "echo 1 &gt; /sys/devices/soc.0/2090000.netcp/ptp/ptp0/pps_enable" to generate TS_COMP_OUT signals.</li>
<li>Under Linux prompt, issue "./testptp -e 10" to read the HW4_TS_PUSH timestamps.</li></ol>
<p><br />
</p>
<h6><span class="mw-headline" id="CPTS_References">CPTS References</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=98" title="Edit section: CPTS References">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>i. <a rel="nofollow" class="external text" href="http://www.mjmwired.net/kernel/Documentation/networking/timestamping/timestamping.c">Linux Documentation Timestamping Test</a>
</p><p>ii. <a rel="nofollow" class="external text" href="http://www.mjmwired.net/kernel/Documentation/ptp/testptp.c">Linux Documentation PTP Test</a>
</p><p>iii. <a rel="nofollow" class="external text" href="http://linuxptp.sourceforge.net/">Open Source Project linuxptp</a>
</p><p>iv. <a rel="nofollow" class="external text" href="http://ptpd.sourceforge.net/">Open Source Project ptpd</a>
</p><p>v. <a rel="nofollow" class="external text" href="http://www.mjmwired.net/kernel/Documentation/pps/pps.txt">Linux Documentation PPS</a>
</p><p>vi. <a rel="nofollow" class="external text" href="https://github.com/ago/pps-tools">Linux pps-tools</a>
</p>
<h5><span class="mw-headline" id="Quality_of_Service">Quality of Service</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=99" title="Edit section: Quality of Service">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The linux hardware queue driver will download the Quality of Service Firmware to PDSP 1 of QMSS. PDSP 0 has accumulator firmware.
</p><p>The firmware will be programmed by the linux keystone hardware queue QoS driver.
</p><p>The configuration of the firmware is done with the help of device tree bindings. These bindings are documented in the kernel itself at <b>Documentation/devicetree/bindings/hwqueue/keystone-qos.txt</b>
</p>
<h6><span class="mw-headline" id="QoS_Tree_Configuration">QoS Tree Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=100" title="Edit section: QoS Tree Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The QoS implementation allows for an abstracted tree of scheduler nodes represented in device tree form. An example is depicted below
</p><p><br /><a href="File_Qos-tree.html" class="image"><img alt="Qos-tree.jpg" src="https://processors.wiki.ti.com/images/1/11/Qos-tree.jpg" width="521" height="292" /></a>
</p><p><br />At each node, shaping and dropping parameters may be specified, within limits of the constraints outlined in this document. The following sections detail the device tree attributes applicable for this implementation.
</p><p>The actual qos tree configuration can be found at linux/arch/arm/boot/dts/tci6638-evm.dts.
</p><p>The device tree has attributes for configuring the QoS shaper. In the sections below we explain the various qos specific attributes which can be used to setup and configure a QoS shaper.
</p><p>In the device tree we are setting up a shaper that is depicted below
</p><p><br />
</p><p><a href="File_Qos-new-shaper.html" class="image"><img alt="Qos-new-shaper.jpg" src="https://processors.wiki.ti.com/images/f/f7/Qos-new-shaper.jpg" width="804" height="501" /></a>
</p><p><br />When egress shaper is enabled, all packets will be sent to the QoS firmware for shaping via a set of the queues starting from the Q0S base queue which is 8000 by default. DSCP value in the IP header(outer IP incase of IPSec tunnels) or VLAN pbits (if VLAN interface) are used to determine the QoS queue to which the packet is sent. E.g., if the base queue is 8000, if the DSCP value is 46, the packet will be sent to queue number 8046. i.e., base queue number + DSCP value Incase of VLAN interfaces, if the pbit is 7, the packet will be sent to queue number 8071. i.e., base queue number + skip 64 queues used for DSCP + pbit value.
</p><p><br />
</p><p><a href="File_Shaper-config-details.html" class="image"><img alt="Shaper-config-details.jpg" src="https://processors.wiki.ti.com/images/e/e3/Shaper-config-details.jpg" width="902" height="618" /></a>
</p>
<h6><span class="mw-headline" id="QoS_Node_Attributes">QoS Node Attributes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=101" title="Edit section: QoS Node Attributes">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The following attributes are recognized within QoS configuration nodes:
</p>
<ul><li><b>"strict-priority" and "weighted-round-robin"</b></li></ul>
<p>e.g. strict-priority;
</p><p>This attribute specifies the type of scheduling performed at a node. It is an error to specify both of these attributes in a particular node. The absence of both of these attributes defaults the node type to unordered(first come first serve).
</p><p><br />
</p>
<ul><li><b>"weight"</b></li></ul>
<p>e.g. weight = &lt;80&gt;;
</p><p>This attribute specifies the weight attached to the child node of a weighted-round-robin node. It is an error to specify this attribute on a node whose parent is not a weighted-round-robin node.
</p><p><br />
</p>
<ul><li><b>"priority"</b></li></ul>
<p>e.g. priority = &lt;1&gt;;
</p><p>This attribute specifies the priority attached to the child node of a strict-priority node. It is an error to specify this attribute on a node whose parent is not a strict-priority node. It is also an error for child nodes of a strict-priority node to have the same priority specified.
</p><p><br />
</p>
<ul><li><b>"byte-units" or "packet-units"</b></li></ul>
<p>e.g. byte-units;
</p><p>The presence of this attribute indicates that the scheduler accounts for traffic in byte or packet units. If this attribute is not specified for a given node, the accounting mode is inherited from its parent node. If this attribute is not specified for the root node, the accounting mode defaults to byte units.
</p><p><br />
</p>
<ul><li><b>"output-rate"</b></li></ul>
<p>e.g. output-rate = &lt;31250000 25000&gt;;
</p><p>The first element of this attribute specifies the output shaped rate in bytes/second or packets/second (depending on the accounting mode for the node). If this attribute is absent, it defaults to infinity (i.e., no shaping). The second element of this attribute specifies the maximum accumulated credits in bytes or packets (depending on the accounting mode for the node). If this attribute is absent, it defaults to infinity (i.e., accumulate as many credits as possible).
</p><p><br />
</p>
<ul><li><b>"overhead-bytes"</b></li></ul>
<p>e.g. overhead-bytes = &lt;24&gt;;
</p><p>This attribute specifies a per-packet overhead (in bytes) applied in the byte accounting mode. This can be used to account for framing overhead on the wire. This attribute is inherited from parent nodes if absent. If not defined for the root node, a default value of 24 will be used. This attribute is passed through by inheritence (but ignored) on packet accounted nodes.
</p><p><br />
</p>
<ul><li><b>"output-queue"</b></li></ul>
<p>e.g. output-queue = &lt;645&gt;;
</p><p>This specifies the QMSS queue on which output packets are pushed. This attribute must be defined only for the root node in the qos tree. Child nodes in the tree will ignore this attribute if specified.
</p><p><br />
</p>
<ul><li><b>"input-queues"</b></li></ul>
<p>e.g. input-queues = &lt;8010 8065&gt;;
</p><p>This specifies a set of ingress queues that feed into a QoS node. This attribute must be defined only for leaf nodes in the QoS tree. Specifying input queues on non-leaf nodes is treated as an error. The absence of input queues on a leaf node is also treated as an error.
</p><p><br />
</p>
<ul><li><b>"stats-class"</b></li></ul>
<p>e.g. stats-class = "linux-best-effort";
</p><p>The stats-class attribute ties one or more input stage nodes to a set of traffic statistics (forwarded/discarded bytes, etc.). The system has a limited set of statistics blocks (up to 48), and an attempt to exceed this count is an error. This attribute is legal only for leaf nodes, and a stats-class attribute on an intermediate node will be treated as an error.
</p><p><br />
</p>
<ul><li><b>"drop-policy"</b></li></ul>
<p>e.g. drop-policy = "no-drop"
</p><p>The drop-policy attribute specifies a drop policy to apply to a QoS node (tail drop, random early drop, no drop, etc.) when the traffic pattern exceeds specifies parameters. The drop-policy parameters are configured separately within device tree (see "Traffic Police Policy Attributes section below). This attribute defaults to "no drop" for applicable input stage nodes. If a node in the QoS tree specifies a drop-policy, it is an error if any of its descendent nodes (children, children of children, ...) are of weighted-round-robin or strict-priority types.
</p>
<h6><span class="mw-headline" id="Traffic_Police_Policy_Attributes">Traffic Police Policy Attributes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=102" title="Edit section: Traffic Police Policy Attributes">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The following attributes are recognized within traffic drop policy nodes:
</p><p><br />
</p>
<ul><li><b>"byte-units" or "packet-units"</b></li></ul>
<p>e.g. byte-units;
</p><p>The presence of this attribute indicates that the dropr accounts for traffic in byte or packet units. If this attribute is not specified, it defaults to byte units. Policies that use random early drop must be of byte unit type.
</p><p><br />
</p>
<ul><li><b>"limit"</b></li></ul>
<p>e.g. limit = &lt;10000&gt;;
</p><p>Instantaneous queue depth limit (in bytes or packets) at which tail drop takes effect. This may be specified in combination with random early drop, which operates on average queue depth (instead of instantaneous). The absence of this attribute, or a zero value for this attribute disables tail drop behavior.
</p><p><br />
</p>
<ul><li><b>"random-early-drop"</b></li></ul>
<p>e.g. random-early-drop = &lt;32768 65536 2 2000&gt;;
</p><p>The random-early-drop attribute specifies the following four parameters in order:
</p><p>low threshold: No packets are dropped when the average queue depth is below this threshold (in bytes). This parameter must be specified.
</p><p>high threshold: All packets are dropped when the average queue depth above this threshold (in bytes). This parameter is optional, and defaults to twice the low threshold.
</p><p>max drop probability: the maximum drop probability
</p><p>half-life: Specified in milli seconds. This is used to calculate the average queue depth. This parameter is optional and defaults to 2000.
</p>
<h6><span class="mw-headline" id="Sysfs_support">Sysfs support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=103" title="Edit section: Sysfs support">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The keystone hardware queue driver has sysfs support for statistics, drop policies and the tree configuration.
</p><p><br />
</p>
<pre>root@keystone-evm:/sys/devices/soc.0/hwqueue.8/qos-inputs-1# ls
drop-policies  qos-tree       statistics
root@keystone-evm:/sys/devices/soc.0/hwqueue.8/qos-inputs-1#
</pre>
<p>The above shows the location in the kernel where sysfs entries for the keystone hardware&#160;queue can be found. There are sysfs entries for&#160;the qos trees (qos-inuputs1, qos-tree-inputs2). Within the qos directory there are separate directories for statistics, drop-policies and the qos-tree&#160;itself.&#160; Each node in&#160;the tree is a&#160;separate directory entry, starting with&#160;the root&#160;(tip)&#160;entry.&#160;
</p><p><br />Statistics are displayed for each statistics class in the device tree. Four statistics are represented for each stats class.
</p>
<ul><li>bytes forwarded</li>
<li>bytes discarded</li>
<li>packets forwarded</li>
<li>packets discarded</li></ul>
<p><br />An example is depicted below
</p>
<pre>cat /sys/devices/soc.0/hwqueue.8/qos-inputs-1/statistics/linux-be/packets_forwarded
</pre>
<p>Drop policy configuration is also displayed for each drop policy. In the case of a drop policy, the parameters can also be changed. This is depicted below. Please note the the parameters that can be modified for tail drop are a subset of the parameters that can be modified for random early drop.
</p><p><br />
</p><p><br />The qos tree is reached via the <b>qos_tree </b>directory and its sub-directories.&#160; Each sub-directory entry may contain:
</p>
<ul><li>directory entries to reach the subtrees feeding this node</li>
<li>the input queues to this node (valid for leaf nodes only)</li>
<li>the output queue from this node</li>
<li>the output rate for the node. The current value can be shown by:&#160;&#160; "cat output_rate".&#160; The value can be modified by:&#160; <i>echo&#160;&#160;"&lt;val&gt;" &gt; output_rate</i></li>
<li>the overhead bytes parameter for the node.&#160; The current value can be shown by: "cat overhead_bytes". The value can be modified by:&#160; <i>echo&#160;"&lt;val&gt;" &gt; overhead_bytes<br /></i></li>
<li>burst size .&#160; The current value can be shown by: "cat burst_size". The value can be modified by: <i>echo "&lt;val&gt;" &gt; burst_size<br /></i></li>
<li>drop_policy . This is the name of the drop policy to be used.</li>
<li>stats_class associated with node.&#160; This is the name of stats class to be used</li>
<li>the priority of the node (for strict priority nodes only).&#160; The current value can be shown by: "cat priority". The value can be modified by:&#160; <i>echo "&lt;val&gt;" &#160;&gt; priority</i></li>
<li>weight&#160;: for wrr nodes.&#160; The current value can be shown by: "cat weight". The value can be modified by: <i>echo "&lt;val&gt;" &gt; weight<br /></i></li></ul>
<p><br />
</p>
<h6><span class="mw-headline" id="Debug_Filesystem_support">Debug Filesystem support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=104" title="Edit section: Debug Filesystem support">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Debug Filesystem(debugfs) support is also being provided for QoS support. To make use of debugfs support a user might have to mount a debugfs filesystem. This can be done by issuing the command.
</p>
<pre><b>mount -t debugfs debugfs /debug</b>
</pre>
<p><br />
The appropriate path and contents are shown below
</p><p><br />
</p>
<pre>root@keystone-evm:/debug/qos-1# ls
config_profiles  out_profiles     queue_configs    sched_ports
</pre>
<p>With the debugfs support we will be able to see the actual configuration of
</p>
<ul><li>QoS scheduler ports</li>
<li>Drop scheduler queue configs</li>
<li>Drop scheduler output profiles</li>
<li>Drop scheduler config profiles</li></ul>
<p><br />The QoS scheduler port configuration can be seen by issuing the command <b>cat /debug/qos/sched_ports</b>. This is shown below
</p>
<pre>root@keystone-evm:/debug/qos-1# cat sched_ports
port 14
unit flags 15 group # 1 out q 8171 overhead bytes 24 throttle thresh 2500 cir credit 5120000 cir max
51200000
total q's 4 sp q's 0 wrr q's 4
queue 0 cong thresh 0 wrr credit 6144000
queue 1 cong thresh 0 wrr credit 6144000
queue 2 cong thresh 0 wrr credit 6144000
queue 3 cong thresh 0 wrr credit 6144000
</pre>
<pre>port 15
unit flags 15 group # 1 out q 8170 overhead bytes 24 throttle thresh 2500 cir credit 5120000 cir max
51200000
total q's 4 sp q's 0 wrr q's 4
queue 0 cong thresh 0 wrr credit 6144000
queue 1 cong thresh 0 wrr credit 6144000
queue 2 cong thresh 0 wrr credit 6144000
queue 3 cong thresh 0 wrr credit 6144000
</pre>
<pre>port 16
unit flags 15 group # 1 out q 8169 overhead bytes 24 throttle thresh 2500 cir credit 5120000 cir max
51200000
total q's 4 sp q's 0 wrr q's 4
queue 0 cong thresh 0 wrr credit 6144000
queue 1 cong thresh 0 wrr credit 6144000
queue 2 cong thresh 0 wrr credit 6144000
queue 3 cong thresh 0 wrr credit 6144000
</pre>
<pre>port 17
unit flags 15 group # 1 out q 8168 overhead bytes 24 throttle thresh 2500 cir credit 5120000 cir max
51200000
total q's 4 sp q's 0 wrr q's 4
queue 0 cong thresh 0 wrr credit 6144000
queue 1 cong thresh 0 wrr credit 6144000
queue 2 cong thresh 0 wrr credit 6144000
queue 3 cong thresh 0 wrr credit 6144000
</pre>
<pre>port 18
unit flags 15 group # 1 out q 8173 overhead bytes 24 throttle thresh 2500 cir credit 5120000 cir max
51200000
total q's 4 sp q's 0 wrr q's 4
queue 0 cong thresh 0 wrr credit 2457600
queue 1 cong thresh 0 wrr credit 4915200
queue 2 cong thresh 0 wrr credit 7372800
queue 3 cong thresh 0 wrr credit 9830400
</pre>
<pre>port 19
unit flags 15 group # 1 out q 645 overhead bytes 24 throttle thresh 3125 cir credit 6400000 cir max
51200000
total q's 3 sp q's 3 wrr q's 0
queue 0 cong thresh 0 wrr credit 0
queue 1 cong thresh 0 wrr credit 0
queue 2 cong thresh 0 wrr credit 0
</pre>
<pre>root@keystone-evm:/debug/qos-1#
</pre>
<p><br />cat command can be used in a similar way for displaying the Drop scheduler queue configs, output profiles and config profiles
</p><p><br />
</p>
<h6><span class="mw-headline" id="Configuring_QoS_on_an_1-GigE_interface">Configuring QoS on an 1-GigE interface</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=105" title="Edit section: Configuring QoS on an 1-GigE interface">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>To configure QoS on an interface, several definitions must be added to the device tree:
</p>
<ul><li>Drop policies and a QoS tree must be defined. The outer-most QoS block must specify an output queue number; this may be the 1-GigE NETCP's PA PDSP 5 (645) or CPSW (648), one of the 10-GigE CPSW's queues (8752, 8753), or other queue as appropriate.</li></ul>
<pre>Example (k2hk-evm.dts):
</pre>
<pre>droppolicies: default-drop-policies {
        no-drop {
                default;
                packet-units;
                limit = &lt;0&gt;;
        };
        ...
        all-drop {
                byte-units;
                limit = &lt;0&gt;;
        };
};
</pre>
<pre>Example (k2hk-evm.dts):
</pre>
<pre>qostree: qos-tree {
        strict-priority;                /* or weighted-round-robin */
        byte-units;                     /* packet-units or byte-units */
        output-rate = &lt;31250000 25000&gt;;
        overhead-bytes = &lt;24&gt;;          /* valid only if units are bytes */
        output-queue = &lt;645&gt;;           /* allowed only on root node */
</pre>
<pre>        high-priority {
                ...
        }
        ...
        best-effort {
                ...
        };
};
</pre>
<pre>qostree2: qos-tree-2 {
        strict-priority;                /* or weighted-round-robin */
        byte-units;                     /* packet-units or byte-units */
        output-rate = &lt;31250000 25000&gt;;
        overhead-bytes = &lt;24&gt;;          /* valid only if units are bytes */
        output-queue = &lt;648&gt;;           /* allowed only on root node */
</pre>
<pre>        high-priority {
                ...
        }
        ...
        best-effort {
                ...
        };
};
</pre>
<ul><li>QoS inputs must be defined to the hwqueue subsystem. The QoS inputs block defines which group of hwqueues will be used, and links to the set of drop policies and QoS tree to be used.</li></ul>
<pre>Example (k2hk-evm.dts):
</pre>
<pre>hwqueue0: hwqueue@2a40000 {
        ...
        queues {
                ...
                qos-inputs-1 {
                        values                  = &lt;8000 192&gt;;
                        pdsp-id                 = &lt;3&gt;;
                        ...
                        drop-policies           = &lt;&amp;droppolicies&gt;;
                        qos-tree                = &lt;&amp;qostree&gt;;
                        reserved;
                };
                qos-inputs-2 {
                        values                  = &lt;6400 192&gt;;
                        pdsp-id                 = &lt;7&gt;;
                        ...
                        drop-policies           = &lt;&amp;droppolicies&gt;;
                        qos-tree                = &lt;&amp;qostree2&gt;;
                        reserved;
                };
        };
}; /* hwqueue0 */
</pre>
<ul><li>A PDSP must be defined, and loaded with the QoS firmware.</li></ul>
<pre>Example (k2hk-evm.dts):
</pre>
<pre>hwqueue0: hwqueue@2a40000 {
       ...
       pdsps {
               ...
               pdsp3@0x2a13000 {
                       firmware = "keystone/qmss_pdsp_qos_k2_le_2_0_1_5.fw";
                       ...
                       id = &lt;3&gt;;
               };
               pdsp7@0x2a17000 {
                       firmware = "keystone/qmss_pdsp_qos_k2_le_2_0_1_5.fw";
                       ...
                       id = &lt;7&gt;;
               };
       };
}; /* hwqueue0 */
</pre>
<ul><li>A Packet DMA channel must be defined and associated with each of the QoS input queues</li></ul>
<pre>Example (k2hk-evm.dts):
</pre>
<pre>padma: pktdma@2004000 {
         ...
         channels {
                ...
                qos0 {
                        transmit;
                        label           = "qos0";
                        pool            = "pool-net";
                        submit-queue    = &lt;8072&gt;;
                        ...
                };
                ...
                qos5 {
                        transmit;
                        label           = "qos5";
                        pool            = "pool-net";
                        submit-queue    = &lt;8077&gt;;
                        complete-queue  = &lt;8707&gt;;
                        ...
                };
                qos6 {
                        transmit;
                        label           = "qos6";
                        pool            = "pool-net";
                        submit-queue    = &lt;6472&gt;;
                        ...
                };
                ...
                qos11 {
                        transmit;
                        label           = "qos11";
                        pool            = "pool-net";
                        submit-queue    = &lt;6477&gt;;
                        complete-queue  = &lt;8708&gt;;
                        ...
                };
        };
};
</pre>
<ul><li>A NETCP QoS block must be defined. For each interface and "interface-x" block is defined, which contains definitions for each of the QoS input DMA channels to be associated with that interface.</li></ul>
<pre>Example (k2hk-evm.dts):
</pre>
<pre>netcp: netcp@2090000 {
        ...
        qos: qos@0 {
                label = "keystone-qos";
                multi-interface;
</pre>
<pre>                interface-0 {
                        chan-0 {
                                tx-channel = "qos0";
                                tx_queue_depth = &lt;64&gt;;
                        };
                        ...
                        chan-5 {
                                tx-channel = "qos5";
                                tx_queue_depth = &lt;64&gt;;
                        };
                };
                interface-1 {
                        chan-0 {
                                tx-channel = "qos6";
                                tx_queue_depth = &lt;64&gt;;
                        };
                        ...
                        chan-5 {
                                tx-channel = "qos11";
                                tx_queue_depth = &lt;64&gt;;
                        };
                };
        };
};
</pre>
<ul><li>By default, Linux network traffic will be queued to the interface "chan-0" subqueue. To classify and route packets from Linux to specific QoS queues, the Linux traffic control utility "tc" must be used. First a class-full root queuing discipline must be established for the interface, and then filters may be used to classify packets. These filters can use the "skbedit queue_mapping" action to set the subqueue number for the packet. Here is an example:</li></ul>
<pre># Clear any existing configuration
tc qdisc del dev eth0 root
</pre>
<pre># Add DSMARK as the root qdisc
tc qdisc add dev eth0 root handle 1 dsmark indices 8 default_index 0
</pre>
<pre># Create filters to classify packets and route to queues
tc filter add dev eth0 parent 1:0 protocol ip prio 1 \
        u32 match ip dport 5002 0xffff \
        action skbedit queue_mapping 1
tc filter add dev eth0 parent 1:0 protocol ip prio 1 \
        u32 match ip dport 5003 0xffff \
        action skbedit queue_mapping 2
tc filter add dev eth0 parent 1:0 protocol ip prio 1 \
        u32 match ip dport 5004 0xffff \
        action skbedit queue_mapping 3
tc filter add dev eth0 parent 1:0 protocol ip prio 1 \
        u32 match ip dport 5005 0xffff \
        action skbedit queue_mapping 4
tc filter add dev eth0 parent 1:0 protocol ip prio 1 \
        u32 match ip dport 5006 0xffff \
        action skbedit queue_mapping 5
</pre>
<p>Please refer to the Linux Advanced Routing &amp; Traffic Control how-tos and related manpages available on the Internet for more information on "tc".
</p>
<h6><span class="mw-headline" id="Disabling_QoS_on_an_1-GigE_interface">Disabling QoS on an 1-GigE interface</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=106" title="Edit section: Disabling QoS on an 1-GigE interface">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The released "k2hk-evm.dts" file contains definitions for two QoS trees and associates them with the first two ports on the 1-GigE interface. These default trees are configured so that traffic queued to interface subqueue 0 will bypass the QoS tree. Only traffic specifically directed to subqueues 1-6 will be processed through the hardware QoS subsystem. This may be sufficient for your needs. However, you may prefer to remove the QoS configuration entirely from the device tree.
</p><p>To disable QoS on the two 1-GigE interfaces
</p>
<dl><dd><ul><li>delete all the qos related blocks or entries shown in the examples in section <a href="#Configuring_QoS_on_an_1-GigE_interface">Configuring QoS on an 1-GigE interface</a>, namely</li></ul>
<dl><dd><ul><li>droppolicies: default-drop-policies {...}</li>
<li>qostree: qos-tree {...}</li>
<li>qostree2: qos-tree-2 {...}</li>
<li>qos-inputs-1 {...}</li>
<li>qos-inputs-2 {...}</li>
<li>pdsp3@0x2a13000 {...}</li>
<li>pdsp7@0x2a17000 {...}</li>
<li>qos0 {...} to qos11 {...}</li>
<li>qos: qos@0 {...}</li></ul></dd></dl>
<ul><li>modify tx_data_queue_depth in the pa: pa@2000000 {...} block in k2hk-evm.dts to 256.</li></ul></dd></dl>
<h6><span class="mw-headline" id="Configuring_QoS_on_a_10-GigE_interface">Configuring QoS on a 10-GigE interface</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=107" title="Edit section: Configuring QoS on a 10-GigE interface">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The following snippets together shows how to remove the QoS tree associated with the second port of the 1-GigE interface
and associate it with the first port on the 10-GigE interface.  In these snippets, we only depict and highlight the modifications made to the above 1-GigE examples.  Contents not shown in the definitions should just be copy and paste from the file k2hk-evm.dts.
</p><p>Note: this is only for demonstration purpose and is not part of the release.
</p>
<ul><li>Modify the output-queue number of qostree2 to that of the transmit queue of the 10-GigE's first port.</li></ul>
<pre>qostree2: qos-tree-2 {
        strict-priority;                /* or weighted-round-robin */
        byte-units;                     /* packet-units or byte-units */
        output-rate = &lt;31250000 25000&gt;;
        overhead-bytes = &lt;24&gt;;          /* valid only if units are bytes */
        output-queue = &lt;<b>8752</b>&gt;;           /* allowed only on root node */
</pre>
<pre>        high-priority {
                ...
        }
        ...
        best-effort {
                ...
        };
};
</pre>
<ul><li>Remove qos6 to qos11 from padma's channels block.</li></ul>
<pre>padma: pktdma@2004000 {
         ...
         channels {
                ...
                qos0 {
                        transmit;
                        label           = "qos0";
                        pool            = "pool-net";
                        submit-queue    = &lt;8072&gt;;
                        ...
                };
                ...
                qos5 {
                        transmit;
                        label           = "qos5";
                        pool            = "pool-net";
                        submit-queue    = &lt;8077&gt;;
                        complete-queue  = &lt;8707&gt;;
                        ...
                };
                <b>/* qos6 - qos11 removed */</b>
        };
};
</pre>
<ul><li>Define qos6 to qos11 in xgedma's channels block.  This is a cut-and-paste of those defined in the padma block but with the pool name pool-<b>net</b> modified to pool-<b>xge</b>.</li></ul>
<pre>xgedma: pktdma@2fa1000 {
         ...
         channels {
                ...
                qos6 {
                        transmit;
                        label           = "qos6";
                        pool            = "pool-<b>xge</b>";
                        submit-queue    = &lt;6472&gt;;
                        ...
                };
                ...
                qos11 {
                        transmit;
                        label           = "qos11";
                        pool            = "pool-<b>xge</b>";
                        submit-queue    = &lt;6477&gt;;
                        complete-queue  = &lt;8708&gt;;
                        ...
                };
        };
};
</pre>
<ul><li>Remove interface-1 from netcp's qos block.</li></ul>
<pre>netcp: netcp@2090000 {
        ...
        qos: qos@0 {
                label = "keystone-qos";
                multi-interface;
</pre>
<pre>                interface-0 {
                        chan-0 {
                                tx-channel = "qos0";
                                tx_queue_depth = &lt;64&gt;;
                        };
                        ...
                        chan-5 {
                                tx-channel = "qos5";
                                tx_queue_depth = &lt;64&gt;;
                        };
                };
                <b>/* interface-1 removed */</b>
        };
};
</pre>
<p><br />
</p>
<ul><li>Define a qos block qos<b>x</b>: qos@0 {...} in 10-GigE's netcp block.  The chan-N content of this block is the same as those defined in the interface-1 of netcp's qos.</li></ul>
<pre>netcpx: netcp@2f00000 {
        ...
        qos<b>x</b>: qos@0 {
                label = "keystone-qos";
                multi-interface;
</pre>
<pre>                interface-0 {
                        chan-0 {
                                tx-channel = "qos6";
                                tx_queue_depth = &lt;64&gt;;
                        };
                        ...
                        chan-5 {
                                tx-channel = "qos11";
                                tx_queue_depth = &lt;64&gt;;
                        };
                };
        };
};
</pre>
<p><br />
</p>
<h5><span class="mw-headline" id="Crypto_Driver">Crypto Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=108" title="Edit section: Crypto Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Keystone SoC includes a hardware cryptographic accelerator engine also known as CP_ACE (Communication Processor Adaptive Cryptographic engine).
The CP_ACE subsystem is designed to provide packet security as part of IPSec, SRTP and 3GPP industry standards.
Keystone Linux kernel implements a crypto driver which offloads crypto algorithm processing to CP_ACE. Crypto driver registers algorithm implementations in the kernel's crypto algorithm management framework. Since the primary use case for this driver is IPSec ESP offload, it currently registers only AEAD algorithms. Following algorithms are supported by the driver:
</p>
<ol><li>authenc(hmac(sha1),cbc(aes))</li>
<li>authenc(hmac(sha1),cbc(des3-ede))</li>
<li>authenc(xcbc(aes),cbc(aes))</li>
<li>authenc(xcbc(aes),cbc(des3-ede))</li></ol>
<p>The driver code can be found in the files drivers/crypto/keystone-sa.[ch]
<br />
</p>
<h5><span class="mw-headline" id="USB_Driver">USB Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=109" title="Edit section: USB Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The USB 3.0 xHC controller supports the hardware part of the xHCI standard and is implemented with the Synopsys DesignWare core. Driver support of the hardware is provided by the generic usb driver code found in directories and files drivers/usb/, drivers/usb/host/xhci*.c and drivers/usb/dwc3/. Platform specific XHCI glue code is implemented in drivers/usb/dwc3/dwc3-keystone.c and drivers/usb/phy/phy-keystone.c. Currently only usb host mode is supported.
</p><p>K2E has 2 USB controllers, USB0 and USB1.  This USB driver supports both USB controllers simultaneously in host mode.  However, the USB connector for USB1 on K2E EVM is an USB 3.0 micro AB connector, adapter is needed for using it in host mode.  Because of that, the devicetree bindings for USB1 is disabled by default.  To enable the USB1 devicetree bindings, do one of the following:
</p>
<ul><li>Enabling K2E USB1 at Compile Time</li></ul>
<dl><dd>Update the <b>status</b> property of usb1_phy and usb1 bindings from "disabled" to "ok" in arch/arm/boot/dts/k2e.dtsi:
<dl><dd><dl><dd>usb1_phy: usb_phy@2620750 {
<dl><dd><b>status</b> = "<b>ok</b>";</dd></dl></dd>
<dd>};</dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><dl><dd>usb1: usb@25000000 {
<dl><dd><b>status</b> = "<b>ok</b>";</dd></dl></dd>
<dd>};</dd></dl></dd></dl></dd></dl>
<ul><li>Enabling K2E USB1 at Bootup Time</li></ul>
<dl><dd>Alternately, the above updates can be done right before kernel bootup through u-boot scripting.
<dl><dd><dl><dd>setenv run_fdt_usb1 'fdt addr ${addr_fdt}; fdt set /soc/usb_phy@2620750 status "ok"; fdt set /soc/usb@25000000 status "ok" '</dd>
<dd>setenv bootcmd 'run init_${boot} get_fdt_${boot} get_mon_${boot} get_kern_${boot} run_mon <b>run_fdt_usb1</b> run_kern'</dd></dl></dd></dl></dd></dl>
<p><br />
</p><p><br />
<br />
</p><p><br />
</p>
<h5><span class="mw-headline" id="10Gig_Ethernet_Driver">10Gig Ethernet Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=110" title="Edit section: 10Gig Ethernet Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The TI Keystone-2 platforms include a 10 Gig Ethernet Subsystem. The subsystem combines a 3-port ethernet switch sub-module and a packet DMA capable of 10Gbps and 1Gbps per ethernet port. The ethernet switch sub-module contains an EMAC module, SGMII modules, 10GBase-R module, SERDES module, MACSec module and MDIO module.
</p><p>The 10Gig Ethernet Driver makes use of the multi-instance support feature of the NETCP driver which serves as a hook to the Linux Network Stack. The 10Gig Ethernet Driver provides its API to the NETCP driver by registering itself to an instance of the NETCP driver during kernel initialization.
</p><p>Refer to the <a href="#Network_Driver">Network Driver</a> section for more details about the NETCP driver model. But notice that the packet accelerator in that section is not applicable to the 10Gig Ethernet subsystem.
</p><p>The 10Gig Ethernet Driver code can be found in files keystone_xgess.c, keystone_xgepcsr.c and keystone_xgemdio.c in directory drivers/net/ethernet/ti/.
</p><p><br />
For releases <b>before MCSDK 3.0.2</b> release, the 10Gig ethernet driver <b>was not tested due to lack of hardware</b>.  In those releases the driver is not included in the kernel default configuration. To enable the 10Gig Ethernet Driver, add the following two lines in file arch/arm/configs/keystone2_defconfig or arch/arm/configs/keystone2_fullrt_defconfig, and do a distclean build.
</p>
<pre>CONFIG_TI_KEYSTONE_XGE=y
CONFIG_TI_KEYSTONE_XGE_MDIO=y
</pre>
<p>Starting from MCSDK 3.0.2 release, the following lines are added to arch/arm/configs/keystone2_defconfig and arch/arm/configs/keystone2_fullrt_defconfig to enable 10Gig ethernet driver by default.
</p>
<pre>CONFIG_TI_KEYSTONE_XGE=y
CONFIG_MDIO_BITBANG=y
CONFIG_MDIO_GPIO=y
CONFIG_GPIO_PCA953X=y
</pre>
<h6><span class="mw-headline" id="Enabling_10Gig_Ethernet_Driver_Device_Tree_Bindings">Enabling 10Gig Ethernet Driver Device Tree Bindings</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=111" title="Edit section: Enabling 10Gig Ethernet Driver Device Tree Bindings">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Starting from MCSDK 3.1.0 release, the 10Gig related device tree bindings are disabled by default.  Depending on the link interface type, the 10Gig device tree bindings can be enabled for K2E and K2HK platforms at compile time or bootup time as follows.
</p><p><b>MAC-to-PHY Link Interface</b>
</p><p>For example, when a TI K2HK or K2E EVM is connected to a <b>RevA RTM-BOC with 10Gig PHY</b>.
</p>
<ul><li>Enabling 10Gig at Compile Time</li></ul>
<dl><dd>Update the <b>status</b> property of mdiox and netcpx bindings from "disabled" to "ok" in arch/arm/boot/dts/k2e-net.dtsi or arch/arm/boot/dts/k2hk-net.dtsi:
<dl><dd><dl><dd>mdiox0: mdiox {
<dl><dd><b>status</b> = "<b>ok</b>";</dd></dl></dd>
<dd>};</dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><dl><dd>netcpx: netcp@2f00000 {
<dl><dd><b>status</b> = "<b>ok</b>";</dd></dl></dd>
<dd>};</dd></dl></dd></dl></dd></dl>
<dl><dd>Also update the <b>status</b> property of pca@20 binding from "disabled" to "ok" in arch/arm/boot/dts/keystone.dtsi:</dd></dl>
<dl><dd><dl><dd><dl><dd>pca@20 {
<dl><dd><b>status</b> = "<b>ok</b>";</dd></dl></dd>
<dd>};</dd></dl></dd></dl></dd></dl>
<ul><li>Enabling 10Gig at Bootup Time</li></ul>
<dl><dd>Alternately, the above updates can be done right before kernel bootup through u-boot scripting.
<dl><dd><dl><dd>setenv run_fdt 'fdt addr ${addr_fdt}; fdt set /soc/i2c2/pca@20 status "ok"; fdt set /soc/netcp@2f00000 status "ok"; fdt set /soc/mdiox/ status "ok" '</dd>
<dd>setenv bootcmd 'run init_${boot} get_fdt_${boot} get_mon_${boot} get_kern_${boot} run_mon <b>run_fdt</b> run_kern'</dd></dl></dd></dl></dd></dl>
<p><b>MAC-to-MAC Link Interface</b>
</p><p>For example, when a TI K2HK or K2E EVM is connected to a <b>Rev.B/C RTM-BOC with Dual Retimer</b>.
</p>
<ul><li>Enabling 10Gig at Compile Time</li></ul>
<dl><dd>Update the <b>status</b> property of netcpx binding from "disabled" to "ok" and set each slave's <b>link-interface</b> type to 11 in arch/arm/boot/dts/k2e-net.dtsi or arch/arm/boot/dts/k2hk-net.dtsi:</dd></dl>
<dl><dd><dl><dd><dl><dd>netcpx: netcp@2f00000 {
<dl><dd><b>status</b> = "<b>ok</b>";</dd>
<dd>slaves {
<dl><dd>slave0 {
<dl><dd><b>link-interface</b>  = &lt;<b>11</b>&gt;;</dd>
<dd>phy-handle = &lt;&amp;phyx0&gt;;</dd></dl></dd>
<dd>};</dd>
<dd>slave1 {
<dl><dd><b>link-interface</b>  = &lt;<b>11</b>&gt;;</dd>
<dd>phy-handle = &lt;&amp;phyx1&gt;;</dd></dl></dd>
<dd>};</dd></dl></dd>
<dd>};</dd></dl></dd>
<dd>};</dd></dl></dd></dl></dd></dl>
<p>Note: The phy-handle in each slave node can optionally be removed.  phy-handle will not take effect when the link-interface is MAC-to-MAC.
</p>
<ul><li>Enabling 10Gig at Bootup Time</li></ul>
<dl><dd>Alternately, the above updates can be done right before kernel bootup through u-boot scripting.
<dl><dd><dl><dd>setenv run_fdt_1 'fdt addr ${addr_fdt}; fdt set /soc/netcp@2f00000 status "ok"'</dd>
<dd>setenv run_fdt_2 'fdt set /soc/netcp@2f00000/cpswx@2f00000/slaves/slave0 link-interface &lt;11&gt;'</dd>
<dd>setenv run_fdt_3 'fdt set /soc/netcp@2f00000/cpswx@2f00000/slaves/slave1 link-interface &lt;11&gt;'</dd>
<dd>setenv bootcmd 'run init_${boot} get_fdt_${boot} get_mon_${boot} get_kern_${boot} run_mon <b>run_fdt_1 run_fdt_2 run_fdt_3</b> run_kern'</dd></dl></dd></dl></dd></dl>
<p>The driver has been verified on Keystone K2HK and K2E EVMs connected to RevA RTM-BOC with 10Gig PHY or RevB RTM-BOC with Dual Retimer.
</p><p><br />
</p>
<h6><span class="mw-headline" id="Disabling_Support_of_10-GigE">Disabling Support of 10-GigE</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=112" title="Edit section: Disabling Support of 10-GigE">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>To disable the support of 10Gig ethernet,
</p>
<ul><li>Remove the 10-GigE configurations from the defconfig file arch/arm/configs/keystone2_defconfig or arch/arm/configs/keystone2_fullrt_defconfig</li>
<li>Remove the following bindings from the file arch/arm/boot/dts/k2hk-evm.dts</li></ul>
<dl><dd><dl><dd><ul><li>xge{...} and pool-xge {...} in hwqueue0</li>
<li>xgedma: pktdma@2fa1000 {...}</li>
<li>mdiox0: mdiox {...}</li>
<li>netcpx: netcp@2f00000 {...}</li></ul></dd></dl></dd></dl>
<h6><span class="mw-headline" id="Enabling_10G-KR_Firmware">Enabling 10G-KR Firmware</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=113" title="Edit section: Enabling 10G-KR Firmware">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Starting from MCSDK 3.1.4, 10G-KR firmware can be enabled for handling of auto-negotiation and link training.
</p>
<ul><li>Enabling firmware through DTS:</li></ul>
<dl><dd>Update the status property of the firmware and lane bindings from "disabled" to "ok" in arch/arm/boot/dts/k2e-net.dtsi or arch/arm/boot/dts/k2hk-net.dtsi:
<dl><dd><dl><dd>firmware {
<dl><dd><b>status</b> = "<b>ok</b>";</dd>
<dd>lane0 {
<dl><dd><b>status</b> = "<b>ok</b>";</dd></dl></dd>
<dd>};</dd>
<dd>lane1 {
<dl><dd><b>status</b> = "<b>ok</b>";</dd></dl></dd>
<dd>};</dd></dl></dd></dl></dd></dl></dd>
<dd>Additionally, configure the <b>link-interface</b> type to MAC-to-MAC using the above steps.</dd></dl>
<p>Refer to the keystone-serdes.txt under Documentation/ for more information on device tree options.
</p>
<h6><span class="mw-headline" id="10G-KR_Firmware_Usage_Notes">10G-KR Firmware Usage Notes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=114" title="Edit section: 10G-KR Firmware Usage Notes">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<ul><li>Due to constraints there are several usage notes concerning the firmware:</li></ul>
<ol><li>When autonegotiation occurs there is a reset asserted on the lane that affects the MAC layer and switch.
<ol><li>During a simultaneous boot of two devices they will sync and autonegotiate before the aforementioned layers are configured. There is no issue in this scenario.</li>
<li>If a single device is reset this will cause autonegotiation to occur again.  This will reset the lane of the device that stayed persistently on.  When this happens, re-program the MAC_CONTROL register for that lane, otherwise, an interface toggle using ifconfig is sufficient to reconfigure the interface back to a working state.</li></ol></li>
<li>When switching between a non-FW configuration and a FW configuration a POR is required.</li>
<li>Due to errata KeyStoneII.BTS_errata_advisory.29:10GbE PCS Causes Data Corruption, occasionally on link negotiation there may be high levels of packet loss.
<ol><li>The symptoms of this are high packet loss, CRC and alignment errors, and 0xff block errors in a small time period.</li>
<li>When this case is detected, you must reset the PCSR following the below procedure, where iBase is the base of the 10GE SerDes, 0x0231e000.</li></ol></li></ol>
<pre>void fPcsrLaneResetToggle(unsigned int iBase, int iLane)

{

	uint32_t *addr = (uint32_t *)(iBase + 0x01ff4);        //This function assumes no one else is playing with this register.
	uint32_t iOriginal,iTmp;

	iOriginal = *addr;                      //Read Current value
	iTmp = iOriginal;                       //Make a copy

	if (((iOriginal&gt;&gt;iLane)&amp;1)==0) return;  //No signal, the PCSR is held in reset!

	iTmp |= 0x00f0;                       //Set all continue bits
	*addr = iTmp;                         //Write out the register to set all lane signal continue bits
	iTmp  = *addr;                        //Read the register, Allows the cont_sd to propagate
	iTmp &amp;= ~(1&lt;&lt;(iLane + 4));            //Clear the lane Cont_SD bit
	iTmp |= 1&lt;&lt;16;                        //Set the wafter_sd bit, since all SD cont_bits are set already, a glitch will not be seen.
	*addr = iTmp;                         //Write out the register to clear lane signal detect
	iTmp  = *addr;                        //Read the register, Allows the cont_sd to propagate
	fSerdesSbCycleDelay(10000);	      //&gt;100nS wait.
	*addr = iOriginal;                    //Write the original value back to the register.
}
</pre>
<ol><li><ol><li>The firmware can be restarted by writing to CPU_CTRL register, POR_EN bit 29. Set this bit high, then set it low with at least 10ms in between.</li></ol></li></ol>
<ul><li>For helping with debugging there is a tool available called serdes_print. As of right now this is not on an external portal, so it will have to be requested.</li></ul>
<dl><dd><dl><dd>The options available in this utility are:</dd>
<dd>a   -print all.</dd>
<dd>b   -dump the tbus</dd>
<dd>p   -print 10Gb phyb memory.</dd>
<dd>m   -print serdes registers.</dd>
<dd>v   -print adaptation values.</dd>
<dd>x   -print 10Gb switch registers.</dd>
<dd>t   -print xdata history.</dd>
<dd>z   -do a program counter trace.</dd>
<dd><b>k   -print some KR status registers.</b></dd>
<dd>T   -print transmitter parameters.</dd>
<dd>R   -print receiver parameters.</dd></dl></dd></dl>
<p><br />
</p>
<h5><span class="mw-headline" id="PCIe_Driver">PCIe Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=115" title="Edit section: PCIe Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The TI Keystone platforms contain a PCIe module which supports a single bi-directional link interface with a maximum of two lanes width (x2). The module supports Root Complex and End Point operation modes.
</p><p>The PCIe driver implemented supports only the Root Complex (RC) operation mode on K2 platforms (K2HK, K2E). An irq-chip is implemented to support both legacy and MSI irqs. The driver's main implementation can be found in drivers/pci/host/pcie-keystone.c and platform specific code can be found at drivers/pci/host/k2-platform.c
</p><p>PCIe has been verified on K2E and K2HK EVMs. K2E supports two PCI ports. Port 0 is on Domain 0 and Port 1 is on Domain 1. On K2E EVM, a Marvel SATA controller, 0x9182 is connected to port 1 that supports interfacing with Hard disk drives (HDD). Following h/w setup is used to test SATA HDD interface with K2E. Western Digital 1.0 TB SATA / 64MB Cache hard disk drive, WD10EZEX is used for the test over PCI port 1.
</p><p><br />
</p>
<pre>-----------     SATA 6Gbps data cable    ------------
| WD10EZEX | --------------------------&gt; |  K2E EVM |
-----------                              ------------
       ^
       |
(External power supply)
</pre>
<p>Connect HDD to an external power supply. Connect the HDD SATA port to K2E EVM SATA port using a 6Gbps data cable and power on the HDD. Power On K2E EVM. The K2E rev 1.0.2.0 requires a hardware modification to get the SATA detection on the PCI bus. Please check with EVM hardware vendor for the details.
</p><p>At boot up, the PCI enumeration should display the SATA EP detection.
</p>
<pre>[341130.650587] keystone-pcie: Starting PCI scan, nr 0...
[341130.650728] PCI host bridge to bus 0001:00
[341130.650737] pci_bus 0001:00: root bus resource [mem 0x60000000-0x6fffffff]
[341130.650744] pci_bus 0001:00: root bus resource [io  0x4000-0x7fff]
[341130.650751] pci_bus 0001:00: No busn resource found for root bus, will use [bus 00-ff]
[341130.651003] PCI: bus0: Fast back to back transfers disabled
[341130.651011] pci 0001:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[341130.651519] PCI: bus1: Fast back to back transfers disabled
[341130.651548] keystone-pcie: Ending PCI scan...
[341130.651556] keystone-pcie: keystone_pcie_map_irq: slot 0, pin 1
[341130.651560] keystone-pcie: keystone_pcie_map_irq: legacy_irq 572
[341130.651570] keystone-pcie: keystone_pcie_map_irq: slot 0, pin 2
[341130.651574] keystone-pcie: keystone_pcie_map_irq: legacy_irq 573
[341130.651584] keystone-pcie: keystone_pcie_map_irq: slot 0, pin 1
[341130.651588] keystone-pcie: keystone_pcie_map_irq: legacy_irq 572
[341130.651597] keystone-pcie: keystone_pcie_map_irq: slot 0, pin 1
[341130.651601] keystone-pcie: keystone_pcie_map_irq: legacy_irq 608
[341130.651609] keystone-pcie: keystone_pcie_map_irq: slot 0, pin 1
[341130.651613] keystone-pcie: keystone_pcie_map_irq: legacy_irq 608
[341130.651631] pci 0001:00:00.0: BAR 8: assigned [mem 0x60000000-0x601fffff]
[341130.651639] pci 0001:00:00.0: BAR 9: assigned [mem 0x60200000-0x603fffff pref]
[341130.651647] pci 0001:00:00.0: BAR 7: assigned [io  0x4000-0x4fff]
[341130.651657] pci 0001:01:00.0: BAR 6: assigned [mem 0x60200000-0x6020ffff pref]
[341130.651665] pci 0001:01:00.0: BAR 5: assigned [mem 0x60000000-0x600001ff]
[341130.651676] pci 0001:01:00.0: BAR 4: assigned [io  0x4000-0x400f]
[341130.651686] pci 0001:01:00.0: BAR 0: assigned [io  0x4010-0x4017]
[341130.651695] pci 0001:01:00.0: BAR 2: assigned [io  0x4018-0x401f]
[341130.651705] pci 0001:01:00.0: BAR 1: assigned [io  0x4020-0x4023]
[341130.651715] pci 0001:01:00.0: BAR 3: assigned [io  0x4024-0x4027]
[341130.651725] pci 0001:00:00.0: PCI bridge to [bus 01]
[341130.651732] pci 0001:00:00.0:   bridge window [io  0x4000-0x4fff]
[341130.651740] pci 0001:00:00.0:   bridge window [mem 0x60000000-0x601fffff]
[341130.651748] pci 0001:00:00.0:   bridge window [mem 0x60200000-0x603fffff pref]
[341130.651757] PCI: enabling device 0001:00:00.0 (0140 -&gt; 0143)
[341130.651764] keystone-pcie: keystone_pcie_rc_init - end
</pre>
<p>And then look for AHCI and SCSI logs as
</p>
<pre>[   15.651707] ahci 0001:01:00.0: AHCI 0001.0000 32 slots 2 ports 6 Gbps 0x3 impl SATA mode
[   15.658443] ahci 0001:01:00.0: flags: 64bit ncq sntf led only pmp fbs pio slum part sxs
[   15.666086] scsi0&#160;: ahci
[   15.668410] scsi1&#160;: ahci
[   15.670689] ata1: SATA max UDMA/133 abar m512@0x60000000 port 0x60000100 irq 612
[   15.676869] ata2: SATA max UDMA/133 abar m512@0x60000000 port 0x60000180 irq 612
</pre>
<p>Very first time with no partition and file format on HDD, following logs will be displayed
</p>
<pre>[   15.967048] ata1: SATA link down (SStatus 0 SControl 300)
[   16.142035] ata2: SATA link up 6.0 Gbps (SStatus 133 SControl 300)
[   16.147646] ata2.00: ATA-9: WDC WD10EZEX-08M2NA0, 01.01A01, max UDMA/100
[   16.153230] ata2.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA
[   16.159659] ata2.00: configured for UDMA/100
[   16.163344] scsi 1:0:0:0: Direct-Access     ATA      WDC WD10EZEX-08M 01.0 PQ: 0 ANSI: 5
[   16.170463] sd 1:0:0:0: [sda] 1953525168 512-byte logical blocks: (1.00 TB/931 GiB)
[   16.176842] sd 1:0:0:0: [sda] 4096-byte physical blocks
[   16.181339] sd 1:0:0:0: [sda] Write Protect is off
[   16.185364] sd 1:0:0:0: Attached scsi generic sg0 type 0
[   16.185393] sd 1:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[   16.212599]  sda: unknown partition table
[   16.216342] sd 1:0:0:0: [sda] Attached SCSI disk
</pre>
<p>With partition created (in this example there are 4 primary partitions, one for storing file system, one for swap and additional two partitions.
</p>
<pre>[ 4570.941363] ata1: SATA link down (SStatus 0 SControl 300)
[ 4571.108000] ata2: SATA link up 6.0 Gbps (SStatus 133 SControl 300)
[ 4571.113604] ata2.00: ATA-9: WDC WD10EZEX-08M2NA0, 01.01A01, max UDMA/100
[ 4571.119188] ata2.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA
[ 4571.125625] ata2.00: configured for UDMA/100
[ 4571.129313] scsi 1:0:0:0: Direct-Access     ATA      WDC WD10EZEX-08M 01.0 PQ: 0 ANSI: 5
[ 4571.136422] sd 1:0:0:0: [sda] 1953525168 512-byte logical blocks: (1.00 TB/931 GiB)
[ 4571.136550] sd 1:0:0:0: Attached scsi generic sg0 type 0
[ 4571.147216] sd 1:0:0:0: [sda] 4096-byte physical blocks
[ 4571.151686] sd 1:0:0:0: [sda] Write Protect is off
[ 4571.155726] sd 1:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[ 4571.179058]  sda: sda1 sda2 
</pre>
<p>When booted with Filesystem on SATA HDD with ext4 file format.
</p><p>Command line parameters for SATA rootfs.
</p>
<pre>[    0.000000] Kernel command line: console=ttyS0,115200n8 rootwait=1 ro root=/dev/sda1
[    0.000000] PID hash table entries: 4096 (order: 2, 16384 bytes)
</pre>
<p>Log showing mounting for ext4 FS on partition 1 formatted with ext4 file format
</p>
<pre>[  433.556931] EXT3-fs (sda1): error: couldn't mount because of unsupported optional features (240)
[  433.564563] EXT4-fs (sda1): couldn't mount as ext2 due to feature incompatibilities
[  433.578464] EXT4-fs (sda1): INFO: recovery required on readonly filesystem
[  433.584242] EXT4-fs (sda1): write access will be enabled during recovery
[  433.664817] EXT4-fs (sda1): recovery complete
[  433.672994] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)
[  433.679391] VFS: Mounted root (ext4 filesystem) readonly on device 8:1.
</pre>
<p>Port 0 is known to work on customer boards using SATA interface. Internally verified using microTCA AMC chassis and using intel's e1000e NIC card on port 0. The driver for e1000e is supported by intel on its website and IS NOT supported by TI.
</p><p>There are few dts configuration parameters available to customize the driver.See Documentation/devicetree/bindings/pci/pcie-keystone.txt in Linux tree for DT bindings information.
</p>
<h6><span class="mw-headline" id="Procedure_to_boot_Linux_with_FS_on_harddisk">Procedure to boot Linux with FS on harddisk</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=116" title="Edit section: Procedure to boot Linux with FS on harddisk">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Boot Linux kernel on K2E EVM using NFS file system or Ramfs and using rootfs provided in the SDK. Make sure SATA HDD is connected to EVM as explained above and SATA EP is detected during boot up. This example uses a 1TB HDD and create two partition. First partition is for filesystem and is 510GB and second is for swap and is 256MB.
</p><p><b>1. create partition with fdisk</b>
</p><p>First step is to create 2 partitions using fdisk command. At Linux console type the following commands
</p>
<pre>root@keystone-evm:~# fdisk /dev/sda
Welcome to fdisk (util-linux 2.21.2).
</pre>
<pre>Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.
</pre>
<pre>Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0x9b51b66e.
</pre>
<pre>The device presents a logical sector size that is smaller than
the physical sector size. Aligning to a physical sector (or optimal
I/O) size boundary is recommended, or performance may be impacted.
</pre>
<pre>Command (m for help): m
Command action
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   delete a partition
   l   list known partition types
   m   print this menu
   n   add a new partition
   o   create a new empty DOS partition table
   p   print the partition table
   q   quit without saving changes
   s   create a new empty Sun disklabel
   t   change a partition's system id
   u   change display/entry units
   v   verify the partition table
   w   write table to disk and exit
   x   extra functionality (experts only)
</pre>
<pre>Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-1953525167, default 2048): 2048
Last sector, +sectors or +size{K,M,G} (2048-1953525167, default 1953525167): +510G
Partition 1 of type Linux and of size 510 GiB is set
</pre>
<pre>Command (m for help): n
Partition type:
   p   primary (1 primary, 0 extended, 3 free)
   e   extended
Select (default p): p
Partition number (1-4, default 2): 2
First sector (1069549568-1953525167, default 1069549568):
Using default value 1069549568
Last sector, +sectors or +size{K,M,G} (1069549568-1953525167, default 1953525167): +256M
Partition 2 of type Linux and of size 256 MiB is set
</pre>
<pre>Command (m for help): p
</pre>
<pre>Disk /dev/sda: 1000.2 GB, 1000204886016 bytes
255 heads, 63 sectors/track, 121601 cylinders, total 1953525168 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk identifier: 0x9b51b66e
</pre>
<pre>   Device Boot      Start         End      Blocks   Id  System
/dev/sda1            2048  1069549567   534773760   83  Linux
/dev/sda2      1069549568  1070073855      262144   83  Linux
</pre>
<pre>Command (m for help): p
</pre>
<pre>Disk /dev/sda: 1000.2 GB, 1000204886016 bytes
255 heads, 63 sectors/track, 121601 cylinders, total 1953525168 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk identifier: 0x9b51b66e
</pre>
<pre>  Device Boot      Start         End      Blocks   Id  System
/dev/sda1            2048  1069549567   534773760   83  Linux
/dev/sda2      1069549568  1070073855      262144   83  Linux
</pre>
<pre>Command (m for help): t
Partition number (1-4): 2
Hex code (type L to list codes): L
</pre>
<pre> 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris
 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-
 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-
 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-
 4  FAT16 &lt;32M      40  Venix 80286     85  Linux extended  c7  Syrinx
 5  Extended        41  PPC PReP Boot   86  NTFS volume set da  Non-FS data
 6  FAT16           42  SFS             87  NTFS volume set db  CP/M / CTOS / .
 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility
 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt
 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access
 a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O
 b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor
 c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs
 e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT
 f  W95 Ext'd (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/
10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b
11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor
12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor
14  Hidden FAT16 &lt;3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary
16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS
17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE
18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto
1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep
1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT
1e  Hidden W95 FAT1 80  Old Minix
Hex code (type L to list codes): 82
Changed system type of partition 2 to 82 (Linux swap / Solaris)
</pre>
<pre>Command (m for help): p
</pre>
<pre>Disk /dev/sda: 1000.2 GB, 1000204886016 bytes
255 heads, 63 sectors/track, 121601 cylinders, total 1953525168 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk identifier: 0x9b51b66e
</pre>
<pre>  Device Boot      Start         End      Blocks   Id  System
/dev/sda1            2048  1069549567   534773760   83  Linux
/dev/sda2      1069549568  1070073855      262144   82  Linux swap / Solaris
</pre>
<p><b>2. Format partitions</b>
</p>
<pre>root@keystone-evm:~# mkfs.ext4 /dev/sda1
mke2fs 1.42.1 (17-Feb-2012)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
33423360 inodes, 133693440 blocks
6684672 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=0
4080 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
       32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
       4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,
       102400000
</pre>
<pre>Allocating group tables: done
Writing inode tables: done
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done
</pre>
<pre>root@keystone-evm:~# ls -ltr /dev/sda*
brw-rw----    1 root     disk        8,   2 Sep 21 14:37 /dev/sda2
brw-rw----    1 root     disk        8,   0 Sep 21 14:37 /dev/sda
brw-rw----    1 root     disk        8,   1 Sep 21 14:40 /dev/sda1
</pre>
<p><b>3. Copy filesystem to rootfs</b>
</p><p>This procedure assumes the cpio file for SDK filesystem is available on the NFS or ramfs.
</p>
<pre>&gt;mkdir /mnt/test
&gt;mount -t ext4 /dev/sda1 /mnt/test
&gt;cd /mnt/test
&gt;cpio -i -v &lt;/&lt;rootfs&gt;.cpio
&gt;cd /
&gt;umount /mnt/test
Where rootfs.cpio is the cpio file for the SDK fileystem.
</pre>
<p><b>4. Booting with FS on harddisk</b>
</p><p>Once the harddisk is formatted and has a rootfs installed, following procedure can be used to boot Linux kernel using this rootfs.
</p><p>Boot EVM to u-boot prompt.
Add following env variables to u-boot environment&#160;:-
</p>
<pre>K2E EVM # setenv boot hdd
K2E EVM # setenv get_fdt_hdd 'dhcp ${addr_fdt} ${tftp_root}/${name_fdt}'
K2E EVM # setenv get_kern_hdd 'dhcp ${addr_kern} ${tftp_root}/${name_kern}'
K2E EVM # setenv get_mon_hdd 'dhcp ${addr_mon} ${tftp_root}/${name_mon}'
K2E EVM # setenv init_hdd 'run set_fs_none  args_all  args_hdd'
K2E EVM # setenv args_hdd 'setenv bootargs ${bootargs} ro root=/dev/sda1'
K2E EVM # saveenv
</pre>
<p>Now type boot command and boot to Linux. The above steps can be skipped once u-boot implements these env variables by default which is expected to be supported in the future.
</p>
<h6><span class="mw-headline" id="AER_Driver">AER Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=117" title="Edit section: AER Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>AER driver is used for PCIE error handling and recovery. AER driver is attached to RC Port. AER driver requires following kernel command line parameters in bootargs
</p>
<pre>pcie_ports=native pcie_aer=nomsi
</pre>
<p>AER driver is tested by simulating a Unsupported Request. To do so, the EP's BAR is corrupted. For the EP driver to send error responses to RC, SERR bit in PCI_COMMAND must be enabled. Also must enable AER error reporting using
pci_enable_pcie_error_reporting() API. For example to enable AHCI driver to enable
error reporting to RC port, following code (shows diff) was added to drivers/ata/ahci.c in  ahci_init_one()
</p>
<pre>#define DRV_VERSION    "3.0"
+extern int pci_enable_pcie_error_reporting(struct pci_dev *dev);
</pre>
<pre>....
</pre>
<pre>ahci_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)
.....
</pre>
<pre>       int ahci_pci_bar = AHCI_PCI_BAR_STANDARD;
+      u16 pci_cmd;
</pre>
<pre>....
</pre>
<pre>+       pci_read_config_word(pdev, PCI_COMMAND, &amp;pci_cmd);
+       pci_cmd |= PCI_COMMAND_SERR;
+       pci_write_config_word(pdev, PCI_COMMAND, pci_cmd);
+       pci_enable_pcie_error_reporting(pdev);
        return ata_host_activate(host, pdev-&gt;irq, ahci_interrupt,
                 IRQF_SHARED, &amp;ahci_sht);
</pre>
<p>To simulate Unsupported request error, corrupt the memory BAR at EP's config space. For example, write 0 to BAR offset 0x24 as below (dump should show an address in the 0x5xxxxxxx range at 0x21802024 assuming CFG_SETUP is pointing to EP's config space)&#160;:-
</p>
<pre>&gt;devmem2 0x21802024 w 0x0
</pre>
<p>The above assumes the CFG_SETUP register is pointing to bus 1, dev 0, function 0. If not, read the value at offset 0x8 and update it using dev2mem command. Refer the device UG for details of the register.
</p><p>For AHCI case, try writing to the disk using following command after corrupting the
BAR
</p>
<pre>dd if=/dev/zero of=/media/sda1/test-file.bin bs=1K count=1024
</pre>
<p>The command will time out. Once this is timedout, dmesg command will show something
like below for unsupported error received from EP at the RC's port.
</p>
<pre>[  342.828683] pcieport 0000:00:00.0: AER: Multiple Uncorrected (Non-Fatal)
   error received: id=0100
[  342.837572] ahci 0000:01:00.0: PCIe Bus Error: severity=Uncorrected (Non-
   Fatal), type=Transaction Layer, id=0100(Requester ID)
[  342.848916] ahci 0000:01:00.0:   device [1b4b:9125] error
   status/mask=00100000/00000000
[  342.848920] ahci 0000:01:00.0:    [20] Unsupported Request    (First)
[  342.848927] ahci 0000:01:00.0:   TLP Header: 40003001 0000000f 50000134
   00000000
[  342.848945] ahci 0000:01:00.0: broadcast error_detected message
</pre>
<pre>root@keystone-evm:~# cat /proc/interrupts
           CPU0       CPU1       CPU2       CPU3
 29:          0          0          0          0       GIC  arch_timer
 30:      51241      51511      51736      51561       GIC  arch_timer
 70:          1          0          0          0       GIC  pcie-error-irq, aerdrv
 80:      10858          0          0          0       GIC  hwqueue-8704
 81:          0          0          0          0       GIC  hwqueue-8705
 82:         16          0          0          0       GIC  hwqueue-8706
 83:          0          0          0          0       GIC  hwqueue-8707
 84:          0          0          0          0       GIC  hwqueue-8708[
</pre>
<p>The above shows one error interrupt received by RC port.
</p><p>More information on AER driver can be seen at Documentation/PCI/pcieaer-howto.txt
in Linux source tree.
<br />
</p>
<h5><span class="mw-headline" id="DMA_Coherency">DMA Coherency</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=118" title="Edit section: DMA Coherency">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Multicore Cortex-A15 supports cache coherency. So, if one core writes to the memory page and that page has a sharable attribute, corresponding cache entries of other cores will be updated. If SoC doesnt support DMA coherency and external DMA master performs a write transaction L1 and L2 caches will not be updated. So, the software has to invalidate corresponding cache lines. Keystone 2 SoC supports DMA coherency by hardware. MSMC has a special snooping mechanism to monitor bus transactions and communicates to Tetris to update caches. That eliminates necessity to invalidate cache from software. Several conditions must be met in order to support DMA coherency:
</p>
<ul><li>MMU is enabled</li>
<li>LPAE is enabled</li>
<li>Linux runs in DDR3A 0x800000000 address space</li>
<li>US bit in MSMC MPAX Segment registers has to be cleared to enable page sharing and coherency actions. Please read <a rel="nofollow" class="external text" href="http://www.ti.com/lit/ug/spruhj6/spruhj6.pdf">Multicore Shared Memory Controller</a> for details.</li>
<li>Dma-coherent property is set for appropriate node in the DTS.</li></ul>
<p>The MCSDK release meets those requirements because:
</p>
<ul><li>Linux always runs with MMU enabled.</li>
<li>Kernel has LPAE enabled by default in this release.</li>
<li>U-boot in arch_cpu_init() calls share_all_segments() functions for ARM and NetCP MPAXes, which clears US bits.</li>
<li>The default mem_lpae u-boot enviroment variable is set to "1" which makes kernel to work at 0x800000000 DDR3A address space.</li>
<li>The "dma-coherent" property is set for "pktdma" and "netcp" nodes of tci6638_evm.dts</li></ul>
<h5><span class="mw-headline" id="RT_Preempt_patch">RT Preempt patch</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=119" title="Edit section: RT Preempt patch">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>RT Preempt patch is supported in Linux. The master-rt branch in the Linux repo maintains a patched kernel. keystone2_fullrt_defconfig is used to configure the RT Preempt patched kernel. More details on the RT Preempt patch can be obtained from <a rel="nofollow" class="external autonumber" href="https://rt.wiki.kernel.org/index.php/RT_PREEMPT_HOWTO#About_the_RT-Preempt_Patch">[4]</a>
</p><p><br />
</p>
<h4><span class="mw-headline" id="Capture_kernel_crash_dump_using_kexec">Capture kernel crash dump using kexec</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=120" title="Edit section: Capture kernel crash dump using kexec">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>When there is a kernel panic, and the system goes down there is a need to capture the coredump before resetting the system. This coredump could be later analyzed to debug the kernel panic and for other purposes.
To achieve this with Keystone II devices, a few user space utilities were added  as part of the file system. The following sections provides details on what these utilities are and how they were used to enable this feature.
</p><p>Kexec is a patch to the Linux kernel that allows you to boot directly to a new kernel from the currently running one. In the boot sequence, kexec skips the entire bootloader stage (the first part) and directly jumps into the kernel that we want to boot to. There is no hardware reset, no firmware operation, and no bootloader involved.
</p><p><b>Note: kernel crash dump is currently supported only on K2HK EVM for this release</b>
</p>
<h5><span id="Kexec/Kdump_Terminology"></span><span class="mw-headline" id="Kexec.2FKdump_Terminology">Kexec/Kdump Terminology</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=121" title="Edit section: Kexec/Kdump Terminology">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Some terms that will be used later on in this section are explained here:
</p><p>Main-kernel: The kernel that is being used for regular use by the system. <br />
Crash-kernel: The kernel that will be used for bringing up the system at the time of a kernel crash. <br />
</p><p>Crash-kernel-device tree: The device tree file that will be used by the crash kernel at the time of boot up after a panic from main kernel. <br />
</p>
<h5><span id="Kexec/Kdump_User_Space_tools"></span><span class="mw-headline" id="Kexec.2FKdump_User_Space_tools">Kexec/Kdump User Space tools</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=122" title="Edit section: Kexec/Kdump User Space tools">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Kexec-tools provides the /sbin/kexec binary that facilitates a new kernel to boot using the kernel's kexec feature either on a normal or a panic reboot. This package contains the /sbin/kexec binary and ancillary utilities that together form the userspace component of the kernel's kexec feature. 
</p><p>We use this tool only at the time of a kernel panic, but like the description says this can be used even to load a different kernel at a particular point in time.
</p><p>User space kexec tools (version used is v2.0.7) are available in gitweb at:
<a rel="nofollow" class="external text" href="http://git.kernel.org/?p=utils/kernel/kexec/kexec-tools.git;a=summary">Kexec Git web</a>
</p><p>We also need to apply a [[patch]<a rel="nofollow" class="external autonumber" href="http://arago-project.org/git/projects/meta-mcsdk.git?p=projects/meta-mcsdk.git;a=blob;f=meta-arago-extras/recipes-kernel/kexec/kexec-tools-2.0.7/0001-kexec-ks2-use-KS2-aliased-addresses-on.patch;h=6f6eef1fbac4deb35da9b5dbec63594de55a4c4c;hb=refs/heads/master">[5]</a>] on kexec tools v2.0.7 to resolve the address aliasing issue. Keystone II device doesn't have physical memory at the first 4GB address range. In order to access the memory at boot time it aliases two GB of the memory to the that range. So when kexec creates elf header for the crash kernel, it has to convert Keystone II physical addresses to the corresponding aliased ones.
</p>
<h6><span class="mw-headline" id="Kexec_Usage">Kexec Usage</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=123" title="Edit section: Kexec Usage">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>To use kexec to load a different kernel at the time of panic, do this:
kexec -p &lt;path-to-zImage&gt; --command-line=&lt;boot command line&gt; --dtb=&lt;path-to-device-tree-file&gt;
</p><p>The -p option indicates that this rule will be applicable at the time of a panic only.
The path to zImage is the zImage that will be loaded at the time of a panic, this is called crashkernel.
The path to device tree is the device tree file that this crashkernel will use for boot up. 
The boot command line will provide the command line argument for the new crashkernel to come up.
</p><p><b>More options for kexec can be seen by doing: "kexec --help" from the shell prompt.</b>
</p>
<h6><span class="mw-headline" id="Reserving_size_of_crashkernel">Reserving size of crashkernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=124" title="Edit section: Reserving size of crashkernel">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>For kexec-tools to work, a separate area of memory will need to be used to load the crashkernel. This is done by adding "crashkernel=33M@0x810000000" to the bootargs of the main kernel's bootargs. If this is not done, the "kexec -p" command descibed previously will not work and will return an error saying crashkernel size is not allocated.
</p>
<h6><span id="/proc/vmcore"></span><span class="mw-headline" id=".2Fproc.2Fvmcore">/proc/vmcore</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=125" title="Edit section: /proc/vmcore">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>When the main kernel panics, the crashkernel is triggered and when the crashkernel comes up, the /proc/vmcore entry will show the exact state of the previous kernel's view of the system. Capturing this file is needed to analyze the previous kernel panic. But this file will be really huge (because this is in effect, the previous kernel's view of the system). So there are some techniques done to get the exact coredump file that we want which are discussed in the next sections.
</p><p><br />
</p>
<h5><span class="mw-headline" id="makedumpfile">makedumpfile</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=126" title="Edit section: makedumpfile">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>With kexec/kdump, the memory image of the first kernel (called "main kernel") can be taken as /proc/vmcore while the second kernel (called "crash kernel") is running. makedumpfile makes a small DUMPFILE from the /proc/vmcore by compressing dump data or by excluding unnecessary pages for analysis, or both. makedumpfile needs the first kernel's debug information, so that it can distinguish unnecessary pages by analyzing how the first kernel uses the memory. 
</p><p>More information on makedumpfile can be found at:
<a rel="nofollow" class="external text" href="http://linux.die.net/man/8/makedumpfile">makedump file</a>
</p><p>There is one particular usage of makedumpfile that we will be employing to capture relevant detail:
</p>
<pre>   makedumpfile E d 31 /proc/vmcore/ coredump
   the -E option means the output file coredump will be in ELF format. (The default is in "crash" format, which needs "crash" utility)
   -d 31 means all zero pages, cache pages, cache private, user and free pages are removed when generating the coredump file. This is needed otherwise the coredump file will become really huge.
</pre>
<p>makedumpfile option Description for "-d" <br />
1	 Zero pages <br />
2	 Cache pages <br />
4	 Cache private <br />
8	 User pages <br />
16	 Free pages <br />
</p><p>Refer for more information: <a rel="nofollow" class="external text" href="https://access.redhat.com/knowledge/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/ch-kdump.html">makedumpfile options</a>
</p>
<h5><span class="mw-headline" id="Crashkernel_and_crash_kernel_device-tree">Crashkernel and crash kernel device-tree</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=127" title="Edit section: Crashkernel and crash kernel device-tree">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Our kernel uImage file is relocatable and automatically relocates to 0x80008000, so to be used for crashkernel the zImage is preferred and tested.
</p><p>At the time of kernel panic, the idea is that none of the hardware modules are reliable - because there may be some data traffic happening, and file system may be also be corrupted. So the idea is to bring up a crashkernel that does not have any of the hw modules enabled, and crash kernel will use a new filesystem.
The "k2hk_evm_recovery_defconfig" has all TI_KEYSTONE disabled, networking disabled etc.
Correspondingly we need a device tree file also to be used by the crashkernel. This device tree file need to provide the bootargs for the crashkernel, and listthe "elfcorehdr=xxx" for the crashkernel to generate the /proc/vmcore entry.
</p><p>This device tree source file is under &lt;linux-repo&gt;/arch/arm/boot/dts/k2hk-evm-recovery.dts.
</p><p>The crashkernel can be built from our Linux kernel repo, by doing: <br />
make keystone2_recovery_defconfig <br />
make <br />
make &lt;device&gt;-evm-recovery.dtb <br />
</p><p>The output zImage is in &lt;linux-repo&gt;/arch/arm/boot
</p><p>Normally when the kernel is booted by the u-boot, the u-boot takes care to reserve free memory space in the DTB, which is required for the kernel. User has to add the free space manually using dtc complier:
</p><p>dtc -I dtb -O dtb -p 2048 -o &lt;device&gt;-evm-recovery.dtb arch/arm/boot/dts/k2hk-evm-recovery.dtb
</p><p>The output DTB is in &lt;linux-repo&gt;/
<br />
</p><p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  &lt;device&gt; is k2hk, k2l or k2e
</p><p><br />
</p>
<h5><span id="Init-script_to_run_in_the_crash_kernel's_filesystem"></span><span class="mw-headline" id="Init-script_to_run_in_the_crash_kernel.27s_filesystem">Init-script to run in the crash kernel's filesystem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=128" title="Edit section: Init-script to run in the crash kernel&#039;s filesystem">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The crash kernel will use a filesystem and the main expectation from this filesystem is to extract the vmcore information to a elf coredump. For this purpose, an init-script is written which gets executed automatically from the recovery-filesystem. It looks like below:
</p>
<pre> #!/bin/sh
 if [ -f /proc/vmcore ]&#160;; then
   mkdir -p /mnt/boot2
   mount -o rw,sync -t ubifs /dev/ubi0_2 /mnt/boot2
   if [ $? -eq 0 ]&#160;; then
      if [ -f /usr/bin/makedumpfile ]&#160;; then
        makedumpfile -E -d 31 /proc/vmcore /mnt/boot2/home/root/coredump.elf
        gzip -c /mnt/boot2/home/root/coredump.elf &gt; /mnt/boot2/home/root/coredump.elf.gz
        rm -rf /mnt/boot2/home/root/coredump.elf
        sync
        reboot
      else
        echo "makedumpfile not found"
        exit 1
      fi
   else
     echo "mount unsuccessful"
     exit 1
   fi
 fi
 exit 0
</pre>
<p><b>Note: This script is part of the rootfs-recovery filesystem by default under: /etc/rc3.d/S09recoveryfs</b>
</p><p><br />
</p>
<h5><span class="mw-headline" id="How_to_enable_crashdump_kernel_with_MCSDK_on_K2HK-EVM">How to enable crashdump kernel with MCSDK on K2HK-EVM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=129" title="Edit section: How to enable crashdump kernel with MCSDK on K2HK-EVM">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The default root-filesystem of SC-MCSDK contains the kexec and kdump user space utilities under /usr/sbin.
The crashkernel and crash kernel's device tree binary file is pre-built and located under /usr/bin/crashdump.
This kernel is built based on the "k2hk_evm_recovery_defconfig" located under arch/arm/configs of the linux repo.
This device tree file is built based on the "k2hk-evm-recovery.dts" located under &lt;linux-repo&gt;/arch/arm/boot/dts/.
</p><p>To verify the kexec way of loading a crashkernel and capturing main kernel panic information, use steps below:
</p><p>From a UBI based NAND filesystem, do the following:
</p>
<pre> Boot the system with the following text added to the args_all line in u-boot: <br /> 
 "crashkernel=33M@0x810000000" <br /> 
 Boot the system. <br /> 
 cd /usr/bin/crashdump <br /> 
</pre>
<p>For k2hk or k2e:<br />
</p>
<pre> kexec -p zImage --command-line="console=ttyS0,115200n8 earlyprintk rootwait=1 maxcpus=1 rootfstype=ubifs root=ubi0:rootfs-recovery rootflags=sync rw ubi.mtd=2,2048" --dtb=&lt;device&gt;-evm-recovery.dtb <br /> 
</pre>
<p>For k2l:<br />
</p>
<pre> kexec -p zImage --command-line="console=ttyS0,115200n8 earlyprintk rootwait=1 maxcpus=1 rootfstype=ubifs root=ubi0:rootfs-recovery rootflags=sync rw ubi.mtd=2,4096" --dtb=&lt;device&gt;-evm-recovery.dtb <br /> 
</pre>
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  &lt;device&gt; is k2hk, k2l or k2e.<br />
</p>
<pre> At this time, the main kernel is configured to use the zImage as the crash kernel.
 Now invoke a panic, by manually building a simple panic kernel module.
</pre>
<p>A sample panic.c which can be built as kernel module is shown below:
</p>
<pre> /*
  * File name: panic.c
  */
 #include &lt;linux/kernel.h&gt;
 #include &lt;linux/module.h&gt;
 #include &lt;linux/sort.h&gt;
 #include &lt;linux/bsearch.h&gt;
 #include &lt;linux/xfrm.h&gt;
 #include &lt;net/net_namespace.h&gt;
 #include &lt;linux/list.h&gt;
 #include &lt;linux/hash.h&gt;
 MODULE_LICENSE("GPL v2");
 static int __init panic_init(void)
 {
       printk("calling panic()\n");
       panic("panic has been called");
       return 0;
 }
 module_init(panic_init);
</pre>
<p>Now do: <br />
</p>
<pre> insmod panic.ko 
</pre>
<p>This will reboot the board and: <br /> 
1. Come up to the new dump-kernel/recovery-fs (because the crash kernel device tree file uses the recovery filesystem) <br /> 
2. Automatically copy the elf-core-dump (the initscripts of recovery filesystem checks for /proc/vmcore entry and generates the coredump elf) <br /> 
3. Reboots back to the original kernel/fs. (Again, the initscript of recovery fs does a reboot after copying the coredump) <br /> 
</p><p>Now: from /home/root directory, check if there is a  coredump.elf.gz.
This can be transferred to the linux pc, and analyzed with gdb against a vmlinux file.
</p>
<pre> arm-linux-gnueabihf-gdb &lt;vmlinux-file&gt; --core=coredump.elf
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Graceful_Power_shutdown">Graceful Power shutdown</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=130" title="Edit section: Graceful Power shutdown">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This is a sample implementation to support graceful power shutdown. To have a complete implementation, it is assumed that user space daemon listen to the power button event and initiate shutdown.
</p>
<h3><span class="mw-headline" id="Smart_Reflex_Class_0">Smart Reflex Class 0</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=131" title="Edit section: Smart Reflex Class 0">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Please refer to Smart Reflex Class 0 software User's Guide <a rel="nofollow" class="external autonumber" href="http://git.ti.com/cgit/cgit.cgi/keystone-linux/srss-tc.git/plain/docs/srss_c0_ug.pdf">[6]</a> for details.
</p><p><br />
</p>
<h3><span class="mw-headline" id="EVM_Setup">EVM Setup</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=132" title="Edit section: EVM Setup">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This is the sample configuration used for testing the graceful power shutdown use case. The DTS bindings may be altered for the individual GPIO pins used
for the target board and also others as needed for the specific usecase.
</p>
<pre>       GPIO pin 1 (power button)
BMC  -----------------&gt; SOC
</pre>
<pre>       GPIO pin 2 (shutdown complete - power off)
BMC  &lt;----------------- SOC
</pre>
<h3><span class="mw-headline" id="Tests">Tests</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=133" title="Edit section: Tests">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Used BMC version - 1.0.2.5
Use Linux kernel image with patches applied
Boot up the EVM
</p><p>test power button event reception at the user space
</p>
<hr />
<p>step 1. type the following command at the BMC to enable hwdbg
</p>
<pre>[00:00:07]  BMC&gt;hwdbg cmd gpio show
[00:00:07]  Executing command "hwdbg"
[00:00:07]  Enabling command: gpio
</pre>
<p>step 2. type the following command at the Linux console to wait for the power button
event.
</p>
<pre>root@keystone-evm:~# evtest /dev/input/event0
Input driver version is 1.0.1
Input device ID: bus 0x19 vendor 0x1 product 0x1 version 0x100
Input device name: "gpio_keys.7"
Supported events:
 Event type 0 (Sync)
 Event type 1 (Key)
 Event code 116 (Power)
Testing ... (interrupt to exit)
</pre>
<p>step 3. type the following command at the BMC to toggle GPIO pin 1 to high.
</p>
<pre>BMC&gt;gpio xa  XXXX_XXXXXX_XX1X
[19:26:21]  Executing command "gpio"
[19:26:21]  Writing to GPIO expander A...
[19:26:21]  Inputs: 0x0000
High Outputs: 0x0002
Low Outputs: 0x0000
[19:26:21]  Finished setting GPIO expander A...
</pre>
<p><br />
Following log will display at the linux console showing the Power button
event when GPIO pin is toggled to high
</p>
<pre>Event: time 1373363555.593249, type 1 (Key), code 116 (Power), value 1
Event: time 1373363555.593249, -------------- Report Sync ------------
</pre>
<p><br />
test power off event from SoC to BMC
</p>
<hr />
<p>step 1. type the following command to at the BMC to display the current GPIO
pin 2 state
</p>
<pre>[19:37:10]  BMC&gt;gpio xa
[19:37:10]  Executing command "gpio"
[19:37:10]  Reading from GPIO expander A...
[19:37:10]  Inputs:  0000_0000_0000_0001
[19:37:10]  Outputs: XXXX_XXXX_XXXX_XXXX
</pre>
<p>step 2. Initiate shutdown command from user space by typing following command
at the Linux console
</p>
<pre>root@keystone-evm:~# shutdown -P -h "now"
</pre>
<pre>INIT: Sending processes the TERM signalm (ttyS0) (Tue Jul  9 10:02:20 2013):
INIT:Stopping telnet daemon.
Stopping tiipclad daemon.
Stopping syslogd/klogd: stopped syslogd (pid 1586)
stopped klogd (pid 1589)
done
Stopping thttpd.
NOT deconfiguring network interfaces: / is an NFS mount
Sending all processes the TERM signal...
Sending all processes the KILL signal...
Unmounting remote filesystems...
Deactivating swap...
Unmounting local filesystems...
[  460.561642] Power down.
</pre>
<p>step 3. type the following command to at the BMC to display the current GPIO
pin 2 state again
</p>
<pre>[19:37:12]  BMC&gt;gpio xa
[19:37:12]  Executing command "gpio"
[19:37:12]  Reading from GPIO expander A...
[19:37:12]  Inputs:  0000_0000_0000_0101
[19:37:12]  Outputs: XXXX_XXXX_XXXX_XXXX
</pre>
<p>Note that pin2 state is toggled to 1 (in step.1 it was showing 0)
</p>
<h3><span class="mw-headline" id="configuration">configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=134" title="Edit section: configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The feature is enabled by default in the default image shipped with release. To get this working on a board, user need to identify the GPIO pins used and add following bindings to the DTS file
</p>
<pre>              gpio_poweroff {
                      compatible = "gpio-poweroff";
                      /*
                       * Change this as needed in the target board to match the
                       * pin used for signaling Power down event from the SoC.
                       * It is assumed that external controller reads this pin
                       * and remove power to the SoC. On EVM, pin 4 output
                       * can be read from BMC to test this.
                       */
                      gpios = &lt;&amp;gpio0 4 0&gt;;
              };
</pre>
<p><br />
</p>
<pre>              gpio_keys {
                      compatible = "gpio-keys";
                      #address-cells = &lt;1&gt;;
                      #size-cells = &lt;0&gt;;
</pre>
<pre>                      button@1 {
                              label = "Power button";
                              /* this is the key power button defined in Linux input.h */
                              linux,code = &lt;116&gt;;
                              /* EV_KEY */
                              linux,input-type = &lt;1&gt;;
                              /*
                               * On EVM use GPIO pin 3 since it is also connected to
                               * BMC to generate a shutdown event to ARM. Change this
                               * as needed in the target board.
                               */
                              gpios = &lt;&amp;gpio0 3 0&gt;;
                      };
              };
</pre>
<h2><span class="mw-headline" id="Yocto">Yocto</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=135" title="Edit section: Yocto">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>MCSDK uses Yocto projet to build the Linux kernel, U-boot, user space components, and root filesystem.
</p>
<h3><span class="mw-headline" id="Prerequisite">Prerequisite</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=136" title="Edit section: Prerequisite">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>To build yocto in an ubuntu Linux machine, first get a library for 32-bit compilation:
</p><p><code>
sudo apt-get -y install gcc-multilib libc6-i386
</code>
</p><p>Next, the following tools should be installed:
</p><p><code>
sudo apt-get -y install diffstat texi2html texinfo subversion chrpath build-essential subversion ccache sed wget cvs coreutils unzip texinfo docbook-utils gawk help2man file g++ bison flex htmldoc chrpath libxext-dev xserver-xorg-dev doxygen socat uboot-mkimage git
</code>
</p><p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  The apt-get steps only needs to be done once.
</p>
<h3><span class="mw-headline" id="Configuration_2">Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=137" title="Edit section: Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The following steps set up a default configuration that may be customized as needed:
</p><p>NOTE: The first step is changing for the MCSDK 3.0.4 POST GA release.  If using release earlier releases use the old procedure under: oe-layersetup for older releases.
</p>
<dl><dd><dl><dd><ul><li>Clone the oe-layersetup.git (<a rel="nofollow" class="external free" href="git://arago-project.org/git/projects/oe-layersetup.git">git://arago-project.org/git/projects/oe-layersetup.git</a>) from Arago project</li></ul>
<dl><dd>$ git clone <a rel="nofollow" class="external free" href="http://arago-project.org/git/projects/oe-layersetup.git">http://arago-project.org/git/projects/oe-layersetup.git</a></dd>
<dd>$ cd oe-layersetup</dd></dl></dd></dl></dd></dl>
<p>oe-layersetup for older releases
</p>
<hr />
<dl><dd><dl><dd><ul><li>Clone the oe-layersetup-mcsdk.git (<a rel="nofollow" class="external free" href="http://arago-project.org/git/people/hzhang/oe-layersetup-mcsdk.git">http://arago-project.org/git/people/hzhang/oe-layersetup-mcsdk.git</a>) from Arago project</li></ul>
<dl><dd>$ git clone <a rel="nofollow" class="external free" href="http://arago-project.org/git/people/hzhang/oe-layersetup-mcsdk.git">http://arago-project.org/git/people/hzhang/oe-layersetup-mcsdk.git</a> mcsdk</dd>
<dd>$ cd mcsdk</dd></dl></dd></dl></dd></dl>
<hr />
<dl><dd><dl><dd><ul><li>Choose the configuration file based on the release used.</li></ul>
<dl><dd>The configuration file for the mcsdk release is kept at configs/mcsdk/mcsdk-&lt;version&gt;-config.txt</dd>
<dd>The latest mcsdk release configuration file is configs/mcsdk/mcsdk-03.01.03.06-config.txt</dd>
<dd>Note: During development process a different configuration file may be used.</dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><ul><li>Run the setup script to configure oe-core layers and builds (Note to use the right config file here)</li></ul>
<dl><dd>$ ./oe-layertool-setup.sh -f configs/mcsdk/mcsdk-03.01.03.06-config.txt</dd></dl></dd></dl></dd></dl>
<hr />
<dl><dd><dl><dd><dl><dd>Note: For mcsdk 3.1.4.7: In addition to the config script, need to run the following steps</dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><dl><dd>$ cd  sources/oe-core</dd>
<dd>$ git cherry-pick 3fa24eee41c26fecd5e4f680082288ec772d2de9</dd>
<dd>$ cd -</dd></dl></dd></dl></dd></dl>
<hr />
<p><br />
</p>
<h3><span class="mw-headline" id="Build">Build</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=138" title="Edit section: Build">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This section describes how the linux rootfs filesystem can be built. <br />
This section assumes that the Linaro toolchain for ARM is installed and environment variables CROSS_COMPILE, ARCH are set up as per instructions given in section Toolchain Installation <a rel="nofollow" class="external text" href="MCSDK_UG_Chapter_Tools.html#Linaro_toolchain">Linaro_toolchain</a>.
</p><p>export CROSS_COMPILE=arm-linux-gnueabihf-<br />
export ARCH=arm<br />
PATH=&lt;path to installed toolchain&gt;/bin:$PATH<br />
</p><p>To build the linux rootfs filesystem, one can either use the local snapshot of the sources in MCSDK release, or fetch the latest source packages at external URLs.
</p>
<h3><span class="mw-headline" id="Using_the_snapshot_of_the_source_packages_in_MCSDK_release">Using the snapshot of the source packages in MCSDK release</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=139" title="Edit section: Using the snapshot of the source packages in MCSDK release">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Using the snapshot of the arago source packages can avoid fetch errors during the build when external URLs become unavailable. To use the snapshot of sources distributed with MCSDK release, for example, see <a rel="nofollow" class="external text" href="http://downloads.ti.com/sdoemb/sdoemb_public_sw/mcsdk/latest/exports/mcsdk-3_01_03_06.arago.src.tar.gz">mcsdk-arago-source</a>. Once this package is downloaded, the content can be un-tarred under the directory $(INSTALL_DIR)/downloads. With this, the build will use local source packages in the downloads directory instead of fetching the latest from external URLs.
</p>
<dl><dd><dl><dd><ul><li>un-tar the arago source tarball</li></ul>
<dl><dd>$ cd oe-layersetup</dd>
<dd>$ ls
<dl><dd>build   configs  oe-layertool-setup.sh   sample-files   sources</dd></dl></dd>
<dd>$ tar xzvf $(DOWNLOAD_DIR)/mcsdk-3_##_##_##.arago.src.tar.gz</dd>
<dd>$ ls
<dl><dd>build   configs   <b>downloads</b>   oe-layertool-setup.sh   sample-files   sources</dd></dl></dd></dl>
<ul><li>Then, follow all the steps of using the latest source packages on internel URLs below to build</li></ul></dd></dl></dd></dl>
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  for MCSDK 3.0.4, the build version is 3_00_04_18; for MCSDK 3.1.0, the build version is 3_01_00_03; for MCSDK 3.1.1, the build version is 3_01_01_04; for MCSDK 3.1.2, the build version is 3_01_02_05; for MCSDK 3.1.3, the build version is 3_01_03_06.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Build_procedure">Build procedure</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=140" title="Edit section: Build procedure">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<dl><dd><dl><dd><ul><li>Set up the environment variables and start the build using the configuration file</li></ul>
<dl><dd>$ cd build</dd>
<dd>$ source conf/setenv</dd>
<dd>$ MACHINE=&lt;soc&gt;-evm TOOLCHAIN_BRAND=linaro ARAGO_BRAND=mcsdk bitbake tisdk-server-rootfs-image</dd></dl></dd></dl></dd></dl>
<p>For releases older than MCSDK 3.0.4, ARAGO_BRAND=mcsdk is not required.
And also use &lt;soc&gt; as "keystone".
</p><p>For the releases MCSDK 3.0.4 and after use:
&lt;soc&gt; is "k2hk", "k2l" or "k2e"; 
</p><p><br />Once build is complete, the images for the kernel and file system can be located at
</p>
<dl><dd><dl><dd>$(INSTALL_DIR)/build/arago-tmp-external-linaro-toolchain/deploy/images</dd></dl></dd></dl>
<p><br />
</p>
<dl><dd><dl><dd><ul><li>If needed, edit the bitbake configuration file conf/local.conf to customize your bitbake build. In particular, enabling parallel task execution substantially speeds up the Arago build process by fetching package sources in parallel with other build steps. In order to do so, please enable and edit the following parameter in your bitbake configuration BB_NUMBER_THREADS = "4"</li></ul></dd></dl></dd></dl>
<p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  The BB_NUMBER_THREADS definition is not the number of CPUs on your SMP machine. The value of 4 appears to work quite well on a single core system, and may be adjusted upwards on SMP systems.
</p><p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  If you are developing applications outside Yocto, you can point the your build's sysroot to the sysroot, Yocto has generated using above steps. You can add the following to your build option <i>--sysroot=$(INSTALL_DIR)/build/arago-tmp-external-linaro-toolchain/sysroots/keystone-evm</i> to pick up the sysroot, the Yocto build has created.
</p><p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  For MCSDK 3.00.04.18 release, in the file: ./sources/meta-mcsdk/recipes-core/rhino/rhino_1.7r4.bbappend file:
The SRC_URI needs to be changed from: <a rel="nofollow" class="external free" href="ftp://ftp.freebsd.org/pub/FreeBSD/ports/distfiles/rhino/rhino1_7R4.zip">ftp://ftp.freebsd.org/pub/FreeBSD/ports/distfiles/rhino/rhino1_7R4.zip</a>  to <a rel="nofollow" class="external free" href="http://distcache.freebsd.org/ports-distfiles/rhino/rhino1_7R4.zip">http://distcache.freebsd.org/ports-distfiles/rhino/rhino1_7R4.zip</a>
</p>
<h4><span class="mw-headline" id="Building_other_components_in_Yocto">Building other components in Yocto</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=141" title="Edit section: Building other components in Yocto">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>There are other open source components for which are recipes are available in the yocto build system. And customers may choose to build them and add it to their file system.
</p><p>Any open source component for the platform, if available and compatible with the platform, can be built for the using the following bitbake command similar the build procedure for the filesystem.
</p><p>MACHINE=&lt;soc&gt;-evm TOOLCHAIN_BRAND=linaro ARAGO_BRAND=mcsdk bitbake &lt;name_of_recipe_without_version and file extension&gt;
</p><p>For releases older than MCSDK 3.0.4, ARAGO_BRAND=mcsdk is not required.
And also use &lt;soc&gt; as "keystone".
</p><p>For the releases MCSDK 3.0.4 and after use:
&lt;soc&gt; is "k2hk", "k2l" or "k2e"; 
</p><p>(e.g) MACHINE=&lt;soc&gt;-evm TOOLCHAIN_BRAND=linaro ARAGO_BRAND=mcsdk bitbake sudo
</p><p>This depending on the recipe will create the ipks under the appropriate directory structure under
</p>
<dl><dd><dl><dd>$(INSTALL_DIR)/build/arago-tmp-external-linaro-toolchain/deploy/ipk</dd></dl></dd></dl>
<p><br />
</p>
<h3><span class="mw-headline" id="Updating_a_user_space_component_in_MCSDK_filesystem">Updating a user space component in MCSDK filesystem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=142" title="Edit section: Updating a user space component in MCSDK filesystem">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The following procedure can  be used to update a user space component already available in MCSDK filesystem.
<br />
Prerequisite: Follow the procedure to create the build setup for Yocto build for the base MCSDK release.
</p>
<h4><span class="mw-headline" id="Step1:_Update_the_component_recipe">Step1: Update the component recipe</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=143" title="Edit section: Step1: Update the component recipe">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Locate the component recipe under the different YOCTO layers/git repositories cloned under oe-layersetup/sources/*.<br />
And modify locally or patch the recipe. <br />
( And if needed create a patch to keep it for reference, to help recreate the build)
</p><p><br />
</p>
<h4><span class="mw-headline" id="Step_2:_Build_the_component">Step 2: Build the component</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=144" title="Edit section: Step 2: Build the component">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>(Assuming the arm tools are setup based on yocto  build instructions)
</p>
<pre>   $ cd build 
   $ . conf/setenv 
   $ MACHINE=&lt;soc&gt;-evm TOOLCHAIN_BRAND=linaro ARAGO_BRAND=mcsdk bitbake &lt;component_recipe_name&gt;
</pre>
<p>Eg. 
</p>
<pre>   MACHINE=k2hk-evm TOOLCHAIN_BRAND=linaro ARAGO_BRAND=mcsdk bitbake ti-pa-bin
</pre>
<p>( Note with this build complete,  installable user space packages for the module will be  created under:
oe-layersetup/build/arago-tmp-external-linaro-toolchain/deploy/ipk/cortexa15hf-vfp-neon-3.8 
with name &lt;module-name&gt;*.ipk.
<br />
e.g
ti-pa-bin_03.00.00.10-r0_cortexa15hf-vfp-neon-3.8.ipk&#160;: This is the main package to be used with filesystem.
<br />
ti-pa-bin-dbg_03.00.00.10-r0_cortexa15hf-vfp-neon-3.8.ipk&#160;: This is debug package ( Normally not used).
<br />
ti-pa-bin-dev_03.00.00.10-r0_cortexa15hf-vfp-neon-3.8.ipk&#160;: This is dev package to be used with devkit.
<br />
)
</p>
<h4><span class="mw-headline" id="Step_3:_Add_package_to_filesystem">Step 3:  Add package to filesystem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=145" title="Edit section: Step 3: Add package to filesystem">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>There are two ways this can be added to the filesystem.
<br />
On the host machine:
<br />
-	Untar the filesystem in a host directory.
(e.g) 
</p>
<pre>   mkdir rootfs
   cd rootfs
   sudo tar xzf  ../tisdk-rootfs-&lt;k2e|k2h|k2l&gt;-evm.tar.gz
</pre>
<p>-	 Install the package into the filesystem.
</p>
<pre>   dpkg -x &lt;dirname&gt;/&lt;component_recipe_name&gt;_*.ipk &lt;dirname&gt;/rootfs
</pre>
<p>(e.g) 
</p>
<pre>   dpkg -x  ~/ti-pa-bin*.ipk ~/rootfs
</pre>
<p>-	Repackage the file system
</p>
<pre>   sudo tar czvf  . ../ tisdk-rootfs-&lt;k2e|k2h|k2l&gt;-evm-modified.tar.gz
</pre>
<p>( Now this filesytem can be used to create the UBI image etc).
<br />
On the target:
<br />
-   Tftp the *.ipks into the filesytem.
And use the following command to install it 
</p>
<pre>   opkg install &lt;component_recipe_name&gt;_*.ipk
</pre>
<p>e.g:
</p>
<pre>   opkg install ti-pa-bin_*.ipk
</pre>
<h3><span class="mw-headline" id="FAQ">FAQ</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=146" title="Edit section: FAQ">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>1. Error in coying toolchain files:
</p>
<pre>  | DEBUG: Executing shell function do_install
  | cp: cannot stat '/opt/linaro-3.1.0.3/sysroots/i686-arago-linux/usr/arm-linux-gnueabihf/libc/usr/share/*': No such file or directory
</pre>
<p><br />
Make sure the default shell is bash. If not, please use the following command: <br />
(to choose bash instead of dash)<br />
</p>
<pre>  sudo dpkg-reconfigure dash
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Flattened_Device_Tree">Flattened Device Tree</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=147" title="Edit section: Flattened Device Tree">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The Device Tree is a data structure for describing hardware. Rather than hard coding every detail of a device into an operating system, many aspect of the hardware can be described in a data structure that is passed to the operating system at boot time. The device tree is used both by Open Firmware, and in the standalone Flattened Device Tree (FDT) form. For more details refer [<a rel="nofollow" class="external autonumber" href="http://www.devicetree.org/Main_Page">[7]</a>]
</p>
<h3><span class="mw-headline" id="creating_dtb_image">creating dtb image</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=148" title="Edit section: creating dtb image">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Kernel tree has device tree compiler and can be build as part of the kernel build process. DTB can also be built using the dtc compiler part of the rootfs that is shipped with the kernel. Do the following to copy the dts files to rootfs (either on the Host nfs root directory or tftp to the EVM from Linux console) and build dtb
</p>
<pre>git clone <a rel="nofollow" class="external free" href="git://git.ti.com/keystone-linux/linux.git">git://git.ti.com/keystone-linux/linux.git</a> linux-keystone
cd linux-keystone
git reset --hard &lt;release tag&gt;
</pre>
<p>The release tag is obtained from the Release notes. Copy arch/arm/boot/dts/k2hk-evm.dts and arch/arm/boot/dts/skeleton.dtsi to the rootfs (either on Host nfs root directory if using nfs rootfs or rootfs on NAND on EVM if using rootfs on NAND )
</p><p>Once the Linux booted up with the released image, do the following:-
</p>
<pre>cd &lt;path where the dts files are copied&gt;
dtc -I dts -O dtb -o uImage-k2hk-evm.dtb k2hk-evm.dts
</pre>
<p>Copy the uImage-k2hk-evm.dtb to the tftp server or boot volume of the UBI depending on the rootfs used and reboot the EVM.
</p>
<h2><span id="UBI/UBIFS"></span><span class="mw-headline" id="UBI.2FUBIFS">UBI/UBIFS</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=149" title="Edit section: UBI/UBIFS">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="UBI">UBI</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=150" title="Edit section: UBI">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>UBI (Latin: "where?") stands for "Unsorted Block Images". It is a volume management system for raw flash devices which manages multiple logical volumes on a single physical flash device and spreads the I/O load (i.e, wear-leveling) across whole flash chip.
</p><p>In a sense, UBI may be compared to the Logical Volume Manager (LVM). Whereas LVM maps logical sectors to physical sectors, UBI maps logical eraseblocks to physical eraseblocks. But besides the mapping, UBI implements global wear-leveling and transparent I/O errors handling.
</p><p>An UBI volume is a set of consecutive logical eraseblocks (LEBs). Each logical eraseblock may be mapped to any physical eraseblock (PEB). This mapping is managed by UBI, it is hidden from users and it is the base mechanism to provide global wear-leveling (along with per-physical eraseblock erase counters and the ability to transparently move data from more worn-out physical eraseblocks to less worn-out ones).
</p><p>UBI volume size is specified when the volume is created and may later be changed (volumes are dynamically re-sizable). There are user-space tools which may be used to manipulate UBI volumes.
</p><p>There are 2 types of UBI volumes - dynamic volumes and static volumes. Static volumes are read-only and their contents are protected by CRC-32 checksums, while dynamic volumes are read-write and the upper layers (e.g., a file-system) are responsible for ensuring data integrity.
</p><p>UBI is aware of bad eraseblocks (e.g., NAND flash may have them) and frees the upper layers from any bad block handling. UBI has a pool of reserved physical eraseblocks, and when a physical eraseblock becomes bad, it transparently substitutes it with a good physical eraseblock. UBI moves good data from the newly appeared bad physical eraseblocks to good ones. The result is that users of UBI volumes do not notice I/O errors as UBI takes care of them.
</p><p>NAND flashes may have bit-flips which occur on read and write operations. Bit-flips are corrected by ECC checksums, but they may accumulate over time and cause data loss. UBI handles this by moving data from physical eraseblocks which have bit-flips to other physical eraseblocks. This process is called scrubbing. Scrubbing is done transparently in background and is hidden from upper layers.
</p><p>Here is a short list of the main UBI features:
</p>
<dl><dd><ul><li>UBI provides volumes which may be dynamically created, removed, or re-sized;</li>
<li>UBI implements wear-leveling across whole flash device (i.e., you may continuously write/erase only one logical eraseblock of an UBI volume, but UBI will spread this to all physical eraseblocks of the flash chip);</li>
<li>UBI transparently handles bad physical eraseblocks;</li>
<li>UBI minimizes chances to lose data by means of scrubbing.</li></ul></dd></dl>
<p>For more information on UBI, refer [<a rel="nofollow" class="external autonumber" href="http://www.linux-mtd.infradead.org/doc/ubi.html">[8]</a>[UBI]]
</p>
<h3><span class="mw-headline" id="UBIFS">UBIFS</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=151" title="Edit section: UBIFS">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>UBIFS may be considered as the next generation of the JFFS2 file-system.
</p><p>JFFS2 file system works on top of MTD devices, but UBIFS works on top of UBI volumes and cannot operate on top of MTD devices. In other words, there are 3 subsystems involved:
</p><p>MTD subsystem, which provides uniform interface to access flash chips. MTD provides an notion of MTD devices (e.g., /dev/mtd0) which basically represents raw flash UBI subsystem, which is a wear-leveling and volume management system for flash devices. .UBI works on top of MTD devices and provides a notion of UBI volumes; UBI volumes are higher level entities than MTD devices and they are devoid of many unpleasant issues MTD devices have (e.g., wearing and bad blocks); For more information on MTD, refer [<a rel="nofollow" class="external autonumber" href="http://www.linux-mtd.infradead.org/doc/general.html">[9]</a>[MTD]]
</p><p>For more information on UBIFS, refer [<a rel="nofollow" class="external autonumber" href="http://www.linux-mtd.infradead.org/doc/ubifs.html">[10]</a>[UBIFS]]
</p><p><br />
</p>
<h3><span class="mw-headline" id="UBIFS_User-space_tools">UBIFS User-space tools</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=152" title="Edit section: UBIFS User-space tools">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>UBI user-space tools, as well as other MTD user-space tools, are available from the the following git repository: <a rel="nofollow" class="external free" href="git://git.infradead.org/mtd-utils.git">git://git.infradead.org/mtd-utils.git</a>
</p><p>The repository contains the following UBI tools:
</p>
<dl><dd><ul><li>ubinfo - provides information about UBI devices and volumes found in the system</li>
<li>ubiattach - attaches MTD devices (which describe raw flash) to UBI and creates corresponding UBI devices</li>
<li>ubidetach - detaches MTD devices from UBI devices (the opposite to what ubiattach does)</li>
<li>ubimkvol - creates UBI volumes on UBI devices</li>
<li>ubirmvol - removes UBI volumes from UBI devices</li>
<li>ubiupdatevol - updates UBI volumes. This tool uses the UBI volume update feature which leaves the volume in "corrupted" state if the update was interrupted; additionally, this tool may be used to wipe out UBI volumes.</li>
<li>ubicrc32 - calculates CRC-32 checksum of a file with the same initial seed as UBI would use</li>
<li>ubinize - generates UBI images</li>
<li>ubiformat - formats empty flash, erases flash and preserves erase counters, flashes UBI images to MTD devices</li>
<li>mtdinfo - reports information about MTD devices found in the system.</li></ul></dd></dl>
<p>All UBI tools support "-h" option and print sufficient usage information.
</p>
<h3><span class="mw-headline" id="NAND_Layout">NAND Layout</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=153" title="Edit section: NAND Layout">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The NAND flash in the EVM contains three partitions:-
</p>
<dl><dd><ul><li>bootloader - Contains u-boot</li>
<li>params - contains env variables</li>
<li>ubifs - contains following UBI volumes:-</li></ul>
<dl><dd><ul><li>boot volume - contains Kernel image (uImage), device tree blob etc,</li>
<li>rootfs volume - contains the rootfs which is the primary filesystem</li></ul></dd></dl></dd></dl>
<p><br /><b>Note</b>: bootloader partition is blank, u-boot is stored on SPI NOR flash.
</p>
<h3><span class="mw-headline" id="Compiling_UBIFS_Tools">Compiling UBIFS Tools</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=154" title="Edit section: Compiling UBIFS Tools">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The MTD and UBI user-space tools are available from the the following git repository: <a rel="nofollow" class="external free" href="git://git.infradead.org/mtd-utils.git">git://git.infradead.org/mtd-utils.git</a>
</p><p>Suggest using 1.4.8 of the mtd-utils
</p><p>For instructions on compiling MTD-utils, refer [<a rel="nofollow" class="external autonumber" href="MTD_Utilities.html#MTD-Utils_Compilation">[11]</a>[MTD-Utils Compilation]]. In the instruction for building mtd-utils, please replace PREFIX with INSTALL_DIR. The makefile doesn't like the use of PREFIX variable and result in build error. This is a work around to fix the build error.
</p><p><br />
</p>
<h4><span class="mw-headline" id="Creating_UBIFS_file_system">Creating UBIFS file system</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=155" title="Edit section: Creating UBIFS file system">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>For information on how to create a UBIFS image. refer [<a rel="nofollow" class="external autonumber" href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_mkfubifs">[12]</a>]
</p><p><br />
</p>
<dl><dd><ul><li>mkfs.ubifs</li></ul></dd></dl>
<p><br />
</p>
<pre>mtd-utils# mkfs.ubifs -r filesystem/ -o ubifs.img -F -m 2048 -e 126976 -c 936
</pre>
<dl><dd>Where
<dl><dd><ul><li>-m 2KiB (or 2048). The minimum I/O size of the underlying UBI and MTD devices. In our case, we are running</li></ul>
<dl><dd>the flash with no sub-page writes, so this is a 2KiB page.</dd></dl>
<ul><li>-e 124KiB (or 126976) Erase Block Size: UBI requires 2</li></ul>
<dl><dd>minimum I/O units out of each Physical Erase Block (PEB) for overhead: 1 for maintaining erase count information, and 1</dd>
<dd>for maintaining the Volume ID information. The PEB size for the Micron flash is 128KiB, so this leads to each Logical</dd>
<dd>Erase Block (LEB) having 124KiB available for data.</dd></dl>
<ul><li>-c 936 The maximum size, in LEBs, of this file system. See calculation below for how this number is determined.</li>
<li>-r filesystem. Use the contents of the 'filesystem/' directory to generate the initial file system image.</li>
<li>-o ubifs.img Output file.</li>
<li>-F parameter is used to set the "fix up free space" flag in the superblock, which forces UBIFS to "fixup" all the free space which it is going to use.</li></ul></dd></dl></dd></dl>
<p><br />
</p><p>The output of the above command, ubifs.img is fed into the 'ubinize' program to wrap it into a UBI image.
</p>
<h4><span class="mw-headline" id="Creating_UBI_image">Creating UBI image</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=156" title="Edit section: Creating UBI image">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The images produced by mkfs.ubifs must be further fed to the ubinize tool to create a UBI image which must be put to the raw flash to be used a UBI partition.
</p>
<dl><dd><ul><li>Create ubinize.cfg file and write the contents into it</li></ul></dd></dl>
<pre>mtd-utils# vi ubinize.cfg
[ubifs_rootfs_volume] &lt;== Section header
 mode=ubi &lt;== Volume mode (other option is static)
 image=ubifs.img &lt;== Source image
 vol_id=0 &lt;== Volume ID in UBI image
 vol_size=113MiB &lt;== Volume size
 vol_type=dynamic &lt;== Allow for dynamic resize
 vol_name=rootfs &lt;== Volume name
 vol_flags=autoresize &lt;== Autoresize volume at first mount [See calculations below to determine the value
 associated with 'vol_size']
</pre>
<p><b>Note</b>: There is a sample ubinize.cfg under mcsdk_linux_3_00_00_xx/images directory which is used to create the MCSDK ubi image.
</p><p><br />
</p>
<dl><dd><ul><li>ubinize</li></ul></dd></dl>
<pre>mtd-utils# ubi-utils/ubinize -o ubifs.ubi -m 2048 -p 128KiB -s 2048 -O 2048 ubinize.cfg
</pre>
<dl><dd>Where:
<dl><dd><ul><li>-o ubifs.ubi Output file</li>
<li>-m 2KiB (or 2048) Minimum flash I/O size of 2KiB page</li>
<li>-p 128KiB Size of the physical eraseblock of the flash this UBI image is created for</li>
<li>-s 2028 Use a sub page size of 2048 -O 2048 offset if the VID header from start of the physical eraseblock</li></ul></dd></dl></dd></dl>
<p>The output of the above command, 'ubifs.ubi' is the required image.
</p>
<h3><span class="mw-headline" id="Calculations">Calculations</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=157" title="Edit section: Calculations">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Usable Size Calculation As documented here, UBI reserves a certain amount of space for management and bad PEB handling operations. Specifically:
</p>
<dl><dd><ul><li>2 PEBs are used to store the UBI volume table</li>
<li>1 PEB is reserved for wear-leveling purposes;</li>
<li>1 PEB is reserved for the atomic LEB change operation;</li>
<li>a&#160;% of PEBs is reserved for handling bad EBs. The default for NAND is 1%</li>
<li>UBI stores the erase counter (EC) and volume ID (VID) headers at the beginning of each PEB.</li>
<li>1 min I/O unit is required for each of these.</li></ul></dd></dl>
<p>To calculate the full overhead, we need the following values:
</p>
<pre>Symbol            Meaning                                                             value
------            -------                                                             ---------------------------
SP                PEB Size                                                            128KiB
SL                LEB Size                                                            128KiB - 2 * 2KiB = 124 KiB
P                 Total number of PEBs on the MTD device                              126.5MiB / 128KiB = 1012
B                 Number of PEBs reserved for bad PEB handling                        1% of P = 10.12(round to 10)
O                 The overhead related to storing EC and VID headers in bytes,        4KiB
                  i.e. O = SP - SL
</pre>
<p>Assume a partition size of 126.5M (We use 1.5M for bootloader and params leaving 126.5M for ubifs partition)
</p><p>UBI Overhead = (B + 4) * SP + O * (P - B - 4) = (10 + 4) * 128Kib + 4 KiB * (1012 - 9- 4) = 5784 KiB = 45.1875 PEBs (round to 45)
</p><p>This leaves us with 967 PEBs or 123776 KiB available for user data.
</p><p>Note that we used "-c 998 " in the above mkfs.ubifs command line to specify the maximum filesystem size, not "-c 967" The reason for this is that mkfs.ubifs operates in terms of LEB size (124 KiB), not PEB size (128Kib). 123776 KiB / 124 Kib
</p>
<pre>= 998.19 (round to 998).
</pre>
<p>Volume size = 123776 KiB (~120 MiB)
</p><p>Use this caculation method to calculate the size required for each ubifs image going into each of the ubifs volumes on NAND.
</p><p>A sample ubinize.cfg file is included in the images folder of the release. This was used to create the keystone-evm-ubifs.ubi image. There is also a keystone-evm-boot.ubifs that is part of the release images folder. This was created as follows: Use the mkfs.ubifs and ubinize utilities provided with the release (under bin folder)
</p>
<pre>cd &lt;release_folder&gt;/mcsdk_linux_&lt;version&gt;/images
mkdir boot
cp uImage-keystone-evm.bin boot/
cp uImage-k2hk-evm.dtb boot/
cp skern-keystone-evm.bin boot/
export PATH=&lt;release_folder&gt;/mcsdk_linux_&lt;version&gt;/bin:$PATH
mkfs.ubifs -r boot -F -o keystone-evm-boot.ubifs -m 2048 -e 126976 -c 41
cp keystone-evm-boot.ubifs images/
cd images/
ubinize -o keystone-evm-ubifs.ubi -m 2048 -p 128KiB -s 2048 -O 2048 ubinize.cfg
</pre>
<h3><span class="mw-headline" id="Using_UBIFS_file_system">Using UBIFS file system</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=158" title="Edit section: Using UBIFS file system">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Preparing NAND partition Kindly erase the NAND partition before using it for UBI file system. The partition can be erased from either u-boot or from Linux.
</p><p>Follow below steps to erase.
</p><p>From U-boot,
</p><p>1. Reset environment variables to default values and set the boot mode to ubi:
</p>
<pre>u-boot# env default -f -a
u-boot# setenv boot ubi
</pre>
<p><b>Note:</b>On Rev 1.0 or older EVMs, the NAND part used is 128M. So following commands needed
to set mtdparts
</p>
<pre>u-boot# setenv mtdparts 'mtdparts=davinci_nand.0:1024k(bootloader)ro,512k(params)
        ro,129536k(ubifs)'
</pre>
<p>2. Set serverip and tftp_root env variables:
</p>
<pre>u-boot# setenv serverip &lt;TFTP server IP address&gt;
u-boot# setenv tftp_root &lt;directory under TFTP root&gt;
u-boot# saveenv
</pre>
<p>3. Create ${tftp_root} directory under TFTP root and copy mcsdk_linux_3_00_00_xx/images/keystone-evm-ubifs.ubi to ${tftp_root} directory
</p><p>4. TFTP keystone-evm-ubifs.ubi to DDR3 memory and write ubi image from DDR3 to ubifs partition on NAND:
</p>
<pre>u-boot# setenv addr_file 0x82000000
u-boot# nand erase.part ubifs
u-boot# dhcp ${addr_file} ${tftp_root}/keystone-evm-ubifs.ubi
u-boot# nand write ${addr_file} ubifs ${filesize}
</pre>
<p>or use the automated scripts
</p>
<pre>u-boot# run get_ubi_net
u-boot# run burn_ubi
</pre>
<p>Note that the above assumes name_ubi env variable is set to "keystone-evm-ubifs.ubi". If you are using rt version of the ubi image, change name_ubi env variable to match with the rt file name.
</p><p><b>Note</b>: the file size of the keystone-evm-ubifs.ubi is printed on console when tftp is completed.
</p><p><b>Note</b>: If you do not have a DHCP server on your network, you may assign a static IP using the U-Boot command "setenv ipaddr &lt;ipadd&gt;".
</p><p><b>Note</b>: if running on Rev 1.0 or older EVMs, please update dts for correct mtd
partition size to account for 128M NAND available as follows:-
</p><p>Also DTS file needs to be modified for the size of NAND as well as follows:-
</p>
<pre>  nand@2,0 {
      .....
      partition@180000 {
         label = "ubifs";
         reg = &lt;0x180000 0x7e80000&gt;;
      };
  };
</pre>
<p>Rebuild DTB and create a boot ubifs image (keystone-evm-boot.ubifs) using the new DTBas described at the end of the section<a href="#Calculations"> creating boot ubifs</a>. Then remove and create a new boot volume on UBI from u-boot using following commands
</p>
<pre>u-boot# dhcp ${addr_file} ${tftp_root}/keystone-evm-boot.ubifs
u-boot# ubi part ubifs
u-boot# ubifsmount boot
u-boot# ubi remove boot
u-boot# ubi create boot [size in hex of the ubifs image]
u-boot# ubi write $addr_file} boot [size in hex of the ubifs image]
</pre>
<p>From Linux. Assuming MTD partition 2 needs to be erased and used for UBI file system.
</p>
<pre>root@arago-armv7:~# flash_eraseall /dev/mtd2
</pre>
<p><br />Flashing UBIFS image to a NAND partition
</p><p>We can Flash UBIFS image from either Linux Kernel or U-Boot.
</p><p>Follow steps mentioned here to create an UBIFS image.
</p><p>From Linux,
</p><p>Flash the UBI file system image (ubifs.ubi) to MTD partition "X"
</p><p>ubiformat /dev/mtd&lt;X&gt; -f ubifs.ubi -s 2028 -O 2048
</p><p>Assuming 2nd mtd partition, we can use the following command to flash the ubifs ubi image to partition 2.
</p>
<pre>#flash_erase /dev/mtd2 0 0
#ubiformat /dev/mtd2 -f keystone-evm-ubifs.ubi -s 2048 -O 2048
</pre>
<p>Using UBIFS image as root file system
</p><p>Set up the bootargs environment variable as below to use the UBIFS file system image present in a MTD partition:
</p>
<pre>setenv bootargs 'console=ttyS0,115200n8 mem=512M earlyprintk debug rootwait=1 rw ubi.mtd=X,YYYY rootfstype=ubifs
root=ubi0:rootfs rootflags=sync'
</pre>
<p>Where X is the MTD partition number being used for file system and YYYY is the NAND page size. make sure that an UBI file system is flashed into this partition before passing it as a boot partition for Linux.
</p><p>Assuming 2nd mtd partition and page size of 2048,
</p>
<pre>setenv bootargs 'console=ttyS0,115200n8 mem=512M earlyprintk debug rootwait=1 rw ubi.mtd=2,2048 rootfstype=ubifs
root=ubi0:rootfs rootflags=sync'
</pre>
<h3><span class="mw-headline" id="Updating_Boot_volume_images_from_Linux_kernel">Updating Boot volume images from Linux kernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=159" title="Edit section: Updating Boot volume images from Linux kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The files in the boot volume may be removed and replaced by new file and EVM may be rebooted using the new images. See below the steps to replace the file in boot volume.
</p>
<pre>root@keystone-evm:~# mkdir /mnt/boot
root@keystone-evm:~# mount -t ubifs ubi0_0 /mnt/boot
</pre>
<p>&lt;syntaxhighlight lang="c"&gt;
[ 1337.657081] UBIFS: mounted UBI device 0, volume 0, name "boot"
[ 1337.663070] UBIFS: file system size: 3936256 bytes (3844 KiB, 3 MiB, 31 LEBs)u
[ 1337.670334] UBIFS: journal size: 1142785 bytes (1116 KiB, 1 MiB, 8 LEBs)
[ 1337.677502] UBIFS: media format: w4/r0 (latest is w4/r0)
[ 1337.683297] UBIFS: default compressor: lzo
[ 1337.687360] UBIFS: reserved for root: 0 bytes (0 KiB)
&lt;/syntaxhighlight&gt;
</p><p><br />
</p>
<pre>root@keystone-evm:~# root@keystone-evm:~# cd /mnt/boot
root@keystone-evm:/mnt/boot# ls
uImage-k2hk-evm.dtb  uImage-keystone-evm.bin skern-keystone-evm.bin
</pre>
<p>The above files can be deleted and overwritten with new file. For example to replace the dtb file, do
</p>
<pre>root@keystone-evm:/mnt/boot# rm uImage-k2hk-evm.dtb
</pre>
<p>TFTP the uImage-k2hk-evm.dtb to this folder or using the DTC compiler on target DTS file may compiled and saved in this folder. Please note that the file name should match with default files in the boot volume.
</p><p>Once done umount the folder as
</p>
<pre>root@keystone-evm:/# umount /mnt/boot
UBIFS: un-mount UBI device 0, volume 0 root@keystone-evm:/# reboot
</pre>
<h2><span id="SYS/BIOS"></span><span class="mw-headline" id="SYS.2FBIOS">SYS/BIOS</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=160" title="Edit section: SYS/BIOS">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Placeholder for future
</p>
<h1><span class="mw-headline" id="DSP_Subsystem">DSP Subsystem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=161" title="Edit section: DSP Subsystem">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Overview_3">Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=162" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The Multicore Software Development Kit (MCSDK) provides the core foundational building blocks that facilitate application software development on TI's high performance and multicore SoC. The foundational DSP components include:
</p>
<dl><dd><dl><dd><ul><li>SYS/BIOS which is a light-weight real-time embedded operating system for TI devices</li>
<li>Chip support libraries, drivers, and basic platform utilities</li>
<li>Interprocessor communication for communication across cores and devices</li>
<li>Basic networking stack and protocols</li>
<li>Optimized application-specific and application non-specific algorithm libraries</li>
<li>Debug and instrumentation</li>
<li>Bootloaders and boot utilities</li>
<li>Demonstrations and examples</li></ul></dd></dl></dd></dl>
<p>The purpose of this <i>User's Guide</i> is to provide more detailed information regarding the software elements and infrastructure provided with MCSDK. MCSDK pulls together all the elements into demonstrable multicore applications and examples for supported EVMs. The objective being to demonstrate device, platform, and software capabilities and functionality as well as provide the user with instructive examples. The software provided is intended to be used as a reference when starting their development.<br />
</p><p><b>Note</b>: In deciding the endianness of the DSP, all the features using little endian Linux configuration are only supported with Little endian DSP configuration in this release. Although some of the modules are tested standalone with Big endian DSP.
</p><p><b>Note</b>: It is expected the user has gone through the <i>EVM Quick Start Guide (TBD)&#160;</i>provided with their EVM and have booted the out-of-box demonstration application flashed on the device. It is also assumed the user has installed both CCS and the MCSDK.<br />
</p>
<h3><span class="mw-headline" id="API_and_LLD_User_Guides">API and LLD User Guides</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=163" title="Edit section: API and LLD User Guides">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>API Reference Manuals and LLD User Guides are provided with the software. You can reference them from the Eclipse Help system in CCS or you can navigate to the components <i>doc</i> directory and view them there.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Tools_Overview">Tools Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=164" title="Edit section: Tools Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The following documents provide information on the various development tools available to you.
</p>
<table style="width: 700px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Description</b>
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="CCSv5_Getting_Started_Guide.html">CCS v5 Getting Started Guide</a>
</td>
<td>How to get up and running with CCS v5
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="Xds_560.html">XDS560 Emulator Information</a>
</td>
<td>Information on XDS560 emulator
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="https://software-dl.ti.com/ccs/esd/documents/xdsdebugprobes/emu_xds100.html">XDS100 Emulator&#160;Information</a>
</td>
<td>Information on XDS100 emulator
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://focus.ti.com/lit/ug/spru187t/spru187t.pdf">TMS320C6000 Optimizing Compiler v 7.3</a>
</td>
<td>Everything you wanted to know about the compiler, assembler, library-build process and C++ name demangler.
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://focus.ti.com/lit/ug/spru186v/spru186v.pdf">TMS320C6000 Assembly Language Tools v 7.3</a>
</td>
<td>More in-depth information on the assembler, linker command files and other utilities.
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="Multicore_System_Analyzer.html">Multi-core System Analyzer</a>
</td>
<td>How to use and integrate the system analyzer into your code base.
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://rtsc.eclipse.org/docs-tip/Demo_of_the_RTSC_Platform_Wizard_in_CCSv4">Eclipse Platform Wizard</a>
</td>
<td>How to create a platform for RTSC. The demo uses CCSv4 but the platform screens are the same in CCSv5.
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://rtsc.eclipse.org/docs-tip/Runtime_Object_Viewer">Runtime Object Viewer</a>
</td>
<td>How to use the Object Viewer for Eclipse Based Debugging.
</td></tr></tbody></table>
<p><br />
</p>
<h3><span class="mw-headline" id="Hardware_-_EVM_Overview">Hardware - EVM Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=165" title="Edit section: Hardware - EVM Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The following documents provide information about the EVM.
</p>
<table style="width: 600px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Description</b>
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://focus.ti.com/general/docs/video/Portal.tsp?entryid=0_55svdeqr&amp;lang=en">Introducing the C66x Lite EVM Video</a>
</td>
<td>Short video on the C66x Lite Evaluation Module, the cost-efficient development tool from Texas Instruments that enables developers to quickly get started working on designs for the C66x multicore DSPs based on the KeyStone architecture.
</td></tr></tbody></table>
<p><br />
</p>
<h3><span class="mw-headline" id="Hardware_-_Processor_Overview">Hardware - Processor Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=166" title="Edit section: Hardware - Processor Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The following documents provide information about the processor used on the EVM.
</p>
<table style="width: 600px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Description</b>
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/gpn/tci6636k2h">TCI6636K2H Data Manual</a>
</td>
<td rowspan="3">Data manual for specific TI DSP
</td></tr></tbody></table>
<p><br />
</p>
<h3><span class="mw-headline" id="Related_Software">Related Software</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=167" title="Edit section: Related Software">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This section provides a collection links to additional software elements that may be of interest.
</p>
<table style="width: 700px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Link</b>
</td>
<td bgcolor="#c0c0c0"><b>Description</b>
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://www.linux-c6x.org/wiki/index.php/Main_Page">C6x DSP Linux Project</a>
</td>
<td>Community site for C6x DSP Linux project
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://focus.ti.com/docs/toolsw/folders/print/telecomlib.html">Telecom Libraries</a>
</td>
<td>TI software folder for information and download of Telecom Libraries (Voice, Fax, etc) for TI processors.
</td></tr>
<tr>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/tool/s2meddus">Medical Imaging Software Tool Kits</a>
</td>
<td>TI software folder for information and download of medical imaging software tool kits for TI processors.
</td></tr></tbody></table>
<p><br />
</p>
<h2><span id="Platform_Development_Kit_(PDK)"></span><span class="mw-headline" id="Platform_Development_Kit_.28PDK.29">Platform Development Kit (PDK)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=168" title="Edit section: Platform Development Kit (PDK)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span id="Chip_Support_Library_(CSL)"></span><span class="mw-headline" id="Chip_Support_Library_.28CSL.29">Chip Support Library (CSL)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=169" title="Edit section: Chip Support Library (CSL)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div><div style="width: 4in; float: left">
<p>The Chip Support Library constitutes a set of well-defined APIs that abstract low-level details of the underlying SoC device so that a user can configure, control (start/stop, etc.) and have read/write access to peripherals without having to worry about register bit-field details. The CSL services are implemented as distinct modules that correspond with the underlying SoC device modules themselves. By design, CSL APIs follow a consistent style, uniformly across Processor Instruction Set Architecture and are independent of the OS. This helps in improving portability of code written using the CSL.
</p><p>CSL is realized as twin-layer  a basic register-layer and a more abstracted functional-layer. The lower register layer comprises of a very basic set of macros and type definitions. The upper functional layer comprises of C functions that provide an increased degree of abstraction, but intended to provide directed control of underlying hardware.
</p><p>It is important to note that CSL does not manage data-movement over underlying h/w devices. Such functionality is considered a prerogative of a device-driver and serious effort is made to not blur the boundary between device-driver and CSL services in this regard.
</p><p>CSL does not model the device state machine. However, should there exist a mandatory (hardware dictated) sequence (possibly atomically executed) of register reads/writes to setup the device in chosen operating modes as per the device data sheet, then CSL does indeed support services for such operations.
</p><p>The CSL services are decomposed into modules, each following the twin-layer of abstraction described above. The APIs of each such module are completely orthogonal (one modules API does not internally call API of another module) and do not allocate memory dynamically from within. This is key to keeping CSL scalable to fit the specific usage scenarios and ease the effort to ROM a CSL based application.
</p><p>The source code of the CSL is located under $(TI_PDK_INSTALL_DIR)\packages\ti\csl directory.<br />
</p><p><b>Note</b>:
</p><p>The CSL is build with LLD using same script, please refer the LLD build section for details
</p><p>For KeyStone2 Devices CSL Package includes support for multiple devices. Software layer using CSL source would need to pass compile time define -DDEVICE_XXX. Refer ti\csl\cslr_device.h for list of devices/SOC's
</p>
</div><div style="padding-left: 10px; float: left">
<table border="5" cellpadding="2" width="50%">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>Chip Support Library Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Library
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>PDK
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>pdk_keystone2_&lt;version&gt;\packages\ti\csl
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little &amp; Big
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\csl
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>.vecs , .switch, .args, .cio
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>L2 Cache
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\csl
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="Chip_support_library.html">Chip support library</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Product Updates</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
</div></div><div style="clear: both"></div>
<p><br />
</p>
<h3><span class="mw-headline" id="Low_Level_Drivers">Low Level Drivers</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=170" title="Edit section: Low Level Drivers">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div><div style="padding-left: 10px; width: 4in; float: left">
<p>The Low Level Drivers (LLDs) provide ineterfaces to the various peripherals on your SoC Device.
</p><p>The source code for the LLDs is located under $(TI_PDK_INSTALL_DIR)\packages\ti\drv directory.
</p><p>The following table shows PDK LLD vs. SoC Availability
</p>
<table border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Driver</b>
</td>
<td bgcolor="#c0c0c0"><b>Keystone2</b>
</td></tr>
<tr>
<td>CSL
</td>
<td>X
</td></tr>
<tr>
<td>QMSS
</td>
<td>X
</td></tr>
<tr>
<td>PKTDMA (CPPI)
</td>
<td>X
</td></tr>
<tr>
<td>PA
</td>
<td>X
</td></tr>
<tr>
<td>SA
</td>
<td>X
</td></tr>
<tr>
<td>SRIO
</td>
<td>X
</td></tr>
<tr>
<td>PCIe
</td>
<td>X
</td></tr>
<tr>
<td>Hyperlink
</td>
<td>X
</td></tr>
<tr>
<td>EDMA3
</td>
<td>X
</td></tr>
<tr>
<td>FFTC
</td>
<td>X
</td></tr>
<tr>
<td>TCP3d
</td>
<td>X
</td></tr>
<tr>
<td>BCP
</td>
<td>X
</td></tr>
<tr>
<td>RM
</td>
<td>X
</td></tr>
<tr>
<td>DFE
</td>
<td>X
</td></tr>
<tr>
<td>IQN2
</td>
<td>X
</td></tr>
<tr>
<td>TSIP
</td>
<td>X
</td></tr>
<tr>
<td>AIF2
</td>
<td>X
</td></tr></tbody></table>
<p><br />
</p>
</div><div style="padding-left: 10px; float: left">
<table border="5" cellpadding="2" width="50%">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>Driver Library Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Library
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>PDK
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>pdk_keystone2_&lt;version&gt;\packages\ti\drv
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little &amp; Big
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="Chip_support_library.html">Chip support library</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Product Updates</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
</div></div><div style="clear: both"></div>
<p><br />
</p>
<h4><span class="mw-headline" id="Multicore_Navigator">Multicore Navigator</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=171" title="Edit section: Multicore Navigator">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Multicore Navigator provides multicore-safe communication while reducing load on DSPs in order to improve overall system performance.
</p>
<h5><span id="Packet_DMA_(CPPI)"></span><span class="mw-headline" id="Packet_DMA_.28CPPI.29">Packet DMA (CPPI)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=172" title="Edit section: Packet DMA (CPPI)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The CPPI low level driver can be used to configure the CPPI block in CPDMA for the Packet Accelerator (PA). The LLD provides resource management for descriptors, receive/transmit channels and receive flows.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugr9c">User Guide</a>
</td></tr>
<tr>
<td>LLD Users Guide
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\cppi\docs\ CPPI_QMSS_LLD_SDS.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\cppi\docs\cppilldDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_CPPI_LLD.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h5><span id="Queue_Manager_(QMSS)"></span><span class="mw-headline" id="Queue_Manager_.28QMSS.29">Queue Manager (QMSS)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=173" title="Edit section: Queue Manager (QMSS)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The QMSS low level driver provides the interface to Queue Manager Subsystem hardware which is part of the Multicore Navigator functional unit for a keystone device. QMSS provides hardware assisted queue system and implements fundamental operations such as en-queue and de-queue, descriptor management, accumulator functionality and configuration of infrastructure DMA mode. The LLD provides APIs to get full entitlement of supported hardware functionality.
</p><p>The LLD also includes accumulation and QoS (Quality of Service) firmware.  QoS enables restriction of data rates in bytes per second or packets per second, weighted round robin queue selection, and selective descriptor dropping for oversubscribed queues.  Accumulation The APIs are provided through the LLD.  The API documentation for both QoS and Accumulator is available in the API Reference manual below, for all versions of MCSDK.  The capabilities of the QoS firmware are documented in their design documents, which are present in MCSDK 3.1.4 and later.  The capabilities of the accumulator are documented in the Hardware Peripheral User Guide.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugr9c">User Guide</a>
</td></tr>
<tr>
<td>LLD Users Guide
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\qmss\docs\CPPI_QMSS_LLD_SDS.pdf
</td></tr>
<tr>
<td>QoS (Quality of Service) Design Document covering qos_sched_drop_sched, qos_sched, and qos_sched_wide.
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\qmss\docs\firmware\qos_sched,qos_sched_drop_sched,qos_sched_wide.pdf
</td></tr>
<tr>
<td>QoS (Quality of Service) Design Document covering qos (leaky bucket and SRIO TX context tracking).
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\qmss\docs\firmware\qos.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\qmss\docs\qmsslldDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_QMSS_LLD.pdf
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h5><span id="Packet_Library_(PKTLIB)"></span><span class="mw-headline" id="Packet_Library_.28PKTLIB.29">Packet Library (PKTLIB)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=174" title="Edit section: Packet Library (PKTLIB)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Module expands underlying CPPI hardware descriptors for optimal usage at application layer.Functionality includes: - Zero Copy operations for Packet split/merge,Cloning - Headroom/Tail room addition through merge operations - Allocation of packet buffer and descriptors during startup time
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Module Users Guide
</td>
<td>$(TI_TRANSPORT_NET_LIB_INSTALL_DIR)\docs\TransportNetLib_UserGuide.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\runtime\pktlib\docs\doxygen\html\index.html
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\runtime\pktlib\docs\ReleaseNotes_pktlib.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h4><span id="Network_Co-processor_(NETCP)"></span><span class="mw-headline" id="Network_Co-processor_.28NETCP.29">Network Co-processor (NETCP)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=175" title="Edit section: Network Co-processor (NETCP)">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>NETCP provides hardware accelerator functionality for processing Ethernet packets.
</p>
<h5><span id="Security_Accelerator_(SA)"></span><span class="mw-headline" id="Security_Accelerator_.28SA.29">Security Accelerator (SA)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=176" title="Edit section: Security Accelerator (SA)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The SA also known as cp_ace (Adaptive Cryptographic Engine) is designed to provide packet security for IPsec, SRTP and 3GPP industry standards. The SA LLD provides APIs to abstract configuration and control between application and the SA. Similar to the PA LLD, it does not provide a transport layer. The Multicore Navigator is used to exchange control packets between the application and the SA firmware.
</p><p><b>Note</b>: Due to export control restrictions the SA driver is a separate download from the rest of the MCSDK.
</p><p><br />Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugy6">User Guide</a>
</td></tr>
<tr>
<td>LLD Users Guide
</td>
<td>$(TI_SA_LLD_&lt;ver&gt;_INSTALL_DIR)\sasetup\docs\UserGuide_SA_LLD.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_SA_LLD_&lt;ver&gt;_INSTALL_DIR)\sasetup\packages\ti\drv\sa\docs\doxygen\sa_lld_docs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_SA_LLD_&lt;ver&gt;_INSTALL_DIR)\sasetup\packages\ti\drv\sa\docs\ReleaseNotes_SA_LLD.pdf
</td></tr></tbody></table>
<h5><span id="Packet_Accelerator_(PA)"></span><span class="mw-headline" id="Packet_Accelerator_.28PA.29">Packet Accelerator (PA)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=177" title="Edit section: Packet Accelerator (PA)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The PA LLD is used to configure the hardware PA and provides an abstraction layer between an application and the PA firmware. This does not include a transport layer. Commands and data are exchanged between the PA and an application via the Mutlicore Navigator.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugs4">User Guide</a>
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\pa\docs\doxygen\html\index.html
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_PA_LLD.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h5><span id="Network_Adaptation_Layer_(NWAL)"></span><span class="mw-headline" id="Network_Adaptation_Layer_.28NWAL.29">Network Adaptation Layer (NWAL)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=178" title="Edit section: Network Adaptation Layer (NWAL)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Module provides higher level network adaptation layer, and abstracts NETCP access to all upper software layers in TransportNetLib package. Module uses API services from PA/SA/CPPI/QMSS/PKTLIB&#160;modules for control packets towards NetCP. Additionally module provides API for packet transmit and receive from NETCP
</p><p>Additional documentation can be found in: <br />
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Module Users Guide covered in TransportNetLib User Guide<br />
</td>
<td>$(TI_TRANSPORT_NET_LIB_INSTALL_DIR)\docs\TransportNetLib_UserGuide.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\nwal\docs\html\index.html
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\nwal\docs\\ReleaseNotes_NWAL.pdf
</td></tr>
<tr>
<td>User Guide<br />
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\nwal\docs\UserGuide_NWAL.pdf<br />
</td></tr></tbody></table>
<p><br />
</p>
<h4><span id="I/O_and_Buses"></span><span class="mw-headline" id="I.2FO_and_Buses">I/O and Buses</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=179" title="Edit section: I/O and Buses">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<h5><span id="Antenna_Interface_(AIF2)"></span><span class="mw-headline" id="Antenna_Interface_.28AIF2.29">Antenna Interface (AIF2)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=180" title="Edit section: Antenna Interface (AIF2)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The AIF2 low-level driver is meant to be used by applications which make use of AIF2, QMSS and CPPI IPs. The AIF2 low-level driver aims at generalizing the configuration of AIF2 for different modes (CPRI/OBSAI/Generic packet, WCDMA/LTE/Dual mode). The first goal of the AIF2 LLD is to provide programmers with a functional layer or an abstraction of the AIF2 configuration complexity. That means that within a short amount of configuration parameters / API calls, the end user can configure AIF2 for a specific high level scenario.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/ug/spruhl2a/spruhl2a.pdf">User Guide</a>
</td></tr>
<tr>
<td>LLD Users Guide
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\aif2\docs\AIF2-c66xx_usersguide.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\aif2\docs\ AIF2-c66xx_apireferenceguide.html
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_AIF2_LLD.pdf
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h5><span class="mw-headline" id="IQN2">IQN2</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=181" title="Edit section: IQN2">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>IQN2 is intended to communicate with FFTC, RAC, TAC, PA/NetCP sub-systems without the need of constant supervision or control from application software. It is envisioned that application software would initially configure the interaction between IQN2 and these sub-systems, but that in steady state, no or very minimal CPU interventions are required for this data interchange.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/pdf/spruho6">User Guide</a>
</td></tr>
<tr>
<td>LLD SDS
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\iqn2\docs\IQN2_LLD_SDS.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\iqn2\docs\doxygen\html\index.html
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_IQN2_LLD.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h5><span id="Digital_Radio_Front_End_(DFE)"></span><span class="mw-headline" id="Digital_Radio_Front_End_.28DFE.29">Digital Radio Front End (DFE)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=182" title="Edit section: Digital Radio Front End (DFE)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>DFE is a high performance wideband digital IF transmit and receive signal processing peripheral
for small cell base station applications. It implements advanced algorithms for RF power
amplifier linearization including crest factor reduction (CFR) and digital pre-distortion (DPD),
and for correcting other receiver RF impairments like IQ imbalance, DC offset and distortion.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/pdf/spruhx8">User Guide</a>
</td></tr>
<tr>
<td>LLD SDS
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\dfe\docs\DFE_LLD_SDS.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\dfe\docs\doxygen\html\index.html
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_DFE_LLD.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h5><span id="Serial_RapidIO_(SRIO)"></span><span class="mw-headline" id="Serial_RapidIO_.28SRIO.29">Serial RapidIO (SRIO)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=183" title="Edit section: Serial RapidIO (SRIO)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The SRIO Low Level Driver provides a well defined standard interface which allows application to send and receive messages via the SRIO peripheral.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugw1">User Guide</a>
</td></tr>
<tr>
<td>LLD Users Guide
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\srio\docs\SRIO_SDS.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\srio\docs\srioDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_SRIODriver.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h5><span id="Peripheral_Component_Interconnect_Express(PCIe)"></span><span class="mw-headline" id="Peripheral_Component_Interconnect_Express.28PCIe.29">Peripheral Component Interconnect Express(PCIe)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=184" title="Edit section: Peripheral Component Interconnect Express(PCIe)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The PCIe module supports dual operation mode: End Point (EP or Type0) or Root Complex (RC or Type1). This driver focuses on EP mode but it also provides access to some basic RC configuration/functionality. The PCIe subsystem has two address spaces. The first (Address Space 0) is dedicated for local application registers, local configuration accesses and remote configuration accesses. The second (Address Space 1) is dedicated for data transfer. This PCIe driver focuses on the registers for Address Space 0.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugs6a">User Guide</a>
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\pcie\docs\pcieDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_PCIE_LLD.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h5><span class="mw-headline" id="Hyperlink">Hyperlink</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=185" title="Edit section: Hyperlink">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The Hyperlink peripheral provides a high-speed, low-latency, and low-power point-to-point link between two Keystone (SoC) devices. The peripheral is also known as vUSR and MCM. Some chip-specific definitions in CSL and documentation may have references to the old names. The LLD provides a well defined standard interface which allows application to configure this peripheral.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugw8">User Guide</a>
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\hyplnk\docs\hyplnkDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\docs\ReleaseNotes_HYPLNK_LLD.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h4><span class="mw-headline" id="Co-processors">Co-processors</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=186" title="Edit section: Co-processors">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<h5><span id="Bit-rate_Coprocessor_(BCP)"></span><span class="mw-headline" id="Bit-rate_Coprocessor_.28BCP.29">Bit-rate Coprocessor (BCP)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=187" title="Edit section: Bit-rate Coprocessor (BCP)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The BCP driver is divided into 2 layers: Low Level Driver APIs and High Level APIs. The Low Level Driver APIs provide BCP MMR access by exporting register read/write APIs and also provides some useful helper APIs in putting together BCP global and sub-module headers required by the hardware. The BCP Higher Layer provides APIs useful in submitting BCP requests and retrieving their results from the BCP engine.
</p>
<h5><span id="Turbo_Coprocessor_Decoder_(TCP3d)"></span><span class="mw-headline" id="Turbo_Coprocessor_Decoder_.28TCP3d.29">Turbo Coprocessor Decoder (TCP3d)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=188" title="Edit section: Turbo Coprocessor Decoder (TCP3d)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The TCP3 decoder driver provides a well defined standard interface which allows application to send code blocks for decoding and receive hard decision and status via EDMA3 transfers.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugs0">User Guide</a>
</td></tr>
<tr>
<td>LLD Users Guide
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\tcp3d\docs\TCP3D_DriverSDS.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\tcp3d\docs\TCP3D_DRV_APIIF.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\tcp3d\docs\ReleaseNotes_TCP3DDriver.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h5><span id="FFT_Accelerator_Coprocessor(FFTC)"></span><span class="mw-headline" id="FFT_Accelerator_Coprocessor.28FFTC.29">FFT Accelerator Coprocessor(FFTC)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=189" title="Edit section: FFT Accelerator Coprocessor(FFTC)">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The FFTC driver is divided into 2 layers: Low Level Driver APIs and High Level APIs. The Low Level Driver APIs provide FFTC MMR access by exporting register read/write APIs and also provides some useful helper APIs in putting together FFTC control header, DFT size list etc. required by the hardware. The FFTC Higher Layer provides APIs useful in submitting FFT requests and retrieving their results from the FFTC engine without having to know all the details of the Multicore Navigator.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/sprugs2b">User Guide</a>
</td></tr>
<tr>
<td>LLD Users Guide
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\fftc\docs\FFTC_SDS.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\fftc\docs\fftcDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\fftc\docs\ReleaseNotes_FFTCDriver.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h3><span class="mw-headline" id="Instrumentation">Instrumentation</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=190" title="Edit section: Instrumentation">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The instrumentation directory contains components that can be used for the purposes of DSP exception handling, logging, and debug.
</p><p><br />
</p>
<h4><span id="Fault_Management_(FM)_Library"></span><span class="mw-headline" id="Fault_Management_.28FM.29_Library">Fault Management (FM) Library</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=191" title="Edit section: Fault Management (FM) Library">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The FM library defines a standard interface for a DSP to inform the Linux kernel of a fault and provide crash dump information.  On a fault, a DSP configured to use the fault management library can shut down all data transfer IO and then write crash dump information to an ELF Note Section accessible to the Linux kernel.  The fault-originating DSP core can use a FM API to send NMI pulses to other DSP cores to initiate exceptions via the DSP core NMI generation registers.  Initiating exceptions on the remote DSP cores stops their processing to gain a potentially more complete picture of the system state when the originating-exception occurred.  Lastly, the FM module provides an API that the exception handling routine can use to inform the Kernel the DSP has crashed due to an exception and that a coredump has been produced.  This signal is sent to the ARM core via the ARM IPC interrupt generation register.
</p><p><img alt="Note" src="https://processors.wiki.ti.com/images/b/b0/Light_bulb_icon.png" title="Note" width="18" height="25" /><b>Note:</b>  Please note that sending NMI pulses to remote DSP cores to initiate remote exceptions is optional. Please do not initiate a call to this function from the exception hook function if crashing remote DSP cores is not needed.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>FM Users Guide
</td>
<td><a rel="nofollow" class="external text" href="MCSDK_UG_Chapter_Developing_System_Mgmt.html#DSP_Fault_Management_.28FM.29">FM Users Guide</a>
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\instrumentation\fault_mgmt\docs\fault_mgmtlibDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\instrumentation\fault_mgmt\docs\ReleaseNotes_fault_mgmt.pdf
</td></tr></tbody></table>
<p><br />
</p>
<h4><span class="mw-headline" id="Watchdog_Timer_Module">Watchdog Timer Module</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=192" title="Edit section: Watchdog Timer Module">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The Watchdog Timer Module provides APIs for using the local DSP timers as watchdog timers.  Each DSP has a local timer, typically DSP n's local timer is system timer n, that can be configured and used as a 64-bit watchdog timer for that DSP.  The Watchdog Timer Module provides APIs for an application to configure and "feed" a DSPs watchdog timer as an exception failsafe.  If the DSP were to crash or become corrupted the watchdog timer will timeout.  The Watchdog Timer Module provides options for if the watchdog times out.  The timer can be configured to perform a hard/soft reset, generate an NMI, and generate an exception via the BIOS Exception module.
</p><p>If the Watchdog Timer module is configured to generate an exception through the BIOS Exception module it can be plugged into the Fault Management library to generate a core dump on exception.
</p><p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>Hardware Peripheral Users Guide
</td>
<td><a rel="nofollow" class="external text" href="http://www.ti.com/lit/pdf/sprugv5">Timer64 User Guide</a>
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\instrumentation\wdtimer\docs\WatchdogTimerDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\instrumentation\wdtimer\docs\ReleaseNotes_WatchdogTimer.pdf
</td></tr></tbody></table>
<h4><span id="Trace_framework_(TF)_Library"></span><span class="mw-headline" id="Trace_framework_.28TF.29_Library">Trace framework (TF) Library</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=193" title="Edit section: Trace framework (TF) Library">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Trace framework is an infrastructure for  sharing the information from a single producer to multi consumers (maximum 4) over shared memory, designed specifically for the needs of small cell. 
</p><p>Example use cases are:
</p>
<ol><li>UIA traces produced by a single producer, and consumed by other consumers. (Small cell uses this for instrumentation purposes).</li>
<li>Application produced proprietary information by one producer, consumed by multiple consumers in the system (Small cell uses this feature for OAM functionalities)</li></ol>
<p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\instrumentation\traceframework\docs\doxygen\html\index.html
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\instrumentation\traceframework\docs\ReleaseNotes_traceframework.pdf
</td></tr>
<tr>
<td>User Guide
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\instrumentation\traceframework\docs\traceframework_ug.pdf
</td></tr></tbody></table>
<p><br /><b>CSL MODIFICATIONS COMPARED TO KEYSTONE-I</b>
</p>
<ul><li>Multiple CSL macro define modifications corresponding to the register fields</li>
<li>Several module specific MMR register fields are expanded which were arrays in overlay structures. For example in the modules COR, DNT, INT, etc.</li>
<li>Data Structures changed - Bcp_DntHdrCfg, Bcp_SslHdr_WiMaxCfg, Bcp_IntHdrCfg.</li></ul>
<ul><li>Following table captures register field changes at high level. Please refer the files for actual changes</li></ul>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Module</b>
</td>
<td bgcolor="#c0c0c0"><b>Removed</b>
</td>
<td bgcolor="#c0c0c0"><b>Added</b>
</td></tr>
<tr>
<td>SSL  HDR
</td>
<td>tdd_output_pack field in WORD1 register
</td>
<td><br />
</td></tr>
<tr>
<td>TM  MMR
</td>
<td><br />
</td>
<td>New STARVE registers (CDMA_DESC_STARVE_STATUS, CDMA_DESC_STARVE_CLEAR, CDMA_DESC_STARVE_SET, CDMA_DESC_STARVE_INTR_SEL)
</td></tr>
<tr>
<td>TM  MMR
</td>
<td><br />
</td>
<td>rx_teardown, tx_teardown, clkgate_disable fields in BCP_SOFT_RESET register
</td></tr>
<tr>
<td>TM  MMR
</td>
<td>rx_cdmahp_wr_arb_hpriority field in TM_CONTROL register
</td>
<td>frc_payload_endian in TM_CONTROL register
</td></tr></tbody></table>
<p><b>LLD API MODIFICATIONS COMPARED TO KEYSTONE-1</b>
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Removed</b>
</td>
<td>Bcp_enableRxCdmaHpWriteArbPrio(), Bcp_disableRxCdmaHpWriteArbPrio(), Bcp_isRxCdmaHpWriteArbPrioEnabled()
</td></tr>
<tr>
<td bgcolor="#c0c0c0"><b>Modified</b>
</td>
<td>Bcp_setTMControlReg(), Bcp_getTMControlReg()
</td></tr>
<tr>
<td bgcolor="#c0c0c0"><b>Added</b>
</td>
<td>Bcp_doSoftResetRxTeardown(), Bcp_doSoftResetTxTeardown(), Bcp_doSoftResetClockGateDisable(), Bcp_enableForcePayloadEndian(), Bcp_disableForcePayloadEndian(), Bcp_isForcePayloadEndianEnabled(), Bcp_getCdmaDescStarveStatus(), Bcp_setCdmaDescStarveClear(), Bcp_setCdmaDescStarveSet(), Bcp_setCdmaDescStarveInterruptSelect()
</td></tr></tbody></table>
<p>Additional documentation can be found in:
</p>
<table style="width: 720px" border="1" cellpadding="2">

<tbody><tr>
<td bgcolor="#c0c0c0"><b>Document</b>
</td>
<td bgcolor="#c0c0c0"><b>Location</b>
</td></tr>
<tr>
<td>LLD Users Guide
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\bcp\docs\BCP_SDS.pdf
</td></tr>
<tr>
<td>API Reference Manual
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\bcp\docs\bcpDocs.chm
</td></tr>
<tr>
<td>Release Notes
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\bcp\docs\ReleaseNotes_BCPDriver.pdf
</td></tr></tbody></table>
<p><br />
</p><p><br />
<br />
</p><p><br />
</p>
<h3><span id="Keystone-II_CSL/LLD_API_Migration"></span><span class="mw-headline" id="Keystone-II_CSL.2FLLD_API_Migration">Keystone-II CSL/LLD API Migration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=194" title="Edit section: Keystone-II CSL/LLD API Migration">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The following table shows API migration information for CSL/LLD: <a href="File_Keystone2_csl_lld_migration.html" class="image"><img alt="Keystone2 csl lld migration.jpg" src="https://processors.wiki.ti.com/images/6/6c/Keystone2_csl_lld_migration.jpg" width="886" height="1090" /></a>
</p>
<h3><span class="mw-headline" id="Platform_Library">Platform Library</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=195" title="Edit section: Platform Library">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div style="padding-left: 10px; width: 4in; float: left">
<p>The platform library defines a standard interface for platform utilities and functionality and provides sample implementations for the EVM platform. These include things such as reading and writing to EEPROM, FLASH, UART, etc. Platform library supports three libraries
</p>
<ol><li>debug library (ti.platform.evm###.ae66) - located under \platform_lib\lib\debug, needed only when a debug is needed on the platform library since the source is compiled with full source debugging.</li>
<li>release library (ti.platform.evm###.ae66) - located under \platform_lib\lib\release, should be used normally for the best performance of the cycles since the code is compiled with the full optimization.</li></ol>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>Platform Library Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Library
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>PDK for Keystone II
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>pdk_keystone2_&lt;version&gt;\packages\ti\platform\evm###\platform_lib <br />
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="CCSv5_Getting_Started_Guide.html">CCS</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>Select for the TCI66##### EVM <br />
<p>ti.platform.evm###.ae66 (little)
</p>
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\platform\evm###\platform_lib\lib\debug - for debug version <br />$(TI_PDK_INSTALL_DIR)\packages\ti\platform\evm###\platform_lib\lib\release - for release version
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>platform_lib
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>none
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\platform <br />
<p>platform.h defines the interface
</p>
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="http://processors.wiki.ti.com/">Texas Instruments Embedded Processors Wiki</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Product Updates</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
<p><br />
</p>
<h3><span class="mw-headline" id="Transport">Transport</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=196" title="Edit section: Transport">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The Transports are intermediate drivers that sit between either the NDK and interface them to the appropriate EVM peripherals. The Transport supported by MCSDK are:
</p>
<ul><li>NDK transport - Network Interface Management Unit (NIMU) Driver</li></ul>
<p>More information on these can be found in the NDK or IPC sections of this guide.
</p><p><br />
</p>
<h2><span class="mw-headline" id="EDMA3_Low_Level_Driver">EDMA3 Low Level Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=197" title="Edit section: EDMA3 Low Level Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div><div style="padding-left: 10px; width: 4in; float: left">
<p>EDMA3 Low Level Driver is targeted to users (device drivers and applications) for submitting and synchronizing EDMA3-based DMA transfers.
</p><p>EDMA3 is a peripheral that supports data transfers between two memory mapped devices. It supports EDMA as well as QDMA channels for data transfer. This peripheral IP is re-used in different SoCs with only a few configuration changes like number of DMA and QDMA channels supported, number of PARAM sets available, number of event queues and transfer controllers etc. The EDMA3 peripheral is used by other peripherals for their DMA needs thus the EDMA3 Driver needs to cater to the requirements of device drivers of these peripherals as well as other application software that may need to use DMA services.
</p><p>The EDMA3 LLD consists of an EDMA3 Driver and EDMA3 Resource Manager. The <b>EDMA3 Driver</b> provides functionality that allows device drivers and applications for submitting and synchronizing with EDMA3 based DMA transfers. In order to simplify the usage, this component internally uses the services of the <b>EDMA3 Resource Manager</b> and provides one consistent interface for applications or device drivers.
</p>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>EDMA3 Driver Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Library
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>EDMA3 Low level drivers
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>&lt;root_install_dir&gt;/edma3_lld_xx_xx_xx_xx
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little and Big
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>edma3_lld_drv.ae66 (little endian) and edma3_lld_drv.ae66e (big endian)
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under install directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="Programming_the_EDMA3_using_the_Low-Level_Driver_(LLD).html">Programming the EDMA3 using the Low-Level Driver (LLD)</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Product Updates</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
</div>
<p><br />
</p>
<h2><span id="SYS/BIOS_2"></span><span class="mw-headline" id="SYS.2FBIOS_2">SYS/BIOS</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=198" title="Edit section: SYS/BIOS">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div style="padding-left: 10px; width: 4in; float: left">
<p>SYS/BIOS is a scalable real-time kernel. It is designed to be used by applications that require real-time scheduling and synchronization or realtime instrumentation. SYS/BIOS provides preemptive multi-threading, hardware abstraction, real-time analysis, and configuration tools. SYS/BIOS is designed to minimize memory and CPU requirements on the target.
</p>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>SYS/BIOS Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Libraries
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>SYS/BIOS
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>bios_6_&lt;version&gt;\
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little and Big
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>The appropriate libraries are selected for your device and platform as set in the RTSC build properties for your project and based on the use module statements in your configuration.
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>The appropriate path is selected to the libraries for your device and platform as set in the RTSC build properties for your project.
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>
<p>BIOS_CG_ROOT is set automatically by CCS based on the version of BIOS you have checked to build with. <br />${BIOS_CG_ROOT}\packages\ti\bios\include
</p>
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="https://e2e.ti.com/support/processors/f/791/t/840835">SYS/BIOS Online Training</a><br /><a rel="nofollow" class="external text" href="SYS/BIOS_1.html">SYS/BIOS 1.5-DAY Workshop</a><br /><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC Home</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td>
<p><a rel="nofollow" class="external text" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/bios/index.html">SYS/BIOS Downloads</a>
</p>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span id="Inter-Processor_Communication_(IPC)"></span><span class="mw-headline" id="Inter-Processor_Communication_.28IPC.29">Inter-Processor Communication (IPC)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=199" title="Edit section: Inter-Processor Communication (IPC)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div style="padding-left: 10px; width: 4in; float: left">
<p>Inter-Processor Communication (IPC) provides communication between processors in a multi-processor environment.
</p><p>IPC provides messaging APIs for Linux-to-BIOS and BIOS-to-BIOS communication.
</p>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>IPC Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Libraries
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>IPC
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>ipc_&lt;version&gt;
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little and Big
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>The appropriate libraries are selected based on your application's configuration.
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>The appropriate paths are added in the config-generated linker command script, based on your application's configuration.
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>IPC_INSTALL_DIR/packages
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td><a href="IPC_Users_Guide.html" title="IPC Users Guide">IPC Users Guide</a><br />
<p><a rel="nofollow" class="external text" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ipc/latest/docs/doxygen/html/index.html">API Reference</a><br />
<a rel="nofollow" class="external text" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ipc/latest/docs/cdoc/index.html">Config Reference</a>
</p>
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC Home</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a rel="nofollow" class="external text" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ipc/index.html">IPC Downloads</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span id="Network_Development_Kit_(NDK)"></span><span class="mw-headline" id="Network_Development_Kit_.28NDK.29">Network Development Kit (NDK)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=200" title="Edit section: Network Development Kit (NDK)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div style="padding-left: 10px; width: 4in; float: left">
<p>The NDK is a platform for development and demonstration of network enabled applications on DSP devices and includes demonstration software showcasing DSP capabilities across a range of network enabled applications. The NDK serves as a rapid prototype platform for the development of network and packet processing applications, or to add network connectivity to existing DSP applications for communications, configuration, and control. Using the components provided in the NDK, developers can quickly move from development concepts to working implementations attached to the network.
</p><p>The NDK provides an IPv6 and IPv4 compliant TCP/IP stack working with the SYS/BIOS real-time operating system. Its primary focus is on providing the core Layer 3 and Layer 4 stack services along with additional higher-level network applications such as HTTP server and DHCP.
</p><p>The NDK itself does not include any platform or device specific software. The NDK interfaces through well-defined interfaces to the PDK and platform software elements needed for operation.
</p>
The functional architecure for NDK is shown below. <br /><div class="floatleft"><a href="File_Ndkarch.html" class="image" title="Ndkarch.png"><img alt="Ndkarch.png" src="https://processors.wiki.ti.com/images/5/5f/Ndkarch.png" width="365" height="303" /></a></div>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>Network Development Kit Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Libraries
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>NDK
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>ndk_&lt;version&gt;\
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little and Big
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>
<p>binsrc.lib or binsrce.lib <br />and <br />cgi.lib or cgie.lib <br />and <br />console.lib or consolee.lib <br />and <br />hdlc.lib or hdlce.lib <br />and <br />miniPrintf.lib or miniPrintfe.lib <br />and <br />netctrl.lib or netctrle.lib <br />and <br />nettool.lib or nettoole.lib <br />and <br />os.lib or ose.lib <br />and <br />servers.lib or serverse.lib <br />and <br />stack.lib or stacke.lib
</p>
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>$(NDK_INSTALL_DIR)\packages\ti\ndk\lib\&lt;arch&gt;
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>.far:NDK_OBJMEM, .far:NDK_PACKETMEM
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>L2 Cache
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>NDK_INSTALL_DIR is set automatically by CCS based on the version of NDK you have checked to build with. <br />
<p>${NDK_INSTALL_DIR}\packages\ti\ndk\inc <br />${NDK_INSTALL_DIR}\packages\ti\ndk\inc\tools
</p>
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td>The NDK unit test examples are available in <br />$(TI_MCSDK_INSTALL_DIR)\packages\ti\platform\nimu\test\evm####
</td></tr>
<tr>
<td><b>Extended Support</b>
</td>
<td>
<p><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC Home</a> <br /><a rel="nofollow" class="external text" href="http://www-s.ti.com/sc/techlit/spru523.pdf">NDK User's Guide</a> <br /><a rel="nofollow" class="external text" href="http://www-s.ti.com/sc/techlit/spru524.pdf">NDK Programmer's Reference Guide</a> <br /><a rel="nofollow" class="external text" href="http://www-s.ti.com/sc/techlit/sprufp2.pdf">NDK Support Package Ethernet Driver Design Guide</a> <br /><a rel="nofollow" class="external text" href="Network_Developers_Kit_FAQ.html">NDK_FAQ</a> <br /><a rel="nofollow" class="external text" href="https://e2e.ti.com/support/processors/f/791/t/947275">Rebuilding NDK Core</a> <br />
</p>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a rel="nofollow" class="external text" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ndk/index.html">NDK Downloads</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
<p><br />
</p>
<h5><span id="Network_Interface_Management_Unit_(NIMU)_Driver"></span><span class="mw-headline" id="Network_Interface_Management_Unit_.28NIMU.29_Driver">Network Interface Management Unit (NIMU) Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=201" title="Edit section: Network Interface Management Unit (NIMU) Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<div style="padding-left: 10px; width: 4in; float: left">
<p>NIMU sits between NDK common software and the&#160;TCI66##### platform library and provides a common interface for NDK to communicate with. This package have NDK unit test examples for all supported platforms.
</p><p><br />
</p><p><b>Note</b>: This module is only intended to be used with NDK. As such, users should not tie up to its API directly.
</p><p><br />
</p><p>The functional architecture for NIMU (taking TCI66##### platform as an example) is shown below.&#160;&#160;<br />
</p>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>NIMU Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Library
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>PDK_INSTALL_DIR
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>mcsdk_&lt;version&gt;\packages\ti\transport\ndk\nimu
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>ti.transport.ndk.nimu.ae66 (little)
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\transport\ndk\nimu\lib\debug for debug version <br />$(TI_PDK_INSTALL_DIR)\packages\ti\transport\ndk\nimu\lib\release for release version
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>nimu_eth_ll2
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>L2SRAM
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>$(TI_PDK_INSTALL_DIR)\packages\ti\transport\ndk\nimu\include
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>None
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td>The NDK unit test examples are available in <br />$(TI_MCSDK_INSTALL_DIR)\examples\ndk\evm###
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a rel="nofollow" class="external free" href="http://focus.ti.com/docs/toolsw/folders/print/bioslinuxmcsdk.html">http://focus.ti.com/docs/toolsw/folders/print/bioslinuxmcsdk.html</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p><p>Please note that all contributions to MediaWiki may be edited, altered, or removed by other contributors. If you do not want your writing to be edited mercilessly, then do not submit it here. You are also promising us that you wrote this yourself, or copied it from a public domain or similar free resource (see MediaWiki:Copyrights for details). Do not submit copyrighted work without permission!
</p>
<h2><span class="mw-headline" id="Algorithm_Libraries">Algorithm Libraries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=202" title="Edit section: Algorithm Libraries">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>TI provides several algorithm libraries, each specific to a particular arena. Each library provides a collection of C-callable low-level functions (kernels), each tailored for optimal performance on a specific TI processing device (or devices). The libraries are typically used in computationally intensive real-time applications where execution speed is a critical factor. Their use generally accelerates execution speeds well beyond that achieved by equivalent code written in standard ANSI C. Additionally, use of these libraries can significantly reduce application development time. Source code is provided in all cases to facilitate kernel modification when needed.
</p><p>See <a rel="nofollow" class="external text" href="Software_libraries.html">c6x Software Library mediawiki</a> for a comprehensive overview of the various software libraries available for TI's c6x family of processors.
</p><p><br />
</p>
<h3><span id="DSP_Library_(DSPLIB)"></span><span class="mw-headline" id="DSP_Library_.28DSPLIB.29">DSP Library (DSPLIB)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=203" title="Edit section: DSP Library (DSPLIB)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div style="padding-left: 10px; width: 4in; float: left">
<p>DSPLIB is an optimized DSP Function Library and includes many C-callable, optimized, general-purpose signal-processing routines including:
</p>
<ul><li>Adaptive Filtering</li>
<li>Correlation</li>
<li>Fast Fourier Transform</li>
<li>Filtering and convolution</li>
<li>Matrix</li></ul>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>DSPLIB Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Library
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>DSPLIB
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>dsplib_c66x_&lt;version&gt;\
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="CCSv5_Getting_Started_Guide.html">CCS</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Big and Little
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>dsplib.a66 (COFF, little-endian) <br />dsplib.a66e (COFF, big-endian) <br />dsplib.ae66 (ELF, little-endian) <br />dsplib.ae66e (ELF, big-endian)
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>&lt;root_install_dir&gt;\lib\
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>&lt;root_install_dir&gt;\inc\ <br />&lt;root_install_dir&gt;\packages\
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS E2e Forum</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="Software_libraries.html">c6x Software Library mediawiki</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a rel="nofollow" class="external text" href="http://software-dl.ti.com/sdoemb/sdoemb_public_sw/dsplib/latest/index_FDS.html">DSPLIB Downloads</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
<p><br />
</p>
<h3><span id="Image_Processing_Library_(IMGLIB)"></span><span class="mw-headline" id="Image_Processing_Library_.28IMGLIB.29">Image Processing Library (IMGLIB)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=204" title="Edit section: Image Processing Library (IMGLIB)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div style="padding-left: 10px; width: 4in; float: left">
<p>IMGLIB is an optimized image/video processing library with kernels in the following functional categories:
</p>
<ul><li>Compression &amp; Decompression</li>
<li>Image Analysis</li>
<li>Image Filtering and Conversion</li></ul>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>IMGLIB Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Library
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>IMGLIB
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>imglib_c66x_&lt;version&gt;\
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="CCSv5_Getting_Started_Guide.html">CCS</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>imglib.ae66 (ELF, little-endian)
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>&lt;root_install_dir&gt;\lib\
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>&lt;root_install_dir&gt;\inc\ <br />&lt;root_install_dir&gt;\packages\
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS E2e Forum</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="Software_libraries.html">c6x Software Library mediawiki</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a rel="nofollow" class="external text" href="http://software-dl.ti.com/sdoemb/sdoemb_public_sw/imglib/latest/index_FDS.html">IMGLIB Downloads</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
<p><br />
</p>
<h3><span id="Floating_Point_Math_Library_(MATHLIB)"></span><span class="mw-headline" id="Floating_Point_Math_Library_.28MATHLIB.29">Floating Point Math Library (MATHLIB)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=205" title="Edit section: Floating Point Math Library (MATHLIB)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div style="padding-left: 10px; width: 4in; float: left">
<p>MATHLIB contains optimized versions of most commonly used floating point math routines contained in the RTS library. Kernels are offered in two variations:
</p>
<ul><li>Double-precision floating point</li>
<li>Single-precision floating point</li></ul>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>MATHLIB Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Library
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>MATHLIB
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>mathlib_c66x_&lt;version&gt;\
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="CCSv5_Getting_Started_Guide.html">CCS</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Big and Little
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>mathlib.a66 (COFF, little-endian) <br />mathlib.a66e (COFF, big-endian) <br />mathlib.ae66 (ELF, little-endian) <br />mathlib.ae66e (ELF, big-endian)
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>&lt;root_install_dir&gt;\lib\
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>&lt;root_install_dir&gt;\inc\ <br />&lt;root_install_dir&gt;\packages\
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS E2e Forum</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="Software_libraries.html">c6x Software Library mediawiki</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td><a rel="nofollow" class="external text" href="http://focus.ti.com/docs/toolsw/folders/print/mathlib.html">MATHLIB Downloads</a>
</td></tr>
<tr>
<td><b>License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="OMP">OMP</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=206" title="Edit section: OMP">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h2><span class="mw-headline" id="Resource_Manager">Resource Manager</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=207" title="Edit section: Resource Manager">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The Resource Manager is detailed here: <a rel="nofollow" class="external text" href="MCSDK_UG_Chapter_Developing_System_Mgmt.html#Resource_Manager">RM User Guide</a>
</p>
<h2><span class="mw-headline" id="DSP_Management">DSP Management</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=208" title="Edit section: DSP Management">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Boot_Utilities">Boot Utilities</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=209" title="Edit section: Boot Utilities">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Overview_4">Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=210" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>MCSDK includes a Tools Package which provides boot utilities for use with the TI EVMs and are intended to serve as example/reference for customers.
</p><p><br />The MCSDK tools package is located in the C:\ti\mcsdk_bios_#_##_##_##\tools directory and includes:
</p>
<ul><li><b>Writer Utilities</b>: Utilities to program an application image to flash or EEPROM.</li>
<li><b>Program EVM</b>: Utilities to program default application images to flash.</li>
<li><b>Other Utilities</b>: Utilities to do file format conversion that are required by the boot examples.&#160;</li></ul>
<h4><span class="mw-headline" id="Flash_and_Flash_Utilities">Flash and Flash Utilities</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=211" title="Edit section: Flash and Flash Utilities">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The following boot utilities for loading code into the EEPROM, NOR and NAND are provided as part of the Tools Package with the MCSDK. All source code is provided along with documentation so that customers can port to other environments as necessary or to make modifications and enhancements.
</p>
<ul><li><b>EEPROM Writer</b>: Utility for writing to the EEPROM. This utility executes on the EVM using CCS and JTAG and it is located under C:\ti\mcsdk_bios_#_##_##_##\tools\writer\eeprom\evm###\bin directory.</li>
<li><b>NOR Writer</b>: Utility for writing to the NOR flash. This utility executes on the EVM using CCS and JTAG and it is located under C:\ti\mcsdk_bios_#_##_##_##\tools\writer\nor\evm###\bin directory.</li>
<li><b>NAND Writer</b>: Utility for writing to the NAND flash. This utility executes on the EVM using CCS and JTAG and it is located under C:\ti\mcsdk_bios_#_##_##_##\tools\writer\nand\evm###\bin directory.</li></ul>
<table border="1">
<tbody><tr>
<td>
<div class="floatleft"><a href="File_Helpful_tips_image.html" class="image"><img alt="Helpful tips image.jpg" src="https://processors.wiki.ti.com/images/5/5c/Helpful_tips_image.jpg" width="75" height="76" /></a></div> 
<p><span style="color: Red"><b>Useful Tip</b></span>
</p><p>The program_evm utility provides the ability to format the NAND (i.e., permanently erase the entire NAND device). Please refer to program_evm_userguide.pdf (located in the mcsdk_bios_#_##_##_##\tools\program_evm\ directory) for more information.
</p>
</td></tr></tbody></table>
<p><br />
</p>
<h2><span class="mw-headline" id="c6x_DSP_Linux_Community">c6x DSP Linux Community</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=212" title="Edit section: c6x DSP Linux Community">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>(point to community page)  Not required since not applicable to KeyStone II as of yet, but just a test of scalability of the document.
</p>
<h1><span id="DSP_Acceleration,Profiling_utilities_and_Libraries"></span><span class="mw-headline" id="DSP_Acceleration.2CProfiling_utilities_and_Libraries">DSP Acceleration,Profiling utilities and Libraries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=213" title="Edit section: DSP Acceleration,Profiling utilities and Libraries">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>The K2H file system comes bundled with a bunch of applications below
</p>
<h2><span class="mw-headline" id="DSP_Acceleration">DSP Acceleration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=214" title="Edit section: DSP Acceleration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The following components helps the applications to offload their computation
to the DSPs. These runtime components are detailed below
</p>
<h3><span class="mw-headline" id="OpenCL">OpenCL</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=215" title="Edit section: OpenCL">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>OpenCL (Open Computing Language) is a multi-vendor open standard for general-purpose parallel programming of heterogeneous systems that include CPUs, DSPs and other processors. OpenCL is used to dispatch tasks from A15 to DSP cores . 
More details could be found <a rel="nofollow" class="external text" href="http://downloads.ti.com/mctools/esd/docs/opencl/index.html">here</a>
</p>
<h3><span class="mw-headline" id="OpenMP">OpenMP</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=216" title="Edit section: OpenMP">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>OpenMP is the de facto industry standard for shared memory parallel programming. OpenMP is used to achieve parallelism across DSP cores. More details could be found <a rel="nofollow" class="external text" href="MCSDK_HPC_3-2.html">here</a>
</p><p><br />
</p>
<h2><span class="mw-headline" id="DSP_Debug_and_Profiling_Utilities">DSP Debug and Profiling Utilities</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=217" title="Edit section: DSP Debug and Profiling Utilities">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The following Debug &amp; profiling utilities are included for K2H.
</p>
<h3><span class="mw-headline" id="DSPTOP">DSPTOP</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=218" title="Edit section: DSPTOP">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>DSPTOP is similar to the Linux top utility and provides visibility to usage data for TI multicore DSP-ARM SoC devices.
More details could be found <a rel="nofollow" class="external text" href="Dsptop.html">here</a>
</p>
<h3><span class="mw-headline" id="C66x_GDB">C66x GDB</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=219" title="Edit section: C66x GDB">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>C66x GDB is an implementation of a GDB Server debugging stub for the Texas Instruments C66x DSP. It allows developers to utilize the standard features of GDB (GNU Debugger) to gain visibility to and debug the C66x DSP cores in the heterogeneous DSP + ARM KeyStone II system-on-chips. More details could be found <a rel="nofollow" class="external text" href="Hosted_C66x_GDB.html">here</a>
</p>
<h2><span class="mw-headline" id="Libraries">Libraries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=220" title="Edit section: Libraries">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The K2H file system comes with libraries optimized for TI SOC and could be used for application development.
</p>
<h3><span class="mw-headline" id="FFTW">FFTW</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=221" title="Edit section: FFTW">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>FFTW is a C subroutine library for computing the discrete Fourier transform (DFT) in one or more dimensions, of arbitrary input size, and of both real and complex data.
More details on the TI implementation of FFTW could be found <a rel="nofollow" class="external text" href="MCSDK_HPC_3-5.html">here</a>
</p>
<h3><span class="mw-headline" id="Linear_Algebra">Linear Algebra</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=222" title="Edit section: Linear Algebra">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The TI Linear Algebra library (LINALG) is an optimized library for performing dense linear algebra computations. More details could be found <a rel="nofollow" class="external text" href="MCSDK_HPC_3-12.html">here</a>
</p>
<h3><span class="mw-headline" id="Machine_Learning_Libraries">Machine Learning Libraries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=223" title="Edit section: Machine Learning Libraries">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The TI Machine Learning (TIML) Library is a machine learning library currently focused on deep learning networks in general and convolutional neural networks in particular. The machine learning library runs on the ARM and relies on lower level DSP libraries for acceleration. More details could be found <a rel="nofollow" class="external text" href="MCSDK_HPC_3-6.html">here</a>
</p>
<h3><span class="mw-headline" id="Graph_Libraries">Graph Libraries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=224" title="Edit section: Graph Libraries">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The TI Graph Library (TIGL) is a template graph library that supports the Pregel API. More details could be found <a rel="nofollow" class="external text" href="MCSDK_HPC_3-7.html">here</a>
</p><p><br />
NOTE: Please note that the above are available only for K2H
</p><p>NOTE: For MCSDK-HPC 3.0.1.x users ,please refer to this page <a rel="nofollow" class="external text" href="http://processors.wiki.ti.com/index.php?title=MCSDK_HPC_MigrationGuide_to_MCSDK3.1.4">Migration Guide</a>
</p><p><br />
</p>
<h1><span class="mw-headline" id="Tools">Tools</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=225" title="Edit section: Tools">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span id="Multicore_System_Analyzer_(MCSA)"></span><span class="mw-headline" id="Multicore_System_Analyzer_.28MCSA.29">Multicore System Analyzer (MCSA)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=226" title="Edit section: Multicore System Analyzer (MCSA)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div style="padding-left: 10px; width: 4in; float: left">
<p>Multicore System Analyzer (MCSA) is a suite of tools that provide real-time visibility into the performance and behavior of your code, and allow you to analyze information that is collected from software and hardware instrumentation in a number of different ways.
</p><p>Advanced Tooling Features:
</p>
<ul><li>Real-time event monitoring</li>
<li>Multicore event correlation</li>
<li>Correlation of software events, hardware events and CPU trace</li>
<li>Real-time profiling and benchmarking</li>
<li>Real-time debugging</li></ul>
<p>Two key components of System Analyzer are:
</p>
<ul><li>DVT: Various features of Data Analysis and Visualization Technology (DVT) provide the user interface for System Analyzer within Code Composer Studio (CCS)</li>
<li>UIA: The Unified Instrumentation Architecture (UIA) target package defines APIs and transports that allow embedded software to log instrumentation data for use within CCS</li></ul>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>MCSA Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Libraries
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>UIA + DVT
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>ccsv5/uia_&lt;version&gt;, ccsv5/eclipse, ccsv5/ccs_base_5.0.0.*/dvt\
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>The appropriate libraries are selected for your device and platform as set in the RTSC build properties for your project and based on the use module statements in your configuration.
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>The appropriate path is selected to the libraries for your device and platform as set in the RTSC build properties for your project.
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td><a rel="nofollow" class="external text" href="Multicore_System_Analyzer.html">Multicore System Analyzer</a>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td>Installed as a part of MCSDK installation
</td></tr>
<tr>
<td><b>UIA License</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.opensource.org/licenses/bsd-license.php">BSD</a>
</td></tr>
<tr>
<td><b>DVT License</b>
</td>
<td>TI Technology and Software Publicly Available (TSPA). See DVT Manifest in the install directory.
</td></tr></tbody></table>
<p><br />
</p>
<h2><span id="Eclipse_RTSC_Tools_(XDC)"></span><span class="mw-headline" id="Eclipse_RTSC_Tools_.28XDC.29">Eclipse RTSC Tools (XDC)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=227" title="Edit section: Eclipse RTSC Tools (XDC)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div style="padding-left: 10px; width: 4in; float: left">
<p>RTSC is a C-based programming model for developing, delivering, and deploying Real-Time Software Components targeted for embedded platforms. The XDCtools product includes tooling and runtime elements for component-based programming using RTSC.
</p>
</div>
<table style="width: 50%" border="5" cellpadding="2">

<tbody><tr>
<td style="background: #e8e8e8" colspan="2" align="center"><b>XDC Summary</b>
</td></tr>
<tr>
<td><b>Component Type</b>
</td>
<td>Tools
</td></tr>
<tr>
<td><b>Install Package</b>
</td>
<td>XDC
</td></tr>
<tr>
<td><b>Install Directory</b>
</td>
<td>xdctools_&lt;version&gt;\
</td></tr>
<tr>
<td><b>Project Type</b>
</td>
<td><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a>
</td></tr>
<tr>
<td><b>Endian Support</b>
</td>
<td>Little and Big
</td></tr>
<tr>
<td><b>Library Name</b>
</td>
<td>The appropriate libraries are selected for your device and platform as set in the RTSC build properties for your project and based on the use module statements in your configuration.
</td></tr>
<tr>
<td><b>Linker Path</b>
</td>
<td>The appropriate path is selected to the libraries for your device and platform as set in the RTSC build properties for your project.
</td></tr>
<tr>
<td><b>Linker Sections</b>
</td>
<td>systemHeap
</td></tr>
<tr>
<td><b>Section Preference</b>
</td>
<td>none
</td></tr>
<tr>
<td><b>Include Paths</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>Reference Guides</b>
</td>
<td>See docs under Install Directory
</td></tr>
<tr>
<td><b>Support</b>
</td>
<td><a href="#Technical_Support_and_Product_Updates">Technical Support</a>
</td></tr>
<tr>
<td><b>Additional Resources</b>
</td>
<td>
<p><a rel="nofollow" class="external text" href="http://www.eclipse.org/rtsc/">Eclipse RTSC Home</a> <br /><a rel="nofollow" class="external text" href="http://rtsc.eclipse.org/docs-tip/Main_Page">Users Guide and Reference Manual</a>
</p>
</td></tr>
<tr>
<td><b>Downloads</b>
</td>
<td>N/A
</td></tr>
<tr>
<td><b>License</b>
</td>
<td>See XDC Manifest in the install directory
</td></tr></tbody></table>
<p><br />
</p><p><br />
</p>
<h1><span class="mw-headline" id="Demonstrations">Demonstrations</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=228" title="Edit section: Demonstrations">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>The MCSDK consist of demonstration software to illustrate device and software capabilities, benchmarks, and usage.
</p><p>See the <a rel="nofollow" class="external text" href="MCSDK_UG_Chapter_Getting_Started.html#Running_Out_of_Box_Demonstrations">Getting Started Guide's demonstration section</a> for instructions to run the pre-built demonstrations in the filesystem.
</p>
<h2><span class="mw-headline" id="Utility_Application">Utility Application</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=229" title="Edit section: Utility Application">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a rel="nofollow" class="external free" href="MCSDK_Utility_App_Demonstration_Guide.html">http://processors.wiki.ti.com/index.php/MCSDK_Utility_App_Demonstration_Guide</a>
</p>
<h2><span class="mw-headline" id="Image_Processing">Image Processing</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=230" title="Edit section: Image Processing">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a rel="nofollow" class="external free" href="MCSDK_Image_Processing_Demonstration_Guide.html">http://processors.wiki.ti.com/index.php/MCSDK_Image_Processing_Demonstration_Guide</a>
</p>
<h2><span class="mw-headline" id="Inter-Processor_Communication">Inter-Processor Communication</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=231" title="Edit section: Inter-Processor Communication">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a rel="nofollow" class="external free" href="MCSDK_Inter_Processor_Communication_Demonstration_Guide.html">http://processors.wiki.ti.com/index.php/MCSDK_Inter_Processor_Communication_Demonstration_Guide</a>
</p><p><br />
</p>
<h1><span id="Running_examples_of_OpenCL,OpenMP_and_Libraries"></span><span class="mw-headline" id="Running_examples_of_OpenCL.2COpenMP_and_Libraries">Running examples of OpenCL,OpenMP and Libraries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=232" title="Edit section: Running examples of OpenCL,OpenMP and Libraries">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>The MCSDK filesystem for K2H comes bundled with examples for OpenCL,OpenMP and libraries which are typically installed in /usr/share/ti/examples/&lt;component&gt; directory.
The following steps are needed to run them the K2H EVM
</p><p>After mounting the K2H file system,
</p>
<h2><span id="Add_user_to_'keystone'_group"></span><span class="mw-headline" id="Add_user_to_.27keystone.27_group">Add user to 'keystone' group</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=233" title="Edit section: Add user to &#039;keystone&#039; group">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>A non-root user needs to be a part of the 'keystone' group for accessing peripherals such as qmss,dsp etc.
The 'keystone' group aleady exists in the K2H file system and the non-root user needs to be added to that group using the below command.
For example, if the non-root user is "evm-user"
</p>
<pre>su
usermod -a -G keystone evm-user
</pre>
<p>The EVM needs to be rebooted after this step.
</p>
<h2><span class="mw-headline" id="Compile_the_examples">Compile the examples</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=234" title="Edit section: Compile the examples">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The examples for various components are stored under /usr/share/ti/examples/&lt;component-name&gt;. For example, opencl demos are kept at /usr/share/ti/examples/opencl
To compile a component's demos, do the following
</p>
<h3><span class="mw-headline" id="Copy_the_example_to_a_directory">Copy the example to a directory</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=235" title="Edit section: Copy the example to a directory">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>For example, in case of opencl
</p>
<pre>cp -r /usr/share/ti/examples/opencl  ~/
</pre>
<h3><span class="mw-headline" id="Run_the_make_command">Run the make command</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=236" title="Edit section: Run the make command">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Run the make command at the top of the directory
</p>
<pre>cd ~/opencl
make
</pre>
<p>This will build all the examples bundled with opencl. To compile a specific example, you may go in to that sub-directory and issue a make command
For example
</p>
<pre>cd ~/opencl/null
make
</pre>
<p>The above builds the 'null' example alone.
</p>
<h2><span class="mw-headline" id="Run_the_examples">Run the examples</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=237" title="Edit section: Run the examples">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The examples built in the above step binaries reside in their respective directories.
To run any specific example manually, for example the 'null' example,
</p>
<pre>cd ~/opencl/null/
./null
</pre>
<p>The above test's output is shown below
</p>
<pre> The OpenCL runtime will lazily load the device program upon the
 first enqueue of a kernel from the program, so the elapsed time
 overall from the first enqueue will be longer to account for the
 loading of the kernel.  Also, subsequent enqueue's of a kernel will
 also potentially benefit from a warm cache on the device.
 Elapsed (with Load): 561 usecs
 Elapsed (w/o  Load): 69 usecs
 Elapsed (w/o  Load): 129 usecs
 Elapsed (w/o  Load): 149 usecs
 Elapsed (w/o  Load): 145 usecs
 Elapsed (w/o  Load): 142 usecs
 Done!
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Running_Automated_Tests">Running Automated Tests</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=238" title="Edit section: Running Automated Tests">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The K2H filesystem comes bundled with an automated test suite which lets us test all the examples (OpenCL,OpenMP and Libraries) in one step.
This automated test suite builds, runs all the examples and generate a test report as well. This test suite also provides logs for individual tests as well.
</p><p>To run the automated test do the following,
</p>
<dl><dt>Copy the autotest files</dt></dl>
<dl><dt>Copy the /usr/share/ti/keystone-hpc/autotest folder to the current directory</dt></dl>
<pre>&gt; cp -r /usr/share/ti/keystone-hpc/autotest .
</pre>
<dl><dt>Run the automated test</dt></dl>
<pre>&gt; cd autotest
&gt; ./test_release.sh --run-on-hosts &lt;hostname&gt;
</pre>
<p>For example
</p>
<pre>&gt; ./test_release.sh --run-on-hosts k2hk-evm
</pre>
<p>Part of the above command involves copying the demo examples to the current directory, recompiling them.
So, if you would like to skip the portion of recompiling the examples (for example, to just run the test on the binaries produced in an earlier run), you could do it with the 'skip-rebuild' option appended to the script. So, the test command would look like
</p>
<pre>&gt; ./test_release.sh --run-on-hosts skip-rebuild &lt;hostname&gt;
</pre>
<p>For example
</p>
<pre>&gt; ./test_release.sh --run-on-hosts skip-rebuild k2hk-evm
</pre>
<p>Please note that skip-rebuild should be used ONLY if you had successfully run the automated tests at least once before from the same location (with no skip-rebuild option).
</p>
<dl><dt>Verify the test results</dt></dl>
<p>The test takes about 20 minutes or so. The results of the test against each test ,are printed on screen like below,
</p>
<pre>&gt; "opencl:platforms" ... [PASS]
&gt; "opencl:edmamgr" ... [PASS]
&gt; "opencl:ccode" ... [PASS]
&gt; "opencl:dsplib_fft" ... [PASS]
&gt; "opencl:simple" ... [PASS]
&gt; "opencl:null" ... [PASS]
&gt;  Complete
</pre>
<p>NOTE: The following failures are expected.
</p>
<pre>&gt; "opencl:ooo" ...                                                         [FAIL]
&gt; "opencl:mandelbrot" ...                                                  [FAIL]
&gt; "opencl:mandelbrot_native" ...                                           [FAIL]
</pre>
<p>The logs of test execution are kept under seperate folder created every run, based on the timestamp. The folder name is printed at the beginning of the test, For example,
</p>
<pre>&gt; CONFIG: HOSTS_FILE = /home/evmuser/autotest/hosts
&gt; CONFIG: TEST_USER = evmuser
&gt; CONFIG: EXAMPLES_DIR = /home/evmuser/autotest/mcsdk-hpc-examples
&gt; CONFIG: NODE_KNOWN_HOSTS = /home/evmuser/.ssh/known_hosts
&gt; mkdir: created directory /home/evmuser/autotest/20150202211040
&gt; mkdir: created directory /home/evmuser/autotest/20150202211040/test_logs ---&gt; This is the directory where the logs are present for each test case.
&gt; mkdir: created directory /home/evmuser/autotest/20150202211040/logs     
</pre>
<p>In the above example, the test logs for a particular run is kept at 20150202211040/test_logs directory
</p><p><br />
</p>
<h1><span class="mw-headline" id="How_To">How To</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=239" title="Edit section: How To">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span id="How_to_run_Linux_kernel_from_a_different_physical_address_than_default_(0x80000000)_?"></span><span class="mw-headline" id="How_to_run_Linux_kernel_from_a_different_physical_address_than_default_.280x80000000.29_.3F">How to run Linux kernel from a different physical address than default (0x80000000)&#160;?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=240" title="Edit section: How to run Linux kernel from a different physical address than default (0x80000000)?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>A sample patch to change DDR base address to 0xA0000000 instead of the default address 0x80000000 is provided below. User is responsible for maintaining this patch at their code base and the same will not be included in the MCSDK.
</p><p><u>Linux code patch</u>
</p>
<pre>--- ref/keystone-0430a//linux-keystone/arch/arm/mach-keystone/Makefile.boot	2013-04-30 11:19:07.000000000 -0700
+++ linux-keystone/arch/arm/mach-keystone/Makefile.boot	2013-05-09 13:47:29.829257106 -0700
@@ -1 +1 @@
-zreladdr-y	:= 0x80008000
+zreladdr-y	:= 0xA0008000
--- ref/keystone-0430a//linux-keystone/arch/arm/mach-keystone/include/mach/memory.h	2013-04-30 11:19:07.000000000 -0700
+++ linux-keystone/arch/arm/mach-keystone/include/mach/memory.h	2013-05-09 12:05:10.561756528 -0700
@@ -16,6 +16,7 @@
 #ifndef __ASM_MACH_MEMORY_H
 #define __ASM_MACH_MEMORY_H

+
 #define MAX_PHYSMEM_BITS	36
 #define SECTION_SIZE_BITS	34

@@ -32,10 +33,17 @@

 #ifndef __ASSEMBLY__

+static inline phys_addr_t __virt_to_phys(unsigned long x);
+
 static inline phys_addr_t __virt_to_idmap(unsigned long x)
 {
+#ifdef	ORIGINAL_PRE_TBESEMER
 	return (phys_addr_t)(x) - CONFIG_PAGE_OFFSET +
 		KEYSTONE_LOW_PHYS_START;
+#else
+	return __virt_to_phys(x) - KEYSTONE_HIGH_PHYS_START +
+		KEYSTONE_LOW_PHYS_START;
+#endif
 }

 #define virt_to_idmap(x)	__virt_to_idmap((unsigned long)(x))
</pre>
<p><u>Device tree source patch</u>
</p>
<pre>--- ref/keystone-0430a//linux-keystone/arch/arm/boot/dts/k2hk-evm.dts	2013-04-30 11:19:07.000000000 -0700
+++ linux-keystone/arch/arm/boot/dts/k2hk-evm.dts	2013-05-10 09:56:40.418347675 -0700
@@ -17,7 +17,7 @@
 	};

 	memory {
-		reg = &lt;0x00000000 0x80000000 0x00000000 0x20000000&gt;;
+		reg = &lt;0x00000000 0xA0000000 0x00000000 0x20000000&gt;;
 	};

 	droppolicies: default-drop-policies {
</pre>
<p><u>u-boot code patch</u>
</p>
<pre>--- ref/keystone-0430a//u-boot-keystone/include/configs/tci6638_evm.h	2013-04-30 10:29:03.000000000 -0700
+++ u-boot-keystone/include/configs/tci6638_evm.h	2013-05-09 13:46:25.277274692 -0700
@@ -47,8 +47,8 @@

 /* Memory Configuration */
 #define CONFIG_NR_DRAM_BANKS		1
-#define CONFIG_SYS_SDRAM_BASE		0x80000000
-#define CONFIG_MAX_RAM_BANK_SIZE	(2 &lt;&lt; 30)	/* 2GB */
+#define CONFIG_SYS_SDRAM_BASE		0xA0000000
+#define CONFIG_MAX_RAM_BANK_SIZE	((1024 * 1024) * 1024)
 #define CONFIG_STACKSIZE		(512 &lt;&lt; 10)	/* 512 KiB */
 #define CONFIG_SYS_MALLOC_LEN		(512 &lt;&lt; 10)	/* 512 KiB */
 #define CONFIG_SYS_MEMTEST_START	CONFIG_SYS_SDRAM_BASE
@@ -194,7 +194,7 @@
 #define CONFIG_CMD_SF

 /* U-Boot general configuration */
-#define CONFIG_SYS_PROMPT		"TCI6638 EVM # "
+#define CONFIG_SYS_PROMPT		"TCI6638 EVM (teb) # "
 #define CONFIG_SYS_CBSIZE		1024
 #define CONFIG_SYS_PBSIZE		2048
 #define CONFIG_SYS_MAXARGS		16
@@ -265,6 +265,6 @@
 #define CONFIG_SETUP_MEMORY_TAGS
 #define CONFIG_SYS_BARGSIZE		1024
 #define CONFIG_SYS_LOAD_ADDR		(CONFIG_SYS_SDRAM_BASE + 0x08000000)
-#define LINUX_BOOT_PARAM_ADDR		(CONFIG_SYS_SDRAM_BASE + 0x100)
+#define LINUX_BOOT_PARAM_ADDR		(CONFIG_SYS_SDRAM_BASE + 0x00000100)

 #endif /* __CONFIG_H */
</pre>
<p>Also when using the patch, make sure to update the following env variables in u-boot
</p>
<pre>setenv addr_fdt 0xA7000000
setenv addr_kern 0xA8000000
</pre>
<h2><span id="How_to_boot_with_a_combined_kernel_and_initramfs_image?"></span><span class="mw-headline" id="How_to_boot_with_a_combined_kernel_and_initramfs_image.3F">How to boot with a combined kernel and initramfs image?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=241" title="Edit section: How to boot with a combined kernel and initramfs image?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section is borrowed from [<a rel="nofollow" class="external autonumber" href="Initrd.html">[13]</a>]
</p><p>To use initramfs as part of a combined kernel/initramfs image, a cpio archive is embedded directly into the kernel. I.e. you don't create an additional ramfs image. Instead, the initial file system is directly incorporated into the kernel. With this, the kernel size increases by the file system size. It's like you embed above ramfs directly into the kernel. You simply have to fill a directory on your host with the target filesystem you like and then pass the path to this directory to the kernel build process.
</p>
<h3><span class="mw-headline" id="Create_target_file_system">Create target file system</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=242" title="Edit section: Create target file system">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<pre>host &gt; mkdir target_fs
host &gt; ... copy stuff you want to have in initramfs to target_fs... do following command using arago-console-image.tar.gz provided in the release
host &gt; cd target_fs
host &gt; sudo tar -xvzf &lt;path of arago-console-image.tar.gz&gt;
host &gt; cd ..
host &gt; sudo chmod a+rwx target_fs -R
</pre>
<p>Now cd to linux kernel root directory.
</p>
<h3><span class="mw-headline" id="Configure_kernel_to_embed_initramfs">Configure kernel to embed initramfs</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=243" title="Edit section: Configure kernel to embed initramfs">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Kernel options
</p><p>Now give the kernel the path to the target file system you like to embed. Edit the defconfig for the platform and update the CONFIG_INITRAMFS_SOURCE variable and save:-
</p>
<pre>#
# General setup
#
...
CONFIG_BLK_DEV_INITRD=y
CONFIG_INITRAMFS_SOURCE="&lt;path_to&gt;/target_fs&gt;"
...
</pre>
<pre>#
# UBI - Unsorted block images
#
...
CONFIG_BLK_DEV_RAM=y
CONFIG_BLK_DEV_RAM_COUNT=1
CONFIG_BLK_DEV_RAM_SIZE=8192
...
</pre>
<p>Then, if you compile the kernel, e.g. by make uImage, the cpio archive is generated and embedded into the kernel:
</p>
<pre>...
CHK     include/linux/compile.h
GEN     usr/initramfs_data.cpio.gz
AS      usr/initramfs_data.o
LD      usr/built-in.o
...
</pre>
<h3><span class="mw-headline" id="Setup_u-boot_environment_and_boot_combined_image">Setup u-boot environment and boot combined image</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=244" title="Edit section: Setup u-boot environment and boot combined image">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>At the u-boot console, do the following:-
</p><p>For boot mode = ramfs do the following:-
</p><p>Copy the kernel image (build using procedure above), uImage-combined, to the tftp server root directory.
</p>
<pre>env default -f -a
setenv serverip &lt;tftp server IP&gt;
setenv args_ramfs 'setenv bootargs ${bootargs} earlyprintk rdinit=/sbin/init'
setenv name_kern uImage-combined
setenv tftp_root &lt;tftp server root directory&gt;
setenv init_ramfs 'run args_all args_ramfs'
saveenv
</pre>
<p>At this time, issue the boot command and Linux boots up with embedded initramfs image.
</p><p><br />
</p>
<h2><span id="How_to_change_Tetris_and_Core_PLL_speed?"></span><span class="mw-headline" id="How_to_change_Tetris_and_Core_PLL_speed.3F">How to change Tetris and Core PLL speed?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=245" title="Edit section: How to change Tetris and Core PLL speed?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The prerequisite is to follow hardware setup guide to update EVM with the latest BMC and UCD firmware version.
</p><p>1. The PLL clock frequency is now programmed based on EFUSE register settings for K2HK Rev. 3.x EVM and K2EL Rev. 1.0.2.x. The getclk command in u-boot can be used to know the actual frequency used. The default PLL speeds of the Core(DSP) and Tetris(ARM) are
</p>
<table class="wikitable">

<tbody><tr>
<th><b>Platform</b></th>
<th><b>Core</b></th>
<th><b>Tetris</b>
</th></tr>
<tr>
<td>K2H</td>
<td>800MHz</td>
<td>1200MHz
</td></tr>
<tr>
<td>K2K</td>
<td>800MHz</td>
<td>1200MHz
</td></tr>
<tr>
<td>K2E</td>
<td>1250MHz</td>
<td>1250MHz
</td></tr>
<tr>
<td>K2L</td>
<td>1250MHz</td>
<td>1250MHz
</td></tr></tbody></table>
<p>2. To change the Tetris frequency, the EVM's reference clock is needed for the calculation. Each platform may have different main reference clock frequency, please refer to the sys_clk defined in board_k2x.c for the refclkmain frequency. 
</p><p>If Tetris PLL speed needs to be changed on K2HK, at Uboot prompt, pllset command can be used. E.g.:
</p>
<pre>  pllset arm 19 1 2
</pre>
<p>Here the calculation example assuming the refclkmain is 125MHz
please use the refclkmain value mentioned above when changing on EVM):
</p>
<pre>  125000000*19/(1*2) = 1187500000 Hz
</pre>
<p>At Uboot prompt, getclk command can be used to verify the Tetris frequency setting. The argument for Tetris component is based on the enum clk_e definition in clock_k2x.h. For K2H, the Tetris speed can be read by the following command
</p>
<pre>  &gt;getclk 2
</pre>
<p>For K2E, the Tetris speed is the same as core PLL and can not be changed. The core_pll_clk defined in enum clk_e of clock_k2e.h is 0. So, for K2E, the Tetris speed can be read by the following command
</p>
<pre>  &gt;getclk 0
</pre>
<p>3. To change the Core PLL clock, you need to update the core_pll_config[] in board/ti/ks2_evm/board_k2x.c by replacing
CORE_PLL_1228 with appropriate clock define.
</p><p>For example, if current core speed of K2H is at 800MHz, modify the core_pll_config setting in board_k2hk.c 
</p>
<pre>  from  { CORE_PLL,     13,     1,      2 }, /* 799 */
  to    { CORE_PLL,     625,     32,      2 }, /* 1200 */
</pre>
<h2><span id="How_to_boot_Linux_using_uinitrd?"></span><span class="mw-headline" id="How_to_boot_Linux_using_uinitrd.3F">How to boot Linux using uinitrd?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=246" title="Edit section: How to boot Linux using uinitrd?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>To boot Linux using a uImage formatted initrd, follow the procedure given here.
</p><p>1. First generate the uinitrd.bin image using the following command on a Linux Host:
</p>
<pre> mkimage  -A arm -O linux -T ramdisk -C gzip -a 0 -e 0 -n initramfs -d arago-console-image.cpio.gz uinitrd.bin
</pre>
<p>Where arago-console-image.cpio.gz is available as part of the release. Copy uinitrd.bin to the tftp server root directory
</p><p>2. Make sure the u-boot image is built using latest u-boot-keystone source at git.ti.com. Following commits are required at the minimum:-
</p>
<pre> keystone: dt fix up for uinitrd
 keystone2: automate boot up using uinitrd fs
</pre>
<p>3. Upgrade the u-boot image to the EVM.
</p><p>4. Do the following command after u-boot boots up
</p>
<pre> env default -f -a
 setenv serverip &lt;tftp server IP&gt;
 setenv tftp_root &lt;Tftp server root directory&gt;
 setenv boot uinitrd
 saveenv
</pre>
<p>4a. If using LPAE on Linux version below 3.13, and have the patch "keystone2: add env option to do unitrd dt fixup", set the following flag:
</p>
<pre> setenv uinitrd_fixup 1
 saveenv
</pre>
<p>5. Issue boot command to boot to Linux. A sample initial part of u-boot part of the bootlog is shown below.
</p>
<pre>## Booting kernel from Legacy Image at 88000000 ...
   Image Name:   Linux-3.8.4-rt2-01184-gf78749b
   Created:      2013-07-05  19:56:56 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    3648776 Bytes = 3.5 MiB
   Load Address: 80008000
   Entry Point:  80008000
   Verifying Checksum ... OK
## Loading init Ramdisk from Legacy Image at 82000000 ...
   Image Name:   initramfs
   Created:      2013-07-01  18:38:53 UTC
   Image Type:   ARM Linux RAMDisk Image (gzip compressed)
   Data Size:    7652966 Bytes = 7.3 MiB
   Load Address: 00000000
   Entry Point:  00000000
   Verifying Checksum ... OK
## Flattened Device Tree blob at 87000000
   Booting using the fdt blob at 0x87000000
   Loading Kernel Image ... OK
OK
   Using Device Tree in place at 87000000, end 8700dae3
</pre>
<p><br />
</p>
<h2><span id="How_to_use_fixed_IP_address_instead_of_DHCP?"></span><span class="mw-headline" id="How_to_use_fixed_IP_address_instead_of_DHCP.3F">How to use fixed IP address instead of DHCP?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=247" title="Edit section: How to use fixed IP address instead of DHCP?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>1. U-boot IP address
</p>
<pre>  To statically configure an IP address for u-boot, use the setenv command:
   setenv ipaddr &lt;ip_address&gt;
</pre>
<p>2. If static IP address is configured in u-boot, then it is not applicable to use dhcp to download files. It is necessary to change all downloading commands in printenv from 'dhcp &lt;file_name&gt;' to 'tftp &lt;file_name&gt;'. and the command examples are as following:
</p>
<pre>  setenv get_fdt_net 'tftp ${addr_fdt} ${tftp_root}/${name_fdt}'
  setenv get_fdt_ramfs 'tftp ${addr_fdt} ${tftp_root}/${name_fdt}'
  setenv get_fs_ramfs 'tftp ${addr_fs} ${tftp_root}/${name_fs}'
  setenv get_kern_net 'tftp ${addr_kern} ${tftp_root}/${name_kern}'
  setenv get_kern_ramfs 'tftp ${addr_kern} ${tftp_root}/${name_kern}'
  setenv get_mon_net 'tftp ${addr_mon} ${tftp_root}/${name_mon}'
  setenv get_mon_ramfs 'tftp ${addr_mon} ${tftp_root}/${name_mon}'
  setenv get_uboot_net 'tftp ${addr_uboot} ${tftp_root}/${name_uboot}'
  setenv get_uboot_ramfs 'tftp ${addr_uboot} ${tftp_root}/${name_uboot}'
</pre>
<p><br />
To revert the commands back to default settings if not using static IP address:
</p><p><br />
</p>
<pre>  setenv get_fdt_net 'dhcp ${addr_fdt} ${tftp_root}/${name_fdt}'
  setenv get_fdt_ramfs 'dhcp ${addr_fdt} ${tftp_root}/${name_fdt}'
  setenv get_fs_ramfs 'dhcp ${addr_fs} ${tftp_root}/${name_fs}'
  setenv get_kern_net 'dhcp ${addr_kern} ${tftp_root}/${name_kern}'
  setenv get_kern_ramfs 'dhcp ${addr_kern} ${tftp_root}/${name_kern}'
  setenv get_mon_net 'dhcp ${addr_mon} ${tftp_root}/${name_mon}'
  setenv get_mon_ramfs 'dhcp ${addr_mon} ${tftp_root}/${name_mon}'
  setenv get_uboot_net 'dhcp ${addr_uboot} ${tftp_root}/${name_uboot}'
  setenv get_uboot_ramfs 'dhcp ${addr_uboot} ${tftp_root}/${name_uboot}'
</pre>
<p><br />
</p><p>3. Linux Kernel IP address
</p>
<pre>  To statically configure IP address for Linux Kernel, The args_all  need to be updated/modified for all boot modes:ubi, net, ramfs etc. with the following commands using boot=net as the example and assuming the static IP address is the same as u-boot environment variable, ipaddr:
</pre>
<pre>  1) Create uboot environment variable for netmask.
     # setenv netmask 255.255.255.0
  2) Check environment variable for ipaddr is set.  Set if necessary.
     # printenv ipaddr
  3) Check environment variable for gatewayip is set. Set if necessary.
     # printenv gatewayip
  4) Modify args_all
     # setenv args_all 'setenv bootargs console=ttyS0,115200n8 rootwait=1 ip=${ipaddr}::${gatewayip}:${netmask}::eth0:off'
  5) Remove ip=dhcp from args_net
     a)printenv args_net
     b)copy everything except ip=dhcp
     c)setenv args_net &lt;copy args_net from step above without ip=dhcp&gt; (quotes are important).
       The command should look like:
       #setenv args_net 'setenv bootargs ${bootargs} rootfstype=nfs root=/dev/nfs rw nfsroot=${serverip}:${nfs_root},${nfs_options}'
  6) Save the uboot environment
     #saveenv
  7) Boot the EVM
     #boot
</pre>
<h2><span id="If_using_multiple_interfaces,_DHCP_and_NFS_filesystem"></span><span class="mw-headline" id="If_using_multiple_interfaces.2C_DHCP_and_NFS_filesystem">If using multiple interfaces, DHCP and NFS filesystem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=248" title="Edit section: If using multiple interfaces, DHCP and NFS filesystem">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>To make sure the interface your NFS server is connected to is the first interface to boot in the bootargs explained in the section above, you may assign "ip=:::::eth0:dhcp". This will ensure eth0 is used for NFS mount.
</p><p><br />
</p>
<h2><span id="How_to_boot_from_USB_Flash_drive?"></span><span class="mw-headline" id="How_to_boot_from_USB_Flash_drive.3F">How to boot from USB Flash drive?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=249" title="Edit section: How to boot from USB Flash drive?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="On_Ubuntu_Host">On Ubuntu Host</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=250" title="Edit section: On Ubuntu Host">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="I_-_Install_gparted">I - Install gparted</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=251" title="Edit section: I - Install gparted">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre>$sudo apt-get install gparted
</pre>
<p>Used GParted 0.11.0 for this test. So exact steps may vary if version is different
</p>
<h4><span class="mw-headline" id="II_-_Partition_the_device">II - Partition the device</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=252" title="Edit section: II - Partition the device">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Use partition 1 for boot images and Partition 2 for rootfs
</p><p>insert the usb flash drive to usb slot
</p>
<pre>$sudo gparted
</pre>
<p>The GUI will show up now. Choose correct device (/dev/sdx) at the top right corner (shows the correct size of the usb drive). This example uses /dev/sdc1 for partion 1
and /dev/sdc2 for partition 2
</p><p>Warning!! Before you proceed, make sure you selected the correct device, otherwise it may format the active harddisk partition of your PC
</p><p>Got to top level "Partition" pulldown menu and select Unmount to unmount the device. If there is existing partition, delete the same (Partition -&gt; delete)
</p>
<dl><dd><dl><dd>Now Partition and filesystem status shows as unallocated</dd></dl></dd></dl>
<p>1. Create fat32 partion for boot (contains boot images)
</p>
<dl><dd>Partition -&gt; new
<dl><dd>New size = 32MiB</dd>
<dd>File system = fat32</dd>
<dd>label = boot</dd>
<dd>Keep rest of the fields default</dd>
<dd>click add to add partition</dd>
<dd>select the partiton #1 just created and format it (Partition -&gt; format to).
<dl><dd>select fat32 format</dd></dl></dd></dl></dd></dl>
<p>2. Create ext4 format for rootfs (contains root filesystem)
</p>
<dl><dd>select the unallocate partition</dd>
<dd>Partition -&gt; new
<dl><dd>File system = ext4</dd>
<dd>label = rootfs</dd>
<dd>Keep rest of the fields default</dd>
<dd>click add to add partition</dd>
<dd>select the partiton #2 just created and format it (Partition -&gt; format to).
<dl><dd>select ext4 format</dd></dl></dd></dl></dd></dl>
<p>3. Apply the changes and Quit
</p>
<dl><dd>Edit -&gt; Apply All Operations</dd>
<dd>GParted -&gt; Quit</dd></dl>
<h4><span class="mw-headline" id="III_-_Copy_images_and_rootfs_files_to_partitions">III - Copy images and rootfs files to partitions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=253" title="Edit section: III - Copy images and rootfs files to partitions">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Unmount if the devices are automounted
</p>
<pre>$sudo umount  /dev/sdc1
$sudo umount  /dev/sdc2
</pre>
<p>1. Copy images to partition #1 (boot)
</p>
<pre>$sudo mount -t vfat /dev/sdc1 /mnt/test
</pre>
<p>Assume all images are available at the current directory
</p>
<pre>$sudo cp skern-keystone-evm.bin /mnt/test/
$sudo cp uImage-k2hk-evm.dtb /mnt/test/
$sudo cp uImage-keystone-evm.bin /mnt/test/
$ls /mnt/test
skern-keystone-evm.bin  uImage-k2hk-evm.dtb  uImage-keystone-evm.bin
$sudo umount /dev/sdc1
</pre>
<p>2. Copy rootfs files to partition #2 (rootfs)
</p>
<pre>$mdir test
$cd test
$gunzip &lt;path of arago-console-image.cpio.gz&gt;
$sudo cpio -i -F ../arago-console-image.cpio
$sudo mount -t ext4 /dev/sdc2 /mnt/test
$cd ..
$sudo cp -r test/* /mnt/test
$ls /mnt/test/
bin  boot  dev  etc  home  init  lib  lost+found  media  mnt  proc  sbin  srv  sys  tmp  usr  var
$sudo umount /dev/sdc2
</pre>
<h3><span class="mw-headline" id="On_EVM">On EVM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=254" title="Edit section: On EVM">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Requires Linux Kernel image with EXT4 support
</p>
<h4><span class="mw-headline" id="Setup_u-boot_env_variables">Setup u-boot env variables</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=255" title="Edit section: Setup u-boot env variables">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Insert USB flash drive to usb slot on EVM and Power ON EVM
Type the following commands to setup the env for usb boot
</p>
<pre>&gt;setenv boot usb
&gt;setenv args_usb 'setenv bootargs ${bootargs} rootfstype=ext4 root=/dev/sda2 rw'
&gt;setenv init_usb 'usb start; run set_fs_none args_all args_usb'
&gt;setenv get_fdt_usb 'fatload usb 0:1 ${addr_fdt} ${name_fdt}'
&gt;setenv get_kern_usb 'fatload usb 0:1 ${addr_kern} ${name_kern}'
&gt;setenv get_mon_usb 'fatload usb 0:1 ${addr_mon} ${name_mon}'
&gt;saveenv
&gt;boot
<b>IMPORTANT: Make sure "rootwait" (NOT "rootwait=1") appears in args_all</b>
</pre>
<p>Here is the log using a USB 3.0 device. Boot takes about 1 minute
</p>
<pre>U-Boot 2013.01-00009-gd274e3f-dirty (Aug 29 2013 - 12:10:33)
</pre>
<pre>I2C:   ready
DRAM:  1 GiB
NAND:  512 MiB
Net:   TCI6638_EMAC, TCI6638_EMAC1
Hit any key to stop autoboot:  0
(Re)start USB...
USB0:   No power optimization available
Register 2001040 NbrPorts 2
Starting the controller
USB XHCI 1.00
scanning bus 0 for devices...
2 USB Device(s) found
      scanning usb for storage devices... 1 Storage Device(s) found
reading uImage-k2hk-evm.dtb
44562 bytes read in 1067 ms (40 KiB/s)
reading skern-keystone-evm.bin
45056 bytes read in 949 ms (45.9 KiB/s)
reading uImage-keystone-evm.bin
3989320 bytes read in 48025 ms (81.1 KiB/s)
## installed monitor, freq [194560000], status 0
## Booting kernel from Legacy Image at 88000000 ...
  Image Name:   Linux-3.8.4-rt2-01225-g62655f8
  Created:      2013-08-30  14:33:02 UTC
  Image Type:   ARM Linux Kernel Image (uncompressed)
  Data Size:    3989256 Bytes = 3.8 MiB
  Load Address: 80008000
  Entry Point:  80008000
  Verifying Checksum ... OK
## Flattened Device Tree blob at 87000000
  Booting using the fdt blob at 0x87000000
  Loading Kernel Image ... OK
OK
  Using Device Tree in place at 87000000, end 8700de11
</pre>
<pre>Starting kernel ...
</pre>
<pre>[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 3.8.4-rt2-01225-g62655f8 (a0868495@ares-ubuntu.am.dhc
p.ti.com) (gcc version 4.7.3 20130226 (prerelease) (crosstool-NG linaro-1.13.1-4.7
-2013.03-20130313 - Linaro GCC 2013.03) ) #3 SMP PREEMPT RT Fri Aug 30 10:32:50 ED
T 2013
[    0.000000] CPU: ARMv7 Processor [412fc0f4] revision 4 (ARMv7), cr=30c7387d
[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, PIPT instruction cache
[    0.000000] Machine: KeyStone2, model: Texas Instruments Keystone 2 SoC
[    0.000000] switching to high address space at 0x800000000
[    0.000000] cma: CMA: reserved 16 MiB at 1f000000
[    0.000000] Memory policy: ECC disabled, Data cache writealloc
[    0.000000] PERCPU: Embedded 9 pages/cpu @c0bd2000 s12864 r8192 d15808 u36864
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages
: 130048
[    0.000000] Kernel command line: console=ttyS0,115200n8 rootwait=1 rootwait=1 r
ootfstype=ext4 rootwait root=/dev/sda2 rw ip=dhcp
[    0.000000] PID hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] Dentry cache hash table entries: 65536 (order: 6, 262144 bytes)
[    0.000000] Inode-cache hash table entries: 32768 (order: 5, 131072 bytes)
[    0.000000] __ex_table already sorted, skipping sort
[    0.000000] Memory: 512MB = 512MB total
[    0.000000] Memory: 495164k/495164k available, 29124k reserved, 0K highmem
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector &#160;: 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap &#160;: 0xfff00000 - 0xfffe0000   ( 896 kB)
[    0.000000]     vmalloc&#160;: 0xe0800000 - 0xff000000   ( 488 MB)
[    0.000000]     lowmem &#160;: 0xc0000000 - 0xe0000000   ( 512 MB)
[    0.000000]     pkmap  &#160;: 0xbfe00000 - 0xc0000000   (   2 MB)
[    0.000000]     modules&#160;: 0xbf000000 - 0xbfe00000   (  14 MB)
[    0.000000]       .text&#160;: 0xc0008000 - 0xc070243c   (7146 kB)
[    0.000000]       .init&#160;: 0xc0703000 - 0xc0742240   ( 253 kB)
[    0.000000]       .data&#160;: 0xc0744000 - 0xc078b8e0   ( 287 kB)
[    0.000000]        .bss&#160;: 0xc078b8e0 - 0xc07b63ac   ( 171 kB)
[    0.000000] SLUB: Genslabs=11, HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nod
es=1
[    0.000000] Preemptible hierarchical RCU implementation.
[    0.000000] NR_IRQS:16 nr_irqs:16 16
[    0.000000] ipc irq: irqchip registered, range 512-539
[    0.000000] main_pll_clk rate is 1167360000, postdiv = 2, mult = 18,prediv = 0
[    0.000000] pll_clk parent_rate(122880000 Hz), rate(327680000 Hz),postdiv = 6,
mult = 15, prediv = 0
[    0.000000] tci6614-timer: no matching node
[    0.000000] Architected local timer running at 194.56MHz (phys).
[    0.000000] Switching to timer-based delay loop
[    0.000000] sched_clock: 32 bits at 194MHz, resolution 5ns, wraps every 22075ms
[    0.000000] Console: colour dummy device 80x30
[    0.000145] Calibrating delay loop (skipped), value calculated using timer freq
uency.. 389.12 BogoMIPS (lpj=1945600)
[    0.000148] pid_max: default: 4096 minimum: 301
[    0.000300] Mount-cache hash table entries: 512
[    0.011993] CPU: Testing write buffer coherency: ok
[    0.012169] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000
[    0.012204] Setting up static identity map for 0x80517268 - 0x8051729c
[    0.182030] CPU1: Booted secondary processor
[    0.182044] CPU1: thread -1, cpu 1, socket 0, mpidr 80000001
[    0.261490] CPU2: Booted secondary processor
[    0.261504] CPU2: thread -1, cpu 2, socket 0, mpidr 80000002
[    0.341575] CPU3: Booted secondary processor
[    0.341590] CPU3: thread -1, cpu 3, socket 0, mpidr 80000003
[    0.341652] Brought up 4 CPUs
[    0.341674] SMP: Total of 4 processors activated (1556.48 BogoMIPS).
[    0.360841] NET: Registered protocol family 16
[    0.384047] DMA: preallocated 256 KiB pool for atomic coherent allocations
[    0.395928] keystone2_pcie_serdes_setup
[    0.397997] keystone2_pcie_serdes_setup done
[    0.398015] hw-breakpoint: found 5 (+1 reserved) breakpoint and 4 watchpoint re
gisters.
[    0.398021] hw-breakpoint: maximum watchpoint size is 8 bytes.
[    0.411553] bio: create slab &lt;bio-0&gt; at 0
[    0.411792] keystone-pcie: keystone_pcie_rc_init - start
[    0.411941] MEM 0x0000000050000000..0x000000005fffffff -&gt; 0x0000000050000000
[    0.411952] IO 0x0000000024000000..0x0000000024003fff -&gt; 0x0000000000000000
[    0.411993] pcie - number of legacy irqs = 4
[    0.412054] pcie - number of MSI host irqs = 8, msi_irqs = 32
[    0.522253] keystone-pcie: Doing PCI Setup...Done
[    0.522260] keystone-pcie: Starting PCI scan...
[    0.522425] PCI host bridge to bus 0000:00
[    0.522438] pci_bus 0000:00: root bus resource [mem 0x50000000-0x5fffffff]
[    0.522446] pci_bus 0000:00: root bus resource [io  0x0000-0x3fff]
[    0.522454] pci_bus 0000:00: No busn resource found for root bus, will use [bus
 00-ff]
[    0.522497] PCI: bus0: Fast back to back transfers enabled
[    0.522515] keystone-pcie: Ending PCI scan...
[    0.522524] keystone-pcie: keystone_pcie_rc_init - end
[    0.522757] vgaarb: loaded
[    0.523196] SCSI subsystem initialized
[    0.523743] usbcore: registered new interface driver usbfs
[    0.523871] usbcore: registered new interface driver hub
[    0.524010] usbcore: registered new device driver usb
[    0.525636] pps_core: LinuxPPS API ver. 1 registered
[    0.525643] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giomett
i &lt;giometti@linux.it&gt;
[    0.525729] PTP clock support registered
[    0.525906] keystone-hwqueue hwqueue.4: qmgr start queue 0, number of queues 81
92
[    0.526024] keystone-hwqueue hwqueue.4: added qmgr start queue 0, num of queues
8192, reg_peek e0840000, reg_status e0804000, reg_config e0806000, reg_region e08
08000, reg_push e0880000, reg_pop e08c0000
[    0.526034] keystone-hwqueue hwqueue.4: qmgr start queue 8192, number of queues
8192
[    0.526144] keystone-hwqueue hwqueue.4: added qmgr start queue 8192, num of que
ues 8192, reg_peek e0900000, reg_status e080a400, reg_config e080c000, reg_region
e080e000, reg_push e0940000, reg_pop e0980000
[    0.527132] keystone-hwqueue hwqueue.4: qos: sched port @8096, drop sched @8000
[    0.528509] keystone-hwqueue hwqueue.4: qos: sched port @6496, drop sched @6400
[    0.529871] keystone-hwqueue hwqueue.4: added pool pool-net: 2048 descriptors o
f size 128
[    0.529882] keystone-hwqueue hwqueue.4: added pool pool-rio: 128 descriptors of
size 256
[    0.529892] keystone-hwqueue hwqueue.4: added pool pool-udma: 1636 descriptors
of size 256
[    0.529902] keystone-hwqueue hwqueue.4: added pool pool-xge: 2048 descriptors o
f size 128
[    0.529912] keystone-hwqueue hwqueue.4: added pool pool-crypto: 512 descriptors
 of size 128
[    0.533290] keystone-hwqueue hwqueue.4: registered queues 0-16383
[    0.533672] keystone-hwqueue hwqueue.4: qos version 0x2000105, magic valid
[    0.534173] keystone-hwqueue hwqueue.4: qos version 0x2000105, magic valid
[    0.541329] keystone-pktdma 2004000.pktdma: registered 24 logical channels, flo
ws 32, tx chans: 9, rx chans: 24
[    0.545326] keystone-pktdma 2a08000.pktdma: registered 24 logical channels, flo
ws 32, tx chans: 32, rx chans: 32, loopback
[    0.546110] keystone-pktdma 2fa1000.pktdma: registered 4 logical channels, flow
s 32, tx chans: 16, rx chans: 16
[    0.546301] Switching to clocksource arch_sys_counter
[    0.577408] NET: Registered protocol family 2
[    0.577857] TCP established hash table entries: 4096 (order: 3, 32768 bytes)
[    0.577936] TCP bind hash table entries: 4096 (order: 4, 114688 bytes)
[    0.578066] TCP: Hash tables configured (established 4096 bind 4096)
[    0.578105] TCP: reno registered
[    0.578117] UDP hash table entries: 256 (order: 2, 16384 bytes)
[    0.578143] UDP-Lite hash table entries: 256 (order: 2, 16384 bytes)
[    0.578361] NET: Registered protocol family 1
[    0.578574] RPC: Registered named UNIX socket transport module.
[    0.578581] RPC: Registered udp transport module.
[    0.578587] RPC: Registered tcp transport module.
[    0.578592] RPC: Registered tcp NFSv4.1 backchannel transport module.
[    0.579044] hw perfevents: enabled with ARMv7 Cortex-A15 PMU driver, 7 counters
available
[    0.667192] Installing knfsd (copyright (C) 1996 okir@monad.swb.de).
[    0.667560] NTFS driver 2.1.30 [Flags: R/O].
[    0.667944] jffs2: version 2.2. (NAND)  2001-2006 Red Hat, Inc.
[    0.668478] msgmni has been set to 999
[    0.669499] NET: Registered protocol family 38
[    0.669789] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252
)
[    0.669798] io scheduler noop registered
[    0.669804] io scheduler deadline registered
[    0.670000] io scheduler cfq registered (default)
[    0.671576] keystone-udma udma0.5: registered udma device udma0
[    0.734545] Serial: 8250/16550 driver, 4 ports, IRQ sharing disabled
[    0.736476] 2530c00.serial: ttyS0 at MMIO 0x2530c00 (irq = 309) is a 16550A
[    1.523400] console [ttyS0] enabled
[    1.527763] 2531000.serial: ttyS1 at MMIO 0x2531000 (irq = 312) is a 16550A
[    1.538861] loop: module loaded
[    1.542184] at24 0-0050: 131072 byte 24c1024 EEPROM, writable, 1 bytes/write
[    1.550398] Generic platform RAM MTD, (c) 2004 Simtec Electronics
[    1.564415] ONFI param page 0 valid
[    1.567913] ONFI flash detected
[    1.571064] NAND device: Manufacturer ID: 0x2c, Chip ID: 0xac (Micron MT29F4G08
ABBDAHC), 512MiB, page size: 2048, OOB size: 64
[    1.582770] Bad block table found at page 262080, version 0x02
[    1.589032] Bad block table found at page 262016, version 0x02
[    1.595089] nand_read_bbt: bad block at 0x000001a20000
[    1.600266] nand_read_bbt: bad block at 0x00001ce60000
[    1.605484] 3 ofpart partitions found on MTD device 30000000.nand
[    1.611596] Creating 3 MTD partitions on "30000000.nand":
[    1.617014] 0x000000000000-0x000000100000&#160;: "u-boot"
[    1.622827] 0x000000100000-0x000000180000&#160;: "params"
[    1.628599] 0x000000180000-0x000008000000&#160;: "ubifs"
[    1.634328] davinci_nand 30000000.nand: controller rev. 2.5
[    1.640645] spi_davinci 21000400.spi: master is unqueued, this is deprecated
[    1.648106] m25p80 spi32766.0: found n25q128a11, expected n25q128
[    1.654221] m25p80 spi32766.0: n25q128a11 (16384 Kbytes)
[    1.659558] 2 ofpart partitions found on MTD device spi32766.0
[    1.665408] Creating 2 MTD partitions on "spi32766.0":
[    1.670562] 0x000000000000-0x000000080000&#160;: "u-boot-spl"
[    1.676874] 0x000000080000-0x000001000000&#160;: "test"
[    1.682874] spi_davinci 21000400.spi: Controller at 0xe0878400
[    1.689789] tun: Universal TUN/TAP device driver, 1.6
[    1.694854] tun: (C) 1999-2004 Max Krasnyansky &lt;maxk@qualcomm.com&gt;
[    1.701654] keystone-netcp 2f00000.netcp: No streaming regs defined
[    1.708067] keystone-netcp 2090000.netcp: cpts rftclk freq not defined
[    1.715696] keystone-netcp 2090000.netcp: Created interface "eth0"
[    1.721904] keystone-netcp 2090000.netcp: dma_chan_name nettx0
[    1.728761] keystone-netcp 2090000.netcp: Created interface "eth1"
[    1.734967] keystone-netcp 2090000.netcp: dma_chan_name nettx1
[    1.742144] keystone-dwc3 2690000.dwc: usbss revision 47914300
[    1.748031] keystone-dwc3 2690000.dwc: mapped irq 425 to virq 608
[    1.956808] xhci-hcd xhci-hcd: xHCI Host Controller
[    1.961718] xhci-hcd xhci-hcd: new USB bus registered, assigned bus number 1
[    1.969739] xhci-hcd xhci-hcd: irq 608, io mem 0x02690000
[    1.975240] usb usb1: New USB device found, idVendor=1d6b, idProduct=0002
[    1.982052] usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
[    1.989300] usb usb1: Product: xHCI Host Controller
[    1.994191] usb usb1: Manufacturer: Linux 3.8.4-rt2-01225-g62655f8 xhci-hcd
[    2.001176] usb usb1: SerialNumber: xhci-hcd
[    2.005922] hub 1-0:1.0: USB hub found
[    2.009692] hub 1-0:1.0: 1 port detected
[    2.013864] xhci-hcd xhci-hcd: xHCI Host Controller
[    2.018765] xhci-hcd xhci-hcd: new USB bus registered, assigned bus number 2
[    2.025955] usb usb2: New USB device found, idVendor=1d6b, idProduct=0003
[    2.032766] usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
[    2.040012] usb usb2: Product: xHCI Host Controller
[    2.044904] usb usb2: Manufacturer: Linux 3.8.4-rt2-01225-g62655f8 xhci-hcd
[    2.051888] usb usb2: SerialNumber: xhci-hcd
[    2.056645] hub 2-0:1.0: USB hub found
[    2.060414] hub 2-0:1.0: 1 port detected
[    2.064649] Initializing USB Mass Storage driver...
[    2.069687] usbcore: registered new interface driver usb-storage
[    2.075711] USB Mass Storage support registered.
[    2.080647] mousedev: PS/2 mouse device common for all mice
[    2.086548] i2c /dev entries driver
[    2.090806] watchdog 22f0080.wdt: heartbeat 60 sec
[    2.097888] keystone-crypto 20c0000.crypto: crypto accelerator enabled
[    2.104879] usbcore: registered new interface driver usbhid
[    2.110470] usbhid: USB HID core driver
[    2.114750]  remoteproc0: 2620040.dsp0 is available
[    2.119643]  remoteproc0: Note: remoteproc is still under development and consi
dered experimental.
[    2.128633]  remoteproc0: THE BINARY FORMAT IS NOT YET FINALIZED, and backward
compatibility isn't yet guaranteed.
[    2.139060]  remoteproc0: no firmware found
[    2.143397] rproc-user 2620040.dsp0: registered misc device dsp0
[    2.149740]  remoteproc1: 2620044.dsp1 is available
[    2.154631]  remoteproc1: Note: remoteproc is still under development and consi
dered experimental.
[    2.163623]  remoteproc1: THE BINARY FORMAT IS NOT YET FINALIZED, and backward
compatibility isn't yet guaranteed.
[    2.174048]  remoteproc1: no firmware found
[    2.178379] rproc-user 2620044.dsp1: registered misc device dsp1
[    2.184719]  remoteproc2: 2620048.dsp2 is available
[    2.189612]  remoteproc2: Note: remoteproc is still under development and consi
dered experimental.
[    2.198600]  remoteproc2: THE BINARY FORMAT IS NOT YET FINALIZED, and backward
compatibility isn't yet guaranteed.
[    2.209064]  remoteproc2: no firmware found
[    2.213487] rproc-user 2620048.dsp2: registered misc device dsp2
[    2.219843]  remoteproc3: 262004c.dsp3 is available
[    2.224734]  remoteproc3: Note: remoteproc is still under development and consi
dered experimental.
[    2.233723]  remoteproc3: THE BINARY FORMAT IS NOT YET FINALIZED, and backward
compatibility isn't yet guaranteed.
[    2.244149]  remoteproc3: no firmware found
[    2.248479] rproc-user 262004c.dsp3: registered misc device dsp3
[    2.254819]  remoteproc4: 2620050.dsp4 is available
[    2.259712]  remoteproc4: Note: remoteproc is still under development and consi
dered experimental.
[    2.266440] hub 1-0:1.0: unable to enumerate USB device on port 1
[    2.274811]  remoteproc4: THE BINARY FORMAT IS NOT YET FINALIZED, and backward
compatibility isn't yet guaranteed.
[    2.285242]  remoteproc4: no firmware found
[    2.289572] rproc-user 2620050.dsp4: registered misc device dsp4
[    2.295905]  remoteproc5: 2620054.dsp5 is available
[    2.300797]  remoteproc5: Note: remoteproc is still under development and consi
dered experimental.
[    2.309787]  remoteproc5: THE BINARY FORMAT IS NOT YET FINALIZED, and backward
compatibility isn't yet guaranteed.
[    2.320212]  remoteproc5: no firmware found
[    2.324547] rproc-user 2620054.dsp5: registered misc device dsp5
[    2.330885]  remoteproc6: 2620058.dsp6 is available
[    2.335776]  remoteproc6: Note: remoteproc is still under development and consi
dered experimental.
[    2.344765]  remoteproc6: THE BINARY FORMAT IS NOT YET FINALIZED, and backward
compatibility isn't yet guaranteed.
[    2.355192]  remoteproc6: no firmware found
[    2.359519] rproc-user 2620058.dsp6: registered misc device dsp6
[    2.365870]  remoteproc7: 262005c.dsp7 is available
[    2.370762]  remoteproc7: Note: remoteproc is still under development and consi
dered experimental.
[    2.379750]  remoteproc7: THE BINARY FORMAT IS NOT YET FINALIZED, and backward
compatibility isn't yet guaranteed.
[    2.390175]  remoteproc7: no firmware found
[    2.394505] rproc-user 262005c.dsp7: registered misc device dsp7
[    2.400557] rproc-user dspmem.3: kick gpio
[    2.404798] rproc-user dspmem.3: registered misc device dspmem
[    2.410817] GACT probability on
[    2.413967] Mirror/redirect action on
[    2.417641] Simple TC action Loaded
[    2.421669] netem: version 1.3
[    2.424734] u32 classifier
[    2.427448]     Performance counters on
[    2.431290]     input device check on
[    2.434958]     Actions configured
[    2.438379] Netfilter messages via NETLINK v0.30.
[    2.443107] nf_conntrack version 0.5.0 (7992 buckets, 31968 max)
[    2.449469] ctnetlink v0.93: registering with nfnetlink.
[    2.455114] IPv4 over IPv4 tunneling driver
[    2.459827] gre: GRE over IPv4 demultiplexor driver
[    2.464719] ip_gre: GRE over IPv4 tunneling driver
[    2.470185] ip_tables: (C) 2000-2006 Netfilter Core Team
[    2.475612] ipt_CLUSTERIP: ClusterIP Version 0.8 loaded successfully
[    2.482023] arp_tables: (C) 2002 David S. Miller
[    2.486697] TCP: cubic registered
[    2.490018] Initializing XFRM netlink socket
[    2.495227] NET: Registered protocol family 10
[    2.500552] NET: Registered protocol family 17
[    2.505028] NET: Registered protocol family 15
[    2.509539] Bridge firewalling registered
[    2.513564] Ebtables v2.0 registered
[    2.517249] 8021q: 802.1Q VLAN Support v1.8
[    2.521741] sctp: Hash tables configured (established 4096 bind 4681)
[    2.528729] NET: Registered protocol family 40
[    2.533347] VFP support v0.3: implementor 41 architecture 4 part 30 variant f r
ev 0
[    2.541048] Registering SWP/SWPB emulation handler
[    2.546470] usb 2-1: new SuperSpeed USB device number 2 using xhci-hcd
[    2.547633] input: gpio_keys.7 as /devices/soc.0/gpio_keys.7/input/input0
[    2.554138] keystone-netcp 2090000.netcp: initializing cpsw version 1.3 (1) SGM
II identification value 0x4ed1
[    2.554301] keystone-netcp 2090000.netcp: Created a cpsw ale engine
[    2.554307] keystone-netcp 2090000.netcp: initialized cpsw ale revision 1.3
[    2.557389] pps pps0: new PPS source ptp0
[    2.557412] cpts rftclk rate(583680000 HZ),mult(1839607018),shift(30)
[    2.597538] keystone-netcp 2090000.netcp: Using Packet Accelerator Firmware ver
sion 0x01030008
[    2.606188] keystone-netcp 2090000.netcp: pa_clk_rate(163840000 HZ),mult(25000)
,shift(12)
[    2.606609] usb 2-1: Parent hub missing LPM exit latency info.  Power managemen
t will be impacted.
[    2.606962] usb 2-1: New USB device found, idVendor=05dc, idProduct=a203
[    2.606966] usb 2-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[    2.606970] usb 2-1: Product: JumpDrive
[    2.606973] usb 2-1: Manufacturer: Lexar
[    2.606977] usb 2-1: SerialNumber: 09020000003802162764
[    2.636458] scsi0&#160;: usb-storage 2-1:1.0
[    2.658553] keystone-netcp 2090000.netcp: netcp device eth0 opened
[    2.667093] 8021q: adding VLAN 0 to HW filter on device eth0
[    2.672772] keystone-netcp 2090000.netcp: adding rx vlan id: 0
[    2.679143] keystone-netcp 2090000.netcp: initializing cpsw version 1.3 (1) SGM
II identification value 0x4ed1
[    2.695045] keystone-netcp 2090000.netcp: netcp device eth1 opened
[    2.701867] IPv6: ADDRCONF(NETDEV_UP): eth1: link is not ready
[    2.707719] 8021q: adding VLAN 0 to HW filter on device eth1
[    2.713399] keystone-netcp 2090000.netcp: adding rx vlan id: 0
[    2.736385] Sending DHCP requests ., OK
[    2.786410] IPv6: ADDRCONF(NETDEV_CHANGE): eth1: link becomes ready
[    2.806392] IP-Config: Got DHCP answer from 158.218.104.3, my address is 158.21
8.104.111
[    3.636778] scsi 0:0:0:0: Direct-Access     Lexar    JumpDrive        1.00 PQ:
0 ANSI: 5
[    3.645783] sd 0:0:0:0: [sda] 31293440 512-byte logical blocks: (16.0 GB/14.9 G
iB)
[    3.645884] sd 0:0:0:0: Attached scsi generic sg0 type 0
[    3.658873] sd 0:0:0:0: [sda] Write Protect is off
[    3.663853] sd 0:0:0:0: [sda] Write cache: disabled, read cache: disabled, does
n't support DPO or FUA
[    3.674832]  sda: sda1 sda2
[    3.678982] sd 0:0:0:0: [sda] Attached SCSI removable disk
[    4.256594] keystone-netcp 2090000.netcp: removing rx vlan id: 0
[    4.263472] IP-Config: Complete:
[    4.266713]      device=eth0, hwaddr=00:17:ea:f4:46:0b, ipaddr=158.218.104.111,
mask=255.255.255.0, gw=158.218.104.1
[    4.277271]      host=158.218.104.111, domain=am.dhcp.ti.com, nis-domain=(none)
[    4.284603]      bootserver=0.0.0.0, rootserver=0.0.0.0, rootpath=
[    4.290629]      nameserver0=158.218.108.21, nameserver1=157.170.32.67
[    4.305325] EXT4-fs (sda2): mounted filesystem with ordered data mode. Opts: (n
ull)
[    4.313039] VFS: Mounted root (ext4 filesystem) on device 8:2.
[    4.319097] Freeing init memory: 252K
INIT: version 2.88 booting
Starting udev
e or directory
Starting Bootlog daemon: bootlogd.
[    5.869741] EXT4-fs (sda2): re-mounted. Opts: data=ordered
Configuring network interfaces... udhcpc (v1.20.2) started
Sending discover...
Sending select for 158.218.104.111...
Lease of 158.218.104.111 obtained, lease time 3600
/etc/udhcpc.d/50default: Adding DNS 158.218.108.21
/etc/udhcpc.d/50default: Adding DNS 157.170.32.67
done.
Wed May 15 06:38:00 UTC 2013
Starting telnet daemon.
Starting syslogd/klogd: done
Starting thttpd.
Stopping Bootlog daemon: bootlogd.
</pre>
<pre>_____                    _____           _         _
|  _  |___ ___ ___ ___   |  _  |___ ___  |_|___ ___| |_
|     |  _| .'| . | . |  |   __|  _| . | | | -_|  _|  _|
|__|__|_| |__,|_  |___|  |__|  |_| |___|_| |___|___|_|
              |___|                    |___|
</pre>
<pre>Arago Project <a rel="nofollow" class="external free" href="http://arago-project.org/">http://arago-project.org</a> keystone-evm ttyS0
</pre>
<pre>Arago 2013.04 keystone-evm ttyS0
</pre>
<pre>keystone-evm login: root
</pre>
<p><br />
</p>
<h2><span id="Why_can't_I_connect_to_DSP_cores_from_CCS_in_latest_u-boot?"></span><span class="mw-headline" id="Why_can.27t_I_connect_to_DSP_cores_from_CCS_in_latest_u-boot.3F">Why can't I connect to DSP cores from CCS in latest u-boot?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=256" title="Edit section: Why can&#039;t I connect to DSP cores from CCS in latest u-boot?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>In the latest u-boot, we have DSP cores powered OFF by default. Need to set debug_options=1 U-Boot env variable and reset the board to get this working
</p>
<pre>&gt;setenv debug_options 1
&gt;saveenv
&gt;reset
</pre>
<h2><span id="How_to_turn_OFF_ARM_core_0?"></span><span class="mw-headline" id="How_to_turn_OFF_ARM_core_0.3F">How to turn OFF ARM core 0?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=257" title="Edit section: How to turn OFF ARM core 0?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>U-Boot support turning OFF core 0. By default Core 1-3 are OFF. The following command can be used to turn OFF core 0
</p>
<pre>&gt;setenv boot net
&gt;run get_mon_net
&gt;run run_mon
&gt;killme
</pre>
<h2><span id="How_to_debug_kernel_through_CCS?"></span><span class="mw-headline" id="How_to_debug_kernel_through_CCS.3F">How to debug kernel through CCS?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=258" title="Edit section: How to debug kernel through CCS?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Boot up EVM to u-boot. Startup CCS and Launch Target configuration. connect to ARM core using "connect to target from right click menu" or cntrl-alt-c. To do source level debugging, first enable source look up (right click on *.ccxml on the CCS window and choose "Edit source lookup" option. In the window, Right click on ARM core and choose "add" option. Choose "Path Mapping" in the next window. Assuming w:/linux-keystone on the windows machine is mapped to linux /home/&lt;user-id&gt;/linux-keystone, following entries are
required
</p><p><br />
</p>
<pre>Compilation path \home\&lt;user-id&gt;\linux-keystone
Local file system path w:\linux-keystone
</pre>
<p>Click ok and complete the source lookup settings.
</p><p>Boot to Linux. As soon as the Linux start booting, click suspend button on CCS window.
</p><p>Now Load the symbol file, vmlinux that is available in the root directory of the kernel tree where the kernel build is done.
Choose "Run" from the top level menu and then "load" -&gt; "Load Symbol" and choose vmlinux.
</p><p>Once loading completes, the source code will be shown with the PC pointing to current location of code execution. May put break point to stop kernel at specific point in Linux kernel boot up sequence.
</p>
<h2><span id="How_to_workaround_the_UBI_boot_&quot;bad_image_sequence_number&quot;_problem_?"></span><span class="mw-headline" id="How_to_workaround_the_UBI_boot_.22bad_image_sequence_number.22_problem_.3F">How to workaround the UBI boot "bad image sequence number" problem&#160;?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=259" title="Edit section: How to workaround the UBI boot &quot;bad image sequence number&quot; problem?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Sometimes the UBI image is not properly rebooted, the last PEB may get corrupted and cause the "bad image sequence number" error. This mostly happen when users logically configure a ubifs partition with the size smaller than the available NAND space size. E.g. the actual NAND size is 2GB on K2L EVM, but users only use 512MB for bootloader/env params/ubifs partitions.
</p><p>When the problem happens, there is a workaround to scrub the entire NAND device by using the following U-boot command:
</p>
<pre>nand scrub.chip
</pre>
<h2><span id="How_to_boot_a_custom_images_on_Keystone2_devices?"></span><span class="mw-headline" id="How_to_boot_a_custom_images_on_Keystone2_devices.3F">How to boot a custom images on Keystone2 devices?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=260" title="Edit section: How to boot a custom images on Keystone2 devices?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Examples for creation and flashing custom boot images on devices in Keystone2 family are described in the wiki article <a rel="nofollow" class="external text" href="KeystoneII_Boot_Examples.html">KeystoneII_Boot_Examples</a>
</p><p>The article provides single stage and multi-stage boot examples from different boot modes. It also demonstrates formating uboot images for different boot media using the boot utilities provided in the software package.
</p><p><br />
</p>
<h1><span class="mw-headline" id="Trouble_shooting_and_FAQ">Trouble shooting and FAQ</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=261" title="Edit section: Trouble shooting and FAQ">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span id="For_K2e_EVM,_not_able_to_do_&quot;&gt;mon_install_0x0c5f0000&quot;_and_stuck_there_?"></span><span class="mw-headline" id="For_K2e_EVM.2C_not_able_to_do_.22.3Emon_install_0x0c5f0000.22_and_stuck_there_.3F">For K2e EVM, not able to do "&gt;mon_install 0x0c5f0000" and stuck there&#160;?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=262" title="Edit section: For K2e EVM, not able to do &quot;&gt;mon install 0x0c5f0000&quot; and stuck there?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Probably, the MSMC RAM address might be not right.
The MSMC RAM address for loading the *.dtb, uImage, skern is given below. 
</p><p>Please do "&gt; print " to display the image loadable addresses and all the values of the env variables before loading the images to the EVM.
</p><p>For K2E:-
</p><p>&gt;tftpboot 0x87000000 k2e-evm.dtb
</p><p>&gt;tftpboot 0x88000000 uImage-keystone-evm.bin
</p><p>&gt;tftpboot 0x0c140000 skern-k2e.bin
</p><p>&gt;mon_install 0x0c140000
</p><p>&gt;bootm 0x88000000 - 0x87000000
</p><p>For K2H:-
</p><p>&gt;tftpboot 0x87000000 uImage-k2hk-evm.dtb
</p><p>&gt;tftpboot 0x88000000 uImage-keystone-evm.bin
</p><p>&gt;tftpboot 0x0c5f0000 skern-k2hk.bin
</p><p>&gt;mon_install 0x0c5f0000
</p><p>&gt;bootm 0x88000000 - 0x87000000
</p><p><br />
</p>
<h2><span id="In_CCS_version:_5.5.0.00077,_how_to_do_target_configuration_in_*.ccxml_file_as_I_do_not_see_K2E_option_under_&quot;Board_or_device&quot;_column?"></span><span class="mw-headline" id="In_CCS_version:_5.5.0.00077.2C_how_to_do_target_configuration_in_.2A.ccxml_file_as_I_do_not_see_K2E_option_under_.22Board_or_device.22_column.3F">In CCS version: 5.5.0.00077, how to do target configuration in *.ccxml file as I do not see K2E option under "Board or device" column?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=263" title="Edit section: In CCS version: 5.5.0.00077, how to do target configuration in *.ccxml file as I do not see K2E option under &quot;Board or device&quot; column?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>User has to install the emulation packages,
"ti_emupack_keystone2_setup_1.1.0.0.bin" for linux or
"ti_emupack_keystone2_setup_1.1.0.0.exe" for Windows; 
After which it will list the "66AK2E05" in Board or device column.
</p><p><br />
you can download those packages from this link:<a rel="nofollow" class="external free" href="http://software-dl.ti.com/sdoemb/sdoemb_public_sw/mcsdk/latest/index_FDS.html">http://software-dl.ti.com/sdoemb/sdoemb_public_sw/mcsdk/latest/index_FDS.html</a>
</p>
<h2><span id="After_loading_the_loadlin-evm-uboot.js_file,_not_able_to_connect_to_target."></span><span class="mw-headline" id="After_loading_the_loadlin-evm-uboot.js_file.2C_not_able_to_connect_to_target.">After loading the loadlin-evm-uboot.js file, not able to connect to target.</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=264" title="Edit section: After loading the loadlin-evm-uboot.js file, not able to connect to target.">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>In loadlin-evm-uboot.js file, please check that the session name matches correctly.If not edit it.
</p><p><br />
For example, change like below:
</p><p><br />
//var sessionName     = "Texas Instruments XDS2xx USB Emulator_0/CortexA15_1";
</p><p><br />
var sessionName       = "Texas Instruments XDS2xx USB Emulator_0/arm_A15_0";
</p>
<h2><span class="mw-headline" id="MCSDK_3.01.04.07_YOCTO_EDMA3LLD_build_error">MCSDK 3.01.04.07 YOCTO EDMA3LLD build error</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit&amp;section=265" title="Edit section: MCSDK 3.01.04.07 YOCTO EDMA3LLD build error">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Error Log:
</p><p>| chmod a+x maketemp_configuro_cmd_c6xdsp.bat
| ./maketemp_configuro_cmd_c6xdsp.bat
| ./maketemp_configuro_cmd_c6xdsp.bat: 1: ./maketemp_configuro_cmd_c6xdsp.bat: -e: not found
| make[2]: *** [xdc_configuro] Error 127
</p><p>Fix:
</p><p>Use the following command to fix the problem.
</p><p>host$ echo "no" | sudo dpkg-reconfigure -f teletype dash
</p>
<!-- 
NewPP limit report
Cached time: 20201130071952
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.644 seconds
Real time usage: 0.658 seconds
Preprocessor visited node count: 1351/1000000
Preprocessor generated node count: 1797/1000000
Postexpand include size: 1393/2097152 bytes
Template argument size: 490/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip postexpand size: 7223/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   11.380      1 -total
 17.28%    1.966     14 Template:Note
 13.31%    1.515      1 Template:UsefulTip
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:19650-0!canonical and timestamp 20201130071951 and revision id 224110
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>MCSDK UG Chapter Exploring</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>MCSDK UG Chapter Exploring</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>MCSDK UG Chapter Exploring</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>MCSDK UG Chapter Exploring</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>MCSDK UG Chapter Exploring</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>MCSDK UG Chapter Exploring</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>MCSDK UG Chapter Exploring</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>MCSDK UG Chapter Exploring</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>MCSDK UG Chapter Exploring</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;oldid=224110">https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;oldid=224110</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category_Linux.html" title="Category:Linux">Linux</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=MCSDK+UG+Chapter+Exploring" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="MCSDK_UG_Chapter_Exploring.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk"><span><a href="Talk_MCSDK_UG_Chapter_Exploring.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="MCSDK_UG_Chapter_Exploring.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/MCSDK_UG_Chapter_Exploring.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/MCSDK_UG_Chapter_Exploring.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;oldid=224110" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=MCSDK_UG_Chapter_Exploring&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 6 January 2017, at 11:24.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.644","walltime":"0.658","ppvisitednodes":{"value":1351,"limit":1000000},"ppgeneratednodes":{"value":1797,"limit":1000000},"postexpandincludesize":{"value":1393,"limit":2097152},"templateargumentsize":{"value":490,"limit":2097152},"expansiondepth":{"value":3,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":7223,"limit":5000000},"timingprofile":["100.00%   11.380      1 -total"," 17.28%    1.966     14 Template:Note"," 13.31%    1.515      1 Template:UsefulTip"]},"cachereport":{"timestamp":"20201130071952","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":263});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/MCSDK_UG_Chapter_Exploring by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 09:48:09 GMT -->
</html>
