<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/PTM_cc2640 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 03:10:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>PTM cc2640 - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"PTM_cc2640","wgTitle":"PTM cc2640","wgCurRevisionId":230183,"wgRevisionId":230183,"wgArticleId":37794,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["CC2640"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"PTM_cc2640","wgRelevantArticleId":37794,"wgRequestId":"50dabfabe8b5410bf0b47779","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PTM_cc2640 rootpage-PTM_cc2640 skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">PTM cc2640</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><a rel="nofollow" class="external text" href="Category_BluetoothLE.html">Bluetooth Low Energy Main Page</a>
</p>
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Direct_Test_Mode_.28DTM.29"><span class="tocnumber">1.1</span> <span class="toctext">Direct Test Mode (DTM)</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Production_Test_Mode_.28PTM.29"><span class="tocnumber">1.2</span> <span class="toctext">Production Test Mode (PTM)</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#PTM_vs._DTM"><span class="tocnumber">1.3</span> <span class="toctext">PTM vs. DTM</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Mass_Production_Testing"><span class="tocnumber">1.4</span> <span class="toctext">Mass Production Testing</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#How_to_add_Production_Test_Mode_to_a_CC2640R2F_Application"><span class="tocnumber">2</span> <span class="toctext">How to add Production Test Mode to a CC2640R2F Application</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Errata"><span class="tocnumber">2.1</span> <span class="toctext">Errata</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#How_to_add_Production_Test_Mode_to_a_CC2640_Application"><span class="tocnumber">3</span> <span class="toctext">How to add Production Test Mode to a CC2640 Application</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#The_following_application_project_modifications_are_necessary:"><span class="tocnumber">3.1</span> <span class="toctext">The following application project modifications are necessary:</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#The_following_stack_project_modifications_are_necessary."><span class="tocnumber">3.2</span> <span class="toctext">The following stack project modifications are necessary.</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Using_PTM"><span class="tocnumber">4</span> <span class="toctext">Using PTM</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Usage_Example_with_HCI_Tester"><span class="tocnumber">4.1</span> <span class="toctext">Usage Example with HCI Tester</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Test_Commands"><span class="tocnumber">4.2</span> <span class="toctext">Test Commands</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Introduction">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=1" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This page will describe Production Test Mode (PTM) which allows a CC2640/CC2640R2F BLE application in a "single-chip" configuration to temporarily expose the host control interface (HCI) test commands over the serial interface when triggered externally to do so (e.g. holding a GPIO pin low during power up). This test mode allows the device to be connected to a Bluetooth RF Tester in order to run Direct Test Mode (DTM) commands on a production line using the final release firmware, while leaving the UART GPIO pins available for the application to use at all other times.  Note that this page only considers UART, and not SPI, as the transport protocol since it uses the least amount of GPIO's and throughput is not a factor for DTM.
</p>
<ul><li>Note: DTM defines two interface methods for controlling the LE PHY: HCI and 2-wire UART. The TI Bluetooth low energy protocol stack only supports the HCI method for DTM and PTM.</li></ul>
<h3><span id="Direct_Test_Mode_(DTM)"></span><span class="mw-headline" id="Direct_Test_Mode_.28DTM.29">Direct Test Mode (DTM)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=2" title="Edit section: Direct Test Mode (DTM)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>DTM is a standard method for testing BLE devices using the DTM HCI commands. A number of wireless test equipment manufactures, including Anritsu (MT8852B), Keysight and Rhode and Schwarz, make BLE Testers that use this mode. It is very useful to use these testers during development or on the production line in order to verify the RF performance of a BLE system. Complementary to these testers, it is also possible to create your own PC application that sends these DTM commands over the serial link. DTM is very well described in the Bluetooth Core Specification Volume 6 Part F. All DTM commands as well as TI Vendor Specific modem test commands are accessible in embedded (single-device) application via API calls as well as over HCI in the Host_Test sample application. Refer to the TI Vendor Specific HCI guide in the documents folder of your BLE-Stack SDK. Application Note <a rel="nofollow" class="external text" href="http://www.ti.com/lit/pdf/swra530">Configuring the CC2640 for Bluetooth Direct Test Mode (SWRA530)</a> describes the hardware and software configuration for running DTM on the CC2640 / CC2640R2F with standard Bluetooth test equipment.
</p>
<h3><span id="Production_Test_Mode_(PTM)"></span><span class="mw-headline" id="Production_Test_Mode_.28PTM.29">Production Test Mode (PTM)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=3" title="Edit section: Production Test Mode (PTM)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>One problem with DTM is that it relies on a certain stack configuration (network processor with HCI exposed over UART) in order to work with the testers, though many end-applications don’t use this configuration. This would require the customer, during production, to flash the wireless MCU with a network processor image (e.g., host_test) before testing, and then re-flash with the final product image. To circumvent this, the TI BLE-Stack has implemented a feature called Production Test Mode (PTM), which allows for an embedded software application to support direct test mode without exposing the HCI to the UART pins under normal operation.
<br />
Note that the pins used for PTM can also be used for an application UART interface. In this case, it is necessary to ensure that the other device that is connected to the UART interface does not run at the same time that DTM is being exercised. If the device powers up and goes into PTM mode (by a GPIO being held high or low or some other stimulus), the UART will then be used for DTM commands. If the device powers up normally and does not go into PTM mode, then the UART can be initialized by the application and used to communicate with the other device.
<br />
DTM commands can also be called by the embedded BLE application.
</p><p><br />
</p>
<h3><span class="mw-headline" id="PTM_vs._DTM">PTM vs. DTM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=4" title="Edit section: PTM vs. DTM">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Sometimes the question is asked, "What is the difference between PTM and DTM?". As described above, the test commands themselves are defined as DTM and accessed via HCI network processor (e.g., Host_Test). PTM is simply a means to access DTM commands in non-network processor configuration. Entering PTM (e.g., via a pogo pin driving a GPIO) exposes these same DTM commands over a UART interface to a single-device (non-network processor) firmware configuration.
</p>
<h3><span class="mw-headline" id="Mass_Production_Testing">Mass Production Testing</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=5" title="Edit section: Mass Production Testing">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>TI tests each wireless MCU to ensure it meets the data sheet specifications. However, your manufacturing tests are to ensure that your device is assembled correctly. How would you detect if your manufacturer placed a passive component in the antenna incorrectly or not at all? What if there is too much solder on the antenna pins such that they short? The solution can be to use PTM to "spot check" your device on the production line to build confidence that it was assembled correctly. It is assumed that you have completed design validation and the necessary regulatory and BT SIG testing (RF-PHY). Application note <a rel="nofollow" class="external text" href="http://www.ti.com/lit/pdf/SWRA468">"Final Test Considerations for Wireless Technology Products" SWRA468</a> can be a guide to help you determine what test coverage is best for your product during mass production. Ultimately, you will need to collaborate with your manufacturer to determine the final test coverage needs for your product.
</p><p><br />
</p>
<h2><span class="mw-headline" id="How_to_add_Production_Test_Mode_to_a_CC2640R2F_Application">How to add Production Test Mode to a CC2640R2F Application</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=6" title="Edit section: How to add Production Test Mode to a CC2640R2F Application">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The procedure for adding PTM to a CC2640R2F application is in the online <a rel="nofollow" class="external text" href="http://software-dl.ti.com/lprf/sdg-latest/html/ble-stack/index.html?highlight=ptm#sec-using-production-test-mode">SW Developer's Guide</a>.
</p><p><b>Note:</b> ONLY <big>FlashROM_StackLibrary</big> and <big>FlashROM_Library</big> builds are supported at the moment. 
</p><p>The required changes to apply PTM mode to simple_peripheral is available as a patch to the simplelink_cc2640r2_sdk_1_30_00_25 on this thread: 
</p><p><a rel="nofollow" class="external free" href="http://e2e.ti.com/support/wireless_connectivity/bluetooth_low_energy/f/538/p/583721/2149623#2149623">http://e2e.ti.com/support/wireless_connectivity/bluetooth_low_energy/f/538/p/583721/2149623#2149623</a>
</p>
<h3><span class="mw-headline" id="Errata">Errata</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=7" title="Edit section: Errata">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Step 1</b>: Add NPI to Application Project
</p><p>In addition to adding &lt;SDK&gt;\source\ti\blestack\npi\src , add &lt;SDK&gt;\source\ti\blestack\npi\src\inc to include search path as well.
</p><p><br />
</p>
<h2><span class="mw-headline" id="How_to_add_Production_Test_Mode_to_a_CC2640_Application">How to add Production Test Mode to a CC2640 Application</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=8" title="Edit section: How to add Production Test Mode to a CC2640 Application">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section will describe the steps to add PTM to the simpleBLEPeripheral application on the SmartRF06 board.  The UART interface will be over the RS-232 of the mini-USB cable attached to the SmartRF06.  A PC terminal application will be used to send DTM commands and communicate with the SmartRF06.  Note that the network processor interface (NPI) that is used in the network processor project (HostTestApp) will be used to expose the HCI interface via UART for PTM.  This requires adding an additional task to the project which in turn will require modifications of both the application and stack project.
<br />
</p>
<h3><span class="mw-headline" id="The_following_application_project_modifications_are_necessary:">The following application project modifications are necessary:</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=9" title="Edit section: The following application project modifications are necessary:">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>1. Add the following NPI files from $INSTALL$/src/components/npi/src/inc, $INSTALL$/src/components/npi/src/
</p>
<ul><li>npi_tl_uart.c <br /></li>
<li>npi_tl_uart.h <br /></li>
<li>npi_config.h <br /></li>
<li>npi_tl.c <br /></li>
<li>npi_tl.h <br /></li>
<li>npi_frame.h <br /></li>
<li>npi_frame_hci.c <br /></li>
<li>npi_rxbuf.c <br /></li>
<li>npi_rxbuf.h <br /></li>
<li>npi_task.c <br /></li>
<li>npi_task.h <br /></li></ul>
<p>2. If it is desired to only use a 2-wire UART (that is, to not use the CTS and RTS handshaking), undefine the POWER_SAVINGS preprocessor define
<br />Note: This procedure is required if using the UART back-channel on the TI development kits (SmartRF06 / CC2650 LaunchPad).<br />
<br />Note: This procedure is no longer needed for CC2640R2F, newer TI RTOS drivers will wake device.<br />
3. Add the search path to the NPI files to the "Additional include directories" in the Preprocessor Options:
</p>
<ul><li>$SRC_BLE_CORE$/components/npi/src</li>
<li>$SRC_BLE_CORE$/components/npi/src/inc</li></ul>
<p>4. Add the following define to the application project's preprocessor defined symbols:
</p>
<ul><li>NPI_USE_UART</li></ul>
<p>5. In order to account for the additional NPI task, increment the following preprocessor defines as shown:
</p>
<ul><li>ICALL_MAX_NUM_TASKS=4</li>
<li>ICALL_MAX_NUM_ENTITIES=7</li></ul>
<p>6. In main.c, construct the NPI task:
</p>
<pre>#include "inc/npi_task.h" 
main() 
{
...
   NPITask_createTask(ICALL_SERVICE_CLASS_BLE); 
...</pre>
<p>7. Set the task priorities so that NPI has higher priority than the GAPRole and application task.
</p>
<ul><li>in npi_task.c, set NPITASK_PRIORITY to 3</li>
<li>in the GAPRole (i.e.peripheral.c), set GAPROLE_TASK_PRIORITY to 2</li>
<li>in simpleBLEPeripheral.c, set SBP_TASK_PRIORITY to 1</li></ul>
<p>8. Select the pins to be used for TX and RX. These are set by default in Board.h as:
</p>
<pre>#define Board_UART_RX        IOID_2 
#define Board_UART_TX        IOID_3 
</pre>
<p>These pins are correct for using the RS-232 cable in this demo.
<br />
9. Add PTM enable code to the application initialization function.  In this example, the SmartRF06's right button is used to decide whether or not to enter PTM. That is, PTM is entered only if the button is pressed upon reset. This is implemented in SimpleBLEPeripheral_init() as&#160;:
</p>
<pre>#include &lt;ti/drivers/pin/PINCC26XX.h&gt;
#include &lt;ti/drivers/Power.h&gt;
#include &lt;ti/drivers/power/PowerCC26XX.h&gt;
</pre>
<pre>static void SimpleBLEPeripheral_init(void)
{
  ICall_registerApp(&amp;selfEntity, &amp;sem);

  if (!(PIN_getInputValue(Board_BUTTON0))) //enter PTM
  {
    //prevent PM
    Power_setConstraint(PowerCC26XX_SB_DISALLOW);
    Power_setConstraint(PowerCC26XX_IDLE_PD_DISALLOW);
    
    //enable PTM
    HCI_EXT_EnablePTMCmd();
  }
  
  else  //proceed as normal
  {
...</pre>
<p>Note that all of the original SimpleBLEPeripheral_init() functionality besides the ICall registration now resides in the else() statement when PTM is not entered. That is, if PTM is not to be entered, the application should proceed as normal.
</p><p><br />
</p>
<h3><span class="mw-headline" id="The_following_stack_project_modifications_are_necessary.">The following stack project modifications are necessary.</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=10" title="Edit section: The following stack project modifications are necessary.">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>1. Because we added another task (NPI) which needs to communicate with the stack, the default OSAL_MAX_NUM_PROXY_TASKS value needs to be increased. Add the following preprocessor defined symbol:
</p>
<ul><li>OSAL_MAX_NUM_PROXY_TASKS=3</li></ul>
<p>2. Set the compiler option to include PTM library functions in buildConfig.opt:
</p>
<pre>/* Include Transport Layer (Full or PTM) */
/* -DHCI_TL_NONE */
-DHCI_TL_PTM
/* -DHCI_TL_FULL * </pre>
<p>3. If they are not already part of the stack project, add the following files which can be found at $INSTALL$\Projects\ble\common\npi\npi_np\CC26xx\Stack:
</p>
<ul><li>npi.c</li>
<li>npi.h</li></ul>
<p>4. If step 3 was necessary, then also add the search path to find these files in the "Additional Include Directories" in the C/C++ Compiler Tab of the Project Options:
</p>
<ul><li>$PROJ_DIR$/../../../../../../../Components/npi</li></ul>
<p>Note! If a linking error occurs, it is likely due to the Flash Boundary tool and a recompilation should fix it. See the Software Developer's Guide included with the installer for more information.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Using_PTM">Using PTM</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=11" title="Edit section: Using PTM">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>With this code added to the project and he SmartRF06's right button held down during reset, the device will enter PTM upon reset.
A terminal application, such as <a href="LPRF_BLE_HCITester.html" title="LPRF BLE HCITester">HCITester</a>, can then communicate with the device under test (DUT) via UART through a Windows COM port using the following settings:
</p>
<ul><li>Baud Rate 	= 	115200</li>
<li>Flow Control	= 	None</li>
<li>Parity         = 	None</li>
<li>Stop Bits 	= 	1</li>
<li>Data Bits 	= 	8</li></ul>
<p><br />Note: Make sure the terminal application is configured to send raw binary without any additional control characters (e.g., CR/LF).
</p>
<h3><span class="mw-headline" id="Usage_Example_with_HCI_Tester">Usage Example with <a rel="nofollow" class="external text" href="LPRF_BLE_HCITester.html">HCI Tester</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=12" title="Edit section: Usage Example with HCI Tester">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This section will give an example on how to use a PTM enabled DUT to do receive testing.
The set up requires an additional Device running ble5_host_test from SDK v1.40+ as well as a computer with UART Serial connections to both the PTM DUT and ble5_host_test. 
The test itself will be the ble5_host_test device sending exactly 100 packets, using the Vendor Specific Command 'HCI_EXT_SetDtmTxPktCntCmd' and 'HCI_LE_Transmitter_Test' HCI command, while the DUT is in Receive mode via the 'HCI_LE_Receiver_Test' command. The idea here is to be able to get a rough idea of packet loss. This is similar to the 'LE_RECEIVER_TEST' Scenario described in the Core Specification [Vol 6; Part F; 2.2; Figure 2.2].
</p><p>Connect to both devices via UART Serial connections. Two different HCI Tester instances will need to be opened. HCI Tester can utilize UART ports for transmission of commands. (Options -&gt; Port Connection).
Enable Network Control; this feature allows scripts to wait until other scripts have reached a sync point. (Options -&gt; Network).
Download the following example scripts, and connect to the appropriate device. PTM DUT for the receiver, ble5_host_test for the transmitter.
</p><p><a href="File_Hci_tester_example_scripts.html" title="File:Hci tester example scripts.zip">File:Hci tester example scripts.zip</a>
</p><p>Use the updated <a rel="nofollow" class="external text" href="File_HCITesterXML.html">Command library</a> to utilize HCI_EXT_SetDtmTxPktCntCmd from the ble5_host_test HCI command list.
</p><p>Then with one of the HCI Tester instances, press 'Execute Script' to automatically launch both scripts.
</p><p>The trace log on the HCI Tester window will reveal how many packets were recieved by the DUT.
</p><p>Note: HCI Tester can be replaced with any UART Terminal for automatiation purposes. See below for example payloads cooresponding to various HCI Commands.
</p>
<h3><span class="mw-headline" id="Test_Commands">Test Commands</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit&amp;section=13" title="Edit section: Test Commands">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This section will list the DTM commands and corresponding events that can be used for testing.
<br />
<b>HCI_LE_Transmitter_Test</b><br />
Send this hex command to start Tx test: <br />
</p>
<pre>01 1E 20 03 xx yy zz </pre>
<p>xx = the channel you want to transmit on, any value from 0x00 to 0x27 (BLE channels go from 0 to 39)<br />
yy = length of payload bytes in each test packet, which can be any value from 0x00 to 0x25<br />
zz = code for the type of data in the packet payload. The following values can be used<br />
</p>
<ul><li>0x00 Pseudo-Random bit sequence 9</li>
<li>0x01 Pattern of alternating bits ‘11110000’</li>
<li>0x02 Pattern of alternating bits ‘10101010’</li>
<li>0x03 Pseudo-Random bit sequence 15</li>
<li>0x04 Pattern of All ‘1’ bits</li>
<li>0x05 Pattern of All ‘0’ bits</li>
<li>0x06 Pattern of alternating bits ‘00001111’</li>
<li>0x07 Pattern of alternating bits ‘0101’</li></ul>
<p>After sending the HCI_LE_Transmitter_Test command to the DUT, the following response will be returned, indicating that the command was received and the Tx test has begun:<br />
</p>
<pre>04 0E 04 01 1E 20 00 </pre>
<p><b>HCI_LE_Receiver_Test</b><br />
Send this hex command to start Rx test: <br />
</p>
<pre>01 1D 20 01 xx</pre>
<p>xx = the channel you want to receive on, which can be any value from 0x00 to 0x27 (BLE channels go from 0 to 39)<br />
After sending the HCI_LE_Receiver_Test command to the device, the following response will be returned, indicating that the command was received and the Rx test has begun:<br />
</p>
<pre> 04 0E 04 01 1D 20 00 </pre>
<p><b>HCI_LE_Test_End</b><br />
Send this hex command to end Rx or Tx test: <br />
</p>
<pre>01 1f 20 00</pre>
<p>After sending the HCI_LE_Test_End command to the device, the following response will be returned, indicating that the command was received and the test has ended:<br />
</p>
<pre>04 0e 06 01 1f 20 00 xx xx</pre>
<p>xx xx = 00 00 if Tx test was performed<br />
xx xx = Total number of received packets if Rx test was performed.<br />
<b>Other Commands</b><br />
The following HCI Extension commands can also be used for DTM to facilitate regulatory testing (e.g., ETSI, FCC, etc.). These are described in the HCI Vendor Specific API Guide included with the BLE-Stack installer (documents folder):
</p>
<ul><li>HCI Extension Modem Test Transmit</li>
<li>HCI Extension Modem Hop Test Transmit</li>
<li>HCI Extension Modem Test Receive</li>
<li>HCI Extension End Modem Test</li>
<li>HCI Extension Set BDADDR</li>
<li>HCI Extension Set Tx Power</li>
<li>HCI Extension Set Max DTM Tx Power</li>
<li>HCI Extension Build Revision</li>
<li>HCI Extension Reset System</li></ul>

<!-- 
NewPP limit report
Cached time: 20201130061038
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.050 seconds
Real time usage: 0.053 seconds
Preprocessor visited node count: 105/1000000
Preprocessor generated node count: 256/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 901/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:37794-0!canonical and timestamp 20201130061038 and revision id 230183
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>PTM cc2640</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>PTM cc2640</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>PTM cc2640</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>PTM cc2640</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>PTM cc2640</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>PTM cc2640</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>PTM cc2640</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>PTM cc2640</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>PTM cc2640</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;oldid=230183">https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;oldid=230183</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category_CC2640.html" title="Category:CC2640">CC2640</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=PTM+cc2640" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="PTM_cc2640.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:PTM_cc2640&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="PTM_cc2640.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/PTM_cc2640.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/PTM_cc2640.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;oldid=230183" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=PTM_cc2640&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 11 August 2017, at 10:55.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.050","walltime":"0.053","ppvisitednodes":{"value":105,"limit":1000000},"ppgeneratednodes":{"value":256,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":901,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20201130061038","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":231});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/PTM_cc2640 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 03:10:20 GMT -->
</html>
