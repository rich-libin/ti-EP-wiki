<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/PRU_ICSS_EtherCAT_firmware_API_guide by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 10:30:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>PRU ICSS EtherCAT firmware API guide - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"PRU_ICSS_EtherCAT_firmware_API_guide","wgTitle":"PRU ICSS EtherCAT firmware API guide","wgCurRevisionId":227680,"wgRevisionId":227680,"wgArticleId":30063,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["SDK"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"PRU_ICSS_EtherCAT_firmware_API_guide","wgRelevantArticleId":30063,"wgRequestId":"f123d05f31dc052a50aef806","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PRU_ICSS_EtherCAT_firmware_API_guide rootpage-PRU_ICSS_EtherCAT_firmware_API_guide skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">PRU ICSS EtherCAT firmware API guide</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div style="width:800px; text-align:justify;"> 
<div style="display:block; clear: both; margin: 10px 0px; padding: 0px; background-color: #ee1d23; text-align:right;"><a href="File_TIBanner.html" class="image"><img alt="TIBanner.png" src="https://processors.wiki.ti.com/images/c/cd/TIBanner.png" width="667" height="87" /></a></div>
<div style="display:block; margin: 5px 0px; padding: 2px 5px; font-size:1.5em; font-weight:bold; text-align:left;">PRU-ICSS EtherCAT firmware API Guide</div>
<div style="display:block; margin: 5px 0px; padding: 2px; color: #666666; font-size:1.0em; font-weight:bold; text-align:right;"></div> <br />
<p><br /> <br />
</p><p><b><big><big></big></big></b>
</p><p><a href="https://processors.wiki.ti.com/index.php?title=PRU-ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;redlink=1" class="new" title="PRU-ICSS EtherCAT firmware API guide (page does not exist)">Table of Contents</a>
</p>
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Purpose_and_Scope"><span class="tocnumber">1.1</span> <span class="toctext">Purpose and Scope</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Intended_Audience"><span class="tocnumber">1.2</span> <span class="toctext">Intended Audience</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Terms_and_Abbreviations"><span class="tocnumber">1.3</span> <span class="toctext">Terms and Abbreviations</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#References"><span class="tocnumber">1.4</span> <span class="toctext">References</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#EtherCAT_application_-_Software_Architecture"><span class="tocnumber">2</span> <span class="toctext">EtherCAT application - Software Architecture</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Procedure_to_kickoff_ESC_firmware"><span class="tocnumber">2.1</span> <span class="toctext">Procedure to kickoff ESC firmware</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Firmware_APIs"><span class="tocnumber">3</span> <span class="toctext">Firmware APIs</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#Initialization_of_stack-firmware_interface"><span class="tocnumber">3.1</span> <span class="toctext">Initialization of stack-firmware interface</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#bsp_init"><span class="tocnumber">3.1.1</span> <span class="toctext">bsp_init</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#bsp_esc_reg_perm_init"><span class="tocnumber">3.1.2</span> <span class="toctext">bsp_esc_reg_perm_init</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#bsp_start_esc_isr"><span class="tocnumber">3.1.3</span> <span class="toctext">bsp_start_esc_isr</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#bsp_exit"><span class="tocnumber">3.1.4</span> <span class="toctext">bsp_exit</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#bsp_set_pdi_wd_trigger_mode"><span class="tocnumber">3.1.5</span> <span class="toctext">bsp_set_pdi_wd_trigger_mode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="#ESC_Firmware_Command_API"><span class="tocnumber">3.2</span> <span class="toctext">ESC Firmware Command API</span></a>
<ul>
<li class="toclevel-3 tocsection-16"><a href="#bsp_send_command_to_firmware"><span class="tocnumber">3.2.1</span> <span class="toctext">bsp_send_command_to_firmware</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17"><a href="#ESI_EEPROM_emulation_support"><span class="tocnumber">3.3</span> <span class="toctext">ESI EEPROM emulation support</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#bsp_eeprom_emulation_init"><span class="tocnumber">3.3.1</span> <span class="toctext">bsp_eeprom_emulation_init</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#bsp_eeprom_load_esc_registers"><span class="tocnumber">3.3.2</span> <span class="toctext">bsp_eeprom_load_esc_registers</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#bsp_eeprom_emulation_reload"><span class="tocnumber">3.3.3</span> <span class="toctext">bsp_eeprom_emulation_reload</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#HW_EepromReload"><span class="tocnumber">3.3.4</span> <span class="toctext">HW_EepromReload</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="#bsp_eeprom_emulation_command_ack"><span class="tocnumber">3.3.5</span> <span class="toctext">bsp_eeprom_emulation_command_ack</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#bsp_eeprom_emulation_flush"><span class="tocnumber">3.3.6</span> <span class="toctext">bsp_eeprom_emulation_flush</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#bsp_get_eeprom_cache_base"><span class="tocnumber">3.3.7</span> <span class="toctext">bsp_get_eeprom_cache_base</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#bsp_set_eeprom_update_status"><span class="tocnumber">3.3.8</span> <span class="toctext">bsp_set_eeprom_update_status</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#bsp_get_eeprom_update_status"><span class="tocnumber">3.3.9</span> <span class="toctext">bsp_get_eeprom_update_status</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#bsp_eeprom_emulation_exit"><span class="tocnumber">3.3.10</span> <span class="toctext">bsp_eeprom_emulation_exit</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-28"><a href="#SyncManager_properties_management_for_TI_ESC_HAL"><span class="tocnumber">3.4</span> <span class="toctext">SyncManager properties management for TI ESC HAL</span></a>
<ul>
<li class="toclevel-3 tocsection-29"><a href="#bsp_set_sm_properties"><span class="tocnumber">3.4.1</span> <span class="toctext">bsp_set_sm_properties</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="#bsp_get_sm_properties"><span class="tocnumber">3.4.2</span> <span class="toctext">bsp_get_sm_properties</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-31"><a href="#SyncManager_access_and_control_APIs"><span class="tocnumber">3.5</span> <span class="toctext">SyncManager access and control APIs</span></a>
<ul>
<li class="toclevel-3 tocsection-32"><a href="#HW_EnableSyncManChannel"><span class="tocnumber">3.5.1</span> <span class="toctext">HW_EnableSyncManChannel</span></a></li>
<li class="toclevel-3 tocsection-33"><a href="#HW_DisableSyncManChannel"><span class="tocnumber">3.5.2</span> <span class="toctext">HW_DisableSyncManChannel</span></a></li>
<li class="toclevel-3 tocsection-34"><a href="#HW_GetSyncMan"><span class="tocnumber">3.5.3</span> <span class="toctext">HW_GetSyncMan</span></a></li>
<li class="toclevel-3 tocsection-35"><a href="#bsp_pdi_sm_config_ongoing"><span class="tocnumber">3.5.4</span> <span class="toctext">bsp_pdi_sm_config_ongoing</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-36"><a href="#SyncManager_Mailbox_mode_handling"><span class="tocnumber">3.6</span> <span class="toctext">SyncManager Mailbox mode handling</span></a>
<ul>
<li class="toclevel-3 tocsection-37"><a href="#bsp_pdi_mbx_read_start"><span class="tocnumber">3.6.1</span> <span class="toctext">bsp_pdi_mbx_read_start</span></a></li>
<li class="toclevel-3 tocsection-38"><a href="#bsp_pdi_mbx_read_complete"><span class="tocnumber">3.6.2</span> <span class="toctext">bsp_pdi_mbx_read_complete</span></a></li>
<li class="toclevel-3 tocsection-39"><a href="#bsp_pdi_mbx_write_start"><span class="tocnumber">3.6.3</span> <span class="toctext">bsp_pdi_mbx_write_start</span></a></li>
<li class="toclevel-3 tocsection-40"><a href="#bsp_pdi_mbx_write_complete"><span class="tocnumber">3.6.4</span> <span class="toctext">bsp_pdi_mbx_write_complete</span></a></li>
<li class="toclevel-3 tocsection-41"><a href="#HW_EscReadMbxMem"><span class="tocnumber">3.6.5</span> <span class="toctext">HW_EscReadMbxMem</span></a></li>
<li class="toclevel-3 tocsection-42"><a href="#HW_EscWriteMbxMem"><span class="tocnumber">3.6.6</span> <span class="toctext">HW_EscWriteMbxMem</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-43"><a href="#SyncManager_Buffer_mode_handling"><span class="tocnumber">3.7</span> <span class="toctext">SyncManager Buffer mode handling</span></a>
<ul>
<li class="toclevel-3 tocsection-44"><a href="#bsp_get_process_data_address"><span class="tocnumber">3.7.1</span> <span class="toctext">bsp_get_process_data_address</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="#bsp_process_data_access_complete"><span class="tocnumber">3.7.2</span> <span class="toctext">bsp_process_data_access_complete</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-46"><a href="#ESC_Register.2FMemory_access_-_Special_handling_APIs"><span class="tocnumber">3.8</span> <span class="toctext">ESC Register/Memory access - Special handling APIs</span></a>
<ul>
<li class="toclevel-3 tocsection-47"><a href="#bsp_read_byte"><span class="tocnumber">3.8.1</span> <span class="toctext">bsp_read_byte</span></a></li>
<li class="toclevel-3 tocsection-48"><a href="#bsp_read_word"><span class="tocnumber">3.8.2</span> <span class="toctext">bsp_read_word</span></a></li>
<li class="toclevel-3 tocsection-49"><a href="#bsp_read_dword"><span class="tocnumber">3.8.3</span> <span class="toctext">bsp_read_dword</span></a></li>
<li class="toclevel-3 tocsection-50"><a href="#bsp_read"><span class="tocnumber">3.8.4</span> <span class="toctext">bsp_read</span></a></li>
<li class="toclevel-3 tocsection-51"><a href="#bsp_read_byte_isr"><span class="tocnumber">3.8.5</span> <span class="toctext">bsp_read_byte_isr</span></a></li>
<li class="toclevel-3 tocsection-52"><a href="#bsp_read_word_isr"><span class="tocnumber">3.8.6</span> <span class="toctext">bsp_read_word_isr</span></a></li>
<li class="toclevel-3 tocsection-53"><a href="#bsp_read_dword_isr"><span class="tocnumber">3.8.7</span> <span class="toctext">bsp_read_dword_isr</span></a></li>
<li class="toclevel-3 tocsection-54"><a href="#bsp_pdi_post_read_indication"><span class="tocnumber">3.8.8</span> <span class="toctext">bsp_pdi_post_read_indication</span></a></li>
<li class="toclevel-3 tocsection-55"><a href="#bsp_pdi_write_indication"><span class="tocnumber">3.8.9</span> <span class="toctext">bsp_pdi_write_indication</span></a></li>
<li class="toclevel-3 tocsection-56"><a href="#HW_EscReadByteIsr"><span class="tocnumber">3.8.10</span> <span class="toctext">HW_EscReadByteIsr</span></a></li>
<li class="toclevel-3 tocsection-57"><a href="#HW_EscReadWordIsr"><span class="tocnumber">3.8.11</span> <span class="toctext">HW_EscReadWordIsr</span></a></li>
<li class="toclevel-3 tocsection-58"><a href="#HW_EscReadDWordIsr"><span class="tocnumber">3.8.12</span> <span class="toctext">HW_EscReadDWordIsr</span></a></li>
<li class="toclevel-3 tocsection-59"><a href="#HW_EscReadIsr"><span class="tocnumber">3.8.13</span> <span class="toctext">HW_EscReadIsr</span></a></li>
<li class="toclevel-3 tocsection-60"><a href="#HW_EscWriteByte"><span class="tocnumber">3.8.14</span> <span class="toctext">HW_EscWriteByte</span></a></li>
<li class="toclevel-3 tocsection-61"><a href="#HW_EscWriteByteIsr"><span class="tocnumber">3.8.15</span> <span class="toctext">HW_EscWriteByteIsr</span></a></li>
<li class="toclevel-3 tocsection-62"><a href="#HW_EscWriteWord"><span class="tocnumber">3.8.16</span> <span class="toctext">HW_EscWriteWord</span></a></li>
<li class="toclevel-3 tocsection-63"><a href="#HW_EscWriteWordIsr"><span class="tocnumber">3.8.17</span> <span class="toctext">HW_EscWriteWordIsr</span></a></li>
<li class="toclevel-3 tocsection-64"><a href="#HW_EscWriteDWord"><span class="tocnumber">3.8.18</span> <span class="toctext">HW_EscWriteDWord</span></a></li>
<li class="toclevel-3 tocsection-65"><a href="#HW_EscWriteDWordIsr"><span class="tocnumber">3.8.19</span> <span class="toctext">HW_EscWriteDWordIsr</span></a></li>
<li class="toclevel-3 tocsection-66"><a href="#HW_EscWrite"><span class="tocnumber">3.8.20</span> <span class="toctext">HW_EscWrite</span></a></li>
<li class="toclevel-3 tocsection-67"><a href="#HW_EscWriteIsr"><span class="tocnumber">3.8.21</span> <span class="toctext">HW_EscWriteIsr</span></a></li>
<li class="toclevel-3 tocsection-68"><a href="#bsp_write_byte"><span class="tocnumber">3.8.22</span> <span class="toctext">bsp_write_byte</span></a></li>
<li class="toclevel-3 tocsection-69"><a href="#bsp_write_word"><span class="tocnumber">3.8.23</span> <span class="toctext">bsp_write_word</span></a></li>
<li class="toclevel-3 tocsection-70"><a href="#bsp_write_dword"><span class="tocnumber">3.8.24</span> <span class="toctext">bsp_write_dword</span></a></li>
<li class="toclevel-3 tocsection-71"><a href="#bsp_write"><span class="tocnumber">3.8.25</span> <span class="toctext">bsp_write</span></a></li>
<li class="toclevel-3 tocsection-72"><a href="#bsp_pruss_mdioreg_read"><span class="tocnumber">3.8.26</span> <span class="toctext">bsp_pruss_mdioreg_read</span></a></li>
<li class="toclevel-3 tocsection-73"><a href="#bsp_pruss_mdioreg_write"><span class="tocnumber">3.8.27</span> <span class="toctext">bsp_pruss_mdioreg_write</span></a></li>
<li class="toclevel-3 tocsection-74"><a href="#bsp_pruss_iepreg_read"><span class="tocnumber">3.8.28</span> <span class="toctext">bsp_pruss_iepreg_read</span></a></li>
<li class="toclevel-3 tocsection-75"><a href="#bsp_pruss_iepreg_write"><span class="tocnumber">3.8.29</span> <span class="toctext">bsp_pruss_iepreg_write</span></a></li>
<li class="toclevel-3 tocsection-76"><a href="#bsp_pruss_cmd_intfc_read_word"><span class="tocnumber">3.8.30</span> <span class="toctext">bsp_pruss_cmd_intfc_read_word</span></a></li>
<li class="toclevel-3 tocsection-77"><a href="#bsp_pruss_cmd_intfc_write_word"><span class="tocnumber">3.8.31</span> <span class="toctext">bsp_pruss_cmd_intfc_write_word</span></a></li>
<li class="toclevel-3 tocsection-78"><a href="#bsp_get_pdi_access_perm"><span class="tocnumber">3.8.32</span> <span class="toctext">bsp_get_pdi_access_perm</span></a></li>
<li class="toclevel-3 tocsection-79"><a href="#bsp_pdi_access_perm_word"><span class="tocnumber">3.8.33</span> <span class="toctext">bsp_pdi_access_perm_word</span></a></li>
<li class="toclevel-3 tocsection-80"><a href="#bsp_pdi_access_perm_dword"><span class="tocnumber">3.8.34</span> <span class="toctext">bsp_pdi_access_perm_dword</span></a></li>
<li class="toclevel-3 tocsection-81"><a href="#bsp_pdi_access_perm_array"><span class="tocnumber">3.8.35</span> <span class="toctext">bsp_pdi_access_perm_array</span></a></li>
<li class="toclevel-3 tocsection-82"><a href="#bsp_get_pdi_read_access_fail_cnt"><span class="tocnumber">3.8.36</span> <span class="toctext">bsp_get_pdi_read_access_fail_cnt</span></a></li>
<li class="toclevel-3 tocsection-83"><a href="#bsp_get_pdi_write_access_fail_cnt"><span class="tocnumber">3.8.37</span> <span class="toctext">bsp_get_pdi_write_access_fail_cnt</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-84"><a href="#PRU-ICSS_MDIO_host_side_APIs"><span class="tocnumber">3.9</span> <span class="toctext">PRU-ICSS MDIO host side APIs</span></a>
<ul>
<li class="toclevel-3 tocsection-85"><a href="#bsp_pruss_mdio_init"><span class="tocnumber">3.9.1</span> <span class="toctext">bsp_pruss_mdio_init</span></a></li>
<li class="toclevel-3 tocsection-86"><a href="#bsp_pruss_mdio_phy_read"><span class="tocnumber">3.9.2</span> <span class="toctext">bsp_pruss_mdio_phy_read</span></a></li>
<li class="toclevel-3 tocsection-87"><a href="#bsp_pruss_mdio_phy_write"><span class="tocnumber">3.9.3</span> <span class="toctext">bsp_pruss_mdio_phy_write</span></a></li>
<li class="toclevel-3 tocsection-88"><a href="#bsp_pruss_mdio_phy_link_state"><span class="tocnumber">3.9.4</span> <span class="toctext">bsp_pruss_mdio_phy_link_state</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-89"><a href="#PRU-ICSS_DIGIO_host_side_APIs"><span class="tocnumber">3.10</span> <span class="toctext">PRU-ICSS DIGIO host side APIs</span></a>
<ul>
<li class="toclevel-3 tocsection-90"><a href="#void_bsp_set_digio_sw_dataout_enable_.28void.29"><span class="tocnumber">3.10.1</span> <span class="toctext">void bsp_set_digio_sw_dataout_enable (void)</span></a></li>
<li class="toclevel-3 tocsection-91"><a href="#void_bsp_set_digio_out_.28Uint8_num.29"><span class="tocnumber">3.10.2</span> <span class="toctext">void bsp_set_digio_out (Uint8 num)</span></a></li>
<li class="toclevel-3 tocsection-92"><a href="#void_bsp_clear_digio_out_.28Uint8_num.29"><span class="tocnumber">3.10.3</span> <span class="toctext">void bsp_clear_digio_out (Uint8 num)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-93"><a href="#Spinlock_APIs_for_concurrent_Host.2FFirmware_shared_memory_access"><span class="tocnumber">3.11</span> <span class="toctext">Spinlock APIs for concurrent Host/Firmware shared memory access</span></a>
<ul>
<li class="toclevel-3 tocsection-94"><a href="#bsp_hwspinlock_init"><span class="tocnumber">3.11.1</span> <span class="toctext">bsp_hwspinlock_init</span></a></li>
<li class="toclevel-3 tocsection-95"><a href="#bsp_hwspinlock_lock"><span class="tocnumber">3.11.2</span> <span class="toctext">bsp_hwspinlock_lock</span></a></li>
<li class="toclevel-3 tocsection-96"><a href="#bsp_hwspinlock_unlock"><span class="tocnumber">3.11.3</span> <span class="toctext">bsp_hwspinlock_unlock</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-97"><a href="#System_Time_PDI_controlled_APIs"><span class="tocnumber">3.12</span> <span class="toctext">System Time PDI controlled APIs</span></a>
<ul>
<li class="toclevel-3 tocsection-98"><a href="#bsp_pdi_write_system_time"><span class="tocnumber">3.12.1</span> <span class="toctext">bsp_pdi_write_system_time</span></a></li>
<li class="toclevel-3 tocsection-99"><a href="#bsp_pdi_write_system_timeoffset"><span class="tocnumber">3.12.2</span> <span class="toctext">bsp_pdi_write_system_timeoffset</span></a></li>
<li class="toclevel-3 tocsection-100"><a href="#bsp_pdi_write_systime_delay"><span class="tocnumber">3.12.3</span> <span class="toctext">bsp_pdi_write_systime_delay</span></a></li>
<li class="toclevel-3 tocsection-101"><a href="#bsp_pdi_write_filterconfig"><span class="tocnumber">3.12.4</span> <span class="toctext">bsp_pdi_write_filterconfig</span></a></li>
<li class="toclevel-3 tocsection-102"><a href="#bsp_pdi_latch0_control"><span class="tocnumber">3.12.5</span> <span class="toctext">bsp_pdi_latch0_control</span></a></li>
<li class="toclevel-3 tocsection-103"><a href="#bsp_pdi_latch1_control"><span class="tocnumber">3.12.6</span> <span class="toctext">bsp_pdi_latch1_control</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-104"><a href="#Timer_APIs_for_EtherCAT_stack"><span class="tocnumber">3.13</span> <span class="toctext">Timer APIs for EtherCAT stack</span></a>
<ul>
<li class="toclevel-3 tocsection-105"><a href="#bsp_get_timer_register"><span class="tocnumber">3.13.1</span> <span class="toctext">bsp_get_timer_register</span></a></li>
<li class="toclevel-3 tocsection-106"><a href="#bsp_clear_timer_register"><span class="tocnumber">3.13.2</span> <span class="toctext">bsp_clear_timer_register</span></a></li>
<li class="toclevel-3 tocsection-107"><a href="#HW_GetTimer"><span class="tocnumber">3.13.3</span> <span class="toctext">HW_GetTimer</span></a></li>
<li class="toclevel-3 tocsection-108"><a href="#HW_ClearTimer"><span class="tocnumber">3.13.4</span> <span class="toctext">HW_ClearTimer</span></a></li>
<li class="toclevel-3 tocsection-109"><a href="#bsp_get_local_sys_time"><span class="tocnumber">3.13.5</span> <span class="toctext">bsp_get_local_sys_time</span></a></li>
<li class="toclevel-3 tocsection-110"><a href="#bsp_get_latch0_posedge_time"><span class="tocnumber">3.13.6</span> <span class="toctext">bsp_get_latch0_posedge_time</span></a></li>
<li class="toclevel-3 tocsection-111"><a href="#bsp_get_latch1_posedge_time"><span class="tocnumber">3.13.7</span> <span class="toctext">bsp_get_latch1_posedge_time</span></a></li>
<li class="toclevel-3 tocsection-112"><a href="#bsp_get_latch0_negedge_time"><span class="tocnumber">3.13.8</span> <span class="toctext">bsp_get_latch0_negedge_time</span></a></li>
<li class="toclevel-3 tocsection-113"><a href="#bsp_get_latch1_negedge_time"><span class="tocnumber">3.13.9</span> <span class="toctext">bsp_get_latch1_negedge_time</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-114"><a href="#Mutex_APIs_for_EtherCAT_stack"><span class="tocnumber">3.14</span> <span class="toctext">Mutex APIs for EtherCAT stack</span></a>
<ul>
<li class="toclevel-3 tocsection-115"><a href="#bsp_global_mutex_lock"><span class="tocnumber">3.14.1</span> <span class="toctext">bsp_global_mutex_lock</span></a></li>
<li class="toclevel-3 tocsection-116"><a href="#bsp_global_mutex_unlock"><span class="tocnumber">3.14.2</span> <span class="toctext">bsp_global_mutex_unlock</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-117"><a href="#Interrupt_management_APIs_for_EtherCAT_stack"><span class="tocnumber">3.15</span> <span class="toctext">Interrupt management APIs for EtherCAT stack</span></a>
<ul>
<li class="toclevel-3 tocsection-118"><a href="#HW_ResetALEventMask"><span class="tocnumber">3.15.1</span> <span class="toctext">HW_ResetALEventMask</span></a></li>
<li class="toclevel-3 tocsection-119"><a href="#HW_SetALEventMask"><span class="tocnumber">3.15.2</span> <span class="toctext">HW_SetALEventMask</span></a></li>
<li class="toclevel-3 tocsection-120"><a href="#HW_GetALEventMask"><span class="tocnumber">3.15.3</span> <span class="toctext">HW_GetALEventMask</span></a></li>
<li class="toclevel-3 tocsection-121"><a href="#HW_EcatIsr_or_PDI_Isr"><span class="tocnumber">3.15.4</span> <span class="toctext">HW_EcatIsr or PDI_Isr</span></a></li>
<li class="toclevel-3 tocsection-122"><a href="#Sync0_Isr"><span class="tocnumber">3.15.5</span> <span class="toctext">Sync0_Isr</span></a></li>
<li class="toclevel-3 tocsection-123"><a href="#Sync1_Isr"><span class="tocnumber">3.15.6</span> <span class="toctext">Sync1_Isr</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-124"><a href="#Misc_APIs_for_SSC"><span class="tocnumber">3.16</span> <span class="toctext">Misc APIs for SSC</span></a>
<ul>
<li class="toclevel-3 tocsection-125"><a href="#HW_Init"><span class="tocnumber">3.16.1</span> <span class="toctext">HW_Init</span></a></li>
<li class="toclevel-3 tocsection-126"><a href="#HW_Release"><span class="tocnumber">3.16.2</span> <span class="toctext">HW_Release</span></a></li>
<li class="toclevel-3 tocsection-127"><a href="#HW_RestartTarget"><span class="tocnumber">3.16.3</span> <span class="toctext">HW_RestartTarget</span></a></li>
<li class="toclevel-3 tocsection-128"><a href="#HW_SetLed"><span class="tocnumber">3.16.4</span> <span class="toctext">HW_SetLed</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-129"><a href="#PRU_firmware_header_mapping_API"><span class="tocnumber">3.17</span> <span class="toctext">PRU firmware header mapping API</span></a>
<ul>
<li class="toclevel-3 tocsection-130"><a href="#bsp_set_pru_firmware"><span class="tocnumber">3.17.1</span> <span class="toctext">bsp_set_pru_firmware</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-131"><a href="#Firmware_Upgrade_APIs_for_EtherCAT_stack"><span class="tocnumber">3.18</span> <span class="toctext">Firmware Upgrade APIs for EtherCAT stack</span></a>
<ul>
<li class="toclevel-3 tocsection-132"><a href="#bsp_start_fw_download"><span class="tocnumber">3.18.1</span> <span class="toctext">bsp_start_fw_download</span></a></li>
<li class="toclevel-3 tocsection-133"><a href="#bsp_store_fw_data"><span class="tocnumber">3.18.2</span> <span class="toctext">bsp_store_fw_data</span></a></li>
<li class="toclevel-3 tocsection-134"><a href="#bsp_boot_2_init_handler"><span class="tocnumber">3.18.3</span> <span class="toctext">bsp_boot_2_init_handler</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-135"><a href="#TLK110_PHY_configuration_APIs"><span class="tocnumber">3.19</span> <span class="toctext">TLK110 PHY configuration APIs</span></a>
<ul>
<li class="toclevel-3 tocsection-136"><a href="#bsp_tlk110_init"><span class="tocnumber">3.19.1</span> <span class="toctext">bsp_tlk110_init</span></a></li>
<li class="toclevel-3 tocsection-137"><a href="#bsp_tlk110_configure_automdix"><span class="tocnumber">3.19.2</span> <span class="toctext">bsp_tlk110_configure_automdix</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-138"><a href="#PRU-ICSS_interrupt_controller_setup_for_EtherCAT_firmware"><span class="tocnumber">4</span> <span class="toctext">PRU-ICSS interrupt controller setup for EtherCAT firmware</span></a></li>
<li class="toclevel-1 tocsection-139"><a href="#Firmware_Update"><span class="tocnumber">5</span> <span class="toctext">Firmware Update</span></a></li>
<li class="toclevel-1 tocsection-140"><a href="#PRU-ICSS_EtherCAT_Register_List"><span class="tocnumber">6</span> <span class="toctext">PRU-ICSS EtherCAT Register List</span></a></li>
<li class="toclevel-1 tocsection-141"><a href="#AM335x.2FAM437x_SOC_pins_used_for_EtherCAT_functionality"><span class="tocnumber">7</span> <span class="toctext">AM335x/AM437x SOC pins used for EtherCAT functionality</span></a></li>
<li class="toclevel-1 tocsection-142"><a href="#Application_Examples"><span class="tocnumber">8</span> <span class="toctext">Application Examples</span></a>
<ul>
<li class="toclevel-2 tocsection-143"><a href="#Ecat_Open"><span class="tocnumber">8.1</span> <span class="toctext">Ecat_Open</span></a></li>
<li class="toclevel-2 tocsection-144"><a href="#Ecat_OnTimer"><span class="tocnumber">8.2</span> <span class="toctext">Ecat_OnTimer</span></a></li>
<li class="toclevel-2 tocsection-145"><a href="#Ecat_Close"><span class="tocnumber">8.3</span> <span class="toctext">Ecat_Close</span></a></li>
<li class="toclevel-2 tocsection-146"><a href="#.2ApApplication"><span class="tocnumber">8.4</span> <span class="toctext">*pApplication</span></a></li>
<li class="toclevel-2 tocsection-147"><a href="#Device_configuration"><span class="tocnumber">8.5</span> <span class="toctext">Device configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-148"><a href="#Lib_mode"><span class="tocnumber">8.5.1</span> <span class="toctext">Lib mode</span></a></li>
<li class="toclevel-3 tocsection-149"><a href="#Patch_mode"><span class="tocnumber">8.5.2</span> <span class="toctext">Patch mode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-150"><a href="#SDK_EtherCAT_example_using_Sample_Application_Interface_of_Beckhoff_SSC"><span class="tocnumber">8.6</span> <span class="toctext">SDK EtherCAT example using Sample Application Interface of Beckhoff SSC</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=1" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>PRU-ICSS EtherCAT firmware implements EtherCAT slave controller layer2 functionality and provides EtherCAT ASIC like functionality integrated into AM3357/AM3359/AM4377/AM4379 SOC with PRU-ICSS IP.
</p>
<h2><span class="mw-headline" id="Purpose_and_Scope">Purpose and Scope</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=2" title="Edit section: Purpose and Scope">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Purpose of this document is to assist developers porting their EtherCAT slave stack to TI AM3357/9 or AM4377/9 SOCs.
</p>
<h2><span class="mw-headline" id="Intended_Audience">Intended Audience</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=3" title="Edit section: Intended Audience">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>System integrators using TI ESC in their products</li>
<li>EtherCAT slave stack vendors to support TI ESC</li></ul>
<h2><span class="mw-headline" id="Terms_and_Abbreviations">Terms and Abbreviations</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=4" title="Edit section: Terms and Abbreviations">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>PRUSS: Programmable RealTime Unit Sub System
</p><p>PRU-ICSS: Programmable RealTime Unit - Industrial Communication Sub System - PRUSS with industrial communication support
</p><p>ESC&#160;: EtherCAT Slave Controller
</p><p>ECAT: EtherCAT
</p><p>PDI: Process Data Interface (Host interface to ESC)
</p><p>HRT: High Real Time
</p><p>SRT: Soft Real Time
</p>
<h2><span class="mw-headline" id="References">References</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=5" title="Edit section: References">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>EtherCAT ESC datasheet Section I - Technology<a rel="nofollow" class="external autonumber" href="https://download.beckhoff.com/download/Document/io/ethercat-development-products/ethercat_esc_datasheet_sec1_technology_2i2.pdf">[1]</a></li>
<li>EtherCAT ESC datasheet Section 2 - Register Description<a rel="nofollow" class="external autonumber" href="https://download.beckhoff.com/download/Document/io/ethercat-development-products/ethercat_esc_datasheet_sec2_registers_2i7.pdf">[2]</a></li>
<li>AM335x TRM <a rel="nofollow" class="external autonumber" href="http://www.ti.com/litv/pdf/spruh73c">[3]</a></li>
<li>AM335x Industrial SDK <a rel="nofollow" class="external autonumber" href="http://www.ti.com/tool/sysbiossdk-ind-sitara">[4]</a></li>
<li>Beckhoff SSC documentation <a rel="nofollow" class="external autonumber" href="https://download.beckhoff.com/download/Document/io/ethercat-development-products/an_et9300_v1i7.pdf">[5]</a> available as part of ET9300 EtherCAT Slave Stack Code <a rel="nofollow" class="external autonumber" href="http://www.ethercat.org/memberarea/stack_code.aspx">[6]</a></li>
<li>EtherCAT slave implementation guide from ETG <a rel="nofollow" class="external autonumber" href="http://www.ethercat.org/pdf/english/ETG2200_V2i0i0_SlaveImplementationGuide.pdf">[7]</a></li>
<li>SYS/BIOS PRUSS driver API <a rel="nofollow" class="external autonumber" href="AM335x_PRUSS_SYSBIOS_Driver_API_Guide.html">[8]</a></li></ul>
<h1><span class="mw-headline" id="EtherCAT_application_-_Software_Architecture">EtherCAT application - Software Architecture</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=6" title="Edit section: EtherCAT application - Software Architecture">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p><a href="File_TI_ESC_SW_architecture.html" class="image"><img alt="TI ESC SW architecture.JPG" src="https://processors.wiki.ti.com/images/4/4e/TI_ESC_SW_architecture.JPG" width="594" height="430" /></a>
</p>
<h2><span class="mw-headline" id="Procedure_to_kickoff_ESC_firmware">Procedure to kickoff ESC firmware</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=7" title="Edit section: Procedure to kickoff ESC firmware">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ol><li>Initialize memories (register protection, register reset values, EEPROM cache) and PRU-ICSS INTC</li>
<li>Load ESC firmware into PRUs of PRU-ICSS</li>
<li>Initialize the EtherCAT slave stack</li>
<li>Start firmware</li>
<li>Wait for AL Event Request and SYNC (in DC synchronous mode) interrupts from PRU and run EtherCAT stack main loop for handling mailbox and ESC state m/c</li>
<li>Handle the events as needed - Note that this is handled by Beckhoff SSC (Eg:- industrial SDK sample application)or equivalent 3P stack</li></ol>
<h1><span class="mw-headline" id="Firmware_APIs">Firmware APIs</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=8" title="Edit section: Firmware APIs">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>These APIs implement the key interface between ESC emulation firmware and EtherCAT stack. They are implemented in following source code files
</p><p><b>TI h/w access layer to support EtherCAT slave using PRU-ICSS </b>
</p>
<pre>   sdk\protocols\ethercat_slave\ecat_appl\EcatStack\tiescbsp.c
  sdk\protocols\ethercat_slave\include\tiescbsp.h
</pre>
<p><b>Wrapper APIs for SSC</b>
</p>
<pre>   sdk\protocols\ethercat_slave\ecat_appl\EcatStack\tieschw.c
  sdk\protocols\ethercat_slave\include\tieschw.h
</pre>
<p><b>PRU_ICSS EtherCAT firmware headers</b>
</p>
<pre>   For Industrial SDK 1.1
   sdk\protocols\ethercat_slave\firmware\include 
   For Industrial SDK 2.1 
   sdk\protocols\ethercat_slave\firmware\include\v1.0&#160;: (AM335)
   sdk\protocols\ethercat_slave\firmware\include\v2.0&#160;: (AM437)
   NOTE: Industrial SDK 2.1 AM335(v1.0 folder) firmware is compatible to Industrial SDK 1.1 
</pre>
<p>APIs cover following important aspects.
</p>
<ul><li>Stack - EtherCAT firmware IPC interface</li>
<li>EEPROM emulation handling</li>
<li>SyncManager properties management for TI ESC HAL</li>
<li>SyncManager access and control APIs</li>
<li>SyncManager Malibox mode support</li>
<li>SyncManager Buffer mode support</li>
<li>Special register/memory access handling (NOTE: registers are emulated in memory by firmware)</li>
<li>PRU-ICSS MDIO host side APIs</li>
<li>Spinlock APIs for concurrent Host/Firmware shared memory access</li>
<li>System Time PDI controlled APIs</li>
<li>Timer APIs for EtherCAT stack</li>
<li>Mutex APIs for EtherCAT stack</li>
<li>Interrupt Management APIs for EtherCAT stack</li>
<li>PRU firmware header mapping API</li>
<li>Firmware Upgrade APIs for EtherCAT stack</li></ul>
<h2><span class="mw-headline" id="Initialization_of_stack-firmware_interface">Initialization of stack-firmware interface</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=9" title="Edit section: Initialization of stack-firmware interface">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="bsp_init">bsp_init</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=10" title="Edit section: bsp init">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_init(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Initialize stack firmware interface
</p><p>Setup PRU-ICSS interrupt controller for EtherCAT application.
</p><p>Initialize the PRU data memories.
</p><p>Setup register permissions by invoking bsp_esc_reg_perm_init.
</p><p>Load and start EtherCAT PRU firmware.
</p><p>Initialize EEPROM emulation
</p><p>Initialize command semaphore and bsp_mutex GateAll
</p>
<h3><span class="mw-headline" id="bsp_esc_reg_perm_init">bsp_esc_reg_perm_init</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=11" title="Edit section: bsp esc reg perm init">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_esc_reg_perm_init(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Sets up register permissions for ECAT side access for TI ESC, if <b>ENABLE_PDI_REG_PERMISSIONS</b> is defined in tiescbsp.h, then this function also initializes register permissions for PDI side access from stack/application.
</p><p><br />
<b>NOTE&#160;: ENABLE_PDI_REG_PERMISSIONS</b>
</p><p>This feature is not enabled by default in Industrial SDK for optimizing memory and performance. TI_ESC has Onchip PDI interface where Host CPU has direct access to ESC registers as they are emulated using PRU_ICSS shared data memory.If ENABLE_PDI_REG_PERMISSIONS is defined and bsp_read/write_XXX are used by application for all register accesses then ONLY PDI access check is enforced. If application bypasses the use of bsp_read/write_xxx API (say HWREG to ESC register in PRU_ICSS memory), whole scheme won't work. ENABLE_PDI_REG_PERMISSIONS is a software scheme and has overhead of 4KB data memory to maintain permission array and additional overhead of access check for every read/write to registers. ENABLE_PDI_REG_PERMISSIONS is enabled and bsp_read/write is enabled customer needs to set correct permissions in <b>pdi_reg_perm_array</b>, say for implementing vendor specific register for ESC to activate a host side feature.
</p><p><br /> 
<br /> <b>Struct for register permission array </b>
</p>
<pre>/* Starts at PRU1 DMEM @ 0x4a302000 */
typedef struct {
Uint8 reserved[1024];
Uint8 reg_properties[4096];
} t_register_properties;
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="bsp_start_esc_isr">bsp_start_esc_isr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=12" title="Edit section: bsp start esc isr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_start_esc_isr(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Register IRQ handlers for various PRU-ICSS interrupts from firmware to host to clear corresponding events in PRU-ICSS INTC
</p>
<h3><span class="mw-headline" id="bsp_exit">bsp_exit</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=13" title="Edit section: bsp exit">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_exit(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Cleanup of TI ESC HAL
</p><p>Delete command semaphore and bsp_mutex GateAll
</p><p>Flush the EEPROM cache to SPI flash if present
</p><p>Disable PRUs
</p>
<h3><span class="mw-headline" id="bsp_set_pdi_wd_trigger_mode">bsp_set_pdi_wd_trigger_mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=14" title="Edit section: bsp set pdi wd trigger mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_set_pdi_wd_trigger_mode (Uint32 mode)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>mode: PDI_WD_TRIGGER_RX_SOF/PDI_WD_TRIGGER_LATCH_IN/PDI_WD_TRIGGER_SYNC0/1_OUT</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Configure PDI WD trigger mode, PDI WD is triggered automatically by h/w on RX_SOF(port0/port1), latch0/1 input high, SYNC0/1 out high. PDI WD is also triggered whenever host sends a command to firmware. PDI WD may not expire if host stops sending commands to firmware alone, this will occur only if configured h/w events do not occur during WD period
</p>
<h2><span class="mw-headline" id="ESC_Firmware_Command_API">ESC Firmware Command API</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=15" title="Edit section: ESC Firmware Command API">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="bsp_send_command_to_firmware">bsp_send_command_to_firmware</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=16" title="Edit section: bsp send command to firmware">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_send_command_to_firmware(Uint32 command, Uint16 param1, Uint16 param2);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>command: Command Id to be executed by ESC firmware</li>
<li>param1: parameter1 corresponding to the command</li>
<li>param2: parameter2 corresponding to the command</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Send command and parameters from stack to firmware to perform some action based on stack state or in response to AL event interrupt or SYNC interrupt from ESC
</p>
<table cellspacing="1" cellpadding="1" border="2" align="left" style="width: 1073px; height: 341px;">
<caption><b>EtherCAT firmware command table</b>
</caption>
<tbody><tr>
<th scope="col">Command<br />
</th>
<th scope="col">Id<br />
</th>
<th scope="col">Param1<br />
</th>
<th scope="col">Param2<br />
</th>
<th scope="col">
<p>Return <br />
</p><p>value
</p>
</th>
<th scope="col">Remarks<br />
</th></tr>
<tr>
<td>CMD_DL_USER_ACK_MBX_READ<br />
</td>
<td>4<br />
</td>
<td>address<br />
</td>
<td>length<br />
</td>
<td>NA<br />
</td>
<td>Indicate PDI side mailbox read completion to firmware <br />
</td></tr>
<tr>
<td>CMD_DL_USER_ACK_MBX_WRITE<br />
</td>
<td>5<br />
</td>
<td>address<br />
</td>
<td>length<br />
</td>
<td>NA<br />
</td>
<td>Indicate PDI&#160;side mailbox write to firmware<br />
</td></tr>
<tr>
<td>CMD_DL_USER_EEPROM_CMD_ACK<br />
</td>
<td>6<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Acknowledge EEEPROM&#160;emulation command execution by ARM host stack<br />
</td></tr>
<tr>
<td>CMD_DL_USER_READ_SYNC_STATUS<br />
</td>
<td>7<br />
</td>
<td>sync_sel<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Indicate SYNC0/1 status register read by PDI&#160;to firmware<br />
</td></tr>
<tr>
<td>CMD_DL_USER_READ_AL_CONTROL<br />
</td>
<td>8<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Indicate AL&#160;control register read by PDI&#160;to firmware <br />
</td></tr>
<tr>
<td>CMD_DL_USER_WRITE_AL_STATUS<br />
</td>
<td>9<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Indicate AL&#160;status register write by PDI&#160;to firmware<br />
</td></tr>
<tr>
<td>CMD_DL_USER_READ_PD_WD_STATUS<br />
</td>
<td>10<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Indicate PD&#160;watchdog status register read by PDI to firmware updating register status<br />
</td></tr>
<tr>
<td>CMD_DL_USER_READ_SM_ACTIVATE<br />
</td>
<td>11<br />
</td>
<td>sm_index<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Indicate SM&#160;activate register read by PDI&#160;to firmware<br />
</td></tr>
<tr>
<td>CMD_DL_USER_WRITE_SM_PDI_CTRL<br />
</td>
<td>12<br />
</td>
<td>(sm_index&lt;&lt;8) &#124; pdi control reg value<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Indicate SM&#160;PDI&#160;control write to control SM from PDI to firmware<br />
</td></tr>
<tr>
<td>CMD_DL_USER_READ_LATCH_TIME<br />
</td>
<td>13<br />
</td>
<td>latch_sel<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Indicate Latch0/1 time registest read by PDI&#160;to firmware<br />
</td></tr>
<tr>
<td>CMD_DL_USER_READ_SYSTEM_TIME<strike><br /></strike>
</td>
<td>14<strike><br /></strike>
</td>
<td>NA<strike><br /></strike>
</td>
<td>NA<strike><br /></strike>
</td>
<td>NA<strike><br /></strike>
</td>
<td>Indicate System Time register read by PDI&#160;to firmware<br />
</td></tr>
<tr>
<td>CMD_DL_USER_CLEAR_AL_EVENT_LOW<br />
</td>
<td>15<br />
</td>
<td>event_mask<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Clear events not set in event_mask in AL event request register<br />
</td></tr>
<tr>
<td>CMD_DL_USER_SYSTIME_PDI_CONTROL<br />
</td>
<td>16<br />
</td>
<td>reg_sel<br />
</td>
<td>NA<br />
</td>
<td>NA<br />
</td>
<td>Indicate to the firmware DC register update from PDI side<br />
</td></tr></tbody></table>
<p><br />
<br /> <br />
<br />
<br /> <b>Struct for host to PRU-ICSS command interface </b>
</p>
<pre>/* Starts at PRU0 DMEM @ 0x4a300000 */
typedef struct {
Uint8 reserved1[0x90];
Uint32 system_time_low;
Uint32 system_time_high;
Uint8  sm_config_ongoing;
Uint8 reserved2[7];
Uint16 cmdlow;
Uint16 cmdlow_ack;
Uint16 param1low;
Uint16 param2low;
Uint16 resp1low;
Uint16 resp2low;
Uint8 reserved3[212];
t_sm_processdata sm_processdata[6];
} t_host_interface;
</pre>
<pre>typedef struct {
Uint8 sm_buf_index;
Uint8 lock_state;
Uint16 addr;
} t_sm_processdata;
</pre>
<p><b>lock_state can have following values - access is protected using AM335x spinlock 2 to 7 for 6SMs (SM2 to SM7) </b>
</p>
<pre>#define LOCK_PD_BUF_AVAILABLE_FOR_HOST	0 //Process data buffer is available for host access
#define LOCK_PD_BUF_HOST_ACCESS_START	1 //Host started access on process data
#define LOCK_PD_BUF_HOST_ACCESS_FINISH	2 //Host finished accessing process data
</pre>
<p><b>IMPORTANT NOTE on SUPPORT_CMDACK_POLL_MODE </b>
</p><p>EtherCAT firmware supports both poll mode and interrupt mode for command acknowledge. It is found that poll mode offers better latency in given scenarios but will waste CPU cycles busy waiting for command response from PRU. If you need to switch to command ack interrupt mode comment the define for SUPPORT_CMDACK_POLL_MODE in tiescbsp.h
</p><p><br />
</p>
<h2><span class="mw-headline" id="ESI_EEPROM_emulation_support">ESI EEPROM emulation support</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=17" title="Edit section: ESI EEPROM emulation support">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>TI ESC follows 11.2.4 EEPROM Emulation of EtherCAT ESC datasheet Section I - Technology<a rel="nofollow" class="external autonumber" href="https://download.beckhoff.com/download/Document/io/ethercat-development-products/ethercat_esc_datasheet_sec1_technology_2i2.pdf">[9]</a> from functional principle point of view. This is typically used in IP core based ESCs with non-volatile memory. Here Host CPU emulates all EEPROM operations (read/write/reload) using RAM and from EtherCAT master point of view, this is equivalent to I2C EEPROM managed by ESC.
</p><p><br />
<b>ET1100</b>
</p><p>The EtherCAT master can invoke reloading the EEPROM content. In this case the Configured Station Alias 0x0012:0x0013 and PDI Control Bit 0x0140.9 (enhanced link detection) are not taken over, they are only taken over at the initial EEPROM loading after power-on or reset.
</p><p><br />
<b>EtherCAT IP core</b>
</p><p>However The read data for a reload command (or the initial EEPROM loading) is reduced to the Configured Station Alias (0x0012:0x0013) and the Enhanced Link Detection Enables (0x0140[9], 0x0140[15:12]). 
</p><p>IP core uses scheme described in section 3.44.1 EEPROM emulation with IP Core.
</p><p>There are some exceptions to how this implemented in TI ESC, compared to IP core.
</p><p><b>TI ESC</b>
</p><p>Configured Station Alias, Enhanced Link Detection Enables  and DL status. Bit2 is updated directly by HAL driver during initial EEPROM loading operation. Similar to ET1100. Exception to IP core.
</p><p>PDI configuration (0x150:0x153) are not loaded during EEPROM reload/inital load. However this is programmable if customers want to make it similar to ET1100. We kept this way because PDI configuration programmability is limited for TI ESC. Similar to IP core.
</p><p>Register Pulse Length of SyncSignals (0x0982:0x983) is updated from EEPROM ADR 0x0002 during reload operation. Similar to ET1100. Exception to IP core
</p><p><br />
<b>IMPORTANT NOTE on EEPROM_SPI</b>
</p><p>SDK supports non-volatile storage for ESI EEPROM in ICE and IDK using SPI flash. However one can switch to volatile EEPROM (EEPROM in RAM and contents are not retained after power reset) for debugging purposes on ICE/IDK by undefining EEPROM_SPI in tiescbsp.h
</p>
<h3><span class="mw-headline" id="bsp_eeprom_emulation_init">bsp_eeprom_emulation_init</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=18" title="Edit section: bsp eeprom emulation init">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_eeprom_emulation_init (void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Initialize the EEPROM cache in volatile RAM - if SPI flash has valid EEPROM load from SPI flash, otherwise load predefined EEPROM in application
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_eeprom_load_esc_registers">bsp_eeprom_load_esc_registers</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=19" title="Edit section: bsp eeprom load esc registers">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Int32 bsp_eeprom_load_esc_registers (Int32 reload_flag);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>reload_flag: If set reload command is being executed else first boot in progress</li>
<li>Return value: 0: On successful load of registers -1: On CRC error</li></ul>
<p><b>Description</b> For loading ESC registers from EEPROM during first boot/reload after validating CRC
</p>
<h3><span class="mw-headline" id="bsp_eeprom_emulation_reload">bsp_eeprom_emulation_reload</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=20" title="Edit section: bsp eeprom emulation reload">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Int32 bsp_eeprom_emulation_reload(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: 0: On successful load of registers -1: On CRC error</li></ul>
<p><b>Description</b> Perform reload operation after validating EEPROM CRC
</p>
<h3><span class="mw-headline" id="HW_EepromReload">HW_EepromReload</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=21" title="Edit section: HW EepromReload">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  UInt16 HW_EepromReload ();
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: 0: On successful load of registers -1: On CRC error</li></ul>
<p><b>Description</b> Perform reload operation after validating EEPROM CRC, Wrapper API for SSC
</p>
<h3><span class="mw-headline" id="bsp_eeprom_emulation_command_ack">bsp_eeprom_emulation_command_ack</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=22" title="Edit section: bsp eeprom emulation command ack">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_eeprom_emulation_command_ack(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Acknowledges EEPROM emulation command handling by stack to ESC firmware. Firmware performs necessary actions to update EEPROM status and AL event request registers in response to the command
</p>
<h3><span class="mw-headline" id="bsp_eeprom_emulation_flush">bsp_eeprom_emulation_flush</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=23" title="Edit section: bsp eeprom emulation flush">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_eeprom_emulation_flush (void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Flush the EEPROM cache to non-volatile storage (say SPI flash) if available
</p>
<h3><span class="mw-headline" id="bsp_get_eeprom_cache_base">bsp_get_eeprom_cache_base</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=24" title="Edit section: bsp get eeprom cache base">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint8 *bsp_get_eeprom_cache_base(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: Pointer to volatile EEPROM cache start to the stack/application for EEPROM access</li></ul>
<p><b>Description</b> Return pointer to volatile EEPROM cache in TI ESC HAL for processing to access the EEPROM
</p>
<h3><span class="mw-headline" id="bsp_set_eeprom_update_status">bsp_set_eeprom_update_status</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=25" title="Edit section: bsp set eeprom update status">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_set_eeprom_update_status(Uint8 status);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>status: Update the TI ESC HAL EEPROM update status - typically on EEPROM write detection from stack</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Indicate to TI ESC HAL whether EEPROM is written for flushing to non-volatile storage
</p>
<h3><span class="mw-headline" id="bsp_get_eeprom_update_status">bsp_get_eeprom_update_status</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=26" title="Edit section: bsp get eeprom update status">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint8 bsp_get_eeprom_update_status(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: EEPROM updated status</li></ul>
<p><b>Description</b> Read the EEPROM update status from TI ESC HAL - typically from low priority task periodically check EEPROM dirty status for flush
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_eeprom_emulation_exit">bsp_eeprom_emulation_exit</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=27" title="Edit section: bsp eeprom emulation exit">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_eeprom_emulation_exit (void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Call EEPROM flush on exit
</p>
<h2><span class="mw-headline" id="SyncManager_properties_management_for_TI_ESC_HAL">SyncManager properties management for TI ESC HAL</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=28" title="Edit section: SyncManager properties management for TI ESC HAL">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>These APIs indicate to TI ESC HAL layer changes in SM configuration in the h/w registers. Typically called from appropriate state transition handlers in application/stack
</p><p><br /> <b>Struct for SM properties </b>
</p>
<pre>typedef struct {
Uint16 physical_start_addr;
Uint16 length;
} t_sm_properties;
</pre>
<pre>static t_sm_properties sm_properties[MAX_SYNC_MAN];
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="bsp_set_sm_properties">bsp_set_sm_properties</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=29" title="Edit section: bsp set sm properties">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_set_sm_properties (Uint8 sm, Uint16 address, Uint16 length);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>sm: SyncManager index to set</li>
<li>address: physical start address of SyncManager</li>
<li>length: length of SyncManager</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Set the address, length info from register to TI ESC HAL layer. During INIT to PREOP transition in Mailbox mode. During SAFEOP to OP transition in Buffer mode
</p>
<h3><span class="mw-headline" id="bsp_get_sm_properties">bsp_get_sm_properties</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=30" title="Edit section: bsp get sm properties">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  t_sm_properties *bsp_get_sm_properties (Uint8 sm);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>sm: SyncManager index to get properties from TI ESC HAL</li>
<li>Return value: pointer to requested sm_properties array element in TI ESC HAL</li></ul>
<p><b>Description</b> Get the pointer to requested SM properties - used for Buffer/Mailbox read/write detection from Host PDI interface to indicate to the firmware
</p>
<h2><span class="mw-headline" id="SyncManager_access_and_control_APIs">SyncManager access and control APIs</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=31" title="Edit section: SyncManager access and control APIs">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="HW_EnableSyncManChannel">HW_EnableSyncManChannel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=32" title="Edit section: HW EnableSyncManChannel">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EnableSyncManChannel(Uint16 channel)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>channel: channel number (0:7)</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Enables SYNC manager channel from PDI
</p>
<h3><span class="mw-headline" id="HW_DisableSyncManChannel">HW_DisableSyncManChannel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=33" title="Edit section: HW DisableSyncManChannel">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_DisableSyncManChannel(Uint16 channel)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>channel: channel number (0:7)</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Disables SYNC manager channel from PDI
</p>
<h3><span class="mw-headline" id="HW_GetSyncMan">HW_GetSyncMan</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=34" title="Edit section: HW GetSyncMan">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void *HW_GetSyncMan(Uint8 channel)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>channel: channel number (0:7)</li>
<li>Return value: Pointer to requested SM channel settings</li></ul>
<p><b>Description</b> Return SM properties like (address, length, control byte) to application from corresponding ESC registers
</p>
<h3><span class="mw-headline" id="bsp_pdi_sm_config_ongoing">bsp_pdi_sm_config_ongoing</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=35" title="Edit section: bsp pdi sm config ongoing">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint8 bsp_pdi_sm_config_ongoing (void)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>None</li>
<li>Return value: 0&#160;: SM configuration finished Otherwise&#160;: SM configuration ongoing</li></ul>
<p><b>Description</b> Checks whether firmware has finished updating internal state for SM configuration change initiated by stack/PDI
</p>
<h2><span class="mw-headline" id="SyncManager_Mailbox_mode_handling">SyncManager Mailbox mode handling</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=36" title="Edit section: SyncManager Mailbox mode handling">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="bsp_pdi_mbx_read_start">bsp_pdi_mbx_read_start</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=37" title="Edit section: bsp pdi mbx read start">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_mbx_read_start(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Indicates to the firmware that PDI side read from write mailbox has started
</p>
<h3><span class="mw-headline" id="bsp_pdi_mbx_read_complete">bsp_pdi_mbx_read_complete</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=38" title="Edit section: bsp pdi mbx read complete">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_mbx_read_complete(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Indicates to the firmware that PDI side read from write mailbox has completed
</p>
<h3><span class="mw-headline" id="bsp_pdi_mbx_write_start">bsp_pdi_mbx_write_start</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=39" title="Edit section: bsp pdi mbx write start">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_mbx_write_start(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Indicates to the firmware that PDI side write to read mailbox has started
</p>
<h3><span class="mw-headline" id="bsp_pdi_mbx_write_complete">bsp_pdi_mbx_write_complete</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=40" title="Edit section: bsp pdi mbx write complete">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_mbx_write_complete(void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none: none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Indicates to the firmware that PDI side write to read mailbox has completed
</p>
<h3><span class="mw-headline" id="HW_EscReadMbxMem">HW_EscReadMbxMem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=41" title="Edit section: HW EscReadMbxMem">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscReadMbxMem(Uint8 * pdata, Uint16 address, Uint16 len)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>pdata: Pointer to data array in application</li>
<li>address: Mailbox address to read from PDI</li>
<li>len: Length of data array in application</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Read 'len' bytes from ESC mailbox @ 'address' into application buffer pointed by 'pdata'
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_sm_properties</li>
<li>bsp_pdi_mbx_read_start</li>
<li>bsp_read</li>
<li>bsp_pdi_mbx_read_complete</li></ul>
<h3><span class="mw-headline" id="HW_EscWriteMbxMem">HW_EscWriteMbxMem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=42" title="Edit section: HW EscWriteMbxMem">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWriteMbxMem(Uint8 * pdata, Uint16 address, Uint16 len)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>pdata: Pointer to data array in application</li>
<li>address: Mailbox address to write from PDI</li>
<li>len: Length of data array in application</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write 'len' bytes from application buffer pointed by 'pdata' and copy to ESC mailbox @ 'address'
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_sm_properties</li>
<li>bsp_pdi_mbx_write_start</li>
<li>bsp_write</li>
<li>bsp_pdi_mbx_write_complete</li></ul>
<h2><span class="mw-headline" id="SyncManager_Buffer_mode_handling">SyncManager Buffer mode handling</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=43" title="Edit section: SyncManager Buffer mode handling">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="bsp_get_process_data_address">bsp_get_process_data_address</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=44" title="Edit section: bsp get process data address">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  UINT16 bsp_get_process_data_address(Uint16 address, Uint16 len, Int16* p_sm_index);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: SM buffer address for PDI side access</li>
<li>len: SM buffer length for PDI side access</li></ul>
<ul><li>Return value: Actual PDI address in memory</li>
<li>p_sm_index: Matching SM index corresponding to address</li></ul>
<p><b>Description</b> Get the actual address of the buffer for PDI side read/write from host MPU in 3-buffer mode
</p>
<h3><span class="mw-headline" id="bsp_process_data_access_complete">bsp_process_data_access_complete</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=45" title="Edit section: bsp process data access complete">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_process_data_access_complete(Uint16 address, Uint16 len, Int16 sm_index);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: SM buffer address for PDI side access</li>
<li>len: SM buffer length for PDI side access</li>
<li>sm_index: SM index of this process data buffer</li>
<li>Return value: none</li></ul>
<p><b>Description</b> This API is invoked after PDI side completes read/write to PD address returned by bsp_get_process_data_address to indicate this to firmware for swapping buffers etc
</p><p><br />
</p>
<h2><span id="ESC_Register/Memory_access_-_Special_handling_APIs"></span><span class="mw-headline" id="ESC_Register.2FMemory_access_-_Special_handling_APIs">ESC Register/Memory access - Special handling APIs</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=46" title="Edit section: ESC Register/Memory access - Special handling APIs">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Ideally all register/ process data memory access shall use these APIs. This takes care of any special indication to firmware on register read/write etc.
</p>
<h3><span class="mw-headline" id="bsp_read_byte">bsp_read_byte</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=47" title="Edit section: bsp read byte">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint8 bsp_read_byte(Uint16 Address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to read from PDI</li>
<li>Return value: Value at address</li></ul>
<p><b>Description</b> Read a byte value at 'Address' from ESC memory - SM mailbox (single buffer) mapped or register area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_pdi_mbx_read_complete</li>
<li>bsp_pdi_post_read_indication</li></ul>
<h3><span class="mw-headline" id="bsp_read_word">bsp_read_word</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=48" title="Edit section: bsp read word">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint16 bsp_read_word(Uint16 Address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to read from PDI</li>
<li>Return value: Value at address</li></ul>
<p><b>Description</b> Read a 16-bit value at 'Address' from ESC memory - SM mailbox (single buffer) mapped or register area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_pdi_mbx_read_complete</li>
<li>bsp_pdi_post_read_indication</li></ul>
<h3><span class="mw-headline" id="bsp_read_dword">bsp_read_dword</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=49" title="Edit section: bsp read dword">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint32 bsp_read_dword(Uint16 Address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to read from PDI</li>
<li>Return value: Value at address</li></ul>
<p><b>Description</b> Read a 32-bit value at 'Address' from ESC memory - SM mailbox (single buffer) mapped or register area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_pdi_mbx_read_complete</li>
<li>bsp_pdi_post_read_indication</li></ul>
<h3><span class="mw-headline" id="bsp_read">bsp_read</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=50" title="Edit section: bsp read">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   void bsp_read(Uint8 *pdata, Uint16 address, Uint16 len);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>pdata: Pointer to the array in application</li>
<li>address: ESC address to read from PDI</li>
<li>len&#160;: Number of bytes to read from ESC memory</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Read a byte array at 'address' from ESC memory
</p>
<h3><span class="mw-headline" id="bsp_read_byte_isr">bsp_read_byte_isr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=51" title="Edit section: bsp read byte isr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint8 bsp_read_byte_isr(Uint16 Address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to read from PDI</li>
<li>Return value: Value at address</li></ul>
<p><b>Description</b> Read a byte value at 'Address' from ESC process data memory - SM buffer (3-buffer) mapped area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_process_data_read_address</li>
<li>bsp_send_command_to_firmware</li></ul>
<h3><span class="mw-headline" id="bsp_read_word_isr">bsp_read_word_isr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=52" title="Edit section: bsp read word isr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint8 bsp_read_word_isr(Uint16 Address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to read from PDI</li>
<li>Return value: Value at address</li></ul>
<p><b>Description</b> Read a 16-bit value at 'Address' from ESC process data memory - SM buffer (3-buffer) mapped area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_process_data_read_address</li>
<li>bsp_send_command_to_firmware</li></ul>
<h3><span class="mw-headline" id="bsp_read_dword_isr">bsp_read_dword_isr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=53" title="Edit section: bsp read dword isr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint32 bsp_read_dword_isr(Uint16 address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to read from PDI</li>
<li>Return value: Value at address</li></ul>
<p><b>Description</b> Read a 32-bit value at 'Address' from ESC process data memory - SM buffer (3-buffer) mapped area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_process_data_read_address</li>
<li>bsp_send_command_to_firmware</li></ul>
<h3><span class="mw-headline" id="bsp_pdi_post_read_indication">bsp_pdi_post_read_indication</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=54" title="Edit section: bsp pdi post read indication">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_post_read_indication(Uint16 address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address read from PDI</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Invoked after reading a register or mailbox buffer from PDI side
</p><p>Handles following registers
</p>
<ul><li>SM WD status</li>
<li>AL control</li>
<li>SYNC0/1 status</li>
<li>SM Activate registers</li>
<li>Latch0/1 time Postive/Negative edge</li></ul>
<p>Also detects read mailbox start address access from PDI side
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_send_command_to_firmware</li></ul>
<h3><span class="mw-headline" id="bsp_pdi_write_indication">bsp_pdi_write_indication</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=55" title="Edit section: bsp pdi write indication">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_write_indication(Uint16 address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address read from PDI</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Invoked after writing a register or mailbox buffer from PDI side
</p><p>Handles following registers
</p>
<ul><li>AL status</li>
<li>SM PDI control registers</li></ul>
<p>Also detects write mailbox start address access from PDI side
</p><p><br /> <b>Invokes</b>
</p>
<ul><li>bsp_send_command_to_firmware</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_EscReadByteIsr">HW_EscReadByteIsr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=56" title="Edit section: HW EscReadByteIsr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function macro</b>
</p>
<pre>  HW_EscReadByteIsr(ByteValue, Address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>Address: ESC address to read from PDI</li>
<li>Return value: ByteValue at Address</li></ul>
<p><b>Description</b> Used by application to read process data byte from ESC memory
</p><p><b>Invokes</b>
</p>
<ul><li>__HW_EscReadByteIsr</li>
<li>bsp_get_process_data_address</li>
<li>bsp_read_byte_isr</li>
<li>bsp_process_data_access_complete</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_EscReadWordIsr">HW_EscReadWordIsr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=57" title="Edit section: HW EscReadWordIsr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function macro</b>
</p>
<pre>  HW_EscReadWordIsr(WordValue, Address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>Address: ESC address to read from PDI</li>
<li>Return value: WordValue at Address</li></ul>
<p><b>Description</b> Used by application to read process data word from ESC memory
</p><p><b>Invokes</b>
</p>
<ul><li>__HW_EscReadWordIsr</li>
<li>bsp_get_process_data_address</li>
<li>bsp_read_word_isr</li>
<li>bsp_process_data_access_complete</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_EscReadDWordIsr">HW_EscReadDWordIsr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=58" title="Edit section: HW EscReadDWordIsr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function macro</b>
</p>
<pre>  HW_EscReadWordIsr(DWordValue, Address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>Address: ESC address to read from PDI</li>
<li>Return value: DWordValue at Address</li></ul>
<p><b>Description</b> Used by application to read process data word from ESC memory
</p><p><b>Invokes</b>
</p>
<ul><li>__HW_EscReadDWordIsr</li>
<li>bsp_get_process_data_address</li>
<li>bsp_read_word_isr</li>
<li>bsp_process_data_access_complete</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_EscReadIsr">HW_EscReadIsr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=59" title="Edit section: HW EscReadIsr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscReadIsr(Uint8 * pdata, Uint16 address, Uint16 len)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>pdata: Pointer to the data array to read</li>
<li>address: ESC address to read from PDI</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Used by application to read process data output from ESC memory
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_process_data_address</li>
<li>bsp_read</li>
<li>bsp_process_data_access_complete</li></ul>
<p><br /> <br />
</p>
<h3><span class="mw-headline" id="HW_EscWriteByte">HW_EscWriteByte</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=60" title="Edit section: HW EscWriteByte">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWriteByte(Uint8 bytevalue, Uint16 address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to write from PDI</li>
<li>bytevalue: Value to write</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a byte value at 'address' in ESC memory - SM mailbox (single buffer) mapped or register area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_sm_properties</li>
<li>bsp_write_byte</li>
<li>bsp_pdi_mbx_write_complete</li>
<li>bsp_pdi_write_indication</li></ul>
<h3><span class="mw-headline" id="HW_EscWriteByteIsr">HW_EscWriteByteIsr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=61" title="Edit section: HW EscWriteByteIsr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWriteByteIsr(Uint8 bytevalue, Uint16 address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to write from PDI</li>
<li>bytevalue: Value to write</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a byte value at 'address' in ESC memory
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_process_data_address</li>
<li>bsp_write_byte</li>
<li>bsp_process_data_access_complete</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_EscWriteWord">HW_EscWriteWord</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=62" title="Edit section: HW EscWriteWord">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWriteWord(Uint16 wordvalue, Uint16 address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to write from PDI</li>
<li>wordvalue: Value at address</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a 16-bit value to 'address' in ESC memory - SM mailbox (single buffer) mapped or register area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_sm_properties</li>
<li>bsp_write_word</li>
<li>bsp_pdi_mbx_write_complete</li>
<li>bsp_pdi_write_indication</li></ul>
<h3><span class="mw-headline" id="HW_EscWriteWordIsr">HW_EscWriteWordIsr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=63" title="Edit section: HW EscWriteWordIsr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWriteWordIsr(Uint8 wordvalue, Uint16 address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to write from PDI</li>
<li>wordvalue: Value to write</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a word value at 'address' in ESC process data memory - SM buffer (3-buffer) mapped area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_process_data_address</li>
<li>bsp_write_word</li>
<li>bsp_process_data_access_complete</li></ul>
<h3><span class="mw-headline" id="HW_EscWriteDWord">HW_EscWriteDWord</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=64" title="Edit section: HW EscWriteDWord">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWriteDWord(Uint32 dwordValue, Uint16 Address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to write from PDI</li>
<li>dword value: Value at address</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a 32-bit value to 'address' in ESC memory - SM mailbox (single buffer) mapped or register area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_sm_properties</li>
<li>bsp_write_dword</li>
<li>bsp_pdi_mbx_write_complete</li>
<li>bsp_pdi_write_indication</li></ul>
<h3><span class="mw-headline" id="HW_EscWriteDWordIsr">HW_EscWriteDWordIsr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=65" title="Edit section: HW EscWriteDWordIsr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWriteDWordIsr(Uint8 dwordvalue, Uint16 address)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: ESC address to write from PDI</li>
<li>dwordvalue: Value to write</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a 32-bit dword value at 'address' in ESC process data memory - SM buffer (3-buffer) mapped area
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_get_process_data_address</li>
<li>bsp_write_dword</li>
<li>bsp_process_data_access_complete</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_EscWrite">HW_EscWrite</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=66" title="Edit section: HW EscWrite">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWrite(Uint8 * pdata, Uint16 address, Uint16 len)
</pre>
<p><b>Parameters</b>
</p>
<ul><li>pdata: Pointer to data array in application</li>
<li>address: ESC address to read from PDI</li>
<li>len: Length of data array in application</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write 'len' bytes to 'address' in ESC memory from pdata
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_write</li>
<li>bsp_pdi_write_indication</li></ul>
<h3><span class="mw-headline" id="HW_EscWriteIsr">HW_EscWriteIsr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=67" title="Edit section: HW EscWriteIsr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_EscWriteIsr(Uint8 * pdata, Uint16 address, Uint16 len);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>pdata: Pointer to data array in application</li>
<li>address: ESC address to read from PDI</li>
<li>len: Length of data array in application</li>
<li>Return value: None</li></ul>
<p><br /> <b>Description</b> Write 'len' bytes to 'address' in ESC memory from pdata, used to copy process data input values from slave application to ESC memory for sending to EtherCAT master
</p><p><b>Invokes</b>
</p><p><br />
</p>
<ul><li>bsp_get_process_data_address</li>
<li>bsp_write</li>
<li>bsp_process_data_access_complete</li></ul>
<p>Following are mainly helper APIs used by memory access APIs in tieschw.c to implement register permission checks and firewall protection
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_write_byte">bsp_write_byte</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=68" title="Edit section: bsp write byte">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_write_byte(Uint8 val, Uint16 address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>val: 8-bit value to write</li>
<li>address: ESC address to write from PDI</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a byte value at 'address' in ESC memory
</p>
<h3><span class="mw-headline" id="bsp_write_word">bsp_write_word</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=69" title="Edit section: bsp write word">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_write_word(Uint16 val, Uint16 address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>val: 16-bit value to write</li>
<li>address: ESC address to write from PDI</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a 16-bit value at 'address' in ESC memory
</p>
<h3><span class="mw-headline" id="bsp_write_dword">bsp_write_dword</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=70" title="Edit section: bsp write dword">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_write_dword( Uint32 val, Uint16 address);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>val: 32-bit value to write</li>
<li>address: ESC address to write from PDI</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a 32-bit value at 'address' in ESC memory
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_write">bsp_write</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=71" title="Edit section: bsp write">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_write(Uint8 *pdata, Uint16 address, Uint16 len);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>pdata: Pointer to byte array in application</li>
<li>address: ESC address to write from PDI</li>
<li>len: Length of data</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write 'len' bytes from pdata to 'address' in ESC memory
</p>
<h3><span class="mw-headline" id="bsp_pruss_mdioreg_read">bsp_pruss_mdioreg_read</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=72" title="Edit section: bsp pruss mdioreg read">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint32 bsp_pruss_mdioreg_read (Uint32 regoffset);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>val: 32-bit value to read from PRU-ICSS MDIO</li>
<li>regoffset: PRU-ICSS MDIO register offset</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Read a 32-bit value from PRU-ICSS MDIO register at 'regoffset'
</p>
<h3><span class="mw-headline" id="bsp_pruss_mdioreg_write">bsp_pruss_mdioreg_write</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=73" title="Edit section: bsp pruss mdioreg write">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pruss_mdioreg_write (Uint32 val, Uint32 regoffset);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>val: 32-bit value to write to PRU-ICSS MDIO</li>
<li>regoffset: PRU-ICSS MDIO register offset</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a 32-bit value at PRU-ICSS MDIO register at 'regoffset'
</p>
<h3><span class="mw-headline" id="bsp_pruss_iepreg_read">bsp_pruss_iepreg_read</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=74" title="Edit section: bsp pruss iepreg read">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint32 bsp_pruss_iepreg_read (Uint32 regoffset);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>val: 32-bit value to read from PRU-ICSS IEP</li>
<li>regoffset: PRU-ICSS IEP register offset</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Read a 32-bit value from PRU-ICSS IEP register at 'regoffset'
</p>
<h3><span class="mw-headline" id="bsp_pruss_iepreg_write">bsp_pruss_iepreg_write</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=75" title="Edit section: bsp pruss iepreg write">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pruss_iepreg_write (Uint32 val, Uint32 regoffset);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>val: 32-bit value to write to PRU-ICSS IEP</li>
<li>regoffset: PRU-ICSS IEP register offset</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a 32-bit value at PRU-ICSS IEP register at 'regoffset'
</p>
<h3><span class="mw-headline" id="bsp_pruss_cmd_intfc_read_word">bsp_pruss_cmd_intfc_read_word</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=76" title="Edit section: bsp pruss cmd intfc read word">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint16 bsp_pruss_cmd_intfc_read_word (volatile Uint16 *ptr);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>ptr: PRU-ICSS command interface pointer</li>
<li>Return value: 16-bit value read</li></ul>
<p><b>Description</b> Read a 16-bit value from PRU-ICSS IEP command interface
</p>
<h3><span class="mw-headline" id="bsp_pruss_cmd_intfc_write_word">bsp_pruss_cmd_intfc_write_word</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=77" title="Edit section: bsp pruss cmd intfc write word">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pruss_cmd_intfc_write_word (Uint16 val, volatile Uint16 *ptr);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>val: 16-bit value to write</li>
<li>ptr: Pointer to Host - PRU-ICSS command interface in PRU-ICSS data memory</li>
<li>Return value: None</li></ul>
<p><b>Description</b> Write a 16-bit value at PRU-ICSS command interface pointer
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_get_pdi_access_perm">bsp_get_pdi_access_perm</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=78" title="Edit section: bsp get pdi access perm">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  inline Uint8  bsp_get_pdi_access_perm(Uint16 address, Uint8 access);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: PDI Register address</li>
<li>access: Permission to be checked ( Read, Write, Read&amp;Write )</li>
<li>Return value: 1 if the register has the requested permission, 0 if otherwise</li></ul>
<p><b>Description</b> Checks if the PDI register [byte] has the requested access permission and returns the result
</p>
<h3><span class="mw-headline" id="bsp_pdi_access_perm_word">bsp_pdi_access_perm_word</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=79" title="Edit section: bsp pdi access perm word">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  inline Uint8  bsp_pdi_access_perm_word(Uint16 address, Uint8 access);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: PDI Register start address</li>
<li>access: Permission to be checked ( Read, Write, Read&amp;Write )</li>
<li>Return value: 1 if the register has the requested permission, 0 if otherwise</li></ul>
<p><b>Description</b> Checks if the PDI register [Two bytes] has the requested access permission and returns the result
</p>
<h3><span class="mw-headline" id="bsp_pdi_access_perm_dword">bsp_pdi_access_perm_dword</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=80" title="Edit section: bsp pdi access perm dword">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  inline Uint8  bsp_pdi_access_perm_dword(Uint16 address, Uint8 access);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: PDI Register start address</li>
<li>access: Permission to be checked ( Read, Write, Read&amp;Write )</li>
<li>Return value: 1 if the register has the requested permission, 0 if otherwise</li></ul>
<p><b>Description</b> Checks if the PDI registers (Four bytes) has the requested access permission and returns the result
</p>
<h3><span class="mw-headline" id="bsp_pdi_access_perm_array">bsp_pdi_access_perm_array</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=81" title="Edit section: bsp pdi access perm array">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  inline Uint8  bsp_pdi_access_perm_array(Uint16 address, Uint8 access, Uint16 size);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>address: PDI Register start address</li>
<li>access: Permission to be checked ( Read, Write, Read&amp;Write )</li>
<li>size: Number of register bytes</li>
<li>Return value: 1 if the register has the requested permission, 0 if otherwise</li></ul>
<p><b>Description</b> Checks if all PDI registers starting from 'address' has the requested access permission and returns the result
</p>
<h3><span class="mw-headline" id="bsp_get_pdi_read_access_fail_cnt">bsp_get_pdi_read_access_fail_cnt</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=82" title="Edit section: bsp get pdi read access fail cnt">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint32 bsp_get_pdi_read_access_fail_cnt();
</pre>
<p><b>Parameters</b>
</p>
<ul><li>None</li>
<li>Return value: Number of denied PDI register read attempts</li></ul>
<p><b>Description</b> Provides the number of times the read request was denied
</p>
<h3><span class="mw-headline" id="bsp_get_pdi_write_access_fail_cnt">bsp_get_pdi_write_access_fail_cnt</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=83" title="Edit section: bsp get pdi write access fail cnt">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint32 bsp_get_pdi_write_access_fail_cnt();
</pre>
<p><b>Parameters</b>
</p>
<ul><li>None</li>
<li>Return value: Number of denied PDI register write attempts</li></ul>
<p><b>Description</b> Provides the number of times the write request was denied
</p>
<h2><span class="mw-headline" id="PRU-ICSS_MDIO_host_side_APIs">PRU-ICSS MDIO host side APIs</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=84" title="Edit section: PRU-ICSS MDIO host side APIs">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="bsp_pruss_mdio_init">bsp_pruss_mdio_init</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=85" title="Edit section: bsp pruss mdio init">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   Int16 bsp_pruss_mdio_init (t_mdio_params *pmdio_params);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>pmdio_params: Pointer to parameter structure of PRU-ICSS MDIO initialization</li>
<li>pmdio_params-&gt;clkdiv: MDIO clkdiv. MDIO clock = 200/(clkdiv+1)</li>
<li>pmdio_params-&gt;addr0: Address of the PHY hooked to PRU-ICSS MII0</li>
<li>pmdio_params-&gt;addr1: Address of the PHY hooked to PRU-ICSS MII1</li>
<li>pmdio_params-&gt;link0pol: LINK_MII signal polarity of PHY hooked to PRU-ICSS MII0</li>
<li>pmdio_params-&gt;link1pol: LINK_MII signal polarity of PHY hooked to PRU-ICSS MII1</li>
<li>pmdio_params-&gt;enhancedlink_enable: Enable enhanced link detection using MII RXLINK and TLK110 enhanced link detection features</li></ul>
<p><b>Struct for MDIO initialization parameters </b>
</p>
<pre>typedef struct {
 Uint16 clkdiv;
 Uint8 addr0;
 Uint8 addr1;
 Uint8 link0pol; //1: Active Low 0: Active High
 Uint8 link1pol; //1: Active Low 0: Active High
 Uint8 enhancedlink_enable;
} t_mdio_params;
</pre>
<p><br />
</p>
<ul><li>Return value: none</li></ul>
<p><b>Description</b> Initializes PRU-ICSS MDIO for EtherCAT firmware to communicate with PHYs. Must be called after powering on PRU-ICSS domain and before PRU firmware is loaded and executed on both PRUs.
</p><p>The setting of Link polarity parameters link0pol and link1pol are determined by MDIOLINK Register when enhanced link detection is enabled.
</p><p>MDIOLINK Register is updated after a read of the Generic Status Register of a PHY. Typically the bit is set if the PHY with the corresponding address has link and the PHY acknowledges the read transaction. The bit is reset if the PHY indicates it does not have link or fails to acknowledge the read transaction. Writes to the register have no effect. <b>In addition, the status of the two PHYs specified in the MDIOUSERPHYSELn registers can be determined using the MLINK input pins. This is determined by the LINKSEL bit in the MDIOUSERPHYSELn register.</b>
</p><p>The LINKSEL (Link status determination select) bit  in  MDIOUSERPHYSELn register determines link status using the MLINK pin by setting to 1. Default value is 0 which implies that the link status is determined by the MDIO state machine.
</p><p>pr1_mii0_rxlink/pr1_mii1_rxlink pin of PRU-ICSS, which connects to  PHY LED_LINK/LED_SPEED pin is connected as MLINK signal to MDIO and in enhanced link detection mode MDIO directly uses MLINK signal to detect the link status from PHY. MDIO state machine based detection is very slow - slow serial link for messaging from MDIO controller to PHYs - this  typically takes around 200-250us for PHYs. MLINK/mii_rxlink detection as fast as PHY can toggle this link – with special settings TI PHYs can detect link within 10us, depending on the PHY strap settings link polarity will be different for different boards and needs to adjusted per board by reading MDIOLINK register, also insure to set PHY LED_LINK/LED_SPEED mode as 'LINK_OK' in stead of 'RX/TX Activity' to prevent link detection failure from RX/TX activity.
</p>
<h3><span class="mw-headline" id="bsp_pruss_mdio_phy_read">bsp_pruss_mdio_phy_read</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=86" title="Edit section: bsp pruss mdio phy read">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Int16 bsp_pruss_mdio_phy_read (Uint8 phyaddr, Uint8 regoffset, Uint16 *regval);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>phyaddr: Select the PHY to read using PHY address</li>
<li>regoffset: Register offset in PHY to read
<ul><li>regval: Pointer to the variable to hold the register value read</li></ul></li>
<li>Return value: 0&#160;: Success -1&#160;: MDIO access error</li></ul>
<p><b>Description</b> API to read PHY register via PRU-ICSS MDIO
</p>
<h3><span class="mw-headline" id="bsp_pruss_mdio_phy_write">bsp_pruss_mdio_phy_write</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=87" title="Edit section: bsp pruss mdio phy write">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Int16 bsp_pruss_mdio_phy_write (Uint8 phyaddr, Uint8 regoffset, Uint16 regval);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>phyaddr: Select the PHY to write using PHY address</li>
<li>regoffset: Register offset in PHY to read</li>
<li>regval: Value to write to the PHY register</li>
<li>Return value: 0&#160;: Success -1&#160;: MDIO access error</li></ul>
<p><b>Description</b> API to write PHY register via PRU-ICSS MDIO
</p>
<h3><span class="mw-headline" id="bsp_pruss_mdio_phy_link_state">bsp_pruss_mdio_phy_link_state</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=88" title="Edit section: bsp pruss mdio phy link state">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint8 bsp_pruss_mdio_phy_link_state (Uint8 phyaddr);  <b>//Till 1.1.0.4</b>
</pre>
<p><b>Function</b>
</p>
<pre>  <b>Uint32</b> bsp_pruss_mdio_phy_link_state (Uint8 phyaddr);  <b>//From 1.1.0.5</b>
</pre>
<p><br />
<br /> <b>Parameters</b>
</p>
<ul><li>phyaddr: Select the PHY for link status</li>
<li>Return value: 0: Link Down Otherwise: Link Up</li></ul>
<p><b>Description</b> Get the link status for selected PHY, this API considers MII_link signal polarity differences and recommended when TIESC_MDIO_RX_LINK_ENABLE is enabled for enhanced link detection
</p><p><br />
</p>
<h2><span class="mw-headline" id="PRU-ICSS_DIGIO_host_side_APIs">PRU-ICSS DIGIO host side APIs</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=89" title="Edit section: PRU-ICSS DIGIO host side APIs">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>These APIs are added to support PDI ISR output to external SOC pin (via one of the 8 PRU-ICSS digio outputs). However they can be used as generic GPIO pin from host side.
PRU side access is obviously way faster. PDI ISR pin can be selected via vendor specific register @ 0xE0A
</p>
<h3><span id="void_bsp_set_digio_sw_dataout_enable_(void)"></span><span class="mw-headline" id="void_bsp_set_digio_sw_dataout_enable_.28void.29">void bsp_set_digio_sw_dataout_enable (void)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=90" title="Edit section: void bsp set digio sw dataout enable (void)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_set_digio_sw_dataout_enable (void);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Configure digio for sw controlled dataout mode
</p><p><br />
</p>
<h3><span id="void_bsp_set_digio_out_(Uint8_num)"></span><span class="mw-headline" id="void_bsp_set_digio_out_.28Uint8_num.29">void bsp_set_digio_out (Uint8 num)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=91" title="Edit section: void bsp set digio out (Uint8 num)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   void bsp_set_digio_out (Uint8 num);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>num: digital output selection (num=0..7)</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Set selected digital output pin
</p>
<h3><span id="void_bsp_clear_digio_out_(Uint8_num)"></span><span class="mw-headline" id="void_bsp_clear_digio_out_.28Uint8_num.29">void bsp_clear_digio_out (Uint8 num)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=92" title="Edit section: void bsp clear digio out (Uint8 num)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   void bsp_clear_digio_out (Uint8 num);
</pre>
<p><b>Parameters</b>
</p>
<ul><li>num: digital output selection (num=0..7)</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Clear selected digital output pin
</p><p><br />
</p>
<h2><span id="Spinlock_APIs_for_concurrent_Host/Firmware_shared_memory_access"></span><span class="mw-headline" id="Spinlock_APIs_for_concurrent_Host.2FFirmware_shared_memory_access">Spinlock APIs for concurrent Host/Firmware shared memory access</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=93" title="Edit section: Spinlock APIs for concurrent Host/Firmware shared memory access">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>AM335x spinlock infrastructure is used to synchronize firmware and host when DC latch time stamp registers are updated by firmware and host reads them in parallel
</p>
<h3><span class="mw-headline" id="bsp_hwspinlock_init">bsp_hwspinlock_init</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=94" title="Edit section: bsp hwspinlock init">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p><p><br />
</p>
<pre>   void bsp_hwspinlock_init (void)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Initialize SOC spinlock, enable clocks and init spinlock instance 0 through 7 to unlocked state
</p>
<h3><span class="mw-headline" id="bsp_hwspinlock_lock">bsp_hwspinlock_lock</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=95" title="Edit section: bsp hwspinlock lock">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p><p><br />
</p>
<pre>   Uint32 bsp_hwspinlock_lock (int num)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>num: Spinlock instance(0:&#160;DC&#160;latch 2:&#160;SM2 3:&#160;SM3 4:&#160;SM4 5:&#160;SM5 6: SM6 7:&#160;SM7) <b>//Upto 1.1.0.6</b></li>
<li>num: Spinlock instance(0:&#160;DC&#160;latch ) <b>//From 1.1.0.8</b></li>
<li>Return value: 0: success 1: already locked</li></ul>
<p><b>Description</b> Acquire selected spinlock instance
</p>
<h3><span class="mw-headline" id="bsp_hwspinlock_unlock">bsp_hwspinlock_unlock</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=96" title="Edit section: bsp hwspinlock unlock">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p><p><br />
</p>
<pre>   void bsp_hwspinlock_unlock (int num)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>num: Spinlock instance</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Release selected spinlock instance
</p><p><br />
</p>
<h2><span class="mw-headline" id="System_Time_PDI_controlled_APIs">System Time PDI controlled APIs</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=97" title="Edit section: System Time PDI controlled APIs">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Enable DC feature of system time compensation via PDI interface instead of ECAT interface for synchronizing two independent EtherCAT networks
</p>
<h3><span class="mw-headline" id="bsp_pdi_write_system_time">bsp_pdi_write_system_time</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=98" title="Edit section: bsp pdi write system time">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_write_system_time (Uint32 systime);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>systime: 32-bit system time value</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Write 32-bit system time to firmware to trigger drift compensation
</p>
<h3><span class="mw-headline" id="bsp_pdi_write_system_timeoffset">bsp_pdi_write_system_timeoffset</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=99" title="Edit section: bsp pdi write system timeoffset">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_write_system_timeoffset (unsigned long long systime)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>systime: 64-bit system time offset value</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Write 64-bit System Time Offset (0x920) register and indicate to the firmware
</p>
<h3><span class="mw-headline" id="bsp_pdi_write_systime_delay">bsp_pdi_write_systime_delay</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=100" title="Edit section: bsp pdi write systime delay">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_write_systime_delay(Uint32 systime);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>systime: 32-bit system time delay value</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Write 32-bit System Time Delay (0x928) register
</p>
<h3><span class="mw-headline" id="bsp_pdi_write_filterconfig">bsp_pdi_write_filterconfig</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=101" title="Edit section: bsp pdi write filterconfig">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_write_filterconfig (Uint16 speedcount_start, Uint8 speedcount_filtdepth, Uint8 systime_filtdepth)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>speedcount_start: 16-bit Speed Counter Start value  at (0x930)</li>
<li>speedcount_filtdepth: Filter depth 0-16 (0x935)</li>
<li>systime_filtdepth:  Filter depth 0-16 (0x934)</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Initialize the System Time and SpeedCounter Diff filters from PDI side
</p><p><br />
<big><b><i>NOTE&#160;: Following APIs are not available in Industrial SDK 1.1</i></b></big>
</p>
<h3><span class="mw-headline" id="bsp_pdi_latch0_control">bsp_pdi_latch0_control</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=102" title="Edit section: bsp pdi latch0 control">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_latch0_control(PRUICSS_Handle pruIcssHandle, Uint8 val)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>val: Bitmask to enable singleshot mode [Bit0&#160;: posedge Bit1: negedge]</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Enable latch single shot/continuous mode for Latch0 via PDI interface
If bit is clear latch will be configured in continuous mode
</p>
<h3><span class="mw-headline" id="bsp_pdi_latch1_control">bsp_pdi_latch1_control</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=103" title="Edit section: bsp pdi latch1 control">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_pdi_latch1_control(PRUICSS_Handle pruIcssHandle, Uint8 val)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>val: Bitmask to enable singleshot mode [Bit0&#160;: posedge Bit1: negedge]</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Enable latch single shot/continuous mode for Latch1 via PDI interface
</p><p>If bit is clear latch will be configured in continuous mode
</p>
<h2><span class="mw-headline" id="Timer_APIs_for_EtherCAT_stack">Timer APIs for EtherCAT stack</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=104" title="Edit section: Timer APIs for EtherCAT stack">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><b>IMPORTANT NOTE on USE_ECAT_TIMER</b>
</p><p>There are 2 options for time base. If USE_ECAT_TIMER is defined in tiescbsp.h, ESC timebase is used otherwise SYS/BIOS API "Timestamp_get32" is used. For "Timestamp_get32" make sure to select the same in SYS/BIOS config file
</p>
<h3><span class="mw-headline" id="bsp_get_timer_register">bsp_get_timer_register</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=105" title="Edit section: bsp get timer register">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint32 bsp_get_timer_register(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: 32-bit time elapsed since last call to bsp_clear_timer_register</li></ul>
<p><b>Description</b> Returns the time difference from last call of "bsp_clear_timer_register" to this "bsp_get_timer_register". handles overflow
</p>
<h3><span class="mw-headline" id="bsp_clear_timer_register">bsp_clear_timer_register</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=106" title="Edit section: bsp clear timer register">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_clear_timer_register(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Update the time when "bsp_clear_timer_register" last invoked.This is a wrapper API used by SSC. Implemented using SYS/BIOS API
</p><p><br />
</p>
<h3><span class="mw-headline" id="HW_GetTimer">HW_GetTimer</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=107" title="Edit section: HW GetTimer">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  unsigned int HW_GetTimer()
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: 32-bit time elapsed since last call to HW_ClearTimer</li></ul>
<p><b>Description</b> Returns the time difference from last call of "HW_ClearTimer" to this "HW_GetTimer". handles overflow. This is a wrapper API used by SSC.
</p>
<h3><span class="mw-headline" id="HW_ClearTimer">HW_ClearTimer</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=108" title="Edit section: HW ClearTimer">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_ClearTimer(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Update the time when "HW_ClearTimer" last invoked.This is a wrapper API used by SSC.
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_get_local_sys_time">bsp_get_local_sys_time</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=109" title="Edit section: bsp get local sys time">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   void bsp_get_local_sys_time(Uint32 *systime_low, Uint32 *systime_high);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>Pointers to store system time low (32-bit LSW) and system time high (32-bit MSW)</li>
<li>Return value: 64-bit local system time from EtherCAT slave (nanosec resolution)</li></ul>
<p><b>Description</b> Return EtherCAT time base for application use
</p>
<h3><span class="mw-headline" id="bsp_get_latch0_posedge_time">bsp_get_latch0_posedge_time</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=110" title="Edit section: bsp get latch0 posedge time">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   void bsp_get_latch0_posedge_time (Uint32 *systime_low, Uint32 *systime_high)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>Pointers to store latch0 posedge low (32-bit LSW) and latch0 posedge high (32-bit MSW)</li>
<li>Return value: 64-bit latch0 posedge timestamp from EtherCAT slave (nanosec resolution)</li></ul>
<p><b>Description</b> Return latch0 posedge timestamp for application use
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_get_latch1_posedge_time">bsp_get_latch1_posedge_time</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=111" title="Edit section: bsp get latch1 posedge time">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   void bsp_get_latch1_posedge_time (Uint32 *systime_low, Uint32 *systime_high)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>Pointers to store latch1 posedge low (32-bit LSW) and latch1 posedge high (32-bit MSW)</li>
<li>Return value: 64-bit latch1 posedge timestamp from EtherCAT slave (nanosec resolution)</li></ul>
<p><b>Description</b> Return latch1 posedge timestamp for application use
</p>
<h3><span class="mw-headline" id="bsp_get_latch0_negedge_time">bsp_get_latch0_negedge_time</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=112" title="Edit section: bsp get latch0 negedge time">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   void bsp_get_latch0_negedge_time (Uint32 *systime_low, Uint32 *systime_high)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>Pointers to store latch0 negedge low (32-bit LSW) and latch0 negedge high (32-bit MSW)</li>
<li>Return value: 64-bit latch0 negedge timestamp from EtherCAT slave (nanosec resolution)</li></ul>
<p><b>Description</b> Return latch0 negedge timestamp for application use
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_get_latch1_negedge_time">bsp_get_latch1_negedge_time</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=113" title="Edit section: bsp get latch1 negedge time">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>   void bsp_get_latch1_negedge_time (Uint32 *systime_low, Uint32 *systime_high)
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>Pointers to store latch1 negedge low (32-bit LSW) and latch1 negedge high (32-bit MSW)</li>
<li>Return value: 64-bit latch1 negedge timestamp from EtherCAT slave (nanosec resolution)</li></ul>
<p><b>Description</b> Return latch1 negedge timestamp for application use
</p><p><br />
</p>
<h2><span class="mw-headline" id="Mutex_APIs_for_EtherCAT_stack">Mutex APIs for EtherCAT stack</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=114" title="Edit section: Mutex APIs for EtherCAT stack">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="bsp_global_mutex_lock">bsp_global_mutex_lock</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=115" title="Edit section: bsp global mutex lock">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_global_mutex_lock (void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Critical section enter API using semaphore/mutex/interrupt disable primitives from RTOS. Implemented using SYS/BIOS API "GateAll_enter" in SDK
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_global_mutex_unlock">bsp_global_mutex_unlock</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=116" title="Edit section: bsp global mutex unlock">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_global_mutex_unlock (void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Critical section leave API using semaphore/mutex/interrupt enable primitives from RTOS. Implemented using SYS/BIOS API "GateAll_leave" in SDK
</p><p><br />
</p>
<h2><span class="mw-headline" id="Interrupt_management_APIs_for_EtherCAT_stack">Interrupt management APIs for EtherCAT stack</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=117" title="Edit section: Interrupt management APIs for EtherCAT stack">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="HW_ResetALEventMask">HW_ResetALEventMask</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=118" title="Edit section: HW ResetALEventMask">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_ResetALEventMask(Uint16 intMask);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>intMask: AL event mask</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Reset AL event mask in AL event mask register (0x204), write AND of intMask and current AL event mask value to AL event mask register
</p><p><b>Invokes</b>
</p>
<ul><li>HW_EscReadWord</li>
<li>HW_EscWriteWord</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_SetALEventMask">HW_SetALEventMask</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=119" title="Edit section: HW SetALEventMask">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_SetALEventMask(Uint16 intMask);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>intMask: AL event mask</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Set AL event mask in AL event mask register (0x204), write OR of intMask and current AL event mask value to AL event mask register
</p><p><b>Invokes</b>
</p>
<ul><li>HW_EscReadWord</li>
<li>HW_EscWriteWord</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_GetALEventMask">HW_GetALEventMask</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=120" title="Edit section: HW GetALEventMask">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint16 HW_GetALEventMask(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>None</li>
<li>Return value: Current AL event mask</li></ul>
<p><b>Description</b> Return the current AL event mask used in Stack
</p><p><br />
</p>
<h3><span class="mw-headline" id="HW_EcatIsr_or_PDI_Isr">HW_EcatIsr or PDI_Isr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=121" title="Edit section: HW EcatIsr or PDI Isr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void PDI_Isr/HW_EcatIsr (void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>None</li>
<li>None</li></ul>
<p><b>Description</b> PDI IRQ handler in the EtherCAT slave stack
</p><p><br />
</p>
<h3><span class="mw-headline" id="Sync0_Isr">Sync0_Isr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=122" title="Edit section: Sync0 Isr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void Sync0_Isr (void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>None</li>
<li>None</li></ul>
<p><b>Description</b> SYNC0 IRQ handler in the EtherCAT slave stack
</p><p><br />
</p>
<h3><span class="mw-headline" id="Sync1_Isr">Sync1_Isr</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=123" title="Edit section: Sync1 Isr">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void Sync1_Isr (void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>None</li>
<li>None</li></ul>
<p><b>Description</b> SYNC1 IRQ handler in the EtherCAT slave stack
</p><p><br />
</p>
<h2><span class="mw-headline" id="Misc_APIs_for_SSC">Misc APIs for SSC</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=124" title="Edit section: Misc APIs for SSC">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="HW_Init">HW_Init</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=125" title="Edit section: HW Init">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  Uint8 HW_Init(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: Zero</li></ul>
<p><b>Description</b> Initializes EtherCAT slave interface by calling bsp_init. Wait for firmware to be ready. Reset AL event mask. Register PDI and SYNC interrupt handlers. Disables all SyncManagers
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_init</li>
<li>HW_EscReadWord</li>
<li>HW_ResetALEventMask</li>
<li>HW_DisableSyncManChannel</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_Release">HW_Release</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=126" title="Edit section: HW Release">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_Release(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Wrapper API for bsp_exit, delete RTOS resources, flush ESI EEPROM, disable PRUs
</p><p><b>Invokes</b>
</p>
<ul><li>bsp_exit</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="HW_RestartTarget">HW_RestartTarget</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=127" title="Edit section: HW RestartTarget">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_RestartTarget(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Perform the WARM RST of AM335x
</p><p><b>IMPORTANT NOTE</b>
</p><p>This will result in application state to be lost and disrupt ongoing EtherCAT communication. Typical use is to upgrade the EtherCAT firmware
</p><p><br /> <br />
</p>
<h3><span class="mw-headline" id="HW_SetLed">HW_SetLed</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=128" title="Edit section: HW SetLed">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void HW_SetLed(Uint8 RunLed, Uint8 ErrLed);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>RunLed: 1&#160;: on 0&#160;: off</li>
<li>ErrLed: 1&#160;: on 0&#160;: off</li>
<li>Return value: none</li></ul>
<p><b>Description</b> API to control onboard Run and ERR LEDs
</p><p><b>Invokes</b>
</p>
<ul><li>set_run_led</li>
<li>reset_run_led</li>
<li>set_error_led</li>
<li>reset_error_led</li></ul>
<p><br /> <br />
</p>
<h2><span class="mw-headline" id="PRU_firmware_header_mapping_API">PRU firmware header mapping API<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=129" title="Edit section: PRU firmware header mapping API">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="bsp_set_pru_firmware">bsp_set_pru_firmware</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=130" title="Edit section: bsp set pru firmware">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>ARM Applications running on TI AM335x ICE develoment board can load firmwares for PRUs from SPI flash using binary files or from header files built as part of these applications. This API is mandatory to specify the PRU firmware array address to application if firmware header files are used.
</p><p><b>Function</b>
</p>
<pre>  void bsp_set_pru_firmware(Uint32* frameProc,Uint32 frameProcLen,
               Uint32* hostProc,Uint32 hostProcLen);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>frameProc - Pointer to a buffer containing HRT PRU firmware (ecat_frame_handler_bin.h)</li>
<li>frameProcLen - Size of the HRT PRU firmware</li>
<li>hostProc - Pointer to a buffer containing SRT PRU firmware (ecat_host_interface_bin.h)</li>
<li>hostProcLen - Size of the SRT PRU firmware</li>
<li>Return value: none</li></ul>
<p><b>Description</b> This function internally sets the location from which PRU firmwares can be loaded.<b>If this API is not called, Application will try to load PRU firmwares from SPI flash.</b>
</p><p><br />
</p>
<h2><span class="mw-headline" id="Firmware_Upgrade_APIs_for_EtherCAT_stack">Firmware Upgrade APIs for EtherCAT stack<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=131" title="Edit section: Firmware Upgrade APIs for EtherCAT stack">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>EtherCAT application supports runtime firmware upgrade. This functionality can be enabled/disabled by defining/undefining ENABLE_ONLINE_FIRMWARE_UPGRADE macro in tiesbsp.h
</p>
<h3><span class="mw-headline" id="bsp_start_fw_download">bsp_start_fw_download</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=132" title="Edit section: bsp start fw download">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_start_fw_download(Uint32 password);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>password: password received from master</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Called by EtherCAT stack when a firmware download command is received from EtherCAT master
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_store_fw_data">bsp_store_fw_data</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=133" title="Edit section: bsp store fw data">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_store_fw_data(Uint16 *pData,Uint16 Size);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>pData: Pointer to data buffer</li>
<li>Size: Number of bytes received</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Stores the received data as part of firmware download from EtherCAT master. This may get called multiple times during firmware download. This function performs SPI flash writes for every 256-bytes received from master.
</p><p><br />
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_boot_2_init_handler">bsp_boot_2_init_handler</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=134" title="Edit section: bsp boot 2 init handler">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_boot_2_init_handler();
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>None</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Initiates the Application restart when EtherCAT state is changed from BOOTSTRAP to INIT after application update using FoE protocol. This function performs SPI flash write for remaining bytes in receive data buffer once firmware download is finished by EtherCAT master
</p><p><br />
</p>
<h2><span class="mw-headline" id="TLK110_PHY_configuration_APIs">TLK110 PHY configuration APIs<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=135" title="Edit section: TLK110 PHY configuration APIs">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>These APIs are used to configure Texas Instruments TLK110 phy and variants.
</p><p>Please note that these API are PHY specific and are only for the use of TLK105/106/110 Phys.
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_tlk110_init">bsp_tlk110_init</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=136" title="Edit section: bsp tlk110 init">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_tlk110_init(Uint8 phy0addr, Uint8 phy1addr, Uint8 enhancedlink_enable);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>phy0addr: Phy address of port0</li>
<li>phy1addr: Phy address of port1</li>
<li>enhancedlink_enable: Fast link detect (enhanced link detection) enable/disable flag</li>
<li>Return value: none</li></ul>
<p><b>Description</b>&#160;This API configures port0 and port1 phys for enhanced link detection, enable RXERR detection during IDLE, disable detection of transmit error in odd-nibble boundary (for odd nibble insertion) and fast RXDV detection. This is called only during initialization.
</p><p><br />
</p>
<h3><span class="mw-headline" id="bsp_tlk110_configure_automdix">bsp_tlk110_configure_automdix</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=137" title="Edit section: bsp tlk110 configure automdix">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void bsp_tlk110_configure_automdix(Uint8 phy0addr, Uint8 phy1addr);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>phy0addr: Phy address of port0</li>
<li>phy1addr: Phy address of port1</li>
<li>Return value: none</li></ul>
<p><b>Description</b> This API enables port0 and port1 phys with auto-negotiation and auto MDIX capability.
</p><p><br />
</p>
<h1><span class="mw-headline" id="PRU-ICSS_interrupt_controller_setup_for_EtherCAT_firmware">PRU-ICSS interrupt controller setup for EtherCAT firmware</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=138" title="Edit section: PRU-ICSS interrupt controller setup for EtherCAT firmware">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>PRU-ICSS subsystem has got a dedicated INTC which actually takes various system events and map it to PRUs and Host processor (max 8 interrupts).
</p><p>SYS_EVT_16-31 is reserved for generating interrupts for IPC with Host and PRU-ICSS
</p><p>For EtherCAT, INTC initialization and setup is performed by TI ESC HAL driver on ARM side using PRU-ICSS driver API - "prussdrv_pruintc_init"
</p><p><b>Various ICSS events of interest to EtherCAT firmware and their mapping to different SOC cores (A8/PRU0/PRU1) are defined below</b>
</p>
<pre>   sdk/protocols/ethercat/ecat_appl/src/tiesc_pruss_intc_mapping.h
</pre>
<p><b>IMPORTANT NOTE</b>
</p><p>Users shall not modify the above header as it is tightly coupled with Industrial fieldbus protocol implemented using PRU-ICSS
</p><p>EtherCAT firmware and stack/application uses following interrupts
</p><p><b>Stack/application interrupts</b>
</p><p><b>SYNC0_OUT_EVENT -&gt; PRU_EVTOUT0</b> (PRU2ARM interrupt0) - Used in DC mode for syncing the host app
</p><p><b>SYNC1_OUT_EVENT -&gt; PRU_EVTOUT1</b> (PRU2ARM interrupt1) - Used in DC mode for syncing the host app
</p><p><b>PRU2ARM_EVENT0 -&gt; PRU_EVTOUT3</b> (PRU2ARM interrupt3) - AL event interrupt to host stack
</p><p><b>Host-PRU-ICSS IPC interrupts</b>
</p><p><b>ARM2PRU_EVENT0 -&gt; PRU1</b> (Command high indication to SRT PRU which does host command handling)
</p><p><b>ARM2PRU_EVENT1 -&gt; PRU1</b> (Command low indication to SRT PRU which does host command handling)
</p><p><b>PRU2ARM_EVENT1 -&gt; PRU_EVTOUT2</b> (PRU2ARM interrupt2) - Generated from PRU for acknowledging the command high
</p><p><b>PRU2ARM_EVENT2 -&gt; PRU_EVTOUT4</b> (PRU2ARM interrupt4) - Generated from PRU for acknowledging the command low
</p><p><br /> <b>IMPORTANT NOTE: Configuring PRU-ICSS INTC for TI ESC HAL - HW_Init() does all this when invoked by application</b>
</p>
<pre>tpruss_intc_initdata pruss_intc_initdata = PRUSS_INTC_INITDATA;
prussdrv_pruintc_init(&amp;pruss_intc_initdata);
//load PRU firmware
bsp_start_esc_isr();
</pre>
<p>The above API sets up interrupt mapping for EtherCAT firmware and stack in PRUSS-INTC. Stack needs to register for interrupts, it needs to handle now
</p><p>if <b>ENABLE_PDI_TASK</b> and <b>ENABLE_SYNC_TASK</b> are defined in tiescbsp.h, PDI and SYNC0 ISR processing will happen in SYS/BIOS task context. Helps to reduce processing in interrupt context.
</p><p>In this mode, PRU-ICSS interrupt handler (implemented in sdk\os_drivers\src\pruss_drv.c) will post a semaphore and application task will wait on semaphore to handle those interrupts.
</p><p><br />
</p><p><br />
</p>
<pre>/**
* \brief  This function Registers an Interrupt Handler for an ARM Side event.\n
*
* \param   pruEvtoutNum   The ARM side event number.\n
* \param	waitEnable     Flag specifying whether application can wait on this interrupt
* 						   using PRUSSDRVPruWaitEvent function
* \param   irqHandler     Pointer to a function which will be called on interrupt.\n
*
* \return  0 in case of successful registration, -1 otherwise. \n
*/
PRUSSDRVRegisterIrqHandler(HOST_AL_EVENT, 1, &amp;EcatIsr);
PRUSSDRVRegisterIrqHandler(HOST_SYNC0_EVENT, 1, &amp;Sync0Isr);
</pre>
<p><br />
</p>
<pre>/**
* \brief  This function waits for a Syatem event to happen \n
*
* \param   eventnum   The AINTC Event number.\n
*
* \return  0 in case of successful transition, -1 otherwise. \n
*/
PRUSSDRVPruWaitEvent(HOST_AL_EVENT);
PRUSSDRVPruWaitEvent(HOST_SYNC0_EVENT);
</pre>
<p>Application needs to implement tasks for ISR processing, refer to sdk\protocols\ethercat_slave\ecat_appl\EcatStack\tiescappl.c for more details
</p><p><b>For example: </b>
</p><p><br />
</p>
<pre>void HW_EcatIsr(void)
{
/* get the AL event register */
PDI_Isr();
}
</pre>
<pre>Void PDItask(UArg arg1, UArg arg2)
{
while(1)
{
  PRUSSDRVPruWaitEvent(HOST_AL_EVENT);
  /* ISR processing */
  HW_EcatIsr();
}
}
</pre>
<pre>Void Sync0task(UArg arg1, UArg arg2)
{
while(1)
{
  PRUSSDRVPruWaitEvent(HOST_SYNC0_EVENT);
  //Do sync0 event handling
  Sync0_Isr();
}
}
</pre>
<p><br /> if <b>ENABLE_PDI_TASK</b> and <b>ENABLE_SYNC_TASK</b> are NOT defined in tiescbsp.h, PDI and SYNC0 ISR processing will happen in SYS/BIOS HWI context. This is similar to SSC architecture.
</p><p>PRU-ICSS interrupt handler (implemented in sdk\os_drivers\src\pruss_drv.c) won't post a semaphore as there is no task required to handle those interrupts.
</p><p><br />
</p>
<pre>PRUSSDRVRegisterIrqHandler(HOST_AL_EVENT, 0, &amp;EcatIsr); //Note that second argument is zero
PRUSSDRVRegisterIrqHandler(HOST_SYNC0_EVENT, 0, &amp;Sync0Isr); //Note that second argument is zero
</pre>
<p>Directly call PDI ISR handling function (PDI_Isr) of EtherCAT stack from EcatIsr function in tiescbsp.c
</p><p>Directly call SYNC0 ISR handling function (Sync0_Isr) of EtherCAT stack from Sync0Isr function in tiescbsp.c
</p>
<h1><span class="mw-headline" id="Firmware_Update">Firmware Update</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=139" title="Edit section: Firmware Update">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>PRU Firmware is available in header file format and binary file format as part of SDK releas in the folder sdk\protocols\ethercat\firmware.
</p><p>To update the firmware, one needs to rebuild the EtherCAT sample application with new version of headers before flashing the application.
</p><p>Flashing the standalone firmware is also supported in SDK, refer to IRAM build configuration (EXEC_FROM_IRAM)and SDK user guide for more information.
</p><p>Firmware revision is available in ESC registers shown below
</p><p><br />
</p>
<pre>  <b>Revision (0x0001)</b>
1: For PRUSS v2 h/w supporting ESC
</pre>
<pre>  <b>Build (0x0002:0x0003)</b>
Minor number @0x2
Major number @0x3
</pre>
<table width="200" cellspacing="1" cellpadding="1" border="1">

<tbody><tr>
<td><b>Industrial SDK &#160;release&#160;</b>
</td>
<td><b>AM335 firmware build</b>
</td>
<td><b>AM437 firmware build</b>
</td></tr>
<tr>
<td>1.0.0.4
</td>
<td>1.1.11
</td>
<td>NA
</td></tr>
<tr>
<td>1.0.0.5
</td>
<td>1.2.38
</td>
<td>NA
</td></tr>
<tr>
<td>1.0.0.6
</td>
<td>1.2.58
</td>
<td>NA
</td></tr>
<tr>
<td>1.0.0.7
</td>
<td>1.2.78
</td>
<td>NA
</td></tr>
<tr>
<td>1.0.0.8
</td>
<td>1.2.96
</td>
<td>NA
</td></tr>
<tr>
<td>1.0.0.9
</td>
<td>1.3.124
</td>
<td>NA
</td></tr>
<tr>
<td>1.1.0.1
</td>
<td>1.3.134
</td>
<td>NA
</td></tr>
<tr>
<td>1.1.0.3
</td>
<td>1.3.138
</td>
<td>NA
</td></tr>
<tr>
<td>1.1.0.4
</td>
<td>1.3.140
</td>
<td>NA
</td></tr>
<tr>
<td>1.1.0.5
</td>
<td>1.3.154
</td>
<td>NA
</td></tr>
<tr>
<td>2.0.0.2
</td>
<td>NA
</td>
<td>2.3.154
</td></tr>
<tr>
<td>1.1.0.6
</td>
<td>1.3.155
</td>
<td>NA
</td></tr>
<tr>
<td>1.1.0.8
</td>
<td>1.3.175
</td>
<td>NA
</td></tr>
<tr>
<td>2.1.0.1
</td>
<td>1.3.179
</td>
<td>2.3.179
</td></tr>
<tr>
<td>2.1.1.2
</td>
<td>1.3.203
</td>
<td>2.3.203
</td></tr>
<tr>
<td>1.1.0.10
</td>
<td>1.3.203
</td>
<td>NA
</td></tr>
<tr>
<td>1.1.1.1
</td>
<td>1.3.215
</td>
<td>NA
</td></tr>
<tr>
<td>2.1.2.2
</td>
<td>1.3.227
</td>
<td>2.3.227
</td></tr>
<tr>
<td>1.1.2.1
</td>
<td>1.3.227
</td>
<td>NA
</td></tr>
<tr>
<td>2.1.3.2
</td>
<td>1.3.229
</td>
<td>NA
</td></tr></tbody></table>
<h1><span class="mw-headline" id="PRU-ICSS_EtherCAT_Register_List">PRU-ICSS EtherCAT Register List</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=140" title="Edit section: PRU-ICSS EtherCAT Register List">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p><a rel="nofollow" class="external text" href="PRU_ICSS_EtherCAT_Slave_Controller_Register_List.html">PRU_ICSS_EtherCAT_Slave_Controller_Register_List</a>
</p>
<h1><span id="AM335x/AM437x_SOC_pins_used_for_EtherCAT_functionality"></span><span class="mw-headline" id="AM335x.2FAM437x_SOC_pins_used_for_EtherCAT_functionality">AM335x/AM437x SOC pins used for EtherCAT functionality</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=141" title="Edit section: AM335x/AM437x SOC pins used for EtherCAT functionality">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<table width="400" border="1" cellpadding="5" cellspacing="1">

<tbody><tr>
<td align="center"><b>ICSS pin</b>
</td>
<td colspan="2" align="center">
<p><b>AM335x SOC pad information</b>
<b>15x15 BGA</b>
</p>
</td>
<td align="center">
<p><b>AM437x SOC pad information</b>
</p>
</td>
<td>
</td>
<td align="center"><b>Description</b>
</td></tr>
<tr>
<td colspan="6" align="center"><b>PRU-ICSS MDIO</b>
</td></tr>
<tr>
<td>pr1_mdio_mdclk
</td>
<td colspan="2">V12
</td>
<td>A12
</td>
<td>Mandatory
</td>
<td>MDIO clock
</td></tr>
<tr>
<td>pr1_mdio_data
</td>
<td colspan="2">T13
</td>
<td>D24
</td>
<td>Mandatory
</td>
<td>MDIO data
</td></tr>
<tr>
<td colspan="6" align="center"><b>PRU-ICSS MII PORT0</b>
</td></tr>
<tr>
<td>
</td>
<td>Option1
</td>
<td>Option2
</td>
<td>
</td>
<td>
</td>
<td>
</td></tr>
<tr>
<td>pr1_mii_mt0_clk
</td>
<td>U10
</td>
<td>R1
</td>
<td>B22
</td>
<td>Mandatory
</td>
<td>MII0 transmit clock
</td></tr>
<tr>
<td>pr1_mii0_txd3
</td>
<td>U12
</td>
<td>R3
</td>
<td>B21
</td>
<td>Mandatory
</td>
<td>MII0 transmit data3
</td></tr>
<tr>
<td>pr1_mii0_txd2
</td>
<td>T12
</td>
<td>R4
</td>
<td>C21
</td>
<td>Mandatory
</td>
<td>MII0 transmit data2
</td></tr>
<tr>
<td>pr1_mii0_txd1
</td>
<td>R12
</td>
<td>T1
</td>
<td>A20
</td>
<td>Mandatory
</td>
<td>MII0 transmit data1
</td></tr>
<tr>
<td>pr1_mii0_txd0
</td>
<td>V13
</td>
<td>T2
</td>
<td>B20
</td>
<td>Mandatory
</td>
<td>MII0 transmit data0
</td></tr>
<tr>
<td>pr1_mii0_rxd3
</td>
<td>U1
</td>
<td>U5*<br />
</td>
<td>A19
</td>
<td>Mandatory
</td>
<td>MII0 receive data3
</td></tr>
<tr>
<td>pr1_mii0_rxd2
</td>
<td>U2
</td>
<td>R5*<br />
</td>
<td>B19
</td>
<td>Mandatory
</td>
<td>MII0 receive data2
</td></tr>
<tr>
<td>pr1_mii0_rxd1
</td>
<td>U3
</td>
<td>V5*<br />
</td>
<td>A18
</td>
<td>Mandatory
</td>
<td>MII0 receive data1
</td></tr>
<tr>
<td>pr1_mii0_rxd0
</td>
<td>U4
</td>
<td>R6*<br />
</td>
<td>B18
</td>
<td>Mandatory
</td>
<td>MII0 receive data0
</td></tr>
<tr>
<td>pr1_mii0_txen
</td>
<td>T11
</td>
<td>R2
</td>
<td>A21
</td>
<td>Mandatory
</td>
<td>MII0 TX enable
</td></tr>
<tr>
<td>pr1_mii_mr0_clk
</td>
<td>V4
</td>
<td><br />
</td>
<td>C17
</td>
<td>Mandatory
</td>
<td>MII0 receive clock
</td></tr>
<tr>
<td>pr1_mii0_rxdv
</td>
<td>T5
</td>
<td><br />
</td>
<td>D17
</td>
<td>Mandatory
</td>
<td>MII0 RX data valid
</td></tr>
<tr>
<td>pr1_mii0_rxer
</td>
<td>V3
</td>
<td><br />
</td>
<td>D19
</td>
<td>Mandatory
</td>
<td>MII0 RX ERR
</td></tr>
<tr>
<td>pr1_mii0_rxlink
</td>
<td>V2
</td>
<td><br />
</td>
<td>C19
</td>
<td>Recommended
</td>
<td align="left">Enhanced link detection<sup>**</sup>/Redundancy support - connect LED_LINK/LED_SPEED from PHY here<br />
</td></tr>
<tr>
<td colspan="6" align="center"><b>PRU-ICSS MII PORT1</b>
</td></tr>
<tr>
<td>pr1_mii_mt1_clk
</td>
<td colspan="2">R13
</td>
<td>E8
</td>
<td>Mandatory
</td>
<td>MII1 transmit clock
</td></tr>
<tr>
<td>pr1_mii1_txd3
</td>
<td colspan="2">V14
</td>
<td>C6
</td>
<td>Mandatory
</td>
<td>MII1 transmit data3
</td></tr>
<tr>
<td>pr1_mii1_txd2
</td>
<td colspan="2">U14
</td>
<td>A4
</td>
<td>Mandatory
</td>
<td>MII1 transmit data2
</td></tr>
<tr>
<td>pr1_mii1_txd1
</td>
<td colspan="2">T14
</td>
<td>D7
</td>
<td>Mandatory
</td>
<td>MII1 transmit data1
</td></tr>
<tr>
<td>pr1_mii1_txd0
</td>
<td colspan="2">R14
</td>
<td>E7
</td>
<td>Mandatory
</td>
<td>MII1 transmit data0
</td></tr>
<tr>
<td>pr1_mii1_rxd3
</td>
<td colspan="2">V15
</td>
<td>F7
</td>
<td>Mandatory
</td>
<td>MII1 receive data3
</td></tr>
<tr>
<td>pr1_mii1_rxd2
</td>
<td colspan="2">U15
</td>
<td>B4
</td>
<td>Mandatory
</td>
<td>MII1 receive data2
</td></tr>
<tr>
<td>pr1_mii1_rxd1
</td>
<td colspan="2">T15
</td>
<td>G8
</td>
<td>Mandatory
</td>
<td>MII1 receive data1
</td></tr>
<tr>
<td>pr1_mii1_rxd0
</td>
<td colspan="2">V16
</td>
<td>D8
</td>
<td>Mandatory
</td>
<td>MII1 receive data0
</td></tr>
<tr>
<td>pr1_mii1_txen
</td>
<td colspan="2">U17
</td>
<td>C3
</td>
<td>Mandatory
</td>
<td>MII1 TX enable
</td></tr>
<tr>
<td>pr1_mii_mr1_clk
</td>
<td colspan="2">U16
</td>
<td>F6
</td>
<td>Mandatory
</td>
<td>MII1 receive clock
</td></tr>
<tr>
<td>pr1_mii1_rxdv
</td>
<td colspan="2">T16
</td>
<td>C5
</td>
<td>Mandatory
</td>
<td>MII1 RX data valid
</td></tr>
<tr>
<td>pr1_mii1_rxer
</td>
<td colspan="2">V17
</td>
<td>B3
</td>
<td>Mandatory
</td>
<td>MII1 RX ERR
</td></tr>
<tr>
<td>pr1_mii1_rxlink
</td>
<td colspan="2">U18
</td>
<td>E24
</td>
<td>Recommended
</td>
<td align="left">Enhanced link detection<sup>**</sup>/Redundancy support - connect LED_LINK/LED_SPEED from PHY here
</td></tr>
<tr>
<td colspan="6" align="center"><b>PRU-ICSS Distributed Clocks (Network clock synchronization)</b>
</td></tr>
<tr>
<td>pr1_edc_sync0_out
</td>
<td colspan="2">E18
</td>
<td>L25
</td>
<td>Recommended (for DC capable slaves)
</td>
<td align="left">SYNC0 out - Time synchronized OUT0
</td></tr>
<tr>
<td>pr1_edc_sync1_out
</td>
<td colspan="2">E17
</td>
<td>G25
</td>
<td>Optional
</td>
<td align="left">SYNC1 out - Time synchronized OUT1 (depends on SYNC0)
</td></tr>
<tr>
<td>pr1_edc_latch0_in
</td>
<td colspan="2">D18
</td>
<td>AE22
</td>
<td>Optional
</td>
<td align="left">LATCH0 in (Time stamp latch input0)
</td></tr>
<tr>
<td>pr1_edc_latch1_in
</td>
<td colspan="2">D17
</td>
<td>AD22
</td>
<td>Optional
</td>
<td align="left">LATCH1 in (Time stamp latch input1)
</td></tr></tbody></table>
<p><br />
</p><p><b>NOTE1:&#160;<sup>*</sup></b>&#160;Via ICSS internal pinmuxing (PRUSSPinMux_Config API from host side)
</p><p><b>NOTE2: <sup>**&#160;</sup></b>Need to enable pmdio_params-&gt;enhancedlink_enable while initializing MDIO (bsp_pruss_mdio_init), default mode in SDK is enabled
</p><p><b>NOTE3:</b>&#160; Refer to&#160;sdk\protocols\ethercat_slave\ecat_appl\EcatStack\ecat_appl_cnfg.h for PINMUX configuration for AM335x ICE/IDK platforms&#160; &#160;
</p><p><br />
</p>
<h1><span class="mw-headline" id="Application_Examples">Application Examples</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=142" title="Edit section: Application Examples">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>For detailed information on EtherCAT&#160;SSC architecture and examples - please refer to Beckhoff documentation mentioned in the references section.
</p><p>EtherCATSampleLibrary.h (public\sdk\protocols\ethercat_slave\include) provides the API to EtherCAT slave stack library from Beckhoff.&#160;
</p><p>This interface allows user to control 32-bit digital I/O interface of AM335x ICE /IDK using an EtherCAT master. Note that this is a limited demo available for evaluation of EtherCAT I/O functionality in ICE/IDK using Industrial SDK and Beckhoff SSC stack library in binary format.
</p>
<h3><span class="mw-headline" id="Ecat_Open">Ecat_Open</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=143" title="Edit section: Ecat Open">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  pECAT_SLAVE_INTERFACE Ecat_Open(unsigned short InputSize, unsigned short OutputSize);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>InputSize - Process data input size<br /></li>
<li>OutputSize - Process data output size</li>
<li>Return value: Pointer to&#160;ECAT_SLAVE_INTERFACE structure on success, NULL Otherwise.</li></ul>
<p><b>Description</b> Initializes Sample application interface of Beckhoff SSC library
</p>
<h3><span class="mw-headline" id="Ecat_OnTimer">Ecat_OnTimer</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=144" title="Edit section: Ecat OnTimer">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void Ecat_OnTimer(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Periodically call this from application to invoke Beckhoff SSC main stack processing function
</p>
<h3><span class="mw-headline" id="Ecat_Close">Ecat_Close</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=145" title="Edit section: Ecat Close">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void Ecat_Close(void);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>none</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Close Sample application interface of Beckhoff SSC library
</p>
<h3><span id="*pApplication"></span><span class="mw-headline" id=".2ApApplication">*pApplication</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=146" title="Edit section: *pApplication">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>Function</b>
</p>
<pre>  void (* pApplication)(unsigned short);
</pre>
<p><br /> <b>Parameters</b>
</p>
<ul><li>outputs_running: If set indicates OP state</li>
<li>Return value: none</li></ul>
<p><b>Description</b> Function pointer to user application which updates 32-bit digital input(u32Input)from slave and act on 32-bit digital output (u32Output) received from EtherCAT master. This is invoked by Sample application interface of Beckhoff SSC library from SYNC0 ISR (DC SYNC mode) or PDI ISR (SM SYNC mode) depending on synchronization mode selected by EtherCAT master. u32Input may be set with value read from 8-bit digital I/O or any predefined pattern. u32output may be used to update digital output LEDs.
</p>
<h2><span class="mw-headline" id="Device_configuration">Device configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=147" title="Edit section: Device configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Lib_mode">Lib mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=148" title="Edit section: Lib mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>TI ESC device description (TiEtherCATLib.xml) used for lib mode application can be found in sdk\examples\ethercat_slave\esi
</p><p>This describes 32-bit digital I/O interface
</p>
<h3><span class="mw-headline" id="Patch_mode">Patch mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=149" title="Edit section: Patch mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>For advanced configuration, user needs to use Bechkoff stack or 3P stack.
</p><p>TI ESC device description (TI_ESC.xml) used for patch mode application can be found in sdk\protocols\ethercat\docs\esi
</p><p>This describes the sample 5-byte process data output 7-byte process data input application configuration.
</p><p>For more details, refer to SDK documentation <a rel="nofollow" class="external autonumber" href="AM335x_SYSBIOS_Industrial_SDK_01.00.00-18.html#EtherCAT">[10]</a>
</p>
<h2><span class="mw-headline" id="SDK_EtherCAT_example_using_Sample_Application_Interface_of_Beckhoff_SSC">SDK EtherCAT example using Sample Application Interface of Beckhoff SSC</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;section=150" title="Edit section: SDK EtherCAT example using Sample Application Interface of Beckhoff SSC">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><b>Usage </b>
</p>
<pre>  /////////////////////////////////////////////////////////////////////////////////////////
/**
\brief    This function will called from the synchronisation ISR
or from the mainloop if no synchronisation is supported
*////////////////////////////////////////////////////////////////////////////////////////
void Demo_Application(unsigned short outputs_running)
{
static Uint8 prevState = 55;
Uint8 LED = u32Output &amp; 0xFF;
u32Input = 0xaabbccdd;
if (!outputs_running) return;
if(LED&#160;!= prevState)
{
    set_led(LED);
}
prevState = LED;
}
</pre>
<pre>Void task1(UArg arg0, UArg arg1)
{
UINT8 u8Err = 0;
Task_Params taskParams;
BOOL bRunApplication = TRUE;
<b>u8Err = (UINT8)Ecat_Open();</b>
if(u8Err == 0)
{
    //assign application function pointer
    <b> pApplication = &amp;Demo_Application;</b>
    /* Create tasks */
    Task_Params_init(&amp;taskParams);
    taskParams.priority = 15;
    ledTaskHndl = Task_create (LEDtask, &amp;taskParams, NULL);
    do
    {
        Task_sleep(1);
        <b>Ecat_OnTimer();</b>
    } while (bApplicationRun == TRUE)
    <b>Ecat_Close();</b>
    BIOS_exit(0);
}
}
</pre></div>
<!-- 
NewPP limit report
Cached time: 20201201012949
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.242 seconds
Real time usage: 0.245 seconds
Preprocessor visited node count: 612/1000000
Preprocessor generated node count: 656/1000000
Post‐expand include size: 487/2097152 bytes
Template argument size: 36/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    1.524      1 Template:SpArticleStart
100.00%    1.524      1 -total
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:30063-0!canonical and timestamp 20201201012949 and revision id 227680
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>PRU ICSS EtherCAT firmware API guide</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>PRU ICSS EtherCAT firmware API guide</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>PRU ICSS EtherCAT firmware API guide</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>PRU ICSS EtherCAT firmware API guide</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>PRU ICSS EtherCAT firmware API guide</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>PRU ICSS EtherCAT firmware API guide</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>PRU ICSS EtherCAT firmware API guide</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>PRU ICSS EtherCAT firmware API guide</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>PRU ICSS EtherCAT firmware API guide</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;oldid=227680">https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;oldid=227680</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category_SDK.html" title="Category:SDK">SDK</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=PRU+ICSS+EtherCAT+firmware+API+guide" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="PRU_ICSS_EtherCAT_firmware_API_guide.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="PRU_ICSS_EtherCAT_firmware_API_guide.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/PRU_ICSS_EtherCAT_firmware_API_guide.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/PRU_ICSS_EtherCAT_firmware_API_guide.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;oldid=227680" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=PRU_ICSS_EtherCAT_firmware_API_guide&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 25 May 2017, at 21:55.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.242","walltime":"0.245","ppvisitednodes":{"value":612,"limit":1000000},"ppgeneratednodes":{"value":656,"limit":1000000},"postexpandincludesize":{"value":487,"limit":2097152},"templateargumentsize":{"value":36,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":0,"limit":5000000},"timingprofile":["100.00%    1.524      1 Template:SpArticleStart","100.00%    1.524      1 -total"]},"cachereport":{"timestamp":"20201201012949","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":260});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/PRU_ICSS_EtherCAT_firmware_API_guide by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 10:30:50 GMT -->
</html>
