<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/Smart_Home_and_Energy_Gateway_Software_Manual by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 08:41:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Smart Home and Energy Gateway Software Manual - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Smart_Home_and_Energy_Gateway_Software_Manual","wgTitle":"Smart Home and Energy Gateway Software Manual","wgCurRevisionId":193631,"wgRevisionId":193631,"wgArticleId":37585,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Smart Grid \u0026 Energy"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Smart_Home_and_Energy_Gateway_Software_Manual","wgRelevantArticleId":37585,"wgRequestId":"623abbda0c6ae3a28b15132c","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->

                    <script>var w=window;if(w.performance||w.mozPerformance||w.msPerformance||w.webkitPerformance){var d=document;AKSB=w.AKSB||{},AKSB.q=AKSB.q||[],AKSB.mark=AKSB.mark||function(e,_){AKSB.q.push(["mark",e,_||(new Date).getTime()])},AKSB.measure=AKSB.measure||function(e,_,t){AKSB.q.push(["measure",e,_,t||(new Date).getTime()])},AKSB.done=AKSB.done||function(e){AKSB.q.push(["done",e])},AKSB.mark("firstbyte",(new Date).getTime()),AKSB.prof={custid:"295384",ustr:"",originlat:"0",clientrtt:"276",ghostip:"23.11.215.94",ipv6:false,pct:"10",clientip:"163.125.46.158",requestid:"1746b9d5",region:"26813",protocol:"",blver:14,akM:"g",akN:"ae",akTT:"O",akTX:"1",akTI:"1746b9d5",ai:"181835",ra:"false",pmgn:"",pmgi:"",pmp:"",qc:""},function(e){var _=d.createElement("script");_.async="async",_.src=e;var t=d.getElementsByTagName("script"),t=t[t.length-1];t.parentNode.insertBefore(_,t)}(("https:"===d.location.protocol?"https:":"http:")+"//ds-aksb-a.akamaihd.net/aksb.min.js")}</script>
                    </head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Smart_Home_and_Energy_Gateway_Software_Manual rootpage-Smart_Home_and_Energy_Gateway_Software_Manual skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">Smart Home and Energy Gateway Software Manual</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div style="width:800px; text-align:justify;"> 
<div style="display:block; clear: both; margin: 10px 0px; padding: 0px; background-color: #ee1d23; text-align:right;"><a href="File_TIBanner.html" class="image"><img alt="TIBanner.png" src="https://processors.wiki.ti.com/images/c/cd/TIBanner.png" width="667" height="87" /></a></div>
<div style="display:block; margin: 5px 0px; padding: 2px 5px; font-size:1.5em; font-weight:bold; text-align:left;">Smart Home and Energy Gateway Software Manual</div>
<div style="display:block; margin: 5px 0px; padding: 2px; color: #666666; font-size:1.0em; font-weight:bold; text-align:right;">Smart Grid Solutions</div>
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#READ_FIRST"><span class="tocnumber">1</span> <span class="toctext">READ FIRST</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#U-Boot"><span class="tocnumber">2</span> <span class="toctext">U-Boot</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Building_U-Boot"><span class="tocnumber">2.1</span> <span class="toctext">Building U-Boot</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Prerequisite"><span class="tocnumber">2.1.1</span> <span class="toctext">Prerequisite</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#U-boot_patch"><span class="tocnumber">2.1.2</span> <span class="toctext">U-boot patch</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Compile"><span class="tocnumber">2.1.3</span> <span class="toctext">Compile</span></a>
<ul>
<li class="toclevel-4 tocsection-7"><a href="#UART"><span class="tocnumber">2.1.3.1</span> <span class="toctext">UART</span></a></li>
<li class="toclevel-4 tocsection-8"><a href="#NAND"><span class="tocnumber">2.1.3.2</span> <span class="toctext">NAND</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#SPI"><span class="tocnumber">2.1.3.3</span> <span class="toctext">SPI</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Kernel"><span class="tocnumber">3</span> <span class="toctext">Kernel</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Building_Linux_Kernel"><span class="tocnumber">3.1</span> <span class="toctext">Building Linux Kernel</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#Prerequisite_2"><span class="tocnumber">3.1.1</span> <span class="toctext">Prerequisite</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Kernel_patch"><span class="tocnumber">3.1.2</span> <span class="toctext">Kernel patch</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Cleaning_the_Kernel_sources"><span class="tocnumber">3.1.3</span> <span class="toctext">Cleaning the Kernel sources</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Configure_the_Kernel"><span class="tocnumber">3.1.4</span> <span class="toctext">Configure the Kernel</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Compile_2"><span class="tocnumber">3.1.5</span> <span class="toctext">Compile</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#Flashing_U-Boot_and_Kernel_images"><span class="tocnumber">4</span> <span class="toctext">Flashing U-Boot and Kernel images</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#Target_configuration"><span class="tocnumber">4.1</span> <span class="toctext">Target configuration</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#U-Boot_network_configuration"><span class="tocnumber">4.2</span> <span class="toctext">U-Boot network configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="#Dynamic_IP"><span class="tocnumber">4.2.1</span> <span class="toctext">Dynamic IP</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#Static_IP"><span class="tocnumber">4.2.2</span> <span class="toctext">Static IP</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-22"><a href="#UART_Boot"><span class="tocnumber">4.3</span> <span class="toctext">UART Boot</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Flashing_U-Boot_and_Kernel_images_to_NAND_using_U-Boot_commands"><span class="tocnumber">4.4</span> <span class="toctext">Flashing U-Boot and Kernel images to NAND using U-Boot commands</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Flashing_U-Boot_and_Kernel_images_to_SPI_using_U-Boot_commands"><span class="tocnumber">4.5</span> <span class="toctext">Flashing U-Boot and Kernel images to SPI using U-Boot commands</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Additional_U-Boot_configuration"><span class="tocnumber">4.6</span> <span class="toctext">Additional U-Boot configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="#DDR_memory_size"><span class="tocnumber">4.6.1</span> <span class="toctext">DDR memory size</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-27"><a href="#Filesystem"><span class="tocnumber">5</span> <span class="toctext">Filesystem</span></a>
<ul>
<li class="toclevel-2 tocsection-28"><a href="#NAND_2"><span class="tocnumber">5.1</span> <span class="toctext">NAND</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#NFS"><span class="tocnumber">5.2</span> <span class="toctext">NFS</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#USB_drive"><span class="tocnumber">5.3</span> <span class="toctext">USB drive</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-31"><a href="#WiFi"><span class="tocnumber">6</span> <span class="toctext">WiFi</span></a>
<ul>
<li class="toclevel-2 tocsection-32"><a href="#Building_WiFi"><span class="tocnumber">6.1</span> <span class="toctext">Building WiFi</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#Installing_and_configuring_WiFi"><span class="tocnumber">6.2</span> <span class="toctext">Installing and configuring WiFi</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Verifying_WiFi"><span class="tocnumber">6.3</span> <span class="toctext">Verifying WiFi</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Running_WiFi"><span class="tocnumber">6.4</span> <span class="toctext">Running WiFi</span></a>
<ul>
<li class="toclevel-3 tocsection-36"><a href="#Station_mode"><span class="tocnumber">6.4.1</span> <span class="toctext">Station mode</span></a></li>
<li class="toclevel-3 tocsection-37"><a href="#AP_mode"><span class="tocnumber">6.4.2</span> <span class="toctext">AP mode</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-38"><a href="#Bluetooth"><span class="tocnumber">7</span> <span class="toctext">Bluetooth</span></a>
<ul>
<li class="toclevel-2 tocsection-39"><a href="#Building_Bluetooth"><span class="tocnumber">7.1</span> <span class="toctext">Building Bluetooth</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Installing_Bluetooth"><span class="tocnumber">7.2</span> <span class="toctext">Installing Bluetooth</span></a>
<ul>
<li class="toclevel-3 tocsection-41"><a href="#Stonestreet_one_binaries"><span class="tocnumber">7.2.1</span> <span class="toctext">Stonestreet one binaries</span></a></li>
<li class="toclevel-3 tocsection-42"><a href="#Bluetooth_firmware"><span class="tocnumber">7.2.2</span> <span class="toctext">Bluetooth firmware</span></a></li>
<li class="toclevel-3 tocsection-43"><a href="#Bluetooth_enable_kernel_module"><span class="tocnumber">7.2.3</span> <span class="toctext">Bluetooth enable kernel module</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-44"><a href="#Running_Bluetooth"><span class="tocnumber">7.3</span> <span class="toctext">Running Bluetooth</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-45"><a href="#NFC"><span class="tocnumber">8</span> <span class="toctext">NFC</span></a>
<ul>
<li class="toclevel-2 tocsection-46"><a href="#Building_NFC"><span class="tocnumber">8.1</span> <span class="toctext">Building NFC</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="#Running_NFC"><span class="tocnumber">8.2</span> <span class="toctext">Running NFC</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="READ_FIRST">READ FIRST</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=1" title="Edit section: READ FIRST">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<div style="margin: 5px; padding: 5px 10px; background-color: #ffffec; border-left: 5px solid #ff6600;"><b>IMPORTANT</b><br /><br />The following instructions have only been tested and verified with the following software versions:
<ul><li>Sitara AM335x AMSDK v6.00</li>
<li>WiFi version R8.3 SP1</li>
<li>Stonestreet One Bluetooth version 4.0.1.3</li>
<li>Gateway board support package version 1.3</li></ul>
<p>Please download and install <a rel="nofollow" class="external text" href="http://software-dl.ti.com/sitara_linux/esd/AM335xSDK/06_00_00_00/index_FDS.html">SDK 6.00</a> before continuing. You will also need the Gateway board support package (BSP). Contact your local TI representative to get access to the Gateway BSP.
</p><p>For information about the hardware, please see the <a href="Smart_Home_and_Energy_Gateway_Hardware_Manual.html" title="Smart Home and Energy Gateway Hardware Manual">Smart Home and Energy Gateway Hardware Manual</a>.
</p>
</div>
<p><br />
</p>
<h1><span class="mw-headline" id="U-Boot">U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=2" title="Edit section: U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>The U-boot on AM335x uses a two stage approach. The size of the internal RAM in AM335X is 128KB out of which 18KB at the end is used by the ROM code. Also, 1 KB at the start (0x402f0000 - 0x402f0400) is secure, and it cannot be accessed. This places a limit of 109KB on the size of the U-Boot binary which the ROM code can transfer to the internal RAM and use as an initial stack before initialization of DRAM.
</p><p>Since it is not possible to squeeze in all the functionality that is normally expected from U-Boot in less than 110KB (after setting aside some space for stack, heap etc) a two stage approach has been adopted. Initial stage initialize only the required boot devices (NAND, SPI, UART, I2C etc); 2nd full stage install all other devices (Ethernet, timers, clocks etc).
</p>
<br /> <div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />In the rest of this document when referring to the binaries, the binary for the 1st stage is referred to as SPL and the binary for the 2nd stage is U-Boot.</div>
<p><br />
</p>
<h2><span class="mw-headline" id="Building_U-Boot">Building U-Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=3" title="Edit section: Building U-Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Prerequisite">Prerequisite</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=4" title="Edit section: Prerequisite">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Verify that SDK 6.00 is installed on your host computer. GNU toolchain for ARM processor from Linaro is recommended to build U-Boot. Linaro toolchain can be found in the linux-devkit directory of the SDK. If you have not already done so, add this compiler to the path by doing:
</p>
<pre>$ export PATH="&lt;sdk install dir&gt;/linux-devkit/sysroots/i686-arago-linux/usr/bin:$PATH"
</pre>
<p>Change to the base of the U-Boot directory.
</p>
<pre>$ cd &lt;sdk install dir&gt;/board-support/u-boot-2013.01.01-psp06.00.00.00
</pre>
<h3><span class="mw-headline" id="U-boot_patch">U-boot patch</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=5" title="Edit section: U-boot patch">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Download Gateway board support package (BSP) and apply patches to U-Boot source. The patches are located in the patches/uboot folder of the Gateway BSP.
</p>
<pre>$ patch -p1 &lt; 0001-Baseline-uboot-patch-for-Gateway.patch
$ patch -p1 &lt; 0002-DDR-and-MPU-speed-increase-and-add-USB-commands.patch
</pre>
<h3><span class="mw-headline" id="Compile">Compile</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=6" title="Edit section: Compile">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Below are instructions on how to generate binaries for the memory or peripheral devices. Building into a separate object directory with the "O=" parameter is strongly recommended.&#160; Note that the board names are different than what is typically used to build U-Boot for other AM335x EVM.&#160;
</p>
<h4><span class="mw-headline" id="UART">UART</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=7" title="Edit section: UART">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre>$ [ -d ./am335x ] &amp;&amp; rm -rf ./am335x
$ make O=am335x CROSS_COMPILE=arm-linux-gnueabihf- ARCH=arm am335x_zbgw
</pre>
<p>In the am335x directory, SPL is spl/u-boot-spl.bin and U-Boot is u-boot.img.
</p>
<h4><span class="mw-headline" id="NAND">NAND</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=8" title="Edit section: NAND">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre>$ [ -d ./am335x ] &amp;&amp; rm -rf ./am335x
$ make O=am335x CROSS_COMPILE=arm-linux-gnueabihf- ARCH=arm am335x_zbgw
</pre>
<p>In the am335x directory, SPL is MLO and U-Boot is u-boot.img.
</p>
<h4><span class="mw-headline" id="SPI">SPI</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=9" title="Edit section: SPI">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<pre>$ [ -d ./am335x ] &amp;&amp; rm -rf ./am335x
$ make O=am335x CROSS_COMPILE=arm-linux-gnueabihf- ARCH=arm am335x_zbgw_spiboot
</pre>
<p>In the am335x directory, SPL is MLO.byteswap and U-Boot is u-boot.img.
</p><p><br />
</p>
<h1><span class="mw-headline" id="Kernel">Kernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=10" title="Edit section: Kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>This section will cover the basic steps for building the Linux kernel and driver modules.
</p>
<h2><span class="mw-headline" id="Building_Linux_Kernel">Building Linux Kernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=11" title="Edit section: Building Linux Kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Prerequisite_2">Prerequisite</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=12" title="Edit section: Prerequisite">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Verify that SDK 6.00 is installed on your host computer. GNU toolchain for ARM processor from Linaro is recommended to build the kernel. Linaro toolchain can be found in the linux-devkit directory of the SDK. If you have not already done so, add this compiler to the path by doing:
</p>
<pre>$ export PATH="&lt;sdk install dir&gt;/linux-devkit/sysroots/i686-arago-linux/usr/bin:$PATH"
</pre>
<p>Change to the base of the Kernel directory.
</p>
<pre>$ cd &lt;sdk install dir&gt;/board-support/linux-3.2.0-psp04.06.00.11
</pre>
<h3><span class="mw-headline" id="Kernel_patch">Kernel patch</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=13" title="Edit section: Kernel patch">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Download Gateway board support package (BSP) and apply patches to kernel source. The patches are located in the patches/kernel folder of the Gateway BSP.
</p>
<pre>$ patch -p1 &lt; 0001-Baseline-kernel-patch-for-Gateway.patch
$ patch -p1 &lt; 0002-Add-USB-modem-kernel-config.patch
$ patch -p1 &lt; 0003-Fixed-SPI-flash-device-name.patch
</pre>
<h3><span class="mw-headline" id="Cleaning_the_Kernel_sources">Cleaning the Kernel sources</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=14" title="Edit section: Cleaning the Kernel sources">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Prior to compiling the Linux kernel, it is often a good idea to make sure that the kernel sources are clean and that there are no remnants left over from a previous build.
</p>
<div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />The next step will delete any saved .config file in the kernel tree as well as the generated object files.  If you have done a previous configuration and do not wish to lose your configuration file, save a copy of the configuration file before proceeding.</div>
<p>Clean the kernel
</p>
<pre>$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mrproper
</pre>
<h3><span class="mw-headline" id="Configure_the_Kernel">Configure the Kernel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=15" title="Edit section: Configure the Kernel">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Before compiling the Linux kernel, it needs to be configured to select what components will become part of the kernel image, which components will be built as dynamic modules, and which components will be left out all together.&#160;
</p><p>Set default kernel configuration
</p>
<pre>$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- tisdk_am335x-evm_defconfig
</pre>
<p>If you would like to customize the kernel configuration, run the following command
</p>
<pre>$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- menuconfig
</pre>
<h3><span class="mw-headline" id="Compile_2">Compile</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=16" title="Edit section: Compile">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Once the kernel has been configured, it must be compiled to generate the bootable kernel image, as well as any dynamic kernel modules that were selected.&#160;
</p><p>Build the kernel image. The resulting kernel image file will be located in the arch/arm/boot directory called uImage.
</p>
<pre>$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- uImage
</pre>
<p>Build the dynamic modules. This will result in .ko (kernel object) files being placed in the kernel tree. These .ko files are the dynamic kernel modules.
</p>
<pre>$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- modules
</pre>
<h1><span class="mw-headline" id="Flashing_U-Boot_and_Kernel_images">Flashing U-Boot and Kernel images</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=17" title="Edit section: Flashing U-Boot and Kernel images">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Target_configuration">Target configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=18" title="Edit section: Target configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Switch SW2 is used to select the boot modes. The following sections will note which boot mode to enter. Make sure that the Gateway's boot switch settings are set to the required boot mode and then power on the board.
</p>
<table width="400" border="1" align="center" cellspacing="1" cellpadding="1">
<caption><b>SW2, Boot Mode Select</b>
</caption>
<tbody><tr>
<th scope="col">Boot Mode
</th>
<th scope="col">1
</th>
<th scope="col">2
</th>
<th scope="col">3
</th>
<th scope="col">4
</th></tr>
<tr>
<td>UART0
</td>
<td>OFF
</td>
<td>ON
</td>
<td>ON
</td>
<td>ON
</td></tr>
<tr>
<td>NAND
</td>
<td>OFF
</td>
<td>ON
</td>
<td>ON
</td>
<td>OFF
</td></tr>
<tr>
<td>SPI0
</td>
<td>OFF
</td>
<td>OFF
</td>
<td>ON
</td>
<td>OFF
</td></tr></tbody></table>
<br /> <div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />Must power cycle the board to change boot modes.  Reset button will only perform a warm reset.</div>
<p><br />
</p>
<h2><span class="mw-headline" id="U-Boot_network_configuration">U-Boot network configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=19" title="Edit section: U-Boot network configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>In order to download images from the TFTP server, the network settings in U-Boot need to be configured.
</p><p>When booting for the first time, U-Boot tries to fetch the MAC address from the env space. If it returns empty, it will look for MAC address from the eFuse registers in the Control module space and set the "ethaddr" variable in the env appropriately. The ethaddr can also be set using the setenv/saveenv commands. In such cases, the user-set MAC address will take effect on subsequent reboot only.
</p><p>To set a different MAC address, use the following command
</p>
<pre>U-Boot# set ethaddr &lt;MAC address, e.g. 08:11:23:32:12:77&gt;
</pre>
<h3><span class="mw-headline" id="Dynamic_IP">Dynamic IP</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=20" title="Edit section: Dynamic IP">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Run the dhcp command to obtain the IP address from the DHCP server on the network to which the Gateway is connected.
</p>
<pre>U-Boot# setenv serverip &lt;tftp server in your network&gt;
U-Boot# setenv autoload no
U-Boot# dhcp
U-Boot# saveenv
</pre>
<h3><span class="mw-headline" id="Static_IP">Static IP</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=21" title="Edit section: Static IP">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>If running on a network without a DHCP server, run the following commands to set the static IP.
</p>
<pre>U-Boot# setenv ipaddr &lt;static IP&gt;
U-Boot# saveenv
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="UART_Boot">UART Boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=22" title="Edit section: UART Boot">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section describes how to boot from UART using TeraTerm.
</p>
<ol><li>Turn on Gateway with switch settings for <a href="#Target_configuration">UART boot</a></li>
<li>When "CCCC" characters appear on TeraTerm window, from the File Menu select Transfer --&gt; XMODEM --&gt; Send (1K mode)</li>
<li>Select "u-boot-spl.bin" for the transfer</li>
<li>After image is successfully downloaded, the ROM will boot the SPL</li>
<li>When "CCCC" characters appear on TeraTerm window, from the File Menu select Transfer --&gt; YMODEM --&gt; Send (1K mode)</li>
<li>Select "u-boot.img" for the transfer</li>
<li>After image is successfully downloaded, U-Boot will boot</li>
<li>Hit &lt;Enter&gt; and get to U-Boot prompt "U-Boot#"</li></ol>
<p><br />
</p>
<h2><span class="mw-headline" id="Flashing_U-Boot_and_Kernel_images_to_NAND_using_U-Boot_commands">Flashing U-Boot and Kernel images to NAND using U-Boot commands</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=23" title="Edit section: Flashing U-Boot and Kernel images to NAND using U-Boot commands">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The NAND part on the Gateway has been configured in the following manner. The addresses mentioned here are used in the subsequent NAND related commands.
</p>
<pre>+------+--&gt;0x00000000-&gt; SPL start         (SPL copy on 1st block)
|      |
|      |--&gt;0x0001FFFF-&gt; SPL end
|      |--&gt;0x00020000-&gt; SPL.backup1 start (SPL copy on 2nd block)
|      |
|      |--&gt;0x0003FFFF-&gt; SPL.backup1 end
|      |--&gt;0x00040000-&gt; SPL.backup2 start (SPL copy on 3rd block)
|      |
|      |--&gt;0x0005FFFF-&gt; SPL.backup2 end
|      |--&gt;0x00060000-&gt; SPL.backup3 start (SPL copy on 4th block)
|      |
|      |--&gt;0x0007FFFF-&gt; SPL.backup3 end
|      |--&gt;0x00080000-&gt; U-Boot start
|      |
|      |--&gt;0x0025FFFF-&gt; U-Boot end
|      |--&gt;0x00260000-&gt; ENV start
|      |
|      |--&gt;0x0027FFFF-&gt; ENV end
|      |--&gt;0x00280000-&gt; Linux Kernel start
|      |
|      |
|      |
|      |
|      |--&gt;0x0077FFFF-&gt; Linux Kernel end
|      |--&gt;0x00780000-&gt; File system start
|      |
|      |
|      |
|      |
|      |
+------+--&gt;0x10000000-&gt; NAND end (Free end)
</pre>
<p><br /> This section describes how to flash the NAND images using U-Boot.
</p>
<ul><li>Boot using <a href="#UART_Boot">UART boot mode</a>. After the U-Boot prompt comes up, the images for the 1st and 2nd stage can be flashed to NAND for persistent storage.</li>
<li>Configure the <a href="#U-Boot_network_configuration">U-Boot network settings</a> for either static or dynamic IP</li>
<li>Set the TFTP server IP&#160;address</li></ul>
<pre>U-Boot# setenv serverip &lt;TFTP server in your network&gt;</pre>
<ul><li>Download SPL from TFTP server, erase and write image to NAND flash</li></ul>
<pre>U-Boot# tftp MLO
U-Boot#&#160;nand erase 0x0 0x20000
U-Boot# nand write ${loadaddr} 0x0 0x20000
</pre>
<ul><li>Download U-Boot from TFTP server, erase and write image to NAND flash</li></ul>
<pre>U-Boot# tftp u-boot.img
U-Boot# nand erase 0x80000 0x200000
U-Boot# nand write ${loadaddr} 0x80000 0x200000
</pre>
<ul><li>Download kernel image from TFTP server, erase and write image to NAND flash</li></ul>
<pre>U-Boot# tftp uImage
U-Boot# nand erase 0x280000 0x500000
U-Boot# nand write ${loadaddr} 0x280000 0x500000
</pre>
<ul><li>Set boot switch settings for <a href="#Target_configuration">NAND boot</a> and power cycle the board.</li>
<li>If no error messages are display and the U-Boot prompt comes up, NAND boot is successful</li>
<li>Modify U-Boot environment variable to boot kernel and filesystem from NAND flash</li></ul>
<pre>U-Boot# setenv bootcmd "run nandboot"
U-Boot# saveenv
</pre>
<h2><span class="mw-headline" id="Flashing_U-Boot_and_Kernel_images_to_SPI_using_U-Boot_commands">Flashing U-Boot and Kernel images to SPI using U-Boot commands</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=24" title="Edit section: Flashing U-Boot and Kernel images to SPI using U-Boot commands">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The SPI part on the Gateway has been configured in the following manner. The addresses mentioned here are used in the subsequent SPI related commands.
</p><p><br />
</p>
<pre>+------+--&gt;0x000000-&gt; SPL start         (SPL copy on 1st block)
|      |
|      |--&gt;0x01FFFF-&gt; SPL end
|      |--&gt;0x020000-&gt; SPL.backup1 start (SPL copy on 2nd block)
|      |
|      |--&gt;0x03FFFF-&gt; SPL.backup1 end
|      |--&gt;0x040000-&gt; SPL.backup2 start (SPL copy on 3rd block)
|      |
|      |--&gt;0x05FFFF-&gt; SPL.backup2 end
|      |--&gt;0x060000-&gt; SPL.backup3 start (SPL copy on 4th block)
|      |
|      |--&gt;0x07FFFF-&gt; SPL.backup3 end
|      |--&gt;0x080000-&gt; U-Boot start
|      |
|      |--&gt;0x0DFFFF-&gt; U-Boot end
|      |--&gt;0x0E0000-&gt; ENV start
|      |
|      |--&gt;0x0EFFFF-&gt; ENV end
|      |--&gt;0x0F0000-&gt; Linux Kernel start
|      |
|      |
|      |
|      |
|      |--&gt;0x44FFFF-&gt; Linux Kernel end
|      |--&gt;0x450000-&gt; Userspace start
|      |
|      |
|      |
|      |
|      |
|      |
+------+--&gt;0x800000-&gt; Userspace end (Free end)
</pre>
<p><br /> This section describes how to flash the SPI images from UART boot mode.
</p>
<ul><li>Boot using <a href="#UART_Boot">UART boot mode</a>. After the U-Boot prompt comes up, the images for the 1st and 2nd stage can be flashed to SPI for persistent storage.</li>
<li>Configure the <a href="#U-Boot_network_configuration">U-Boot network settings</a> for either static or dynamic IP</li>
<li>Set the TFTP server</li></ul>
<pre>U-Boot# setenv serverip &lt;TFTP server in your network&gt;</pre>
<ul><li>Select the SPI flash</li></ul>
<pre>U-Boot# sf probe 0</pre>
<ul><li>Erase the SPI flash</li></ul>
<pre>U-Boot# sf erase 0 +F0000</pre>
<ul><li>Download SPL from TFTP server and write image to SPI flash</li></ul>
<pre>U-Boot# tftp MLO.byteswap
U-Boot# sf write ${loadaddr} 0 ${filesize}</pre>
<ul><li>Download U-Boot from TFTP server and write image to SPI flash</li></ul>
<pre>U-Boot# tftp u-boot.img
U-Boot# sf write ${loadaddr} 0x80000 ${filesize}</pre>
<ul><li>Download kernel image from TFTP server, erase and write image to SPI flash</li></ul>
<pre>U-Boot# tftp uImage
U-Boot# sf erase ${spisrcaddr} ${spiimgsize}
U-BOot# sf write ${loadaddr} ${spisrcaddr}&#160;${filesize}</pre>
<ul><li>Set boot switch settings for <a href="#Target_configuration">SPI boot</a> and power cycle the board.</li>
<li>If no error messages are display and the U-Boot prompt comes up, SPI boot is successful</li>
<li>Modify U-Boot environment variable to boot kernel from SPI flash. Note, since there is not enough room on the SPI&#160;flash, the filesystem will still reside on the NAND flash.&#160; <br /></li></ul>
<pre>U-Boot# setenv bootcmd "run spiboot"
U-Boot# saveenv</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Additional_U-Boot_configuration">Additional U-Boot configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=25" title="Edit section: Additional U-Boot configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Depending on your Gateway, below are additional board configuration(s) that will need to be modified.
</p>
<h3><span class="mw-headline" id="DDR_memory_size">DDR memory size</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=26" title="Edit section: DDR memory size">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>By default, U-Boot sets the DDR memory size to 256MB. However, some Gateways have a higher DDR memory capacity. Modify the U-Boot parameter (as shown below) to reflect the correct DDR memory size.
</p><p>For 256MB
</p>
<pre>U-Boot# setenv optargs mem=256M
</pre>
<p>For 512MB
</p>
<pre>U-Boot# setenv optargs mem=512M
</pre>
<p>Save the settings
</p>
<pre>U-Boot# saveenv
</pre>
<p><br />
</p>
<h1><span class="mw-headline" id="Filesystem">Filesystem</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=27" title="Edit section: Filesystem">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Below section explains the different methods to load the filesystem for the Gateway.
</p>
<h2><span class="mw-headline" id="NAND_2">NAND</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=28" title="Edit section: NAND">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The following steps describe how to flash the UBI filesystem into NAND flash.
</p>
<ul><li>Locate the SDK6.0's UBI filesystem from the below folder location and copy to TFTP folder</li></ul>
<pre>&lt;sdk install dir&gt;/filesystem/arago-base-tisdk-image-am335x-evm.ubi
</pre>
<ul><li>Run the following U-Boot commands to flash UBI filesystem into NAND flash</li></ul>
<pre>U-Boot# tftp arago-base-tisdk-image-am335x-evm.ubi
U-Boot# nand erase 0x780000 0xF880000
U-Boot# nand write ${loadaddr} 0x780000 ${filesize} </pre>
<h2><span class="mw-headline" id="NFS">NFS</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=29" title="Edit section: NFS">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The following steps describe how to configure U-Boot to run NFS. It assumes that a valid NFS and TFTP are currently running on your host machine.
</p>
<ul><li>Copy the kernel image (uImage) to your host machine's tftp directory.</li>
<li>Run the following U-Boot commands to boot the board from NFS</li></ul>
<pre>U-Boot# setenv serverip &lt;host machine IP addr&gt;
U-Boot# setenv bootfile uImage
U-Boot# setenv rootpath &lt;NFS directory on host machine&gt;
U-Boot# setenv bootcmd "run netboot"
U-Boot# saveenv
</pre>
<h2><span class="mw-headline" id="USB_drive">USB drive</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=30" title="Edit section: USB drive">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The following steps describe how to setup the USB drive filesystem and configure U-Boot.
</p>
<ul><li>Plug in the USB drive to the host computer, where SDK 6.00 resides.</li>
<li>Go to the &lt;SDK install&gt;/bin folder</li></ul>
<pre>$ cd &lt;sdk install dir&gt;/bin
</pre>
<ul><li>Run the create-sdcard script and follow the prompt to create a two-partition filesystem on the USB drive. This script will partition, format and populate the USB drive.</li></ul>
<pre>$ sudo ./create-sdcard.sh
</pre>
<ul><li>Once script is completed, the USB drive has a working Linux root file system loaded and is ready for use.</li></ul>
<ul><li>Unplug and reinsert the USB drive onto the host computer. Transfer the kernel image (uImage) onto the boot partition of the USB drive</li>
<li>Unplug the USB drive from host computer and plug it into the Gateway board</li>
<li>Run the following U-Boot commands to boot the board from the USB drive</li></ul>
<pre>U-Boot# usb start
U-Boot# fatload usb 0:1 ${loadaddr} uImage
U-Boot# setenv bootargs "console=ttyO0,115200n8 root=/dev/sda2 noinitrd rootfstype=ext3 rootwait"
U-Boot# bootm
</pre>
<p><br />
</p>
<h1><span class="mw-headline" id="WiFi">WiFi</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=31" title="Edit section: WiFi">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>This section describes how to build, verify and run the WiFi drivers on the Gateway. A WiFi pre-built binary package is included in the BSP. This pre-built can be extracted onto the top-level of the Gateway's filesystem to enable WiFi.  For instructions on how to rebuild the WiFi drivers, see <a href="#Building_WiFi">Building WiFi</a> section. If you do not need to rebuild the WiFi drivers, proceed to <a href="#Verifying_WiFi">Verifying WiFi</a> and <a href="#Running_WiFi">Running WiFi</a> sections.
</p>
<h2><span class="mw-headline" id="Building_WiFi">Building WiFi</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=32" title="Edit section: Building WiFi">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Below is an abridged version of the instructions to compile WL18xx WiFi drivers (version R8.3 SP1) for the Gateway.&#160; For full instructions on the WL18xx WiFi build process, please see <a rel="nofollow" class="external free" href="https://www.ti.com/lit/swru561">http://processors.wiki.ti.com/index.php/WL18xx_WiFi_Build_Process</a>.<br />
</p>
<ul><li>Add Linaro toolchain to your PATH. Do not source the environment-setup file. The WiFi drivers build script will not build correctly if you do.</li></ul>
<pre>$ export PATH="&lt;sdk install dir&gt;/linux-devkit/sysroots/i686-arago-linux/usr/bin:$PATH"
</pre>
<ul><li>Clone build script located in github</li></ul>
<pre>$ mkdir wl18xx_build
$ cd wl18xx_build
$ git clone git://github.com/TI-ECS/build-utilites.git
$ cd build-utilites
</pre>
<ul><li>Set git tag to R8.3 SP1</li></ul>
<pre>$ git reset --hard ol_r8.a8.10_32</pre>
<ul><li>Configure build script's environment settings</li></ul>
<dl><dd><ul><li>Create a copy of setup-env.sample and name the file, setup-env</li>
<li>Edit setup-env. The main settings to modify are:</li></ul>
<dl><dd><ul><li>ROOTFS - path to target root filesystem</li>
<li>PATH - path to the Linaro toolchain</li>
<li>KLIB_PATH - path to the kernel sources</li>
<li>CROSS_COMPILE - beginning part of the cross compiler executable name</li>
<li>WORK_SPACE - work directory for download and build process</li></ul></dd></dl>
<ul><li>Typical user settings in setup-env file will look like the following</li></ul></dd></dl>
<pre># User specific environment settings
export CROSS_COMPILE="arm-linux-gnueabihf-"
export PATH="$PATH:&lt;sdk install dir&gt;/linux-devkit/sysroots/i686-arago-linux/usr/bin"
export ROOTFS="/home/user/AM335x/RootFS"
export WORK_SPACE="/home/user/AM335x/work_space_R8_A8_10_32"
export KLIB_BUILD="&lt;sdk install dir&gt;/board-support/linux-3.2.0-psp04.06.00.11"
# MACHINE_TYPE - The target machine type. Can have one of the following values: "am1808" , "omap3evm" , "am335x"
# This is needed to build bluetooth components.
# This parameter is not relevant for ti814x board.
export MACHINE_TYPE="am335x"
export BUILD_VERSION="r8"
</pre>
<ul><li>Build WiFi drivers using the build script</li></ul>
<pre>$ ./wl18xx_build.sh all</pre>
<ul><li>After the build has completed, WiFi drivers binaries are located in ROOTFS folder that was defined in setup-env file. Transfer all the binaries to the Gateway's filesystem.</li></ul>
<h2><span class="mw-headline" id="Installing_and_configuring_WiFi">Installing and configuring WiFi</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=33" title="Edit section: Installing and configuring WiFi">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Below is an abridged version of the instructions to install and configure the WiFi PHY for the Gateway.  For full instructions, please see <a rel="nofollow" class="external free" href="Open_Source_Wireless_Connectivity_wlconf.html">http://processors.wiki.ti.com/index.php/Open_Source_Wireless_Connectivity_wlconf</a>.
</p>
<ul><li>Add the WiFi binaries to the Gateway's filesystem</li>
<li>Run the following commands to generate the WiFi PHY firmware file</li></ul>
<pre>root@am335x-evm:~# cd /usr/sbin/wlconf/official_inis
root@am335x-evm:~# cp WL8_System_parameters.ini  WL8_System_parameters_PG2_RDL_2_4_SP_MIMO.ini
root@am335x-evm:~# cd /home/root/scripts/wlconf
root@am335x-evm:~# ./wlconf-mimo.sh</pre>
<p>root@am335x-evm:~# sync
</p>
<ul><li>After running the above steps, a newly generated WiFi PHY file, wl18xx-conf.bin, should be located in /lib/firmware/ti-connectivity folder on the Gateway filesystem</li>
<li>Reboot the Gateway and proceed to next section to verify that the WiFi drivers are loaded correctly</li></ul>
<h2><span class="mw-headline" id="Verifying_WiFi">Verifying WiFi</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=34" title="Edit section: Verifying WiFi">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Once the WiFi binaries have been added to the Gateway's filesystem, reboot the Gateway. The WiFi drivers will automatically load during boot. Below are some options to verify that the WiFi drivers have loaded correctly.
</p>
<ul><li>Verify that you see WiFi drivers loading during boot. You should see something similar to below during boot messages</li></ul>
<pre>[    6.565032] compat-drivers backport release: ol_r8.a8.04_32
[    6.570892] Backport based on wl18xx.git ol_r8.a8.10_32
[    6.576446] compat.git: wl18xx.git
[    8.910156] cfg80211: Calling CRDA to update world regulatory domain
[    9.324310] wlcore: wl18xx driver version: ol_r8.a8.04_32
[    9.774902] wlcore: wl18xx HW: 183x or 180x, PG 2.1 (ROM 0xe)
[    9.814117] wlcore: loaded
[    9.817016] wlcore: driver version: ol_r8.a8.04_32
[    9.822052] wlcore: compilation time: Thu Jul  3 11:51:12 2014
</pre>
<ul><li>Verify that WiFi modules are loaded after boot.</li></ul>
<pre>root@am335x-evm:~# lsmod
Module                  Size  Used by
wl18xx                 75194  0
wlcore                179486  1 wl18xx
mac80211              351991  2 wlcore,wl18xx
cfg80211              201383  3 mac80211,wlcore,wl18xx
wlcore_sdio             4950  0
compat                 21281  5 wlcore_sdio,cfg80211,mac80211,wlcore,wl18xx
</pre>
<ul><li>Verify wlan0 interface is available</li></ul>
<pre>root@am335x-evm:~# ifconfig wlan0
wlan0     Link encap:Ethernet  HWaddr E0:C7:9D:34:4A:70
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
</pre>
<h2><span class="mw-headline" id="Running_WiFi">Running WiFi</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=35" title="Edit section: Running WiFi">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The WL8 module can operate in several modes, including station and AP&#160;mode. For complete instructions on how to configure the WL8 module in these different modes follow the steps in the Texas Instruments&#160;<a rel="nofollow" class="external text" href="WiLink8_WLAN_Demo__Linux.html">WiLink8 WLAN Demo</a> wiki article.&#160;Below is an abridged version of the instructions.<br />
</p>
<h3><span class="mw-headline" id="Station_mode">Station mode</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=36" title="Edit section: Station mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Below instructions will connect Gateway to an AP (e.g., router).
</p>
<ul><li>Modify config file, /etc/wpa_supplicant.conf, with the router's SSID.&#160; Below are sample wpa_supplicant.conf files.</li></ul>
<dl><dd><ul><li>AP with no security</li></ul></dd></dl>
<pre>ctrl_interface=/var/run/wpa_supplicant
update_config=1

network={
        key_mgmt=NONE
        ssid="ECS"       #Replace with router's SSID
}
</pre>
<dl><dd><ul><li>AP with WPA-PSK security</li></ul></dd></dl>
<pre>ctrl_interface=/var/run/wpa_supplicant
update_config=1

network={
        auth_alg=OPEN
        key_mgmt=WPA-PSK
        psk="12345678"   #Replace with WPA-PSK key
        mode=0
        ssid="ECS"       #Replace with router's SSID

}
</pre>
<ul><li>Connect to AP. Connection is successful when you see "wlcore: association completed".</li></ul>
<pre>root@am335x-evm:~# wpa_supplicant -d -Dnl80211 -c /etc/wpa_supplicant.conf -iwlan0 -B
</pre>
<ul><li>Obtain an IP address from AP's DHCP server</li></ul>
<pre>root@am335x-evm:~# udhcpc -i wlan0
</pre>
<ul><li>Check ifconfig to verify that the Gateway received an IP address from the router's DHCP server</li></ul>
<pre>root@am335x-evm:~# ifconfig wlan0
wlan0     Link encap:Ethernet  HWaddr E0:C7:9D:34:4A:70
          inet addr:192.168.1.10  Bcast:0.0.0.0  Mask:255.255.252.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:25 errors:0 dropped:0 overruns:0 frame:0
          TX packets:15 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:5917 (5.7 KiB)  TX bytes:2310 (2.2 KiB)
</pre>
<h3><span class="mw-headline" id="AP_mode">AP mode<br /></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=37" title="Edit section: AP mode">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Below instructions will configure Gateway to broadcast an SSID.&#160; WiFi-enabled devices will be able to connect to the Gateway's SSID.
</p>
<ul><li>Modify config file, /etc/hostapd.conf, with the desired AP setting.&#160; By default, the config file sets the SSID to "test" with no security. Below are key fields to modify in the config file.<br />
<ul><li>hw_mode=g</li>
<li>preamble=1</li>
<li>ht_capab=[SHORT-GI-20]</li>
<li>ieee80211n=1</li></ul></li>
<li>Create a new file, /etc/udhcpd.conf, to configure the DHCP server's setting.&#160; Below is a sample udhcpd.conf file.</li></ul>
<pre># Sample udhcpd configuration file (/etc/udhcpd.conf)
# The start and end of the IP lease block
start 		10.4.30.40	#default: 192.168.0.20
end		10.4.30.48	#default: 192.168.0.254
# The interface that udhcpd will use
interface   wlan0		#default: eth0
#Examles
opt	dns	8.8.8.8  8.8.4.4 # public google dns servers
option	subnet	255.255.255.0
opt	router	10.4.30.34
option	lease	864000		# 10 days of
</pre>
<ul><li>Run in AP&#160;mode</li></ul>
<pre>root@am335x-evm:~# hostapd -B /etc/hostapd.conf -P /var/run/hostapd.pid
</pre>
<ul><li>Assign IP address to the wlan0 port. Note that the IP address is the same as "opt router" that is defined in /etc/udhcpd.conf file</li></ul>
<pre>root@am335x-evm:~# ifconfig wlan0 10.4.30.34 netmask 255.255.255.0 up
</pre>
<ul><li>Add NAT and DHCP server capability to the AP</li></ul>
<pre>root@am335x-evm:~# echo 1 &gt; /proc/sys/net/ipv4/ip_forward
root@am335x-evm:~# udhcpd /etc/udhcpd.conf
root@am335x-evm:~# iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
</pre>
<ul><li>Use a WiFi-enabled device and look for the Gateway's SSID that was defined in /etc/hostapd.conf. Connect and the device should receive an IP address from the Gateway's DHCP server.</li></ul>
<h1><span class="mw-headline" id="Bluetooth">Bluetooth</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=38" title="Edit section: Bluetooth">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>The Bluetooth stack is supported by Stonestreet One Bluetopia Bluetooth Protocol Stack and Platform Manager. For the Gateway, download the "LINUXEZSDK-WILINK8-BT-EVAL" Bluetooth package from here: <a rel="nofollow" class="external free" href="http://www.ti.com/tool/linuxezsdk-am335x-wilink8">http://www.ti.com/tool/linuxezsdk-am335x-wilink8</a>.
</p><p>For more information about the Stonestreet One Bluetooth overview, see <a rel="nofollow" class="external free" href="TI_Bluetooth_Stack_for_WL18xx_-_Getting_Started_Guide.html">http://processors.wiki.ti.com/index.php/StoneStreet_One_Bluetopia_Platform_Manager_Bluetooth_Stack_for_TI_WL18xx</a>
</p>
<h2><span class="mw-headline" id="Building_Bluetooth">Building Bluetooth</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=39" title="Edit section: Building Bluetooth">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Below is an abridged version of the instructions to compile Stonestreet One Bluetooth stack (version 4.0.1.3) for the Gateway. For full instructions on the Stonestreet One build process, see <a rel="nofollow" class="external free" href="Bluetooth__Stonestreet_One_Build_Process.html">http://processors.wiki.ti.com/index.php/Bluetooth:_Stonestreet_One_Build_Process</a>
</p>
<ul><li>Download and install LINUXEZSDK-WILINK8-BT-EVAL package</li>
<li>Source the Linaro toolchain</li></ul>
<pre>$ source &lt;sdk install dir&gt;/linux-devkit/environment-setup
</pre>
<ul><li>Navigate to the StoneStreet One device library</li></ul>
<pre>$ cd &lt;sso_bt dir&gt;/BluetopiaPM/Bluetopia/sample/SS1BTVEN/
</pre>
<ul><li>Modify BTPSVEND.c file. If BTPSVEND.c already has the below setting correct, the rest of the build steps can be skipped. Proceed to <a href="#Installing_Bluetooth">Installing Bluetooth</a> section.
<ul><li>BLUETOOTH_HCI_DEV_TTY_COM_PORT_NUMBER should be set to 1 for UART1</li>
<li>BLUETOOTH_CONTROLLER_POWER_CYCLE_DELAY should be set to 2000</li></ul></li>
<li>Rebuild BTPSVEND for the Gateway</li></ul>
<pre>$ make -f BTPSVEND.mak
</pre>
<ul><li>Copy library to the lib folder</li></ul>
<pre>$ cp libBTPSVEND.a ../../lib
</pre>
<ul><li>Add Stonestreet One Bluetopia Platform Manager to the environment variables</li></ul>
<pre>$ export BLUETOPIA_PATH=&lt;sso_bt dir&gt;/BluetopiaPM/Bluetopia
$ export BLUETOPIA_ROOT_PATH=&lt;sso_bt dir&gt;/BluetopiaPM/Bluetopia</pre>
<ul><li>Navigate to PM Server (SS1BTPM)</li></ul>
<pre>$ cd &lt;sso_bt dir&gt;/Bluetopia/ss1btpm/server
</pre>
<ul><li>Rebuilt SS1BTPM</li></ul>
<pre>$ make -f SS1BTPM.mak clean
$ make -f SS1BTPM.mak
</pre>
<ul><li>Copy SS1BTPM to the binaries folder</li></ul>
<pre>$ cp SS1BTPM ../../bin/
</pre>
<h2><span class="mw-headline" id="Installing_Bluetooth">Installing Bluetooth</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=40" title="Edit section: Installing Bluetooth">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Below are instructions on how to install the various Bluetooth software components into the Gateway's filesystem.
</p>
<h3><span class="mw-headline" id="Stonestreet_one_binaries">Stonestreet one binaries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=41" title="Edit section: Stonestreet one binaries">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Package the Stonestreet One binaries</li></ul>
<pre>$ cd &lt;sso_bt dir&gt;/Bluetopia/bin
$ tar -zcf sso_bt_4013.tar.gz *
</pre>
<ul><li>Transfer the Stonestreet One tarball to the Gateway</li>
<li>Create a new folder and extract the tarball</li></ul>
<pre>root@am335x-evm:~# cd
root@am335x-evm:~# mkdir sso_bt
root@am335x-evm:~# cd sso_bt
root@am335x-evm:~# tar -zxf sso_bt_4013.tar.gz
root@am335x-evm:~# chmod +x *
</pre>
<h3><span class="mw-headline" id="Bluetooth_firmware">Bluetooth firmware</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=42" title="Edit section: Bluetooth firmware">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Download the firmware, TIInit_11.8.32.bts, from <a rel="nofollow" class="external free" href="https://github.com/TI-ECS/bt-firmware/tree/master/am335x">https://github.com/TI-ECS/bt-firmware/tree/master/am335x</a></li>
<li>Copy TIInit_11.8.32.bts to below location in the filesystem.</li></ul>
<pre>/lib/firmware
</pre>
<h3><span class="mw-headline" id="Bluetooth_enable_kernel_module">Bluetooth enable kernel module</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=43" title="Edit section: Bluetooth enable kernel module">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>Navigate to bt-enable-1.0 folder</li></ul>
<pre>$ cd &lt;sdk install dir&gt;/board-support/extra-drivers/bt-enable-1.0
</pre>
<ul><li>Build the kernel module</li></ul>
<pre>$ make
</pre>
<ul><li>Copy gpio_en.ko to the below location of the filesystem</li></ul>
<pre>/lib/modules/3.2.0/kernel/drivers/bt_enable
</pre>
<h2><span class="mw-headline" id="Running_Bluetooth">Running Bluetooth</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=44" title="Edit section: Running Bluetooth">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>For full instructions on how to run the various Stonestreet One sample applications, see <a rel="nofollow" class="external free" href="TI_Bluetooth_Stack_for_WL18xx_-_Demo_Guide.html">http://processors.wiki.ti.com/index.php/WL18xx_Bluetopia_Platform_Manager_Demo_Guide</a>. Below is an example on how to communicate with a TI SensorTag, <a rel="nofollow" class="external free" href="http://www.ti.com/ww/en/wireless_connectivity/sensortag/index.shtml">http://www.ti.com/ww/en/wireless_connectivity/sensortag/index.shtml</a>.
</p>
<ul><li>Run the Stonestreet One GATM Demo Application</li></ul>
<pre>root@am335x-evm:~# cd /home/root/sso_bt
root@am335x-evm:~# ./SS1BTPM &amp;
root@am335x-evm:~# ./LinuxGATM_CLT
GATM&gt; Initialize 1
GATM&gt; SetDevicePower 1
</pre>
<ul><li>Discover SensorTag</li></ul>
<pre>GATM&gt; StartDeviceDiscovery 1 60
[Press SensorTag side key]
</pre>
<p>Below is an example SensorTag discovery. The rest of the instructions will use "9059AF0B84AD" as the Bluetooth address.  Replace it with your SensorTag's BD_ADDR value.
</p>
<pre>Remote Device Found.
BD_ADDR:             9059AF0B84AD
Address Type:        Public
Device Name:         SensorTag
LE Type:             Single Mode
Device Flags:        0x40080001
LE RSSI:             -73
LE Trans. Power:     0
LE Paired State&#160;:    FALSE
LE Connect State:    FALSE
LE Encrypt State:    FALSE
GATT Services Known: FALSE
</pre>
<ul><li>Pair with SensorTag</li></ul>
<pre>GATM&gt; RegisterAuthentication
GATM&gt; PairWithRemoteDevice 9059AF0B84AD 1
GATM&gt; UserConfirmationResponse 1
</pre>
<ul><li>Connect with SensorTag</li></ul>
<pre>GATM&gt; RegisterGATTCallback
GATM&gt; ConnectWithRemoteDevice 9059AF0B84AD 1
</pre>
<ul><li>Enable Temperature Reading. The raw temperature data will be displayed every one second.</li></ul>
<pre>GATM&gt; WriteValue 9059AF0B84AD 38 1 0100       // Enable notification
GATM&gt; WriteValue 9059AF0B84AD 41 1 01         // Start sensor and measurements
</pre>
<ul><li>Enable Key Press Notifications. The button value will be printed whenever the state of the button changes.</li></ul>
<pre>GATM&gt; ReadValue 9059AF0B84AD 97 0 1 1         // Read user description
GATM&gt; WriteValue 9059AF0B84AD 96 1 0100       // Enable key press notification
</pre>
<h1><span class="mw-headline" id="NFC">NFC</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=45" title="Edit section: NFC">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>This section describes how to build and run the RF430CL330H example code.
</p>
<div style="margin: 5px; padding: 2px 10px; background-color: #ecffff; border-left: 5px solid #3399ff;"><b>NOTE</b><br /><br />A Texas Instruments RF430CL330H daughtercard is needed to run this example. The daughtercard must have the following modifications: 1. short pin 6 and 14 on connector RF1 and, 2. remove resistor R8. For more information on the RF430CL330H daughtercard, please see this site: <a rel="nofollow" class="external text" href="http://www.ti.com/tool/rf430cl330htb">http://www.ti.com/tool/rf430cl330htb</a></div>
<h2><span class="mw-headline" id="Building_NFC">Building NFC</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=46" title="Edit section: Building NFC">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Add SDK6.0's Linaro toolchain into the PATH</li></ul>
<pre>$ export PATH="&lt;sdk install dir&gt;/linux-devkit/sysroots/i686-arago-linux/usr/bin:$PATH"</pre>
<ul><li>Extract nfcTest_sdk6_linaro_gateway.tar.gz that is found in the BSP</li></ul>
<pre>$ tar -zxf nfcTest_sdk6_linaro_gateway.tar.gz</pre>
<ul><li>Navigate into the source folder</li></ul>
<pre>$ cd nfc/nfcTestGw_source</pre>
<ul><li>Compile the source</li></ul>
<pre>$ make</pre>
<ul><li>Generated binary is called "rf430_example"</li></ul>
<h2><span class="mw-headline" id="Running_NFC">Running NFC</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;section=47" title="Edit section: Running NFC">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Attach the RF430CL330H daughtercard to the EM headers (P4 and P5) on the Gateway</li>
<li>Run the NFC binary</li></ul>
<pre>root@am335x-evm:~# nfc/rf430_example</pre>
<ul><li>Place an NFC-enable device (e.g. Android phone) close to the Gateway.</li>
<li>The NFC-enbled device will read the tag "Hello World!" from the Gateway.</li></ul>
</div>
<!-- 
NewPP limit report
Cached time: 20201130202215
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.098 seconds
Real time usage: 0.101 seconds
Preprocessor visited node count: 634/1000000
Preprocessor generated node count: 1256/1000000
Post‐expand include size: 2674/2097152 bytes
Template argument size: 1578/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 6990/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    8.429      1 -total
 18.89%    1.592      1 Template:SpArticleStart
 18.02%    1.519      4 Template:SpNote
 15.85%    1.336      1 Template:SpImportant
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:37585-0!canonical and timestamp 20201130202215 and revision id 193631
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>Smart Home and Energy Gateway Software Manual</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>Smart Home and Energy Gateway Software Manual</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>Smart Home and Energy Gateway Software Manual</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>Smart Home and Energy Gateway Software Manual</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>Smart Home and Energy Gateway Software Manual</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>Smart Home and Energy Gateway Software Manual</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>Smart Home and Energy Gateway Software Manual</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>Smart Home and Energy Gateway Software Manual</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>Smart Home and Energy Gateway Software Manual</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;oldid=193631">https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;oldid=193631</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category_Smart_Grid_%26_Energy.html" title="Category:Smart Grid &amp; Energy">Smart Grid &amp; Energy</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=Smart+Home+and+Energy+Gateway+Software+Manual" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="Smart_Home_and_Energy_Gateway_Software_Manual.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="Smart_Home_and_Energy_Gateway_Software_Manual.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/Smart_Home_and_Energy_Gateway_Software_Manual.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/Smart_Home_and_Energy_Gateway_Software_Manual.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;oldid=193631" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=Smart_Home_and_Energy_Gateway_Software_Manual&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 12 February 2015, at 16:38.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.098","walltime":"0.101","ppvisitednodes":{"value":634,"limit":1000000},"ppgeneratednodes":{"value":1256,"limit":1000000},"postexpandincludesize":{"value":2674,"limit":2097152},"templateargumentsize":{"value":1578,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":6990,"limit":5000000},"timingprofile":["100.00%    8.429      1 -total"," 18.89%    1.592      1 Template:SpArticleStart"," 18.02%    1.519      4 Template:SpNote"," 15.85%    1.336      1 Template:SpImportant"]},"cachereport":{"timestamp":"20201130202215","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":235});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/Smart_Home_and_Energy_Gateway_Software_Manual by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 08:42:07 GMT -->
</html>
