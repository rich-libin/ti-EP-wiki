<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/Template:RemoTI-1.4.0-AdvancedRemote-Voice by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 03:19:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Template:RemoTI-1.4.0-AdvancedRemote-Voice - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"Template","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":10,"wgPageName":"Template:RemoTI-1.4.0-AdvancedRemote-Voice","wgTitle":"RemoTI-1.4.0-AdvancedRemote-Voice","wgCurRevisionId":208275,"wgRevisionId":208275,"wgArticleId":40107,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["RF4CE"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Template:RemoTI-1.4.0-AdvancedRemote-Voice","wgRelevantArticleId":40107,"wgRequestId":"7ff75765bd81cc3714ef83e3","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-10 ns-subject page-Template_RemoTI-1_4_0-AdvancedRemote-Voice rootpage-Template_RemoTI-1_4_0-AdvancedRemote-Voice skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">Template:RemoTI-1.4.0-AdvancedRemote-Voice</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Detailed_guide_to_add_Voice_support_for_the_Advanced_Remote_project"><span class="tocnumber">1</span> <span class="toctext">Detailed guide to add Voice support for the Advanced Remote project</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Project_options_update"><span class="tocnumber">1.1</span> <span class="toctext">Project options update</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Source_files_update"><span class="tocnumber">1.2</span> <span class="toctext">Source files update</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Application"><span class="tocnumber">1.2.1</span> <span class="toctext">Application</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#OSAL"><span class="tocnumber">1.2.2</span> <span class="toctext">OSAL</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Driver"><span class="tocnumber">1.2.3</span> <span class="toctext">Driver</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Detailed_guide_to_add_Voice_support_for_the_Advanced_Remote_project">Detailed guide to add Voice support for the Advanced Remote project</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=edit&amp;section=1" title="Edit section: Detailed guide to add Voice support for the Advanced Remote project">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section describes all steps required to add the Voice remote functionality to RemoTI-1.4.0. There are several aspects and gotchas to consider. Each code snippet that is added comes with a brief comment of why it is added.
</p>
<h3><span class="mw-headline" id="Project_options_update">Project options update</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=edit&amp;section=2" title="Edit section: Project options update">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ol>
 <li>Add <code>$PROJ_DIR$\..\..\..\..\COMPONENTS\audio\include</code> to the include paths</li>
 <li>Add to the pre-compiler options the following two defines</li>
 <table>
  <tbody><tr><td>
<pre>  <code>
  CC2533F96_VRC_REVB
  RAS_LIB
  </code>
</pre>
  </td></tr>
 <tr><td><a href="File_IncludePath-Define-ForVoiceRemote.html" class="image"><img alt="IncludePath-Define-ForVoiceRemote.png" src="https://processors.wiki.ti.com/images/b/b1/IncludePath-Define-ForVoiceRemote.png" width="550" height="513" /></a></td></tr>
 </tbody></table>
 <li>We need to link with the audio library, in addition to the network library. Instead of adding the path to the compile options, we add a folder in the project, and then place both libraries there.</li>
<pre><a href="File_AudioLibraryFolderInIARproject.html" class="image"><img alt="AudioLibraryFolderInIARproject.png" src="https://processors.wiki.ti.com/images/c/cf/AudioLibraryFolderInIARproject.png" width="389" height="172" /></a>
</pre>
 <li>Uncheck the box which includes command line arguments for the linker. This is required since we add the library to the project in a new folder.</li>
<pre><a href="File_UncheckIncludeCommandLineArgumentsForLinker.html" class="image"><img alt="UncheckIncludeCommandLineArgumentsForLinker.png" src="https://processors.wiki.ti.com/images/a/a2/UncheckIncludeCommandLineArgumentsForLinker.png" width="551" height="218" /></a>
</pre>
 <li>We also need to add <code>hal_codec.c</code> to drive the codec</li>
<pre><a href="File_AddAudioCodecDriverInIARproject.html" class="image"><img alt="AddAudioCodecDriverInIARproject.png" src="https://processors.wiki.ti.com/images/a/ad/AddAudioCodecDriverInIARproject.png" width="388" height="206" /></a>
</pre>
 <li>To improve throughput and processing time we need to use compiler optimization settings for speed</li>
<pre><a href="File_AudioIARprojectOptimizationForSpeed.html" class="image"><img alt="AudioIARprojectOptimizationForSpeed.png" src="https://processors.wiki.ti.com/images/4/46/AudioIARprojectOptimizationForSpeed.png" width="550" height="302" /></a>
</pre>
</ol>
<h3><span class="mw-headline" id="Source_files_update">Source files update</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=edit&amp;section=3" title="Edit section: Source files update">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Application">Application</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=edit&amp;section=4" title="Edit section: Application">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>In the main application code, <code>rsa_point.c</code>
</p>
<ol>
 <li>Include headers</li>
<pre><code>
#include "hal_codec.h"
#include "ras_lib.h"
</code>
</pre>
 <li>Add stream event to the event list</li>
<pre><code>
// RSA Events
#define RSA_EVT_INIT                    0x0001
...
#ifdef RAS_LIB
#define RSA_EVT_STOP_STREAM             0x0100
#endif 
</code>
</pre>
 <li>Add stream state to the state enum</li>
<pre><code>
// RSA States
enum
{
...
 RSA_STATE_POLLING,
#ifdef RAS_LIB
 RSA_STATE_STREAM,
#endif
};
</code>
</pre>
 <li>Add action define for audio and "push-to-talk". These defines serve as function pointer table index in the array <code>rsaAppKeyActions</code>. We simply subtract 0xB0 to use them as index.</li>
<pre><code>
#define RSA_ACT_TOGGLE_POLL        0xB8
#if (defined RAS_LIB)
#define RSA_ACT_AUDIO              0xB9
#define RSA_ACT_PUSH_TO_TALK       0xBA
#endif //RAS_LIB
#define RSA_ACT_APP_END            0xBA
</code>
</pre>
 <li>Add action in key map, so that an action is associated with a button on the remote.</li>
<pre><code>
...
 { RSA_ACT_XMIT, RTI_CERC_RECORD, HID_NONE },                   // 0b00 00 1000   - REC
 { RSA_ACT_XMIT, RTI_CERC_NUM_1, HID_KEYBOARD_1 },              // 0b00 00 1001   - 1
#if (defined RAS_LIB)
 { RSA_ACT_AUDIO, RTI_CERC_RESERVED_1, HID_NONE },              // 0b00 00 1010   - AV
#else
 { RSA_ACT_KEY_EX, RTI_CERC_RESERVED_1, HID_NONE },             // 0b00 00 1010   - AV
#endif //RAS_LIB
 { RSA_ACT_PAIR, RTI_CERC_RESERVED_1, HID_NONE },               // 0b00 00 1100   - RED (K1)
...
 { RSA_ACT_UNPAIR, RTI_CERC_RESERVED_1, HID_NONE },             // 0b00 01 1011   - YELLOW (K3)
#if (defined RAS_LIB)
 { RSA_PUSH_TO_TALK, RTI_CERC_RESERVED_1, HID_NONE },           // 0b00 01 1100   - GREEN (K2)
#else
 { RSA_ACT_TEST_MODE, RTI_CERC_RESERVED_1, HID_NONE },          // 0b00 01 1100   - GREEN (K2)
#endif
 { RSA_ACT_XMIT, RTI_CERC_NUM_8, HID_KEYBOARD_8 },              // 0b00 01 1101   - 8
...
</code>
</pre>
 <li>Add functions to handle key press, and callback from audio library</li>
<pre><code>
#if (defined RAS_LIB)
static void rsaAudioKeyAction( rsaKeyState_t keyState );
static void rsaPushToTalkKeyAction( rsaKeyState_t keyState );
static void rsaAudioToggle(void);
void RSA_StreamStopped( uint8 status);
#endif //RAS_LIB
</code>
</pre>
 <li>Add audio key action functions to function array.</li>
<pre><code>
const rsaAppActionFn_t rsaAppKeyActions[] =
{
...
  rsaTogglePollAction,
#if (defined RAS_LIB)
  rsaAudioKeyAction,
  rsaPushToTalkKeyAction
#endif //RAS_LIB
</code>
</pre>
 <li>Add state variable to track audio state</li>
<pre><code>
#ifdef RAS_LIB
static uint8 rsaAudioState;
#endif //RAS_LIB
</code>
</pre>
 <li>Initialize audio state when application initializes</li>
<pre><code>
void RSA_Init( uint8 taskId )
{
...
#ifdef RAS_LIB
  rsaAudioState = RSA_STATE_READY;
#endif //RAS_LIB
</code>
</pre>
 <li>Add STOP_STREAM event handling</li>
<pre><code>
uint16 RSA_ProcessEvent( uint8 taskId, uint16 events )
{
...
#ifdef RAS_LIB
  if (events &amp; RSA_EVT_STOP_STREAM)
  {
    if ( (rsaState == RSA_STATE_STREAM) )
    {
      //Rest the codec to put it in Power down mode
      Hal_codecReset();
      //Stop the MCLK
      Hal_codecMclockStop();
      RAS_Stop(); //==&gt; Lib will call the stop confirmation callback
      
      //Technically, it s not ready, a packet might be pending in the queue...
      //Wait for the callback before chaning state
      //rsaState = RSA_STATE_READY;
    }
    return events ^ RSA_EVT_STOP_STREAM;
  }
#endif 
</code>
</pre>
 <li>We need all processing that has to do with audio to happen fast. So we use local compile optimization pragmas. Note that this is redundant when we can afford to use speed optimization globally, however it is required when we have to select parts of the code to optimize for speed. When streaming audio we route the send data confirmation to the audio library. Following are the updates required in the <code>RTI_SendDataCnf()</code></li>
<pre><code>
#ifdef RAS_LIB
#pragma optimize=speed
#endif
void RTI_SendDataCnf( rStatus_t status )
{
#ifdef RAS_LIB    
  if( (rsaState == RSA_STATE_STREAM))
  {
    RAS_SendDataCnf(status);
  }
#endif
</code>
</pre>
 <li> Add function to process callback from audio library </li>
<pre><code>
#if (defined RAS_LIB)
void RSA_StreamStopped( uint8 status)
{ 
  rsaState = RSA_STATE_READY;

  if(status == 0)
  {
#if (defined HAL_BUZZER) &amp;&amp; (HAL_BUZZER == TRUE)
    /* Tell OSAL to not go to sleep because buzzer uses T3 */
    osal_pwrmgr_task_state( RSA_TaskId, PWRMGR_HOLD );
    
    RSA_PlayTune( RSA_TUNE_END  ); // ring buzzer to signal end
#endif    
  }
  else
  {
    //Status fail, stop the clock...
    Hal_codecReset();
    //Stop the MCLK
    Hal_codecMclockStop();
    
#if (defined HAL_BUZZER) &amp;&amp; (HAL_BUZZER == TRUE)
    /* Tell OSAL to not go to sleep because buzzer uses T3 */
    osal_pwrmgr_task_state( RSA_TaskId, PWRMGR_HOLD );

    RSA_PlayTune( RSA_TUNE_ERROR  ); // ring buzzer to signal end error
#endif    
  }
  
  rsaAudioState = RSA_STATE_READY;
}
#endif // RAS_LIB
</code>
</pre>
 <li>Add function to start/stop audio stream</li>
<pre><code>
#if (defined RAS_LIB)
uint8 globalRsaCalledRAS_Start = FALSE;
static void rsaAudioToggle(void)
{
  if(  rsaDestIndex&#160;!= RTI_INVALID_PAIRING_REF)
  {
    {
      if(rsaState == RSA_STATE_STREAM)          
      {
        if (rsaAudioState == RSA_STATE_STREAM)
        {
          //Rest the codec to put it in Power down mode
          Hal_codecReset();
          //Stop the MCLK
          Hal_codecMclockStop();
          RAS_Stop(); //==&gt; Lib will call the stop confirmation callback
          
          //Technically, it s not ready, a packet might be pending in the queue...
          //Wait for the callback before changing state
          //rsaState = RSA_STATE_READY;
        }
      }
      else if (rsaState == RSA_STATE_READY)
      {
        if (rsaAudioState == RSA_STATE_READY)
        {
          rasCfg_t rasAudioCfg;
          rsaState = RSA_STATE_STREAM;
          
          //First start the MCLK and reset the codec.
          Hal_codecMclockStart(4000);
          Hal_codecReset();
          
          //Configure the codec
#ifdef CC2533F96_VRC_REVB
          Hal_codecInit16kHz_ADC3101_mic_vrc_diff();    
#else
          Hal_codecInit16kHz_ADC3101_mic_vrc();    
#endif            
          //Hal_codecInit16kHz_ADC3101_lineIn_vrc();
          
          //Initialize the Audio Configuration Structure.
          rasAudioCfg.fs       = 16;
          rasAudioCfg.nbBits  =  16;
          rasAudioCfg.format   = 1;
          rasAudioCfg.ras_StreamStopped   = RSA_StreamStopped;
          rsaAudioState = RSA_STATE_STREAM;
          
          globalRsaCalledRAS_Start = TRUE;
          RAS_Start( rsaDestIndex , rasAudioCfg);
          globalRsaCalledRAS_Start = FALSE;
          
          //If the audio needs to run for a specific duration, set a timeout now.
          //if (rasCfg.duration)
          //  osal_start_timerEx(RSA_TaskId, RSA_EVT_STOP_AUDIO_CMD,rasCfg.duration*10 );
        }
      }
    }    
  }  
}
#endif // RAS_LIB
</code>
</pre>
</ol>
<h4><span class="mw-headline" id="OSAL">OSAL</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=edit&amp;section=5" title="Edit section: OSAL">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>In the OSAL setup code, <code>rsa_osal.c</code> perform the following steps
</p>
<ol>
 <li>Include header</li>
<pre><code>
#include "ras_lib.h"
</code>
</pre>
 <li>Add <code>RAS_ProcessEvent</code> function to the task processing functions array. Position in array reflects the priority given to the audio task</li>
<pre><code>
const pTaskEventHandlerFn tasksArr[] =
{
  macEventLoop,
  RCN_ProcessEvent,
  RTI_ProcessEvent,
#ifdef RAS_LIB
  RAS_ProcessEvent,
#endif //RAS_LIB  
  gdpOriginator_ProcessEvent,
  RSA_ProcessEvent,
  Hal_ProcessEvent
};
</code>
</pre>
 <li>Add OSAL init function for audio task. Again, order is not random, but reflects task priority</li>
<pre><code>
void osalInitTasks( void )
{
...
  RTI_Init( taskID++ );
#ifdef RAS_LIB
  RAS_Init( taskID++ );
#endif //RAS_LIB  
  gdpOriginator_Init( taskID++ );
</code>
</pre>
</ol>
<h4><span class="mw-headline" id="Driver">Driver</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=edit&amp;section=6" title="Edit section: Driver">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>In the main file, <code>rsa_main.c</code>, add hardware initialization steps required for the codec.
</p>
<ol>
 <li>Include header</li>
<pre><code>
#include "hal_codec.h"
</code>
</pre>
 <li>Call the codec reset functions</li>
<pre><code>
#if (defined RAS_LIB)
  Hal_codecResetConfig();
  Hal_codecReset();
#endif
</code>
</pre>
</ol>
<p>In the CODEC driver file <code>hal_codec.c</code>, set global ticks to 0. The buzzer driver has been updated to use a divided global tick source (8MHz). Before starting the codec we must set it back to an undivided clock.
</p>
<ol>
 <li>While setting up the master clock, set the global tick speed back to undivided.</li>
<pre><code>
void Hal_codecMclockStart( uint16 freq )
{
...
  /* Configure output pin as peripheral since we're using T4 to generate */
  MCLK_SEL |= (uint8)HAL_MCLK_GPIO_PINS;

  CLKCONCMD &amp;= (TICKSPD_MASK ^ 0xFF);
  
  T4CTL = divider |
          HAL_T4_TIMER_CTL_CLEAR |
          opmode;
</code>
</pre>
</ol>
<p>In the DMA driver file <code>hal_dma.c</code>, add hooks for the audio library.
</p>
<ol>
 <li>Include header</li>
<pre><code>
#include "ras_lib.h"
</code>
</pre>
 <li>Add <code>RAS_LIB</code> to precompiler clause to enable DMA interrupt, and to implement interrupt handler</li>
<pre><code>
void HalDmaInit( void )
{
</code></pre><code>
<p>...
</p>
<pre>#if (HAL_UART_DMA || \
  ((defined HAL_SPI) &amp;&amp; (HAL_SPI == TRUE))  || \
  (defined RAS_LIB)  || \
  ((defined HAL_IRGEN) &amp;&amp; (HAL_IRGEN == TRUE)))
 DMAIE = 1;
#endif
}
</pre>
</code><pre><code>#if (HAL_UART_DMA || \
   ((defined HAL_SPI) &amp;&amp; (HAL_SPI == TRUE))  || \
   (defined RAS_LIB)   || \
   ((defined HAL_IRGEN) &amp;&amp; (HAL_IRGEN == TRUE)))
/******************************************************************************
 * @fn      HalDMAInit
</code>
</pre>
 <li>Add call to audio library's DMA interrupt handler</li>
<pre><code>
#if (defined RAS_LIB) 
  if ( HAL_DMA_CHECK_IRQ( HAL_DMA_CH_RX ) )
  {
    HAL_DMA_CLEAR_IRQ( HAL_DMA_CH_RX );
    RAS_DmaIsr();
  }
#endif 
</code>
</pre>
</ol>
<p>In the key scanner driver <code>hal_key.c</code> update to support voice remote layout
</p>
<ol>
 <li>Voice remote uses P0.7 instead of P1.4 for key scan, so update relevant macros.</li>
<pre><code>
#ifdef CC2533F96_VRC_REVB
  //VRC-RevB use P0.7 for key scan.
  #define HAL_KEY_P0_GPIO_PINS  ( HAL_KEY_BIT0 | HAL_KEY_BIT1 | HAL_KEY_BIT2 | HAL_KEY_BIT3 | HAL_KEY_BIT4 | HAL_KEY_BIT7)
#else
  #define HAL_KEY_P0_GPIO_PINS  ( HAL_KEY_BIT0 | HAL_KEY_BIT1 | HAL_KEY_BIT2 | HAL_KEY_BIT3 | HAL_KEY_BIT4)
#endif
...
#ifndef CC2533F96_VRC_REVB
  //adv. remote use P1.4 for key scan.
  #define HAL_KEY_P1_GPIO_PINS  ( HAL_KEY_BIT4 )
#endif
...
#ifdef CC2533F96_VRC_REVB
  //VRC-RevB use P0.7 for key scan.
  #define HAL_KEY_P0_OUTPUT_PINS  ( HAL_KEY_BIT3 | HAL_KEY_BIT4 | HAL_KEY_BIT7)
#else
  #define HAL_KEY_P0_OUTPUT_PINS  ( HAL_KEY_BIT3 | HAL_KEY_BIT4 )
#endif
...
#ifndef CC2533F96_VRC_REVB
  #define HAL_KEY_P1_OUTPUT_PINS  ( HAL_KEY_BIT4 )
#endif
...
#ifdef CC2533F96_VRC_REVB
  #define HAL_KEY_SHIFT_REGISTER_DATA_PIN   P0_7
#else
  #define HAL_KEY_SHIFT_REGISTER_DATA_PIN   P1_4
#endif
</code>
</pre>
 <li>In the initialization routine we no longer have to setup Port 1 since no pins are connected anymore</li>
<pre><code>
#ifndef CC2533F96_VRC_REVB
  P1SEL &amp;= (uint8) ~HAL_KEY_P1_GPIO_PINS;
#endif  
...
#ifndef CC2533F96_VRC_REVB
  P1DIR |= (uint8) HAL_KEY_P1_OUTPUT_PINS;
#endif
</code>
</pre>
</ol>
<p>In the accelerometer driver <code>hal_accel.c</code> update to support voice remote layout
</p>
<ol>
 <li>Voice remote uses P1.3 instead of P1.2 for accelerometer interrupt and no pin to control power to the accelerometer, so update relevant macros.</li>
<pre><code>
#ifdef CC2533F96_VRC_REVB
//VRC-Rev B: P1.3 used for Accel interrupt
#define HAL_ACCEL_P1_GPIO_PINS  ( BV(3) )
/* These defines indicate the direction of each pin */
#define HAL_ACCEL_P1_INPUT_PINS  ( BV(3) )
/* Which pins are used for key interrupts */
#define HAL_ACCEL_P1_INTERRUPT_PINS   ( BV(3) )
#else
...
/* Which pins are used for key interrupts */
#define HAL_ACCEL_P1_INTERRUPT_PINS   ( BV(2) )
...
#endif
</code>
</pre>
 <li>Then update initialization code</li>
<pre><code>
 /* Initialize outputs */
#ifdef CC2533F96_VRC_REVB
  P1SEL &amp;= (uint8) ~HAL_ACCEL_P1_GPIO_PINS;
  P1DIR &amp;= (uint8) ~HAL_ACCEL_P1_INPUT_PINS;
#else
...
 P1DIR &amp;= (uint8) ~HAL_ACCEL_P1_INPUT_PINS;
#endif
</code>
</pre>
</ol>
<p>In the gyro driver <code>hal_gyro.c</code> update to support voice remote layout
</p>
<ol>
 <li>Voice remote uses P1.2 instead of P1.3 for gyro interrupt, and no pin to control power to the gyro, so update relevant macros.</li>
<pre><code>
</code></pre><code>
<ol><li>ifdef CC2533F96_VRC_REVB</li></ol>
</code><pre><code>/* The following define which port pins are being used by the gyro */
#define HAL_GYRO_P0_GPIO_PINS  ( BV( 5 ) )
#define HAL_GYRO_P1_GPIO_PINS  ( BV( 2 ) )
/* These defines indicate the direction of each pin */
#define HAL_GYRO_P0_OUTPUT_PINS  ( BV( 5 ) )
#define HAL_GYRO_P1_OUTPUT_PINS  ( BV( 2 ) )
/* Defines for each output pin assignment */
#define HAL_GYRO_CLKIN_PIN  P0_5
#define HAL_GYRO_INT_PIN    P1_2
#else
...
#define HAL_GYRO_INT_PIN    P1_3
#endif
</code>
</pre>
 <li>Update initialization code to not control power pin, which no longer exist</li>
<pre><code>
#ifndef CC2533F96_VRC_REVB
  HAL_GYRO_POWER_PIN = 1;
#endif  
</code>
</pre>
</ol>

<!-- 
NewPP limit report
Cached time: 20201130082347
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.057 seconds
Real time usage: 0.061 seconds
Preprocessor visited node count: 22/1000000
Preprocessor generated node count: 28/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:40107-0!canonical and timestamp 20201130082347 and revision id 208275
 -->
</div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;oldid=208275">https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;oldid=208275</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category_RF4CE.html" title="Category:RF4CE">RF4CE</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=Template%3ARemoTI-1.4.0-AdvancedRemote-Voice" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-template" class="selected"><span><a href="Template_RemoTI-1.4-3.html" title="View the template [c]" accesskey="c">Template</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Template_talk:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="Template_RemoTI-1.4-3.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/Template_RemoTI-1.4-3.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/Template_RemoTI-1.4-3.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;oldid=208275" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=Template:RemoTI-1.4.0-AdvancedRemote-Voice&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 13 October 2015, at 04:59.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.057","walltime":"0.061","ppvisitednodes":{"value":22,"limit":1000000},"ppgeneratednodes":{"value":28,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":0,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20201130082347","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":181});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/Template:RemoTI-1.4.0-AdvancedRemote-Voice by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 03:19:41 GMT -->
</html>
