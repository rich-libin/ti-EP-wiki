<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/TI_DirectShow_Filters by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 04:21:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>TI DirectShow Filters - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"TI_DirectShow_Filters","wgTitle":"TI DirectShow Filters","wgCurRevisionId":181703,"wgRevisionId":181703,"wgArticleId":3855,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["WinCE"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"TI_DirectShow_Filters","wgRelevantArticleId":3855,"wgRequestId":"401b36fb3ca884dc3140c342","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-TI_DirectShow_Filters rootpage-TI_DirectShow_Filters skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">TI DirectShow Filters</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#DirectShow_Filters_for_TI_multimedia_stack"><span class="tocnumber">1</span> <span class="toctext">DirectShow Filters for TI multimedia stack</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Overview"><span class="tocnumber">1.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Decode_System_Architecture"><span class="tocnumber">1.2</span> <span class="toctext">Decode System Architecture</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Details_on_Decode_Filter_Architecture"><span class="tocnumber">1.3</span> <span class="toctext">Details on Decode Filter Architecture</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#Version_1.0"><span class="tocnumber">1.3.1</span> <span class="toctext">Version 1.0</span></a>
<ul>
<li class="toclevel-4 tocsection-6"><a href="#Filter_graph_creation_.28File_open.29"><span class="tocnumber">1.3.1.1</span> <span class="toctext">Filter graph creation (File open)</span></a></li>
<li class="toclevel-4 tocsection-7"><a href="#Data_Flow_in_video_streaming_thread"><span class="tocnumber">1.3.1.2</span> <span class="toctext">Data Flow in video streaming thread</span></a></li>
<li class="toclevel-4 tocsection-8"><a href="#End_of_stream"><span class="tocnumber">1.3.1.3</span> <span class="toctext">End of stream</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#Filter_graph_destruction_.28File_close.29"><span class="tocnumber">1.3.1.4</span> <span class="toctext">Filter graph destruction (File close)</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-10"><a href="#Version_1.10"><span class="tocnumber">1.3.2</span> <span class="toctext">Version 1.10</span></a>
<ul>
<li class="toclevel-4 tocsection-11"><a href="#Filter_graph_creation_.28File_open.29_2"><span class="tocnumber">1.3.2.1</span> <span class="toctext">Filter graph creation (File open)</span></a></li>
<li class="toclevel-4 tocsection-12"><a href="#Data_Flow_in_video_streaming_threads"><span class="tocnumber">1.3.2.2</span> <span class="toctext">Data Flow in video streaming threads</span></a>
<ul>
<li class="toclevel-5 tocsection-13"><a href="#End_of_stream_2"><span class="tocnumber">1.3.2.2.1</span> <span class="toctext">End of stream</span></a></li>
<li class="toclevel-5 tocsection-14"><a href="#Seeks"><span class="tocnumber">1.3.2.2.2</span> <span class="toctext">Seeks</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-15"><a href="#Data_Flow_in_audio_streaming_thread"><span class="tocnumber">1.3.2.3</span> <span class="toctext">Data Flow in audio streaming thread</span></a>
<ul>
<li class="toclevel-5 tocsection-16"><a href="#End_of_stream_3"><span class="tocnumber">1.3.2.3.1</span> <span class="toctext">End of stream</span></a></li>
<li class="toclevel-5 tocsection-17"><a href="#Seek_operations"><span class="tocnumber">1.3.2.3.2</span> <span class="toctext">Seek operations</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-18"><a href="#Filter_graph_destruction_.28File_close.29_2"><span class="tocnumber">1.3.2.4</span> <span class="toctext">Filter graph destruction (File close)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-19"><a href="#Debugging_tips"><span class="tocnumber">1.4</span> <span class="toctext">Debugging tips</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="#How_to_obtain_debug_trace_to_debug_the_data_flow_in_the_filter"><span class="tocnumber">1.4.1</span> <span class="toctext">How to obtain debug trace to debug the data flow in the filter</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#When_media_failed_to_play"><span class="tocnumber">1.4.2</span> <span class="toctext">When media failed to play</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="#How_to_figure_out_the_GUID_for_a_specific_media_type"><span class="tocnumber">1.4.3</span> <span class="toctext">How to figure out the GUID for a specific media type</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#How_to_register_a_filter_for_a_given_media_type"><span class="tocnumber">1.4.4</span> <span class="toctext">How to register a filter for a given media type</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-24"><a href="#Using_Super_to_create_video_clips_for_CEPlayer_on_WinCE"><span class="tocnumber">1.5</span> <span class="toctext">Using Super to create video clips for CEPlayer on WinCE</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Creating_a_filter_for_a_new_codec.2Falgorithm"><span class="tocnumber">1.6</span> <span class="toctext">Creating a filter for a new codec/algorithm</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Summary"><span class="tocnumber">1.7</span> <span class="toctext">Summary</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Useful_Resources"><span class="tocnumber">1.8</span> <span class="toctext">Useful Resources</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="DirectShow_Filters_for_TI_multimedia_stack">DirectShow Filters for TI multimedia stack</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=1" title="Edit section: DirectShow Filters for TI multimedia stack">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Link to latest version of this article: <a class="mw-selflink selflink">TI_DirectShow_Filters</a>
</p>
<h2><span class="mw-headline" id="Overview">Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=2" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>DirectShow is a multimedia framework produced by Microsoft for Windows applications to perform various operations with media files or streams. In particular, the DirectShow framework is used in the WinCE environment to render audio and video. Similar to other multimedia frameworks such as Gstreamer, DirectShow uses a modular architecture, in which the application hooks up a number of software components called filters. Each filter would implement one particular stage in the processing of the data, and can have one or more input and output connections, called 'pins'. Buffers exchanged between input and output pins are called media samples. Not only do media samples hold the data to be processed, but they also contain meta-data such as timestamps. In a given DirectShow-based application (e.g. CEPlayer), a filter graph is constructed using a group of filters by making pin connections, and the resulting filter graph is run to perform data i/o and intermediate processing.
</p><p>For more info on DirectShow, please refer to MSDN. An overview can be found at <a rel="nofollow" class="external free" href="http://msdn.microsoft.com/en-us/library/ms778824(VS.85).aspx">http://msdn.microsoft.com/en-us/library/ms778824(VS.85).aspx</a>
</p><p>When rendering a file in the WinCE Media Player (also known as CEPlayer), DirectShow's filter graph manager goes through a filter selection and connection process based on the type of media being played. WinCE comes with a set of default filters, including a file source filter, an AVI demux/splitter filter and a video rendering filter (aka the video renderer). It also comes with a default set of decode filters for MPEG1, MPEG2, MP3, and WMV. However, these decode filters do the decoding on the ARM processor. On TI OMAP and Davinci platforms, there is typically a DSP processor that can be used for accelerating decode operations. So it would make sense to supply filters that would perform the decoding on the DSP instead to free up the ARM application processor, and to provide support for unsupported codecs such as H264.
</p><p>The purpose of this page is to hold information related to the DirectShow filters provided by TI to leverage some of the codecs available on the DSP, so that the latter can help offload the system.
</p>
<h2><span class="mw-headline" id="Decode_System_Architecture">Decode System Architecture</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=3" title="Edit section: Decode System Architecture">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The CEPlayer is an application provided by Windows CE out-of-box for video and audio playback. The player calls into the DirectShow framework in order to perform the video and audio processing, and in particular the decoding is handled within the decode filter, as illustrated in Fig. 1:
</p><p><br />
<b>Fig. 1 System Overview</b>
</p><p><a href="File_Dshow_overview.html" class="image" title="Fig. 1 System Overview"><img alt="Fig. 1 System Overview" src="https://processors.wiki.ti.com/images/0/0d/Dshow_overview.png" width="920" height="644" /></a>
</p><p>TI currently provides several decode filters, one for each type of codec supported (note that even though Fig.1 only shows video decode filters, audio decode filters have a similar story). Each of these filters consists of two parts, compiled into separate DLLs. The first part, written in C++, is codec-specific and implements all of the functions that are expected to be exposed by a DirectShow filter. It defines the connection process to ensure the filter only connects to appropriate filters at its input and output (or you can think of input as being "upstream" and output as being "downstream" in data streaming terminology). It also specifies the corresponding names of the engine and codec to be opened on the DSP server. The second part is a C library called TIMM that invokes DMAI and Codec Engine to perform the processing, and is common to all filters. It acts as a wrapper around Codec Engine software stack and only needs to be compiled once for a given codec server. Some of the benefits of having such a shared DLL are:
</p>
<ul><li>Reducing code size: DMAI and Codec Engine APIs are linked only once into TIMM, and the code is shared across all filters.</li>
<li>Minimizing the use of a hybrid build process: The TIMM library requires a hybrid build process that uses gmake, configuro (utility provided by XDCTOOLS to use TI software) and the WinCE build system. This is somewhat complex and therefore it'd be desirable to minimize the user's exposure to this build system if possible. By having the current architecture, only the TIMM library needs to be build using this hybrid build process. The filter DLLs (i.e. the part that implements all the basic functions that are needed in a DirectShow filter) have no dependency on the binaries in Codec Engine, DMAI, etc.. Hence they can be compiled using the standard build flow in WinCE. If someone were to add a filter for a codec that is already included as part of the standard DSP codec server shipped in the DVSDK, they can write it and simply compile it using the standard WinCE build flow.</li>
<li>Having an API that is more geared towards the use in a DirectShow filter: DMAI and Codec Engine are designed to be flexible and exposes many features such as creation of contiguous buffers, display/capture driver control and color space conversion just to name a few. On the other hand, TIMM exposes just the bare minimum in terms of supporting the DirectShow filters supplied by TI. So it should in theory require less of a learning curve.</li>
<li>Facilitating the creation of new filters to support new codecs: When creating a filter for another video codec for example, one can reuse the application code in the TIMM library, saving development time.</li></ul>
<p>Access to the DSP is enabled by TI's Codec Engine framework. The decode filter uses DMAI/Codec Engine API to control codecs compiled into the DSP codec server (ie. the DSP executable). Interprocessor communication is handled by DSPLINK underneath the hood of Codec Engine.
</p>
<h2><span class="mw-headline" id="Details_on_Decode_Filter_Architecture">Details on Decode Filter Architecture</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=4" title="Edit section: Details on Decode Filter Architecture">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>When rendering video, normally there are three main threads created by DirectShow when playing a video:
</p>
<ul><li>The thread that runs the source filter and pushes the data through the AVI splitter;</li>
<li>The video streaming thread, which takes data from the 'video' output pin of the AVI splitter and runs the video decode filter and renderer;</li>
<li>The audio streaming thread. which takes data from the 'audio' output pin of the AVI splitter and runs the audio decode filter and renderer.</li></ul>
<p>In addition, there will typically be a filter graph manager thread which oversees control of the filter graph and the application's thread.
</p><p>DirectShow filters are COM-based software components that have any number of inputs and outputs, called pins. In TI's implementation of the decode filters, all filters are transform filters (i.e. inherit from the class CTransformFilter), with single input and output pins. The input pin only accepts media types that are relevant to the decoder it encapsulates. More information on the structure of a transform filter can be found at <a rel="nofollow" class="external free" href="http://msdn.microsoft.com/en-us/library/aa921464.aspx">http://msdn.microsoft.com/en-us/library/aa921464.aspx</a>
</p>
<h3><span class="mw-headline" id="Version_1.0">Version 1.0</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=5" title="Edit section: Version 1.0">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This version of the filters contain only video filters. Therefore, we would focus mainly on the filter graph manager thread and the video streaming thread in this discussion.
</p>
<h4><span id="Filter_graph_creation_(File_open)"></span><span class="mw-headline" id="Filter_graph_creation_.28File_open.29">Filter graph creation (File open)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=6" title="Edit section: Filter graph creation (File open)">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>When a video clip is opened in the WinCE Media Player (ceplayer.exe), the latter calls into the filter graph manager to create a graph of filters to render the given clip. The filter graph manager goes through a filter selection and connection process that is detailed on MSDN. The main steps are shown in Fig. 2.
</p><p><br />
<b>Fig. 2 Connection process</b>
</p><p><a href="File_Filter_connection_process.html" class="image" title="Fig. 2 Connection process"><img alt="Fig. 2 Connection process" src="https://processors.wiki.ti.com/images/d/db/Filter_connection_process.png" width="723" height="510" /></a>
</p><p><br />
This filter connection process is standard in the world of DirectShow filters, except for the opening of Codec Engine and the codec instance in step 6, which is TI-specific. For generic information regarding the connection process, refer to steps 3 and 4 in MSDN's documentation on "Writing Transform Filters" (<a rel="nofollow" class="external free" href="http://msdn.microsoft.com/en-us/library/ms788165(VS.85).aspx">http://msdn.microsoft.com/en-us/library/ms788165%28VS.85%29.aspx</a>). One fine point is that over the course of the filter graph building process, the filter may potentially be instantiated multiple times. Given a source, the filter graph manager tries to connect it with each one of the filters available in the system until it finds one that can connect to it, and iterates through this process til it forms a complete graph. Each time it'd attempt to instantiate the filter, query for its supported media types, and if it fails to connect it'd destroy the instance. Hence it is always better to do as little as possible in the constructor of the filter, and leave the heavier tasks such as opening up the Codec Engine till late in the connection process, once we are almost certain that the connection will be established. In TI's decode filters, we have chosen to do it during the 'DecideBufferSize' stage, during which media types have already been agreed upon and the filter is simply trying to finalize the buffer count and buffer size for the output media samples that would be passed downstream. Typically after the DecideBufferSize function call succeeds, the connection of the filter is complete, and the filter graph is finalized by the filter graph manager.
</p><p>A typical graph constructed by the filter graph manager for video playback looks like the one shown in the upper part of Fig. 1. This is the graph we will focus on from now on in our discussion. The source filter is hooked up to a demux filter (e.g. AVI Splitter), which splits the data stream into its audio and video components. The video stream is sent down to the decode filter, which output is passed to the Video Renderer. Similarly, the audio stream is decoded in a filter and rendered at the Audio Renderer. At the time of writing, only video is accelerated on the DSP.
</p><p>Based on the final graph, one or more streaming threads are then created by the main thread to handle video and/or audio processing.
</p>
<h4><span class="mw-headline" id="Data_Flow_in_video_streaming_thread">Data Flow in video streaming thread</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=7" title="Edit section: Data Flow in video streaming thread">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The data flow in the filter while the graph is in running state is shown in Fig. 3.
</p><p><br />
<b>Fig. 3 Receiving data in video thread</b>
</p><p><a href="File_Receiving_data_in_video_thread.html" class="image" title="Fig. 3 Receiving data in video thread"><img alt="Fig. 3 Receiving data in video thread" src="https://processors.wiki.ti.com/images/e/ed/Receiving_data_in_video_thread.png" width="894" height="624" /></a>
</p><p><br />
</p>
<ol><li>StartStreaming() is called by DirectShow when a filter enters the Running state. This function technically runs in the filter graph manager thread, though it is synchronized to run prior to the processing in the video thread. We leverage this function to find out the stride of the DirectDraw surfaces used by the Video Renderer. Note that we need to do this because in some cases the stride does not necessarily match up with the width of an output image (e.g. when the VRFB is enabled on the OMAP3530).</li>
<li>In the video thread, the Receive function is called on each input sample. For each sample, the filter copies the input data into a physically contiguous buffer, and passes it to the DSP, which does the processing and may return one or more display frames back to the ARM as a result. This is done via the function TIMM_algExecViddec2.</li>
<li>The filter records the meta data such as timestamps from the input sample.</li>
<li>If there are display frames returned from the DSP, the filter would allocate an output sample from the Video Renderer</li>
<li>The filter then transfers the display frame data into the sample. During the transfer of the display data, color space conversion may be necessary depending on the media type requested by the video renderer. What media type is requested by the renderer depends on how it decides to render the video, as we'll explain below.</li>
<li>The filter binds the output sample to the corresponding meta data.</li>
<li>After the output sample is fully prepared, it is finally delivered downstream.</li>
<li>The output sample is released from the decode filter. If more than one display frame comes back from the codec, the filter would repeat the whole process of allocating an output sample, filling it, binding it and delivering it for each one of the frames.</li></ol>
<p>To clarify the flow in terms of buffer management, Fig. 4 summarizes how a typical video buffer moves through the system:
</p><p><br />
<b>Fig. 4 Buffer management</b>
</p><p><a href="File_Decode_filter_buffer_management.html" class="image" title="Fig. 4 Buffer management"><img alt="Fig. 4 Buffer management" src="https://processors.wiki.ti.com/images/0/04/Decode_filter_buffer_management.png" width="872" height="422" /></a>
</p><p><br />
As shown, there are a total of 2 buffer copies performed as part of the decode filter, if we put aside the decode operation itself.
</p><p>Given memory copies are expensive, one would ask why we need to do the data copies in steps 2 and 5 from Fig. 3. Why not simply pass the buffer obtained from the input or output media sample directly to the DSP? As it turns out, the copy of the input data (step 2) is a result of the fact that the filter upstream may choose to use its own 'allocator'. An allocator is used for allocating the media samples between two filters. The input pin of the decode filter can propose an allocator to the output pin of the filter upstream, possibly one that allocates physically contiguous buffers. However, the output pin of the filter upstream always has the final say as to which allocator to use. As a result, the decode filter cannot force the filter upstream to give it samples that reside in physically contiguous memory.
</p><p>Copy of the output data in step 5 is needed for a different reason. In this case, the decode filter is the upstream filter and can decide which allocator to use. However, the constraint comes now from the operation of the Video Renderer. The Video Renderer normally renders video using DirectDraw, which provides the application with direct access to the video display buffers. Meanwhile, TI decoders generally outputs display data in YUV format. Since DirectDraw supports YUV data, filling out the buffer in the output media sample is as simple as making a direct copy from the decoded buffer from the DSP -- a copy that we could have possibly avoided. However, under certain conditions (e.g. when the video window is shrunk or when it is hidden by another window), the Video Renderer will revert to using GDI for rendering the video. Because GDI does not support YUV color spaces, the Video Renderer filter would 'dynamically' request a change in the media type on the output pin to RGB. As a result, a YUV to RGB conversion would need to be performed by the filter on the decoded data from the DSP. It is customary for users to observe higher CPU utilization under these conditions. Now if the DSP were to directly use the buffers allocated from the output pin, the filter would then need to do the color conversion plus an extra copy to bring the converted data back into the output sample, given the color conversion is not performed in-place. Therefore, we have chosen to do the extra copy under DirectDraw operation to avoid further penalizing the already slower use-case. Taking from the rich to give to the poor, so to speak.
</p>
<h4><span class="mw-headline" id="End_of_stream">End of stream</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=8" title="Edit section: End of stream">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The EndOfStream() function is called by the video streaming thread when the last frame in the video clip is reached. It flushes the DSP codec, and delivers all flushed display frames downstream. In order to get ready for a possible repeat of the same clip, it needs to close the flushed codec and re-create a new instance of it. Finally it delivers the end of stream notification downstream.
</p>
<h4><span id="Filter_graph_destruction_(File_close)"></span><span class="mw-headline" id="Filter_graph_destruction_.28File_close.29">Filter graph destruction (File close)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=9" title="Edit section: Filter graph destruction (File close)">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>When a file is closed, the destructor of the filter is called by the filter graph manager. It performs clean-up by closing the codec instance and exits Codec Engine itself.
</p>
<h3><span class="mw-headline" id="Version_1.10">Version 1.10</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=10" title="Edit section: Version 1.10">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This version of the filters contain both video decode filters and audio decode filters. In this section we will discuss both of them.
</p>
<h4><span id="Filter_graph_creation_(File_open)_2"></span><span class="mw-headline" id="Filter_graph_creation_.28File_open.29_2">Filter graph creation (File open)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=11" title="Edit section: Filter graph creation (File open)">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>For both video and audio filters, the filter graph creation process is essentially the same as in the previous version. Refer to the [<a rel="nofollow" class="external text" href="http://ap-fpdsp-swapps.dal.design.ti.com/index.php/TI_DirectShow_Filters#Filter_graph_creation_.28File_open.29">|discussion</a>] in version 1.0. The only difference is in DecideBufferSize(). We now spawn a worker thread of a priority level that is one less than the main video thread (i.e. higher priority) that would be later used during processing to decouple display from the input. The priority is chosen so that we minimize any accumulation of data between the two threads.
</p>
<h4><span class="mw-headline" id="Data_Flow_in_video_streaming_threads">Data Flow in video streaming threads</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=12" title="Edit section: Data Flow in video streaming threads">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The data flow in the filter while the graph is in running state is shown in Fig. 5.
</p><p><br />
<b>Fig. 5 Receiving data using a worker thread</b>
</p><p><a href="File_Receiving_data_in_video_thread_1.10.html" class="image" title="Fig. 5 Receiving data using a worker thread"><img alt="Fig. 5 Receiving data using a worker thread" src="https://processors.wiki.ti.com/images/7/7e/Receiving_data_in_video_thread_1.10.png" width="923" height="874" /></a>
</p><p><br />
</p>
<ol><li>StartStreaming() is called by DirectShow when a filter enters the Running state. This function technically runs in the filter graph manager thread, though it is synchronized to run prior to the processing in the video thread. We leverage this function to find out the stride of the DirectDraw surfaces used by the Video Renderer. Note that we need to do this because in some cases the stride does not necessarily match up with the width of an output image (e.g. when the VRFB is enabled on the OMAP3530).</li>
<li>In the video thread, the Receive function is called on each input sample. For each sample, the filter copies the input data into a physically contiguous buffer, and passes it to the DSP, which does the processing and may return one or more display frames back to the ARM as a result. The display frames are then queued up for the worker thread.</li>
<li>The filter records the meta data such as timestamps from the input sample, and queue the meta data entry up for the worker thread.</li>
<li>The worker thread waits for a meta data entry from the main video thread.</li>
<li>The worker thread gets an output sample and fill it with meta data from the received meta data entry.</li>
<li>If the frame arrived too late or if a seek operation happened, the filter may need to discard the next decoded display frame. Otherwise, it transfers the display frame data into the sample. During the transfer of the display data, color space conversion may be necessary depending on the media type requested by the video renderer. What media type is requested by the renderer depends on how it decides to render the video, as we have explained in the architecture discussion in version 1.0.</li>
<li>After the output sample is fully prepared, it is finally delivered downstream.</li>
<li>The output sample is released from the decode filter. The worker thread then goes back to wait for the next meta data entry from the main video thread.</li></ol>
<p>To deal with occasional spikes in processing time, buffers have been pre-allocated between the main video thread and the worker thread for both display frames and meta data entries. The maximum number of display frames that can be queued at one time between the two threads is NUMBUFS + the maximum number of buffers a codec may hold internally at once. The latter is dependent on the video codec itself, as there are cases when the decoder may decide to keep display frames internally and to only return them for display later on in time. Meanwhile, NUMBUFS is set in &lt;dshow_install_dir&gt;\timm\timm_viddec2.c, and represents the number of buffers used for smoothing video processing spikes. Similarly, the maximum number of meta entries that can be queued up is set by MAXNUMMETAENTRIES in the &lt;dshow_install_dir&gt;\filters\&lt;filter_name&gt;\&lt;filter_name&gt;.cpp file. Under normal operation, one would set NUMBUFS + max # of buffers held by codec to be less than or equal to MAXNUMMETAENTRIES. This is because the number of meta entries queued up represents the number of display frames expected at the output, and the total number of display frames in the queue and codec can never exceed this number at any given time. Therefore, increasing NUMBUFS and/or MAXNUMMETAENTRIES will allow for better "smoothing" of spikes in processing load over multiple frames, at the expense of a higher amount of memory allocated from CMEM and the system.
</p><p>Let's now look at the data flow in terms of buffer management, Fig. 6 summarizes how a typical video buffer moves through the system:
</p><p><br />
<b>Fig. 6 Buffer management</b>
</p><p><a href="File_Buffer_management_video_1.10.html" class="image" title="Fig. 6 Buffer management"><img alt="Fig. 6 Buffer management" src="https://processors.wiki.ti.com/images/a/a6/Buffer_management_video_1.10.png" width="764" height="365" /></a>
</p><p><br />
As shown, there are a total of 2 buffer copies performed as part of the decode filter, if we put aside the decode operation itself. The rationale behind the data copies was explained in the discussion for version 1.0.
</p><p>One enhancement we did with respect to the copy of the output data in step 6 of Fig. 5 is to use the SDMA to perform the data transfer, when the hardware is available on the platform used and the corresponding SDMA proxy driver is available. This helps alleviate loading on the ARM processor.
</p>
<h5><span class="mw-headline" id="End_of_stream_2">End of stream</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=13" title="Edit section: End of stream">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The EndOfStream() function is called by the main video streaming thread when the last frame in the video clip is reached. It flushes the DSP codec, and sends all flushed display frames to the worker thread which then delivers them downstream, looping through steps 4 through 8 in Fig. 5. In order to get ready for a possible repeat of the same clip, it shutdowns the worker thread, closes the flushed codec and re-creates a new instance of both the codec and the worker thread. Finally it delivers the end of stream notification downstream.
</p>
<h5><span class="mw-headline" id="Seeks">Seeks</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=14" title="Edit section: Seeks">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The EndFlush() function is called by the main video thread when a seek operation occurs. The way this is handled is by recording the number of meta entries queued up between the worker thread and the main video thread and ensure that the worker thread discards those entries and their corresponding display frames. This results in a fast transition to the new video segment.
</p>
<h4><span class="mw-headline" id="Data_Flow_in_audio_streaming_thread">Data Flow in audio streaming thread</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=15" title="Edit section: Data Flow in audio streaming thread">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The data flow in an audio decode filter while the graph is in running state is shown in Fig. 7.
</p><p><br />
<b>Fig. 7 Receiving data in audio thread</b>
</p><p><a href="File_Receiving_data_in_audio_thread_1.10.html" class="image" title="Fig. 7 Receiving data in audio thread"><img alt="Fig. 7 Receiving data in audio thread" src="https://processors.wiki.ti.com/images/2/22/Receiving_data_in_audio_thread_1.10.png" width="848" height="537" /></a>
</p>
<ol><li>In the audio thread, the Receive function is called on each input sample. For each sample, the filter copies the input data into a physically contiguous circular buffer. This is done via the function TIMM_queueInputDataAuddec1.</li>
<li>The filter requests an output sample from the allocator downstream.</li>
<li>TIMM_algExecAuddec1() is called. If there is sufficient data in the circular buffer for the XDM codec's process() function to be called, the call would be performed. The decoded audio buffer is copied into the buffer provided by the output sample. However, if there is insufficient data, the audio thread returns from the Receive() function and works on the next input sample.</li>
<li>The output sample is stamped with timestamps that are computed based on the number of audio samples that have been previously rendered. This 'time counter' is reset every time there is a seek operation.</li>
<li>The output sample is delivered downstream.</li>
<li>The output sample is released from the decode filter. If more than one display frame comes back from the codec, the filter would repeat the whole process of allocating an output sample, filling it, binding it and delivering it for each one of the frames.</li></ol>
<p>To clarify the flow in terms of buffer management, Fig. 8 summarizes how a typical audio buffer moves through the filter:
</p><p><br />
<b>Fig. 8 Buffer management in audio decode filters</b>
</p><p><a href="File_Buffer_management_audio_1.10.html" class="image" title="Fig. 8 Buffer management in audio decode filters"><img alt="Fig. 8 Buffer management in audio decode filters" src="https://processors.wiki.ti.com/images/a/af/Buffer_management_audio_1.10.png" width="771" height="392" /></a>
</p><p><br />
As shown, there are a total of 2 buffer copies performed as part of the decode filter, if we put aside the decode operation itself. The copy of the input data (step 1 in Fig. 7) is needed due to the fact that the process() function of a codec may require more input data then what is available in a given input sample. So we need to queue up the data in physically contiguous memory until there is sufficient data to process. Moreover, the filter upstream may choose to use its own 'allocator'. An allocator is used for allocating the media samples between two filters. The input pin of the decode filter can propose an allocator to the output pin of the filter upstream, possibly one that allocates physically contiguous buffers. However, the output pin of the filter upstream always has the final say as to which allocator to use. As a result, the decode filter cannot force the filter upstream to give it samples that reside in physically contiguous memory. Yet physically contiguous memory is necessary for processing by the DSP.
</p><p>Copy of the output data in step 3 can arguably be removed by forcing the downstream filter to use an allocator that uses contiguous memory. However, because the volume of data in audio processing is relatively low compared to video, we have chosen to simplify things by performing the data copy. This is certainly an area in the audio filters that is open to further optimizations.
</p>
<h5><span class="mw-headline" id="End_of_stream_3">End of stream</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=16" title="Edit section: End of stream">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The EndOfStream() function is called by the audio streaming thread when the last set of input data is reached. It would loop through steps 2 to 6 in Fig. 7 until there is no more data in the circular buffer, regardless of the minimum amount of data the DSP codec normally requires as input. After that, it delivers the end of stream notification downstream.
</p>
<h5><span class="mw-headline" id="Seek_operations">Seek operations</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=17" title="Edit section: Seek operations">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>The EndFlush() function is called by the audio thread when a seek operation occurs. The way this is handled is by discarding all data queued up in the circular buffer to ensure a quick transition to the new segment.
</p>
<h4><span id="Filter_graph_destruction_(File_close)_2"></span><span class="mw-headline" id="Filter_graph_destruction_.28File_close.29_2">Filter graph destruction (File close)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=18" title="Edit section: Filter graph destruction (File close)">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>When a file is closed, the destructor of the filter is called by the filter graph manager. It performs clean-up by tearing down any working thread created by the filter, flushing all data queues and closing the codec instance. Finally it exits Codec Engine itself.
</p>
<h2><span class="mw-headline" id="Debugging_tips">Debugging tips</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=19" title="Edit section: Debugging tips">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="How_to_obtain_debug_trace_to_debug_the_data_flow_in_the_filter">How to obtain debug trace to debug the data flow in the filter</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=20" title="Edit section: How to obtain debug trace to debug the data flow in the filter">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>The codec-specific dlls (mpeg4videodecoder.dll, h264videodecoder.dll, mpeg2videodecoder.dll) and TIMM.dll all have debug zones implemented. The debug zones are as follows:
</p>
<ul><li><i>Info</i>: verbose information messages. Excellent for finding out what is happening on a frame-by-frame basis. Will cause the filters to miss real-time due to verbosity.</li>
<li><i>Stats</i>: periodic statistics (e.g. CPU load in the TIMM dll, # of frames per sec in the codec-specific dlls). Generally not very verbose, so has minimal effect on run-time performance.</li>
<li><i>Perf</i> (only available in TIMM.dll): verbose performance related messages. Gives some more info on performance, but due to its frame-by-frame nature it will cause the filters to miss real-time.</li>
<li><i>Error</i>: error messages</li>
<li><i>Warning</i>: warning messages</li></ul>
<p>To enable debug zones, do the following:
</p>
<ul><li>Ensure you have enabled both the kernel debugger and KITL under your OS design project properties-&gt;configuration properties-&gt;build option.</li>
<li>Open up the clip of your choice in CEPlayer. This will cause the DLLs to be loaded.</li>
<li>Select Target-&gt;CE Debug Zones option in Visual Studio</li>
<li>Find the dll for which you want debug zones enabled in the list. Enable the zones of your choice.</li>
<li>Hit OK</li></ul>
<p>All output is generated using RETAILMSG calls, hence will work for both debug and retail builds of the DLLs.
</p><p>You may wish to reopen the clip a second time to catch any debug messages that were missed while you are enabling the debug zones the first time.
</p><p>To learn more regarding debug zones, refer to MSDN documentation.
</p>
<h3><span class="mw-headline" id="When_media_failed_to_play">When media failed to play</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=21" title="Edit section: When media failed to play">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>It is possible that one tries to play a clip in the CEPlayer and it wouldn't play. Typically there would be an error popup message such as "No Video Renderer found". This happens when the filter graph manager failed to construct a graph that would render the clip selected. When this happens, and you are think you are certain that the media type can be played using TI's codecs, you can check out the trace from DirectShow itself to find out about the filter construction process. To do so, enable the first 4 debug zones in quartz.dll
</p><p>To enable the debug zones, do the following:
</p>
<ul><li>Ensure you have enabled both the kernel debugger and KITL under your OS design project properties-&gt;configuration properties-&gt;build option.</li>
<li>If you are working on the retail configuration of your OS design, rebuild the debug configuration, rename the quartz.* files in the release folder of the retail configuration to quartz_retail.*, and copy the files quartz.* from the release folder of the debug configuration to the release folder of the retail configuration. Do a makeimg on the retail configuration.</li>
<li>Start your OS</li>
<li>Open up the CEPlayer.</li>
<li>Select Target-&gt;CE Debug Zones option in Visual Studio</li>
<li>Find quartz.dll in the list of DLLs. Enable the first 4 zones in the list of debug zones. Hit Apply then OK.</li>
<li>Open up the clip you are having trouble with in CEPlayer.</li></ul>
<p>The resulting output in Visual Studio is very verbose. In particular, you will see the filter graph manager attempt to connect pins together based on the media type requested by output pin of the filter upstream. It will try to enumerate every filter in the system to attempt to find out that would work with that media type. For example:
</p>
<pre>41242370 PID:5580006 TID:58b000a RegEnumFilterInfo pin        0 (1: e436eb83 e436eb88 0)-(0:        0        0)
41242370 PID:5580006 TID:58b000a RegEnumFilterInfo[6e560]: Considering f3e5aa25 (Audio MP3 Decoder filter)
41242370 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 55
PB Debugger Loaded 'C:\WINCE600\OSDESIGNS\EVM_OMAP3530\EVM_3530\RELDIR\TI_EVM_3530_ARMV4I_RELEASE\MPEG2VIDEODECODER.DLL', no matching symbolic information found.
41242370 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 50
41242370 PID:5580006 TID:58b000a RegEnumFilterInfo: Audio MP3 Decoder filter not wanted (input wog output O)
41242370 PID:5580006 TID:58b000a RegEnumFilterInfo[6e760]: Considering ecad26de (H264 Video Decoder Filter)
41242370 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 34363268
41242370 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 34363248
41242370 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 48535356
41242370 PID:5580006 TID:58b000a RegEnumFilterInfo: H264 Video Decoder Filter not wanted (input wog output O)
41242370 PID:5580006 TID:58b000a RegEnumFilterInfo[6e960]: Considering 2b8e6cff (MPEG4 Video Decoder Filter)
41242370 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 44495658
41242748 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 58564944
41242748 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 5634504d
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 3234504d
41242780 PID:5580006 TID:58b000a RegEnumFilterInfo: MPEG4 Video Decoder Filter not wanted (input wog output O)
41242780 PID:5580006 TID:58b000a RegEnumFilterInfo[6e9e0]: Considering 1bb0ea4a (MPEG2 Video Decoder Filter)
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 e436eb81
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 e436eb80
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 3267706d
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 3247504d
41242780 PID:5580006 TID:58b000a RegEnumFilterInfo: MPEG2 Video Decoder Filter not wanted (input wog output O)
41242780 PID:5580006 TID:58b000a RegEnumFilterInfo[622c0]: Considering 5bae8e20 (WMAudio Decoder DMO)
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 160
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 161
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 162
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 163
41242780 PID:5580006 TID:58b000a RegEnumFilterInfo: WMAudio Decoder DMO not wanted (input wog output O)
41242780 PID:5580006 TID:58b000a RegEnumFilterInfo[6ea20]: Considering 38be3000 (MPEG-1 Layer-3 Decoder)
41242780 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 e436eb80
41242836 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 e436eb81
41242836 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 55
41242836 PID:5580006 TID:58b000a RegEnumFilterInfo: MPEG-1 Layer-3 Decoder not wanted (input wog output O)
41242836 PID:5580006 TID:58b000a RegEnumFilterInfo[6e660]: Considering 3ff9f0d8 (WMVideo &amp; MPEG4 Decoder DMO)
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 3234706d
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 3234504d
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 3334706d
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 3334504d
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 7334706d
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 5334504d
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 31564d57
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 31766d77
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 32564d57
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 32766d77
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 33564d57
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 33766d77
41242839 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 50564d57
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 70766d77
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 41564d57
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 61766d77
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 32505657
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 32707677
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 31435657
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 31637677
41242887 PID:5580006 TID:58b000a RegEnumFilterInfo: WMVideo &amp; MPEG4 Decoder DMO not wanted (input wog output O)
41242887 PID:5580006 TID:58b000a RegEnumFilterInfo[6e5e0]: Considering 70e102b0 (Video Renderer)
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 0
41242887 PID:5580006 TID:58b000a RegEnumFilterInfo: Video Renderer not wanted (input wog output O)
41242887 PID:5580006 TID:58b000a RegEnumFilterInfo[6ea60]: Considering e30629d1 (Audio Renderer)
41242887 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 0
41242979 PID:5580006 TID:58b000a RegEnumFilterInfo: Audio Renderer not wanted (input wog output O)
PB Debugger Loaded 'C:\WINCE600\OSDESIGNS\EVM_OMAP3530\EVM_3530\RELDIR\TI_EVM_3530_ARMV4I_RELEASE\DECODECOMBO1.DLL', no matching symbolic information found.
41242979 PID:5580006 TID:58b000a RegEnumFilterInfo[6eca0]: Considering 48025243 (Internal Script Command Renderer)
41242979 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73636d64 0
41242979 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73747874 0
41242979 PID:5580006 TID:58b000a RegEnumFilterInfo: Internal Script Command Renderer not wanted (input wog output O)
41242979 PID:5580006 TID:58b000a RegEnumFilterInfo[6ece0]: Considering feb50740 (MPEG Video Codec)
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 e436eb80
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73646976 e436eb81
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo: MPEG Video Codec not wanted (input wog output O)
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo[6eee0]: Considering 4a2286e0 (MPEG Audio Codec)
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 e436eb80
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 e436eb81
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 50
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo: MPEG Audio Codec not wanted (input wog output O)
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo[625c0]: Considering 521fb373 (WMSpeech Decoder DMO)
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 a
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo: WMSpeech Decoder DMO not wanted (input wog output O)
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo[6ef20]: Considering 6a08cf80 (ACM Wrapper)
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(73647561 0
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo: ACM Wrapper not wanted (input wog output O)
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo[685a0]: Considering b9d1f32e (ASF embedded stuff Handler)
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(18056900 736c7275
41242989 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(18056900 74726c6d
41242989 PID:5580006 TID:58b000a RegEnumFilterInfo: ASF embedded stuff Handler not wanted (input wog output O)
41243000 PID:5580006 TID:58b000a RegEnumFilterInfo[68900]: Considering b9d1f323 (ASF URL Handler)
41243000 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(18056900 59dacfc0
41243000 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(18056900 14082850
41243000 PID:5580006 TID:58b000a RegEnumFilterInfo: ASF URL Handler not wanted (input wog output O)
41243000 PID:5580006 TID:58b000a RegEnumFilterInfo[6d060]: Considering b9d1f322 (ASF ICM Handler)
41243000 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(18056900 bc19efc0
41243000 PID:5580006 TID:58b000a RegEnumFilterInfo: ASF ICM Handler not wanted (input wog output O)
41243000 PID:5580006 TID:58b000a RegEnumFilterInfo[6ee20]: Considering b9d1f321 (ASF ACM Handler)
41243000 PID:5580006 TID:58b000a No type match yet: Req (e436eb83 e436eb88) Found(18056900 f8699e40
41243000 PID:5580006 TID:58b000a RegEnumFilterInfo: ASF ACM Handler not wanted (input wog output O)
41243000 PID:5580006 TID:58b000a RegEnumFilterInfo[6ee60]: Considering 1b544c20 (AVI Splitter)
41243000 PID:5580006 TID:58b000a Types match: Req (e436eb83 e436eb88) Found(e436eb83 e436eb88
41243028 PID:5580006 TID:58b000a RegEnumFilterInfo returning AVI Splitter
41243028 PID:5580006 TID:58b000a EnumRegFilters returning 1 filters
</pre>
<p>The above trace snippet shows the filter graph manager trying to find a filter that would accept media type "e436eb83 e436eb88" from the output of the source filter. Eventually it found the AVI Splitter filter being able to accept such a media type at its input pin. If at some point in the trace the filter graph manager is unable to locate a filter that would support a media type, then the graph building process would fail. You would need to find out what that media type is and figure out which filter is supposed to take it and why it isn't, etc. A common root cause could be that the stream is mislabeled with a data type not recognized by the corresponding filter. See the sections "How to figure out the GUID for a specific media type" and  "How to register a filter for a given media type" in this case.
</p><p><br />
Eventually, once you are successful in tracking down the problem and fixing it, you should get a complete filter graph dump. Here's an example of one that successfully played an MPEG4 video clip in an AVI container:
</p>
<pre> 686282 PID:5340006 TID:57d000a Filter graph dump
 686282 PID:5340006 TID:57d000a Filter e9460 'Video Renderer' Iunknown e9450
 686282 PID:5340006 TID:57d000a     Pin e98e8 Input (Input) connected to e664c
 686282 PID:5340006 TID:57d000a Filter e62cc 'MPEG4 Video Decoder Filter' Iunknown e62c0
 686282 PID:5340006 TID:57d000a     Pin e654c XForm In (Input) connected to e0390
 686282 PID:5340006 TID:57d000a     Pin e664c XForm Out (PINDIR_OUTPUT) connected to e98e8
 686282 PID:5340006 TID:57d000a Filter e4e10 'Audio Renderer' Iunknown e4e00
 686282 PID:5340006 TID:57d000a wo: GetPin, 0
 686282 PID:5340006 TID:57d000a     Pin e5010 Audio Input pin (rendered) (Input) connected to e48ec
 686282 PID:5340006 TID:57d000a Filter 6354c 'Audio MP3 Decoder filter' Iunknown 63540
 686282 PID:5340006 TID:57d000a     Pin e47ec XForm In (Input) connected to e0630
 686282 PID:5340006 TID:57d000a     Pin e48ec XForm Out (PINDIR_OUTPUT) connected to e5010
 686282 PID:5340006 TID:57d000a MP3: NonDelegatingQueryInterface
 686282 PID:5340006 TID:57d000a Filter 693d0 'AVI Splitter' Iunknown 693c0
 686282 PID:5340006 TID:57d000a     Pin e0630 Stream 01 (PINDIR_OUTPUT) connected to e47ec
 686282 PID:5340006 TID:57d000a     Pin e0390 Stream 00 (PINDIR_OUTPUT) connected to e654c
 686282 PID:5340006 TID:57d000a     Pin 6e6b0 input pin (Input) connected to 68da0
 686282 PID:5340006 TID:57d000a MP3: NonDelegatingQueryInterface
 686282 PID:5340006 TID:57d000a Filter 68c70 '\Storage Card\MPEG4 MP3 D1 1.7Mbps 23.97fps.AVI' Iunknown 68c60
 686282 PID:5340006 TID:57d000a     Pin 68da0 Output (PINDIR_OUTPUT) connected to 6e6b0
 686282 PID:5340006 TID:57d000a End of filter graph dump
</pre>
<h3><span class="mw-headline" id="How_to_figure_out_the_GUID_for_a_specific_media_type">How to figure out the GUID for a specific media type</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=22" title="Edit section: How to figure out the GUID for a specific media type">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>GUIDs are identifiers used to designate media types, and are useful for understanding filter graphs and registering filters. Unfortunately there is no complete list of all the GUIDs for all media types at one place. The following items may be able to help:
</p>
<ul><li>The files PUBLIC\DIRECTX\OAK\FILES\directx.reg, PUBLIC\DIRECTX\SDK\INC\uuids.h, PUBLIC\DIRECTX\SDK\INC\wmcodectypes.h</li>
<li>Common FourCC codes list: <a rel="nofollow" class="external free" href="http://msdn.microsoft.com/en-us/library/ms867195.aspx#fourcccodes">http://msdn.microsoft.com/en-us/library/ms867195.aspx#fourcccodes</a></li>
<li>A Microsoft DirectShow developer (if you know of any!)</li></ul>
<p>Typically, a GUID is constructed with a prefix that contains the hexadecimal equivalent to the four letters to the FourCC code corresponding to its type, with the letters spelled in reverse order. E.g. FMP4 would have a GUID prefix of 0x34504d46, i.e. "4PMF". The suffix seems to be 0000-0010-8000-00AA00389B71 most of the time for video subtypes.
</p><p>If a GUID hasn't been defined anywhere in WinCE, you can define it yourself in your filter so that you can register against it, e.g.:
</p>
<pre>DEFINE_GUID(MEDIASUBTYPE_mpg2,
0x3247504D, 0x0000, 0x0010, 0x80, 0x00, 0x00, 0xAA, 0x00, 0x38, 0x9B, 0x71);
</pre>
<h3><span class="mw-headline" id="How_to_register_a_filter_for_a_given_media_type">How to register a filter for a given media type</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=23" title="Edit section: How to register a filter for a given media type">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Registration is done at multiple levels:
</p>
<ul><li>In the registry. Each DirectShow filter comes with a set of registry entries which needs to be copied manually into the BSP after changes. It contains entries such as this for its input and output pins:</li></ul>
<pre>[HKEY_CLASSES_ROOT\CLSID\{F3E5AA25-3203-4ead-8DC6-BA46AF506294}\Pins\Input\Types\{73647561-0000-0010-8000-00AA00389B71}\{00000055-0000-0010-8000-00AA00389B71}]
</pre>
<p>The above example corresponds to registration of a major type with GUID of {73647561-0000-0010-8000-00AA00389B71} and a subtype of {00000055-0000-0010-8000-00AA00389B71}. The major type's GUID can usually be figured out by looking at the registration of existing filters in RelDir\reginit.ini. It's usually either video or audio. Figuring out the subtype is a little trickier. The subtype's GUID needs to be determined using the techniques described in the previous section on "How to figure out the GUID for a specific media type".
</p>
<ul><li>In the AMOVIESETUP_MEDIATYPE structure in the filter's C code. This structure lists the media types supported by the filter. For example, the structure looks as follows for MPEG2:</li></ul>
<p>&lt;syntaxhighlight lang='c'&gt;
static const AMOVIESETUP_MEDIATYPE sudInputPinTypes[] =
{
</p>
<pre>   {
       &amp;MEDIATYPE_Video,            // Major type
       &amp;MEDIASUBTYPE_MPEG1Payload   // Minor type
   },
   {
       &amp;MEDIATYPE_Video,            // Major type
       &amp;MEDIASUBTYPE_MPEG1Packet    // Minor type
   },
   {
       &amp;MEDIATYPE_Video,            // Major type
       &amp;MEDIASUBTYPE_MPG2           // Minor type
   },
   {
       &amp;MEDIATYPE_Video,            // Major type
       &amp;MEDIASUBTYPE_mpg2           // Minor type
   }
</pre>
<p>};
&lt;/syntaxhighlight&gt;
</p><p>\WINCE600\PUBLIC\DIRECTX\OAK\FILES\directx.reg, \WINCE600\PUBLIC\DIRECTX\SDK\INC\wmcodectypes.h and \WINCE600\PUBLIC\DIRECTX\SDK\INC\uuids.h are good files to look into to find out about the predefined types. If you have a media which GUID is not defined anywhere in WinCE, you can define it yourself in your filter as described in the previous section on "How to figure out the GUID for a specific media type".
</p>
<ul><li>Modify the code in CheckInputType(), GetMediaType() and CheckTransform() to ensure the type is accepted by your filter's input and/or output pins. These functions are used during construction of a filter graph, and if they are not modified they may result in the filter being rejected by the filter graph manager. Check out an existing filter to find out how to write these functions.</li></ul>
<h2><span class="mw-headline" id="Using_Super_to_create_video_clips_for_CEPlayer_on_WinCE">Using Super to create video clips for CEPlayer on WinCE</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=24" title="Edit section: Using Super to create video clips for CEPlayer on WinCE">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Super is a free tool that is available here: <a rel="nofollow" class="external free" href="http://www.erightsoft.com/SupCk2.html">http://www.erightsoft.com/SupCk2.html</a>
</p><p>This tool is very handy in order to convert your existing video into a format that is supported by the media player on WinCE.
</p><p>Here's a screenshot of the tool:
</p><p><a href="File_Super_main_screen.html" class="image" title="Context menu in Super"><img alt="Context menu in Super" src="https://processors.wiki.ti.com/images/e/e1/Super_main_screen.png" width="638" height="689" /></a>
</p><p>To use this tool, first select the appropriate output container, output video codec and output audio codec. Here's a summary of the various container formats and codecs supported by the filters out-of-box in each major release:
</p>
<table width="100%" border="1" align="center" cellpadding="1" cellspacing="1">
<caption><b>Media formats supported by DirectShow filters</b>
</caption>
<tbody><tr>
<td><b>Version</b>
</td>
<td><b>Container formats</b>
</td>
<td><b>Codecs</b>
</td></tr>
<tr>
<td>1.0
</td>
<td>avi
</td>
<td>MPEG2, MPEG4, H264, MP3
</td></tr>
<tr>
<td>1.10
</td>
<td>avi
</td>
<td>MPEG2, MPEG4, H264, MP3
</td></tr>
<tr>
<td>
</td>
<td>mp4/3gp
</td>
<td>MPEG4, H264, AAC
</td></tr></tbody></table>
<p>Choose "FFmpeg" as the tool used for encode. This is a very versatile tool, and supports almost all formats that possibly exists.
</p><p>For Video Scale Size, simply select the radio button "NoChange". This will preserve your original clip's resolution. Or you can choose to change the size by using the other options.
</p><p>Select the bitrate you'd like to use for the output. Suggest you use &lt; 4Mbps for smoother playback.
</p><p>Right click anywhere in the main window. Select "Output File Saving Management" and choose the location at which the newly encoded file will reside.
</p><p><a href="File_Super.html" class="image" title="Context menu in Super"><img alt="Context menu in Super" src="https://processors.wiki.ti.com/images/9/96/Super.png" width="837" height="746" /></a>
</p><p>Then drop a valid multimedia file into the box near the bottom. You can use any file that is perhaps using a different container format or encoded using a different codec. Make sure the file is checked after it has been added.
</p><p>Hit the "Encode (Active Files)" button. Super will then prompt you for the variants of the encoding to use (aka Rendered file optimizer). Each variant is identified with a FourCC code (see <a rel="nofollow" class="external free" href="http://www.fourcc.org/">http://www.fourcc.org/</a>). The Directshow filters currently only support the media encoded with encoders with these FourCC codes, which have been found to work with TI decoders:
</p>
<table width="100%" border="1" align="center" cellpadding="1" cellspacing="1">
<caption><b>FourCC codes supported by DirectShow filters</b>
</caption>
<tbody><tr>
<td><b>Codec</b>
</td>
<td><b>FourCC codes supported</b>
</td></tr>
<tr>
<td>MPEG2
</td>
<td>mpg2, MPG2
</td></tr>
<tr>
<td>MPEG4
</td>
<td>FMP4, MP4V, DIVX, XVID
</td></tr>
<tr>
<td>H264
</td>
<td>H264, h264, VSSH
</td></tr></tbody></table>
<p>Super will then transcode the media into the new format, and you can now play the output file on your board in CEPlayer.
</p>
<h2><span id="Creating_a_filter_for_a_new_codec/algorithm"></span><span class="mw-headline" id="Creating_a_filter_for_a_new_codec.2Falgorithm">Creating a filter for a new codec/algorithm</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=25" title="Edit section: Creating a filter for a new codec/algorithm">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The current DirectShow filters only support a small set of codecs run on the DSP. It might be desirable at some point to add support for other xDM-compliant codecs (or even non-codec algorithms, as long as it adheres to one of the xDM interfaces). In a way, the filters supplied by TI can be considered examples of how any DSP codec can be run from DirectShow. In general, supporting a new codec on the DSP consists of doing the following:
</p>
<ul><li>Create a codec server that contains the codec. This can be done by using existing tools such as the RTSC codec/server/combo package wizards (<a href="RTSC_Codec_And_Server_Package_Wizards.html" title="RTSC Codec And Server Package Wizards">RTSC_Codec_And_Server_Package_Wizards</a>). These tools run on a Windows PC and 'package' up the codec in such a way it can be consumed in a server package. The latter contains the DSP image that runs the codec on the DSP. Note that only one server image can run at any one time on the DSP, hence if you still intend to use the existing filters in your new system, you would need to add the corresponding codecs into your new DSP server as well.</li>
<li>If the codec you want to run implements the IVIDDEC2 xDM interface, you can pick an existing filter and modify it to run your codec instead. Here's an outline of the procedure to follow:
<ul><li>Pick a filter (say MPEG4).</li>
<li>Make a copy of the directory MPEG4VideoDecoder under the 'filters' directory. Rename it to match your codec's name.</li>
<li>From the newly created directory, open MPEG4VideoDecoder.hpp and MPEG4VideoDecoder.cpp in your favorite text editor.</li>
<li>Do a search and replace "MPEG4" with the name of your codec. This includes all variable names, strings, etc.</li>
<li>At the top of the .cpp file, 'ALGNAME' is defined. This corresponds to the name of the codec on the DSP server image. Make sure you modify it to match the name of your codec, as defined in the server configuration file (server.cfg) of the server package.</li>
<li>At the top of the .cpp file, 'ENGINE_NAME' is defined. Make sure this matches the engine name you have chosen in your DSP server configuration file. If you have changed the name of the engine from the default one used in the DVSDK, you would need to perform the same change in the existing filters if you want them to continue to work.</li>
<li>Modify the functions involved in the filter connection process to accept/report the media types supported by your codec for both input and output of the filter: CheckInputType, CheckTransform, GetMediaType, SetMediaType. MSDN is a good resource if you need help dealing with media types in these functions.</li>
<li>Modify DecideBufferSize to allocate the right output buffer size. This is also where you can change the xDM parameters passed to the codec if necessary.</li>
<li>Recompile the newly created directory containing your filter.</li>
<li>Copy both your filter's codec-specific dll and the new server image (.x64P file) into the Release folder.</li>
<li>Modify the platform.reg file to add registry entries for your filter and its pins (you may wish to check out the existing entries for MPEG4 to get an idea of what to do)</li>
<li>Modify the platform.bib file to add bib entries for your new DLL and server image.</li>
<li>Rebuild your OS image. Your should now be able to run your codec as part of this new image.</li></ul></li>
<li>For all other xDM interfaces, you will need to study TIMM in detail and create some TIMM functions to talk to the xDM interface in question. For example, if you want to add support for the IAUDDEC1 interface, you will need to create an iauddec1.c and iauddec1.h file that make DMAI and Codec Engine calls to invoke the codec. Refer to DMAI and Codec Engine documentation on how to do this. Then recompile TIMM and write the codec-specific DirectShow filter dll that calls into your TIMM API. Given the nature of your codec may be very different from an 'IVIDDEC2' video codec, your filter may also look very different from the existing ones. If you are new to DirectShow you may wish to stick to the transform filter model (i.e. use CTransformFilter as a base class) as it is simpler to use.</li></ul>
<h2><span class="mw-headline" id="Summary">Summary</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=26" title="Edit section: Summary">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>TI's DirectShow filters provide the WinCE DirectShow framework with access to the DSP for acceleration of multimedia processing in the WinCE Media Player. This access is enabled by TI's traditional DMAI/Codec Engine software stack. In general, the filter code can also be used as an example of how to leverage DMAI and Codec Engine in the context of DirectShow in order to run any algorithm on the DSP.
</p>
<h2><span class="mw-headline" id="Useful_Resources">Useful Resources</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit&amp;section=27" title="Edit section: Useful Resources">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>DirectShow overview: <a rel="nofollow" class="external free" href="http://msdn.microsoft.com/en-us/library/ms778824(VS.85).aspx">http://msdn.microsoft.com/en-us/library/ms778824(VS.85).aspx</a></li>
<li>Transform filters overview: <a rel="nofollow" class="external free" href="http://msdn.microsoft.com/en-us/library/aa921464.aspx">http://msdn.microsoft.com/en-us/library/aa921464.aspx</a></li>
<li>How directshow filters are registered in a system: <a rel="nofollow" class="external free" href="http://msdn.microsoft.com/en-us/library/ms783789(VS.85).aspx">http://msdn.microsoft.com/en-us/library/ms783789(VS.85).aspx</a> and <a rel="nofollow" class="external free" href="http://msdn.microsoft.com/en-us/library/aa918244.aspx">http://msdn.microsoft.com/en-us/library/aa918244.aspx</a></li>
<li>Microsoft DirectShow forums: <a rel="nofollow" class="external free" href="http://social.msdn.microsoft.com/Forums/en-US/windowsdirectshowdevelopment/threads">http://social.msdn.microsoft.com/Forums/en-US/windowsdirectshowdevelopment/threads</a></li>
<li>Codec Engine overview: <a href="Codec_Engine.html" title="Codec Engine">Codec_Engine</a></li>
<li>DMAI (Davinci Multimedia Application Interface) overview: <a href="DMAI.html" class="mw-redirect" title="DMAI">DMAI</a></li></ul>

<!-- 
NewPP limit report
Cached time: 20201130124203
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.096 seconds
Real time usage: 0.103 seconds
Preprocessor visited node count: 142/1000000
Preprocessor generated node count: 192/1000000
Postexpand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip postexpand size: 12118/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:3855-0!canonical and timestamp 20201130124203 and revision id 181703
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>TI DirectShow Filters</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>TI DirectShow Filters</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>TI DirectShow Filters</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>TI DirectShow Filters</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>TI DirectShow Filters</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>TI DirectShow Filters</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>TI DirectShow Filters</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>TI DirectShow Filters</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>TI DirectShow Filters</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;oldid=181703">https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;oldid=181703</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category_WinCE.html" title="Category:WinCE">WinCE</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=TI+DirectShow+Filters" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="TI_DirectShow_Filters.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:TI_DirectShow_Filters&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="TI_DirectShow_Filters.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/TI_DirectShow_Filters.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/TI_DirectShow_Filters.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;oldid=181703" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=TI_DirectShow_Filters&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 15 July 2014, at 19:24.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.096","walltime":"0.103","ppvisitednodes":{"value":142,"limit":1000000},"ppgeneratednodes":{"value":192,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":12118,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20201130124203","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":229});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/TI_DirectShow_Filters by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 04:21:22 GMT -->
</html>
