<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from processors.wiki.ti.com/index.php/AM35x-VPFE-Software-Application_Notes by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 06:21:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>AM35x-VPFE-Software-Application Notes - Texas Instruments Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"AM35x-VPFE-Software-Application_Notes","wgTitle":"AM35x-VPFE-Software-Application Notes","wgCurRevisionId":218059,"wgRevisionId":218059,"wgArticleId":6679,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["AM437x","AM335x","AM35x","AM37x","AM1x","AM18x"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"AM35x-VPFE-Software-Application_Notes","wgRelevantArticleId":6679,"wgRequestId":"0dc2c5f1c969e333d09d101d","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":["sysop"],"wgRestrictionMove":["sysop"]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@19o3a1s",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://processors.wiki.ti.com/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.31.6"/>
<link rel="shortcut icon" href="https://processors.wiki.ti.com/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://processors.wiki.ti.com/opensearch_desc.php" title="Texas Instruments Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://processors.wiki.ti.com/api.php?action=rsd"/>
<link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Texas Instruments Wiki Atom feed" href="https://processors.wiki.ti.com/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=Vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-AM35x-VPFE-Software-Application_Notes rootpage-AM35x-VPFE-Software-Application_Notes skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="siteNotice" class="mw-body-content"><div id="localNotice" lang="en" dir="ltr"><div class="mw-parser-output"><p><br />
<span style="color:#ff0000"><b>NOTICE: The Processors Wiki will End-of-Life on January 15, 2021. It is recommended to download any files or other content you may need that are hosted on processors.wiki.ti.com. The site is now set to read only.</b></span>
</p></div></div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">AM35x-VPFE-Software-Application Notes</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">From Texas Instruments Wiki</div>				<div id="contentSub"></div>
								<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-head">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><a href="File_TIBanner.html" class="image"><img alt="TIBanner.png" src="https://processors.wiki.ti.com/images/c/cd/TIBanner.png" width="667" height="87" /></a>
</p><p><b><big><big><big><span style="color:red">Content is no longer maintained and is being kept for reference only!</span></big></big></big></b>
<br />
<br />
</p><p><b>AM35x VPFE Software Application Note</b>  
</p><p><br />
</p>
<div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Read_This_First"><span class="tocnumber">1</span> <span class="toctext"><b>Read This First</b></span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#About_this_Manual"><span class="tocnumber">1.1</span> <span class="toctext"><b>About this Manual</b></span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#References"><span class="tocnumber">1.2</span> <span class="toctext"><b>References</b></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#VPFE_Hardware_Block_Diagram"><span class="tocnumber">2</span> <span class="toctext"><b>VPFE Hardware Block Diagram</b></span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Features_Supported"><span class="tocnumber">2.1</span> <span class="toctext"><b>Features Supported</b></span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#CCDC"><span class="tocnumber">2.2</span> <span class="toctext"><b>CCDC</b></span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Interrupt_Capabilities"><span class="tocnumber">2.3</span> <span class="toctext"><b>Interrupt Capabilities</b></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Software_Architecture"><span class="tocnumber">3</span> <span class="toctext"><b>Software Architecture</b></span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#Interfacing_BT656_compatible_device_to_AM3517_CCDC"><span class="tocnumber">3.1</span> <span class="toctext"><b>Interfacing BT656 compatible device to AM3517 CCDC</b></span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Interfacing_RAW.2FRGB_Sensor_device_to_AM3517_CCDC"><span class="tocnumber">3.2</span> <span class="toctext"><b>Interfacing RAW/RGB Sensor device to AM3517 CCDC</b></span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#Sensor_interfacing_with_AM3517"><span class="tocnumber">3.2.1</span> <span class="toctext"><b>Sensor interfacing with AM3517</b></span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#Image_Processing_inside_AM3517_VPFE"><span class="tocnumber">3.2.2</span> <span class="toctext"><b>Image Processing inside AM3517 VPFE</b></span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Software_Change"><span class="tocnumber">3.2.3</span> <span class="toctext"><b>Software Change</b></span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Read_This_First"><b>Read This First</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=1" title="Edit section: Read This First">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p><b><big><big><big><span style="color:red">Content is no longer maintained and is being kept for reference only!</span></big></big></big></b>
<br />
<br />
</p>
<h2><span class="mw-headline" id="About_this_Manual"><b>About this Manual</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=2" title="Edit section: About this Manual">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This document describes all the internal details which driver developer should refer to for writing any sensor/camera/decoder slave driver for Texas Instruments'
AM3517 platform running Linux.
</p><p>The PSP (Platform Support Package) provides a fundamental software platform for development, which includes support for on-board Video Decoder (TVP5146) and known couple of sensors. Most of the time it always happen that customer would like to use various sensors based on their use-case, so this documents serves the starting point for all such customers/developers who wanted to add support for various sensor available.
</p><p>The document also provides detailed description of Video Decoder driver (based on TVP5146) as implemented in the PSP.
</p>
<h2><span class="mw-headline" id="References"><b>References</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=3" title="Edit section: References">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a rel="nofollow" class="external text" href="http://focus.ti.com/docs/prod/folders/print/am3517.html">http://focus.ti.com/docs/prod/folders/print/am3517.html</a>
</p>
<h1><span class="mw-headline" id="VPFE_Hardware_Block_Diagram"><b>VPFE Hardware Block Diagram</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=4" title="Edit section: VPFE Hardware Block Diagram">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>The video processing subsystem (VPSS) includes a video processing front-end (VPFE) controller, which is
the video input portion of the processor. The VPFE controller receives input video/image data from
external capture devices and stores it to external memory. A built-in DMA engine transfers the capture
data into the external memory. An internal buffer block provides a high bandwidth path between the VPSS
module and the external memory.
</p><p><br />
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:870px;"><a href="File_Vpfe-ccdc-block-diagram.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/b/b4/Vpfe-ccdc-block-diagram.PNG" width="868" height="564" class="thumbimage" /></a>  <div class="thumbcaption"><b>AM3517 VPFE/CCDC block diagram</b></div></div></div></div>
<p><br />
</p>
<h2><span class="mw-headline" id="Features_Supported"><b>Features Supported</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=5" title="Edit section: Features Supported">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Supports conventional Bayer pattern and Foveon sensor formats.</li>
<li>Can be programmed to synchronize to the external horizontal/vertical sync and field ID signals with various timings.</li>
<li>Supports progressive and interlaced sensors.</li>
<li>Supports the REC656/CCIR-656 standard.</li>
<li>Supports YCbCr 422 format, either 8-bit or 16-bit with discrete horizontal and vertical sync signals.</li>
<li>Has built-in digital clamping and black level compensation.</li>
<li>10-bit to 8-bit A-law compression hardware is provided.</li>
<li>Max pixel clock is 75 MHz.</li>
<li>Supports up to 16K pixels (image size) in both the horizontal and vertical directions.</li></ul>
<h2><span class="mw-headline" id="CCDC"><b>CCDC</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=6" title="Edit section: CCDC">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>CCDC is front end to the all external device interface like Video Decoder and sensors. The shared buffer logic is unique block, which acts as the primary source to the CCDC module that is sending data to the SDRAM/DDRAM. In order to efficiently utilize the external SDRAM/DDRAM bandwidth and to absorb the large latency that can be seen in a DDR memory system. The shared buffer
logic/memory interfaces with the DMA system via a high bandwidth bus (32-bit wide). The shared buffer logic/memory also interfaces with the CCDC module via a 32-bit wide bus. The shared buffer logic/memory divided into the write buffer and arbitration logic.
</p><p>Each request going out to the SDR/DDR EMIF is up to a transfer of 256 bytes. CCDC has its own buffer of 1024 bytes to absorb latency.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Interrupt_Capabilities"><b>Interrupt Capabilities</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=7" title="Edit section: Interrupt Capabilities">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>AM3517 CCDC is capable of generating interrupts to main CPU (ARM) for the following events,
</p>
<ul><li>After receiving the number of horizontal lines(VDIN_HD pulse signals) set in the VDINT0 bit in the VDINT register. (CCDC_VD0_INT)</li>
<li>After receiving the number of horizontal lines(VDIN_HD pulse signals) set in the VDINT1 bit in the VDINT register. (CCDC_VD1_INT)</li>
<li>On External write-enable signal (VDIN_WEN) via external pin (CCDC_VD2_INT)</li></ul>
<p><br />
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:626px;"><a href="File_Ccdc-vd0-1-interrupt.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/9/9e/Ccdc-vd0-1-interrupt.PNG" width="624" height="331" class="thumbimage" /></a>  <div class="thumbcaption"><b>CCDC VD0 &amp; VD1 interrupt generation with respect VD polarity</b></div></div></div></div>
<p><br />
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:607px;"><a href="File_Ccdc-vd2-interrupt.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/6/61/Ccdc-vd2-interrupt.PNG" width="605" height="217" class="thumbimage" /></a>  <div class="thumbcaption"><b>CCDC VD2 interrupt generation with respect to external write enable event</b></div></div></div></div>
<p><br />
</p>
<h1><span class="mw-headline" id="Software_Architecture"><b>Software Architecture</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=8" title="Edit section: Software Architecture">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Linux driver for AM3517 VPFE is based on standard Video4Linux sub-device framework, which provides Master-Slave architecture to seamless multiple sensor/decoder interface to single master driver. 
</p><p><br />
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:722px;"><a href="File_Vpfe-sw-arch.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/4/44/Vpfe-sw-arch.PNG" width="720" height="313" class="thumbimage" /></a>  <div class="thumbcaption"><b>V4L2 Sub-Device Architecture</b></div></div></div></div>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:401px;"><a href="File_Subdev-driver-init-seq.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/9/9f/Subdev-driver-init-seq.PNG" width="399" height="421" class="thumbimage" /></a>  <div class="thumbcaption"><b>V4L2 Sub Device Init Sequence</b></div></div></div></div>
<p><br />
So each Sensor AND/OR Decoder will have slave driver registering themselves to VPFE master driver. In case of AM3517 you can locate the source code under
</p><p>1 Master Driver - &lt;Linux Home Directory&gt;/drivers/media/video/davinci/vpfe.c
1 TVP5146 Slave Driver - &lt;Linux Home Directory&gt;/drivers/media/video/tvp514x.c
</p><p>Like wise, when we support any raw sensor (e.g. MT9V113) then the corresponding driver will be available under &lt;Linux Home Directory&gt;/drivers/media/video/mt9v113.c
</p><p><br />
</p>
<h2><span class="mw-headline" id="Interfacing_BT656_compatible_device_to_AM3517_CCDC"><b>Interfacing BT656 compatible device to AM3517 CCDC</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=9" title="Edit section: Interfacing BT656 compatible device to AM3517 CCDC">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section describes the image/data processing in the YUV or BT656 data mode.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:727px;"><a href="File_Ccdc-processing-yuv-mode.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/6/6f/Ccdc-processing-yuv-mode.PNG" width="725" height="355" class="thumbimage" /></a>  <div class="thumbcaption"><b>CCDC Image Processing - YUV/BT656 Mode</b></div></div></div></div>
<p><br />
AM3517 supports interfacing to the device (slave-device) which is capable of giving output in BT656 format either 10-bit or 8-bit. If the output is 10-bit BT656 then it is important to interface upper 8-bit output of slave-device to lower 8-bit of AM3517 CCDC input. The CCDC does support both 8 &amp; 10bit format but it becomes important pack it to 8-bit to get YUV422 data for further processing in software.
</p><p><br />
</p><p><b>NOTE (AM3517EVM Errata)</b>: On AM3517EVM the pins are connected one-to-one (TVP5146[0-9] =&gt; CCDC [0-9]), which leads to loss of color data, since CCDC reads lower 8-bit information and saves it to memory. The workaround implemented for this is, configure CCDC in raw mode, apply A-Law table to convert 10-bit data to 8-bit data and again apply reverse A-Law in application to get original colors. Please note that this workaround does consume significant amount of CPU cycles.
</p><p><br />
</p><p>AM3517 PSP SDK supports BT656 interface with on-board TVP5146 Video Decoder, below are the details,
</p>
<ul><li>Data pin interfacing - TVP5146 [0-9] =&gt; CCDC[0-9]</li>
<li>Pixel Clock - 27MHz adhering BT656 standard</li>
<li>Input Frame type - Interlacing fields adhering BT656 standard</li>
<li>Support for Control configuration - Brightness, Contrast, Hue and Gain control</li>
<li>Input interface support - Composite and S-Video Input</li>
<li>Input Standard - NTSC and PAL standard</li>
<li>External SYNC signals - not Applicable, since it CCDC works with Embedded sync signals</li>
<li>Interrupts being used - Only VD1 interrupt</li>
<li>Number of interrupts per Second -
<ul><li>NTSC Standard - @30FPS with 2 fields =&gt; 30 * 2 = 60 interrupts/sec</li>
<li>PAL Standard - @25FPS with 2 fields  =&gt; 25 * 2 = 50 interrupts/sec</li></ul></li></ul>
<p>Since the input stream is interlacing fields we have to use single buffer for both odd and even field. CCDC support seamless dumping of both the fields to the memory by configuring CCDC.SDOFST register.
</p><p><br />
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:595px;"><a href="File_Ccdc.sdofst.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/e/e1/Ccdc.sdofst.PNG" width="593" height="463" class="thumbimage" /></a>  <div class="thumbcaption"><b>CCDC De-Interlacing using SDOFST register configuration</b></div></div></div></div>
<p><br />
</p>
<h2><span id="Interfacing_RAW/RGB_Sensor_device_to_AM3517_CCDC"></span><span class="mw-headline" id="Interfacing_RAW.2FRGB_Sensor_device_to_AM3517_CCDC"><b>Interfacing RAW/RGB Sensor device to AM3517 CCDC</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=10" title="Edit section: Interfacing RAW/RGB Sensor device to AM3517 CCDC">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This section describes the image/data processing in the raw/RGB data mode.
</p>
<h3><span class="mw-headline" id="Sensor_interfacing_with_AM3517"><b>Sensor interfacing with AM3517</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=11" title="Edit section: Sensor interfacing with AM3517">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:638px;"><a href="File_Am3517-ccdc-sensor-interface.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/8/8a/Am3517-ccdc-sensor-interface.PNG" width="636" height="315" class="thumbimage" /></a>  <div class="thumbcaption"><b>CCDC interface to sensor in Raw/RGB mode</b></div></div></div></div>
<h3><span class="mw-headline" id="Image_Processing_inside_AM3517_VPFE"><b>Image Processing inside AM3517 VPFE</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=12" title="Edit section: Image Processing inside AM3517 VPFE">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:741px;"><a href="File_Ccdc-processing-raw-mode.html" class="image"><img alt="" src="https://processors.wiki.ti.com/images/6/68/Ccdc-processing-raw-mode.PNG" width="739" height="111" class="thumbimage" /></a>  <div class="thumbcaption"><b>CCDC Image Processing - RAW/RGB Mode</b></div></div></div></div>
<p><br />
AM3517 supports interfacing to the device (slave-device) in raw mode configurable between 8-bit and 16-bit. In raw mode user can use image processing features like, black clamping, A-Law compression, etc... Please refer to the above block diagram.
</p><p><br />
</p>
<ul><li>Sensor - MT9T111 (3M pixel Sensor)</li>
<li>Data pin interfacing - Sensor [0-15] =&gt; CCDC[0-15]</li>
<li>Pixel Clock - TBD</li>
<li>Input Frame type - Progressive</li>
<li>Support for Control configuration - TBD</li>
<li>Input interface support - RAW/RGB mode</li>
<li>Input Resolution - TBD</li>
<li>Interrupts being used - Only VD1 interrupt</li>
<li>External SYNC signals - Both HS and VS is being used.</li></ul>
<p><br />
</p>
<h3><span class="mw-headline" id="Software_Change"><b>Software Change</b></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;section=13" title="Edit section: Software Change">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Driver Files -
</p>
<pre>Bridge/Master Driver -
&lt;kernel home directory&gt;/drivers/media/video/ti-media/vpfe_capture.c

CCDC Driver -
&lt;kernel home directory&gt;/drivers/media/video/ti-media/dm644x_ccdc.c

Sensor Driver -
&lt;kernel home directory&gt;/drivers/media/video/&lt;sensor&gt;.c
</pre>
<p>The AM3517 V4L2 driver follows Sub-Device Framework, so the sensor driver under discussion here supposed to follow sub-device framework. Please refer to the tvp514x.c file for more details on sub-device driver operations.
</p><p>The VPFE CCDC driver code does support both raw (bayer) and YUV format, but has not been validated against any sensor device. 
In raw (bayer) mode is supports following pixel format -
</p>
<ul><li>SBGGR8</li>
<li>SBGGR16</li></ul>
<p>In YUV mode it does support (8-bit) -
</p>
<ul><li>UYVY</li>
<li>YUYV</li></ul>
<p>In order to add support for Raw/RGB sensor, please follow below steps -
</p><p><b>NOTE:</b> Please note that the below description assumes that you have sub-device (slave) driver ready for your respective sensor configured in Raw/RGB mode.
</p><p>- Board Hookup configuration -
</p>
<ul><li>Include following header file in your board-xxx.c file</li></ul>
<ol><li>include &lt;media/ti-media/vpfe_capture.h&gt;</li></ol>
<ul><li>Define struct vpfe_subdev_info to register your sub-device to VPFE driver -</li></ul>
<p>E.g -
</p>
<pre>static struct vpfe_subdev_info vpfe_sub_devs[] = {
    {
        .name           = "mt9t111",
        .grp_id         = 0,
        .num_inputs     = 0,
        .can_route      = 0,
        .ccdc_if_params = {
            .if_type = VPFE_RAW_BAYER,
            .hdpol   = VPFE_PINPOL_POSITIVE,
            .vdpol   = VPFE_PINPOL_POSITIVE,
         },
         .board_info     = {
            I2C_BOARD_INFO("mt9t111", &lt;i2c addr&gt;),
            .platform_data = &amp;mt9t111_pdata,
         },
    },
};
</pre>
<p>Please note that above parameters are board specific and user should change based on their board interface schema.
</p><p>There are some gaps in CCDC driver which have to be fixed for raw/RGB mode,
</p><p>The function "<i>ccdc_set_hw_if_params</i>" doesn't support raw mode configuration, you have to change this function to support it. Rest of the configuration should happen automatically.
</p><p><br />
<b>NOTE</b>: The above information is created by code walk-in, so might require some more modifications ontop of above changes.
</p>
<div style="padding:5px; background: #eeeeee; color: #348017">
<p><b>Important</b><br />
Please note that We are in the process of adding couple of sensors (in RAW/RGB mode) to the AM3517, so I will update this page for further details once we are done with this.
</p>
</div>

<!-- 
NewPP limit report
Cached time: 20201130084336
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.069 seconds
Real time usage: 0.076 seconds
Preprocessor visited node count: 63/1000000
Preprocessor generated node count: 114/1000000
Post‐expand include size: 116/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 796/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    1.582      1 Template:Sitara_Devices
100.00%    1.582      1 -total
-->
</div>
<!-- Saved in parser cache with key procwiki:pcache:idhash:6679-0!canonical and timestamp 20201130084335 and revision id 218059
 -->
<div class='hf-nsfooter' id='hf-nsfooter-'><table style="text-align:center; background:white; width:100%; text-align:left; height: 65px border-top: 1px solid; border-bottom: 1px solid; border-left: 1px solid; border-right: 1px solid; border-width: 1px; border-style: solid;">
<tr>
<td width="305px"><a href="File_E2e.html" class="image"><img alt="E2e.jpg" src="https://processors.wiki.ti.com/images/8/82/E2e.jpg" width="305" height="63" /></a>
</td>
<td>{{
<ol><li>switchcategory:MultiCore=</li></ol>
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>AM35x-VPFE-Software-Application Notes</b> here.<i></i>
</p>
</td>
<td>Keystone=
<ul><li>For technical support on MultiCore devices, please post your questions in the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/default.aspx">C6000 MultiCore Forum</a></li>
<li>For questions related to the BIOS MultiCore SDK (MCSDK), please use the <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/embedded/f/355.aspx">BIOS Forum</a></li></ul>
<p>Please post only comments related to the article <b>AM35x-VPFE-Software-Application Notes</b> here.<i></i>
</p>
</td>
<td>C2000=<i>For technical support on the C2000 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/tms320c2000_32-bit_real-time_mcus/f/171.aspx">The C2000 Forum</a>. Please post only comments about the article <b>AM35x-VPFE-Software-Application Notes</b> here.</i>
</td>
<td>DaVinci=<i>For technical support on DaVincoplease post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/davinci_digital_media_processors/default.aspx">The DaVinci Forum</a>. Please post only comments about the article <b>AM35x-VPFE-Software-Application Notes</b> here.</i>
</td>
<td>MSP430=<i>For technical support on MSP430 please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/default.aspx">The MSP430 Forum</a>. Please post only comments about the article <b>AM35x-VPFE-Software-Application Notes</b> here.</i>
</td>
<td>OMAP35x=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>AM35x-VPFE-Software-Application Notes</b> here.</i>
</td>
<td>OMAPL1=<i>For technical support on OMAP please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/dsp/omap_applications_processors/default.aspx">The OMAP Forum</a>. Please post only comments about the article <b>AM35x-VPFE-Software-Application Notes</b> here.</i>
</td>
<td>MAVRK=<i>For technical support on MAVRK please post your questions on <a rel="nofollow" class="external text" href="http://e2e.ti.com/support/development_tools/mavrk/default.aspx">The MAVRK Toolbox Forum</a>. Please post only comments about the article <b>AM35x-VPFE-Software-Application Notes</b> here.</i>
</td>
<td><i>For technical support please post your questions at <a rel="nofollow" class="external text" href="http://e2e.ti.com/">http://e2e.ti.com</a>. Please post only comments about the article <b>AM35x-VPFE-Software-Application Notes</b> here.</i>
<p>}}
</p>
</td></tr></table>
<table style="border-style:solid; border-width:1px; text-align:center; width:100%;">

<tr style="font-size:150%;">
<td rowspan="2"><a href="File_Hyperlink_blue.html" class="image"><img alt="Hyperlink blue.png" src="https://processors.wiki.ti.com/images/9/9f/Hyperlink_blue.png" width="96" height="96" /></a>
</td>
<td><b>Links</b>
</td></tr>
<tr>
<td>
<table style="text-align: left;">
<tr>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/amplifier_and_linear.page">Amplifiers &amp; Linear</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/audio/audio_overview.page">Audio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/rfif.page">Broadband RF/IF &amp; Digital Radio</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/clocksandtimers/clocks_and_timers.page">Clocks &amp; Timers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/dataconverters/data_converter.page">Data Converters</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/mems/mems.page">DLP &amp; MEMS</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/high_reliability.page">High-Reliability</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/interface/interface.page">Interface</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/logic/home_overview.page">Logic</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/powermanagement/power_portal.page">Power Management</a>
</p>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/embedded_processor.page">Processors</a>
</p>
<ul><li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/arm.page">ARM Processors</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/dsp/home.page">Digital Signal Processors (DSP)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/microcontroller/home.page">Microcontrollers (MCU)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/omap-applications-processors/the-omap-experience.page">OMAP Applications Processors</a></li></ul>
</td>
<td style="padding-right: 10px; vertical-align: top;">
<p><a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/switches_and_multiplexers.page">Switches &amp; Multiplexers</a><br/>
<a rel="nofollow" class="external text" href="http://www.ti.com/lsds/ti/analog/temperature_sensor.page">Temperature Sensors &amp; Control ICs</a><br/>
<a rel="nofollow" class="external text" href="http://focus.ti.com/wireless/docs/wirelessoverview.tsp?familyId=2003&amp;sectionId=646&amp;tabId=2735">Wireless Connectivity</a>
</p>
</td></tr></table>
</td></tr></table>
<div id="tiPrivacy"></div>
</div></div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;oldid=218059">https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;oldid=218059</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Categories</a>: <ul><li><a href="Category_AM437x.html" title="Category:AM437x">AM437x</a></li><li><a href="Category_AM335x.html" title="Category:AM335x">AM335x</a></li><li><a href="Category_AM35x.html" title="Category:AM35x">AM35x</a></li><li><a href="Category_AM37x.html" title="Category:AM37x">AM37x</a></li><li><a href="Category_AM1x.html" title="Category:AM1x">AM1x</a></li><li><a href="Category_AM18x.html" title="Category:AM18x">AM18x</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-login"><a href="https://processors.wiki.ti.com/index.php?title=Special:UserLogin&amp;returnto=AM35x-VPFE-Software-Application+Notes" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li><li id="pt-createaccount"><a href="Special_RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory">Request account</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="AM35x-VPFE-Software-Application_Notes.html" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://processors.wiki.ti.com/index.php?title=Talk:AM35x-VPFE-Software-Application_Notes&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="AM35x-VPFE-Software-Application_Notes.html">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
						<h3 id="p-cactions-label"><span>More</span></h3>
						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="https://processors.wiki.ti.com/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search Texas Instruments Wiki" title="Search Texas Instruments Wiki [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="Main_Page.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-All-pages"><a href="Special_AllPages.html">All pages</a></li><li id="n-All-categories"><a href="Special_Categories.html">All categories</a></li><li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="Package_Reflow_Profiles.html" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Toolbox</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/AM35x-VPFE-Software-Application_Notes.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/AM35x-VPFE-Software-Application_Notes.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;oldid=218059" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://processors.wiki.ti.com/index.php?title=AM35x-VPFE-Software-Application_Notes&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 28 June 2016, at 13:16.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="Project_Privacy_policy.html" title="Project:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="Project_About.html" title="Project:About">About Texas Instruments Wiki</a></li>
								<li id="footer-places-disclaimer"><a href="Project_General_disclaimer.html" title="Project:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-termsofservice"><a href="Project_Terms_of_Service.html" title="Project:Terms of Service">Terms of Use</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="https://processors.wiki.ti.com/resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"/></a>					</li>
										<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="https://processors.wiki.ti.com/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.069","walltime":"0.076","ppvisitednodes":{"value":63,"limit":1000000},"ppgeneratednodes":{"value":114,"limit":1000000},"postexpandincludesize":{"value":116,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":796,"limit":5000000},"timingprofile":["100.00%    1.582      1 Template:Sitara_Devices","100.00%    1.582      1 -total"]},"cachereport":{"timestamp":"20201130084336","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":229});});</script>
	</body>

<!-- Mirrored from processors.wiki.ti.com/index.php/AM35x-VPFE-Software-Application_Notes by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Dec 2020 06:22:01 GMT -->
</html>
